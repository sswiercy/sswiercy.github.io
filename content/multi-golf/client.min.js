const client={params:{parse:function(e,t){const n=client.params.QUERY.get(e);if(n)return t(n)},parseString:function(e){return client.params.parse(e,game.utility.identity)},parseBoolean:function(e){return client.params.parse(e,(function(e){switch(e){case"false":return!1;case"true":return!0;default:throw new Error("Not a valid boolean")}}))},parseInteger:function(e){return client.params.parse(e,(function(e){return game.utility.parseNumber(parseInt,e)}))},parseFloat:function(e){return client.params.parse(e,(function(e){return game.utility.parseNumber(parseFloat,e)}))},additional:function(e){return[window.location.origin,window.location.pathname,"?",new URLSearchParams(game.utility.mergeObjects([game.utility.collection.map.object(client.params.QUERY),e]))].join("")},QUERY:new URLSearchParams(window.location.search)},network:{handlers:{login:{Opening:function(e,t){this.procedureSocket=e,this.form=t},Main:function(e,t,n){this.procedureSocket=e,this.reference=t,this.form=n}},lobby:{Main:function(e){this.connection=e},NameChanging:function(e,t){this.connection=e,this.form=t},SessionCreating:function(e,t){this.connection=e,this.form=t},SessionJoining:function(e,t,n,i){this.session=e,this.form=t,this.reference=n,this.unknownHandler=i}},session:{Main:function(e,t,n,i){this.member=e,this.sessionForm=t,this.disableHandler=n,this.closeHandler=i,this.update()},Leaving:function(e){this.main=e}},game:{Starting:function(e,t,n,i){this.launcher=e,this.course=t,this.startCallable=n,this.endCallable=i},Main:function(e,t,n,i){this.session=e,this.course=t,this.state=n,this.cancel=i}},Registration:function(e,t){this.procedureSocket=e,this.form=t}},offline:{ProcedureSocket:{send:function(e){}},Connection:function(e,t){this.procedureSocket=e,this.player=t},Session:function(e){this.connection=e}},queues:{Instant:function(){},Delayed:function(e,t){this.minDelay=e,this.maxDelay=t,this.data=[]}},ProcedureSocket:function(e,t){this.socket=e,this.mapper=t,this.outQueue=client.network.queues.build(),this.inQueue=client.network.queues.build(),this.register()},Connection:function(e,t){this.procedureSocket=e,this.player=t},Session:function(e,t){this.connection=e,this.key=t},Member:function(e,t){this.session=e,this.idToPlayer=new Map([e.connection.player].concat(t).map((function(e){return[e.id,e]}))),game.utility.assert(this.idToPlayer.size==t.length+1,"Duplicate player IDs")},Launcher:function(e,t,n){this.session=e,this.reference=t,this.frame=n,this.queue=[]}},form:{utility:{singleElement:function(e){return game.utility.assert(1==e.length,"Not a single element"),e[0]},singleOfTag:(e,t)=>client.form.utility.singleElement(e.getElementsByTagName(t)),singleOfClass:(e,t)=>client.form.utility.singleElement(e.getElementsByClassName(t)),open:function(e){return e.enable(),e.show(),e},close:function(e,t){e.unregister(),e.disable(),e.hide(t)},transition:function(e,t){client.form.utility.close(e,(function(){client.form.utility.open(t)}))},fade:function(e,t,n){function i(n){n.stopPropagation(),delete e._transition,e.removeEventListener("transitionend",i),t&&t()}e._transition&&e.removeEventListener("transitionend",e._transition),e._transition=i,e.addEventListener("transitionend",i),e.style.setProperty("opacity",n)},hide:function(e,t){client.form.utility.fade(e,(function(){e.style.setProperty("visibility","hidden"),t&&t()}),0)},hideDisplay:function(e,t){client.form.utility.hide(e,(function(){e.style.removeProperty("display"),t&&t()}))},show:function(e,t){e.style.setProperty("visibility","visible"),client.form.utility.fade(e,t,1)},showDisplay:function(e,t){e.style.setProperty("display","block"),e.focus(),client.form.utility.show(e,t)},selfColumns:function(e,t){return t?e.map((function(e){return['<span class="self">',"</span>"].join(e)})):e},playerNameId:function(e){return[e.name,' <span class="id">(',e.id,")</span>"].join("")},playerRating:function(e){const t=e.ratingAdjustment(),n=[e.player.rating," "];return t>0&&n.push('<span class="rating positive">(+',t,")</span>"),t<0&&n.push('<span class="rating negative">(',t,")</span>"),0==t&&n.push('<span class="rating zero">(&plusmn;0)</span>'),n.join("")}},inputs:{playerName:function(e,t){return new client.form.Input(e,t,(function(e){if(!game.constraints.string.isPlayerName(e))return"1 to "+game.constraints.string.PLAYER_NAME_MAX_LENGTH+" characters from A-Z, a-z, 0-9 and _"}),game.constraints.string.PLAYER_NAME_MAX_LENGTH)},playerKey:function(e,t){return new client.form.Input(e,t,(function(e){if(!game.constraints.string.isPlayerKey(e))return game.constraints.string.PLAYER_KEY_LENGTH+" characters from A to Z"}),game.constraints.string.PLAYER_KEY_LENGTH)},sessionKey:function(e,t){return new client.form.Input(e,t,(function(e){if(!game.constraints.string.isSessionKey(e))return game.constraints.string.SESSION_KEY_LENGTH+" characters from a to z"}),game.constraints.string.SESSION_KEY_LENGTH)}},menu:{registration:function(){const e=document.getElementById("registration"),t=client.form.utility.singleOfClass(e,"primary"),n=new client.form.Parent(e,new client.form.Multi([client.form.inputs.playerName(client.form.utility.singleOfTag(e,"div"),t),new client.form.Button(t,(function(){n.validate()&&(n.disable(),client.network.handlers.Registration.handle(client.network.ProcedureSocket.open(),n))})),new client.form.Button(client.form.utility.singleOfClass(e,"secondary"),(function(){client.form.utility.transition(n,client.form.menu.login())}))]));return n},login:function(){const e=document.getElementById("login"),t=client.form.utility.singleOfClass(e,"primary"),n=client.form.inputs.playerKey(client.form.utility.singleOfTag(e,"div"),t);n.restore(client.network.handlers.login.Main.LOCAL_STORAGE_KEY);const i=new client.form.Parent(e,new client.form.Multi([n,new client.form.Button(t,(function(){i.validate()&&(i.disable(),client.network.handlers.login.Opening.handle(client.network.ProcedureSocket.open(),i))})),new client.form.Button(client.form.utility.singleOfClass(e,"secondary"),(function(){client.form.utility.transition(i,client.form.menu.registration())}))]));return i},loginIfExists:function(){var e=client.form.menu.login();return 0==e.form.forms[0].get().length&&(e.unregister(),e=client.form.menu.registration()),e},lobby:function(e){var t;const n=document.getElementById("lobby"),i=client.form.utility.singleOfClass(document.getElementById("lobby-name"),"value"),r=client.form.utility.singleOfClass(document.getElementById("lobby-key"),"value"),o=client.form.utility.singleOfClass(document.getElementById("lobby-id"),"value"),a=client.form.utility.singleOfClass(document.getElementById("lobby-rating"),"value"),l=client.form.utility.singleOfClass(document.getElementById("lobby-registration"),"value"),s=document.getElementById("lobby-toggle-key");function c(){r.innerHTML="&#9679;".repeat(game.constraints.string.PLAYER_KEY_LENGTH),s.textContent="Show Key",s.classList.remove("primary"),s.classList.add("secondary"),t=!1}i.textContent=e.player.name,o.textContent=e.player.id,a.textContent=e.player.rating,l.textContent=new Date(e.player.timestamps.registration).toLocaleString(),c();const u=new client.form.Parent(n,new client.form.Multi([new client.form.Button(document.getElementById("lobby-change-name"),(function(){client.form.utility.transition(u,client.form.menu.nameChange(e))})),new client.form.Button(s,(function(){t?c():(r.textContent=e.player.key,s.textContent="Hide Key",s.classList.remove("secondary"),s.classList.add("primary"),t=!0)})),new client.form.Button(document.getElementById("lobby-create-session"),(function(){u.disable(),e.handleSessionCreating(u),e.procedureSocket.send(game.network.Procedure.TREE.LOBBY.CREATE.REQUEST.bind())})),new client.form.Button(document.getElementById("lobby-join-session"),(function(){e.toSessionJoin(u)})),new client.form.Button(document.getElementById("lobby-log-out"),(function(){e.procedureSocket.socket.close(),client.form.utility.transition(u,client.form.menu.login())}))]));return u},nameChange:function(e){const t=document.getElementById("name-change"),n=client.form.utility.singleOfClass(t,"primary"),i=client.form.inputs.playerName(client.form.utility.singleOfTag(t,"div"),n);i.set(e.player.name);const r=new client.form.Parent(t,new client.form.Multi([i,new client.form.Button(n,(function(){r.validate()&&(r.disable(),e.handleNameChanging(r),e.procedureSocket.send(game.network.Procedure.TREE.LOBBY.NAME.CHANGE.REQUEST.bind(i.get())))})),new client.form.Button(client.form.utility.singleOfClass(t,"secondary"),(function(){r.disable(),e.toLobby(r)}))]));return r},sessionJoin:function(e){const t=document.getElementById("session-join"),n=client.form.utility.singleOfClass(t,"primary"),i=client.form.inputs.sessionKey(client.form.utility.singleOfTag(t,"div"),n),r=new client.form.Parent(t,new client.form.Multi([i,new client.form.Button(n,(function(){r.validate()&&(r.disable(),e.toSession(r,i.get(),(function(){r.enable(),i.showValidation(client.form.menu.SESSION_UNKNOWN_MESSAGE)})))})),new client.form.Button(client.form.utility.singleOfClass(t,"secondary"),(function(){r.disable(),e.toLobby(r)}))]));return r},session:function(e){const t=document.getElementById("session"),n=document.getElementById("session-key");client.form.utility.singleOfClass(n,"value").textContent=e.key;const i=new client.form.Parent(t,new client.form.Multi([new client.form.Button(document.getElementById("session-copy"),(function(){navigator.clipboard.writeText(client.params.additional({sessionKey:e.key})).then((function(){n.classList.remove("off"),n.classList.add("on"),n.focus(),n.classList.add("off"),n.classList.remove("on")})).catch((function(e){console.error("Failed to copy to clipboard",e),alert("Could not copy join link to clipboard. Please copy session key manually.")}))})),new client.form.Table(client.form.utility.singleOfTag(t,"table")),new client.form.Button(document.getElementById("session-leave"),(function(){i.disable(),e.connection.procedureSocket.handler.handleLeaving(),e.connection.procedureSocket.send(game.network.Procedure.TREE.SESSION.LEAVE.SELF.REQUEST.bind())})),new client.form.Button(document.getElementById("session-start"),(function(){i.disable(),e.connection.procedureSocket.send(game.network.Procedure.TREE.SESSION.START.REQUEST.bind())}))]));return i},sessionRanking:function(e,t,n){const i=document.getElementById("session-ranking"),r=game.network.PlayerResult.sort(n),o=r.findIndex((function(e){return e.some((function(e){return e.player.id==t.connection.player.id}))}));!function(){const e=document.getElementById("session-ranking-place");e.className=["first","second","third","last"][Math.min(o,3)],e.textContent=[o+1,["st","nd","rd","th"][Math.min(o,3)]," Place"].join("")}();const a=new client.form.Table(client.form.utility.singleOfTag(i,"table"));a.update(game.utility.array.flatten(r.map((function(e,n){return e.map((function(e){return client.form.utility.selfColumns([n+1,client.form.utility.playerNameId(e.player),e.strokes,client.form.utility.playerRating(e)],e.player.id==t.connection.player.id)}))}))));const l=new client.form.Parent(i,new client.form.Multi([a,new client.form.Button(document.getElementById("session-ranking-continue"),(function(){e.handler.disableHandler=function(){},e.handler.closeHandler=function(){l.hide()},client.form.utility.close(l,function(){const n=client.form.menu.session(t);e.handler.sessionForm=n,e.handler.disableHandler=function(){n.disable()},e.handler.closeHandler=function(){client.form.utility.close(n)},e.handler.update(),client.form.utility.open(n)}.bind(this))}))]),function(){if(n.length>1&&0==o)return client.webgl.confetti.run();const e=client.webgl.confetti.canvas();return e.style.setProperty("display","none"),function(){e.style.removeProperty("display")}}());return l},show:function(e){client.form.utility.show(document.getElementById("menu"),e)},hide:function(){client.form.utility.hide(document.getElementById("menu"))},transition:function(e){client.form.utility.open(e),client.form.menu.show((function(){document.getElementById("game").style.removeProperty("display")}))},SESSION_UNKNOWN_MESSAGE:"No session exists with this key"},game:{renderers:{empty:function(e){},multi:function(e){return function(t){e.forEach((function(e){e(t)}))}},display:function(e,t,n,i){var r;return function(o){const a=t(o);a!==r&&(a?e.style.setProperty("display","block"):e.style.removeProperty("display"),r=a),(a?n:i)(o)}},disabled:function(e,t){var n;return function(i){const r=t(i);r!==n&&(e.disabled=r,n=r)}},textContent:function(e,t){var n;return function(i){const r=t(i).toString();r!==n&&(e.textContent=r,n=r)}}},main:function(e){function t(e,t){return function(n){e.textContent=Math.round(100*n)+"%",t(Math.pow(client.controls.Mouse.SENSITIVITY.SCALE,2*n-1))}}const n=document.getElementById("game-menu"),i=n.getElementsByTagName("button"),r=n.getElementsByTagName("div")[0],o=document.getElementById("angle-sensitivity"),a=document.getElementById("distance-sensitivity"),l=document.getElementById("strength-sensitivity");return new client.form.Parent(n,new client.form.Multi([new client.form.Button(i[0],(function(){e.base.insertResetAction()})),new client.form.Button(i[1],(function(){r.style.opacity<.5?(i[1].className="primary",client.form.utility.showDisplay(r)):(i[1].className="secondary",client.form.utility.hideDisplay(r))})),new client.form.Range(o,"multi-golf-angle-sensitivity",t(o.parentElement.nextElementSibling,(function(t){e.sensitivity.angle=client.controls.Mouse.SENSITIVITY.CENTER.ANGLE.multiply(t)}))),new client.form.Range(a,"multi-golf-distance-sensitivity",t(a.parentElement.nextElementSibling,(function(t){e.sensitivity.distance=client.controls.Mouse.SENSITIVITY.CENTER.DISTANCE*t}))),new client.form.Range(l,"multi-golf-strength-sensitivity",t(l.parentElement.nextElementSibling,(function(t){e.sensitivity.strength=client.controls.Mouse.SENSITIVITY.CENTER.STRENGTH*t})))]))},open:function(){client.form.menu.hide(),document.getElementById("game").style.setProperty("display","block")}},Parent:function(e,t,n){this.element=e,this.form=t,this.handler=n},Multi:function(e){this.forms=e},Input:function(e,t,n,i){this.element=e,this.button=t,this.validator=n,this.maxLength=i,this.validation=client.form.utility.singleOfClass(e,"validation"),this.input=client.form.utility.singleOfTag(e,"input"),this.focusHandler=this.hideValidation.bind(this),this.keyupHandler=this.checkConfirm.bind(this),this.assert(),this.register(),this.set("")},Range:function(e,t,n){this.element=e,this.key=t,this.handler=n,this.min=parseFloat(e.getAttribute("min")||"0"),this.max=parseFloat(e.getAttribute("max")||"100"),this.step=parseFloat(e.getAttribute("step")||"1"),this.inputHandler=this.update.bind(this),this.changeHandler=this.store.bind(this),this.register(),this.set(this.default()),this.restore(),this.update()},Button:function(e,t){this.element=e,this.handler=t,this.register()},Table:function(e){this.element=e,this.thead=client.form.utility.singleOfTag(e,"thead"),this.tbody=client.form.utility.singleOfTag(e,"tbody")}},webgl:{confetti:{Shader:function(e){this.program=client.webgl.Program.load(e,"confetti",{}),this.attributes=this.program.floatAttributes().add("aPosition",2,!1).add("aColor",3,!1),this.buffer=e.createBuffer()},Particle:function(e,t,n,i,r,o,a,l,s){this.timestamp=e,this.duration=t,this.position=n,this.velocity=i,this.rotationZ=r,this.axisXY=o,this.rotationXY=a,this.size=l,this.color=s},canvas:function(){return client.form.utility.singleOfTag(document.getElementById("session-ranking"),"canvas")},run:function(){const e=client.webgl.confetti.canvas(),t=e.getContext("webgl",{alpha:!0}),n=client.webgl.confetti.Particle.run(t),i=client.webgl.onResize((function(){const n=client.webgl.canvasSize(e);client.webgl.resizeCanvas(e,n),client.webgl.viewportFit(t,n,1,new game.geometry.Mapping(.5,.5),new game.geometry.Mapping(-.5,-.5),new game.geometry.Mapping(.5,.5))}));return function(){n(),i()}}},game:{arrow:{Shader:function(e,t){this.definitions=t,this.program=client.webgl.Program.load(e,"arrow",t),this.attributes=this.program.floatAttributes().add("aPosition",3,!1).add("aMapping",2,!1),this.uMatrix=this.program.uniform("uMatrix","matrix4fv"),this.uExtents=this.program.uniform("uExtents","2fv"),this.uColor=this.program.uniform("uColor","4fv")},Geometry:function(e,t,n,i){this.matrix=e,this.extents=t,this.color=n,this.alpha=i},Driver:function(e,t,n,i){this.fRenderer=e,this.fGeometry=t,this.matrix=n,this.length=i}},course:{Geometry:function(e,t){this.matrix=e,this.viewpoint=t},Driver:function(e,t){this.viewpoint=e,this.fRenderer=t}},color:{Vertex:function(e,t){this.vertex=e,this.color=t},Shader:function(e,t,n){this.program=client.webgl.Program.load(e,t,n),this.attributes=this.program.floatAttributes().add("aPosition",3,!1).add("aNormal",3,!1).add("aColor",3,!1),this.uMatrix=this.program.uniform("uMatrix","matrix4fv")}},CurveShader:function(e,t){this.program=client.webgl.Program.load(e,"curve",t),this.attributes=this.program.floatAttributes().add("aPosition",3,!1).add("aNormal",3,!1).add("aColor",3,!1),this.uMatrix=this.program.uniform("uMatrix","matrix4fv"),this.uViewpoint=this.program.uniform("uViewpoint","3fv")},canvas:function(){return client.form.utility.singleOfTag(document.getElementById("game"),"canvas")},open:function(){const e=client.webgl.game.canvas().getContext("webgl",{alpha:!1});return e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e},LIGHT_DEFINITIONS:{LIGHT_VECTOR:new game.geometry.Vector(.5,1,1.5).normalize().toShader(),LIGHT_CENTER:"0.6",LIGHT_SCALE:"0.25"}},Program:function(e,t){this.gl=e,this.program=t},Attributes:function(e,t,n){this.program=e,this.type=t,this.size=n,this.attributes=[],this.total=0},Uniform:function(e,t,n){this.gl=e.gl,this.location=e.getUniformLocation(t),this.applier=client.webgl.Uniform.TYPES[n]},canvasSize:function(e){return new game.geometry.Mapping(e.clientWidth,e.clientHeight).multiply(window.devicePixelRatio)},resizeCanvas:function(e,t){e.width=t.u,e.height=t.v},viewportFull:function(e,t){e.viewport(0,0,t.u,t.v)},viewportFit:function(e,t,n,i,r,o){const a=new game.geometry.Mapping(Math.min(t.u,t.v*n),Math.min(t.v,t.u/n)),l=a.add(a.multiplyMapping(o.subtract(r))),s=t.subtract(a).multiplyMapping(i).add(a.multiplyMapping(r));e.viewport(s.u,s.v,l.u,l.v)},onResize:function(e){return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}},renderWithoutDepthTest:function(e,t){return function(){e.disable(e.DEPTH_TEST),t.apply(null,arguments),e.enable(e.DEPTH_TEST)}}},controls:{Base:function(e,t){this.connection=e,this.state=t},Resizer:function(e,t){this.base=e,this.gl=t,this.register()},Mouse:function(e){this.base=e,this.sensitivity={},this.lockChangeHandler=this.handleLockChange.bind(this),this.mouseMoveHandler=this.handleMouseMove.bind(this),this.wheelHandler=this.handleWheel.bind(this),this.lockedClickHandler=this.handleLockedClick.bind(this),this.lockedMouseDownHandler=this.handleLockedMouseDown.bind(this),this.lockedMouseUpHandler=this.handleLockedMouseUp.bind(this),this.unlockedClickHandler=this.handleUnlockedClick.bind(this),this.register()},Keyboard:function(e){this.base=e,this.direction=new game.geometry.Vector(0,0,0);const t=this.buildTracker();this.keyDownHandler=t.handleDown.bind(t),this.keyUpHandler=t.handleUp.bind(t),this.register()},KeyTracker:function(){this.map=new Map},CameraDriver:function(e,t,n,i){this.driver=e,this.mapper=t,this.velocity=n,this.acceleration=i},ArrowDriver:function(e,t,n){this.driver=e,this.velocity=t,this.acceleration=n}},State:function(e,t,n,i,r,o,a){this.reference=e,this.playerDriver=t,this.trace=n,this.timeSync=i,this.indexEvent=r,this.timeEvent=o,this.prunerData=a},Camera:function(e,t,n,i,r){this.center=e,this.pan=t,this.tilt=n,this.zoom=i,this.ratio=r},load:function(){client.TEST_COURSE_ENABLED?(client.form.game.open(),client.network.Launcher.offline(performance.now(),new game.network.Player(0,null,"Tester",game.network.Player.AVERAGE_RATING,null),client.TEST_COURSE)):client.form.menu.loginIfExists().show()}};if(client.network.handlers.login.Opening.handle=function(e,t){e.handler=new client.network.handlers.login.Opening(e,t)},client.network.handlers.login.Opening.prototype.handleSocketOpen=function(){this.procedureSocket.send(game.network.Procedure.TREE.LOGIN.REQUEST.bind(client.network.handlers.login.Main.key(this.form))),this.handleLogin()},client.network.handlers.login.Opening.prototype.handleLogin=function(){this.procedureSocket.handler=new client.network.handlers.login.Main(this.procedureSocket,performance.now(),this.form)},client.network.handlers.login.Main.LOCAL_STORAGE_KEY="multi-golf-player-key",client.network.handlers.login.Main.store=function(e){window.localStorage.setItem(client.network.handlers.login.Main.LOCAL_STORAGE_KEY,e)},client.network.handlers.login.Main.key=function(e){return e.form.forms[0].get()},client.network.handlers.login.Main.prototype.handle_LOGIN_RESPONSE_CONFIRM_LOBBY=function(e,t,n,i,r){this.connection(new game.network.Player(e,null,t,n,{registration:i,login:r})).toLobbyOrSession(this.form)},client.network.handlers.login.Main.prototype.handle_LOGIN_RESPONSE_CONFIRM_GAME=function(e,t,n,i,r){client.form.utility.close(this.form),client.form.game.open(),client.network.Launcher.join(this.session(game.network.Player.fromDataPrivate(e),t),this.reference,n,i,r)},client.network.handlers.login.Main.prototype.handle_LOGIN_RESPONSE_MULTIPLE=function(){this.form.enable(),this.form.form.forms[0].showValidation("Already logged in from another client")},client.network.handlers.login.Main.prototype.handle_LOGIN_RESPONSE_UNKNOWN=function(){this.form.enable(),this.form.form.forms[0].showValidation("No player exists with this key")},client.network.handlers.login.Main.prototype.handleSocketClose=function(){},client.network.handlers.login.Main.prototype.session=function(e,t){return new client.network.Session(this.connection(e),t)},client.network.handlers.login.Main.prototype.connection=function(e){return new client.network.Connection(this.procedureSocket,e.withKey(client.network.handlers.login.Main.key(this.form)))},client.network.handlers.lobby.Main.prototype.handleSocketClose=function(){},client.network.handlers.lobby.NameChanging.prototype.handle_LOBBY_NAME_CHANGE_RESPONSE=function(){this.connection.player.name=this.form.form.forms[0].get(),this.connection.handleLobby(),this.connection.toLobby(this.form)},client.network.handlers.lobby.NameChanging.prototype.handleSocketClose=function(){},client.network.handlers.lobby.SessionCreating.prototype.handle_LOBBY_CREATE_RESPONSE=function(e){new client.network.Session(this.connection,e).toSession(this.form,[])},client.network.handlers.lobby.SessionCreating.prototype.handleSocketClose=function(){},client.network.handlers.lobby.SessionJoining.prototype.handle_LOBBY_JOIN_RESPONSE_CONFIRM_SESSION=function(e){this.session.toSession(this.form,e.map(game.network.Player.fromDataPublic))},client.network.handlers.lobby.SessionJoining.prototype.handle_LOBBY_JOIN_RESPONSE_CONFIRM_GAME=function(e,t,n){client.form.utility.close(this.form),client.form.game.open(),client.network.Launcher.join(this.session,this.reference,e,t,n)},client.network.handlers.lobby.SessionJoining.prototype.handle_LOBBY_JOIN_RESPONSE_UNKNOWN=function(){this.unknownHandler(),this.session.connection.handleLobby()},client.network.handlers.lobby.SessionJoining.prototype.handleSocketClose=function(){},client.network.handlers.session.Main.prototype.handle_SESSION_ENTER=function(e,t,n){this.member.add(new game.network.Player(e,null,t,n,null)),this.update()},client.network.handlers.session.Main.prototype.handle_SESSION_LEAVE_OTHER=function(e){this.member.remove(e),this.update()},client.network.handlers.session.Main.prototype.handle_SESSION_START_RESPONSE=function(){this.disableHandler(),this.member.session.connection.procedureSocket.send(game.network.Procedure.TREE.GAME.START.REQUEST.bind()),this.member.handleStarting(0,function(e){this.closeHandler(),client.form.game.open(),e()}.bind(this),(function(e){throw new Error("Launch should happen directly after start")}))},client.network.handlers.session.Main.prototype.handleSocketClose=function(){},client.network.handlers.session.Main.prototype.update=function(){this.sessionForm&&this.sessionForm.form.forms[1].update(this.member.players().sort(game.network.Player.COMPARATOR).map(function(e,t){return client.form.utility.selfColumns([t+1,client.form.utility.playerNameId(e),e.rating],e.id==this.member.session.connection.player.id)}.bind(this)))},client.network.handlers.session.Main.prototype.handleLeaving=function(){this.member.session.connection.procedureSocket.handler=new client.network.handlers.session.Leaving(this)},client.network.handlers.session.Leaving.prototype.handle_SESSION_ENTER=function(e,t,n){this.main.handle_SESSION_ENTER(e,t,n)},client.network.handlers.session.Leaving.prototype.handle_SESSION_LEAVE_SELF_RESPONSE=function(){this.main.member.session.connection.handleLobby(),this.main.member.session.connection.toLobby(this.main.sessionForm)},client.network.handlers.session.Leaving.prototype.handle_SESSION_LEAVE_OTHER=function(e){this.main.handle_SESSION_LEAVE_OTHER(e)},client.network.handlers.session.Leaving.prototype.handle_SESSION_START_RESPONSE=function(){this.main.handle_SESSION_START_RESPONSE()},client.network.handlers.session.Leaving.prototype.handleSocketClose=function(){this.main.handleSocketClose()},client.network.handlers.game.Starting.prototype.handle_GAME_ENTER=function(e,t){this.launcher.queueEnterAction(e,game.network.Player.fromDataPublic(t))},client.network.handlers.game.Starting.prototype.handle_GAME_LEAVE_OTHER=function(e,t){this.launcher.queueLeaveAction(e,t)},client.network.handlers.game.Starting.prototype.handle_GAME_RESET_OTHER=function(e,t){this.launcher.queueResetAction(e,t)},client.network.handlers.game.Starting.prototype.handle_GAME_FRAME=function(e,t,n,i,r){this.launcher.queueFrameAction(game.network.Frame.from(e,t,n,i,r))},client.network.handlers.game.Starting.prototype.handle_GAME_HIT_OTHER=function(e,t,n,i){this.launcher.queueHitAction(e,t,n,i)},client.network.handlers.game.Starting.prototype.handle_GAME_END=function(e){this.endCallable(e)},client.network.handlers.game.Starting.prototype.handle_GAME_START_RESPONSE=function(e){this.startCallable(this.launcher.launch.bind(this.launcher,performance.now(),e,this.course))},client.network.handlers.game.Starting.prototype.handleSocketClose=function(){},client.network.handlers.game.Main.prototype.handle_GAME_ENTER=function(e,t){this.state.insertEnterAction(e,game.network.Player.fromDataPublic(t))},client.network.handlers.game.Main.prototype.handle_GAME_LEAVE_OTHER=function(e,t){this.state.insertLeaveAction(e,t)},client.network.handlers.game.Main.prototype.handle_GAME_RESET_OTHER=function(e,t){this.state.insertResetAction(e,t)},client.network.handlers.game.Main.prototype.handle_GAME_FRAME=function(e,t,n,i,r){this.state.insertFrameAction(game.network.Frame.from(e,t,n,i,r))},client.network.handlers.game.Main.prototype.handle_GAME_HIT_OTHER=function(e,t,n,i){this.state.insertHitAction(e,t,n,i)},client.network.handlers.game.Main.prototype.handle_GAME_END=function(e){this.cancel(),this.finalize(),this.course+1<game.network.COURSES().length?this.transition(e):this.end(e)},client.network.handlers.game.Main.prototype.handleSocketClose=function(){},client.network.handlers.game.Main.prototype.finalize=function(){document.getElementById("game-end").getElementsByTagName("div")[1].textContent="0"},client.network.handlers.game.Main.prototype.transition=function(e){this.session.connection.procedureSocket.send(game.network.Procedure.TREE.GAME.START.REQUEST.bind()),client.form.menu.show(this.session.handleStartingTransition(this.course+1,e.map(client.State.playerDriverFromResultData)))},client.network.handlers.game.Main.prototype.end=function(e){const t=e.map(game.network.PlayerResult.fromData),n=client.form.menu.sessionRanking(this.session.connection.procedureSocket,this.session,t);this.session.connection.updateRating(t),this.session.handleSession(this.session.connection.otherPlayers(t),null,(function(){n.disable()}),(function(){client.form.utility.close(n)})),client.form.menu.transition(n),document.exitPointerLock()},client.network.handlers.Registration.handle=function(e,t){e.handler=new client.network.handlers.Registration(e,t)},client.network.handlers.Registration.prototype.name=function(){return this.form.form.forms[0].get()},client.network.handlers.Registration.prototype.handleSocketOpen=function(){this.procedureSocket.send(game.network.Procedure.TREE.REGISTRATION.REQUEST.bind(this.name()))},client.network.handlers.Registration.prototype.handle_REGISTRATION_RESPONSE=function(e,t,n){new client.network.Connection(this.procedureSocket,new game.network.Player(e,t,this.name(),game.network.Player.AVERAGE_RATING,{registration:n,login:n})).toLobbyOrSession(this.form)},client.network.handlers.Registration.prototype.handleSocketClose=function(){},client.network.offline.Session.prototype.handleGame=function(e,t,n){},client.network.queues.Instant.prototype.push=function(e,t){t()},client.network.queues.Delayed.MIN_DELAY=client.params.parseInteger("minDelay"),client.network.queues.Delayed.MAX_DELAY=client.params.parseInteger("maxDelay"),client.network.queues.Delayed.DELAY_ENABLED=null!=client.network.queues.Delayed.MIN_DELAY&&null!=client.network.queues.Delayed.MAX_DELAY&&client.network.queues.Delayed.MIN_DELAY<=client.network.queues.Delayed.MAX_DELAY,client.network.queues.Delayed.DELAY_ENABLED&&console.log("delay enabled (min: "+client.network.queues.Delayed.MIN_DELAY+", max: "+client.network.queues.Delayed.MAX_DELAY+")"),client.network.queues.Delayed.prototype.randomDelay=function(){return game.utility.random.closedRange(this.minDelay,this.maxDelay)},client.network.queues.Delayed.prototype.push=function(e,t){const n=this.randomDelay(),i={name:e,callable:t,expired:!1};this.data.push(i),console.log(["push to queue (name: ",e,", size: ",this.data.length,", delay: ",n,")"].join("")),setTimeout(function(){i.expired=!0,this.process()}.bind(this),n)},client.network.queues.Delayed.prototype.process=function(){for(;this.data.length>0&&this.data[0].expired;){const e=this.data.splice(0,1)[0];e.callable(),console.log(["pop from queue (name: ",e.name,", size: ",this.data.length,")"].join(""))}},client.network.queues.build=client.network.queues.Delayed.DELAY_ENABLED?function(){return new client.network.queues.Delayed(client.network.queues.Delayed.MIN_DELAY,client.network.queues.Delayed.MAX_DELAY)}:function(){return new client.network.queues.Instant},client.network.ProcedureSocket.DOMAIN=client.params.parseString("domain"),client.network.ProcedureSocket.DOMAIN&&console.log("using custom domain ("+client.network.ProcedureSocket.DOMAIN+")"),client.network.ProcedureSocket.INSECURE=client.params.parseBoolean("insecure"),client.network.ProcedureSocket.INSECURE&&console.log("insecure connections enabled"),client.network.ProcedureSocket.SERVER_URL=(client.network.ProcedureSocket.INSECURE?"ws":"wss")+"://"+(client.network.ProcedureSocket.DOMAIN||game.network.DOMAIN)+":"+game.network.PORT,client.network.ProcedureSocket.FLOAT_ERROR=client.params.parseFloat("floatError"),null!=client.network.ProcedureSocket.FLOAT_ERROR&&(client.network.ProcedureSocket.MAPPER=function(e,t){return Number.isFinite(t)&&!Number.isInteger(t)?Math.pow(client.network.ProcedureSocket.FLOAT_ERROR,2*Math.random()-1)*t:t},console.log("float error enabled ("+client.network.ProcedureSocket.FLOAT_ERROR+")")),client.network.ProcedureSocket.open=function(){return new client.network.ProcedureSocket(new WebSocket(client.network.ProcedureSocket.SERVER_URL),client.network.ProcedureSocket.MAPPER)},client.network.ProcedureSocket.prototype.register=function(){this.socket.addEventListener("open",this.handleOpen.bind(this)),this.socket.addEventListener("message",this.handleMessage.bind(this)),this.socket.addEventListener("close",this.handleClose.bind(this)),this.socket.addEventListener("error",this.handleError.bind(this))},client.network.ProcedureSocket.prototype.handleOpen=function(e){this.inQueue.push("open",function(){this.handler.handleSocketOpen()}.bind(this))},client.network.ProcedureSocket.prototype.handleMessage=function(e){this.inQueue.push("message",function(){try{game.network.Parser.INSTANCE.parse(e.data,this.mapper).handle(this.handler)}catch(e){this.socket.close(),console.error("Failed to handle message",e),alert("Unexpected network message received. Please reload page and try again.")}}.bind(this))},client.network.ProcedureSocket.prototype.handleClose=function(e){this.inQueue.push("close",function(){this.handler.handleSocketClose()}.bind(this))},client.network.ProcedureSocket.prototype.handleError=function(e){this.inQueue.push("error",(function(){console.error("A socket error occurred",e),alert("Unexpected network error occurred. Please reload page and try again.")}))},client.network.ProcedureSocket.prototype.send=function(e){this.outQueue.push("send",function(){this.socket.send(game.network.Parser.INSTANCE.unparse(e,this.mapper))}.bind(this))},client.network.Connection.prototype.handleLobby=function(){this.procedureSocket.handler=new client.network.handlers.lobby.Main(this)},client.network.Connection.prototype.handleNameChanging=function(e){this.procedureSocket.handler=new client.network.handlers.lobby.NameChanging(this,e)},client.network.Connection.prototype.handleSessionCreating=function(e){this.procedureSocket.handler=new client.network.handlers.lobby.SessionCreating(this,e)},client.network.Connection.prototype.handleSessionJoining=function(e,t,n){this.procedureSocket.handler=new client.network.handlers.lobby.SessionJoining(new client.network.Session(this,t),e,performance.now(),n)},client.network.Connection.prototype.toLobby=function(e){client.form.utility.transition(e,client.form.menu.lobby(this))},client.network.Connection.prototype.toSessionJoin=function(e){const t=client.form.menu.sessionJoin(this);return client.form.utility.transition(e,t),t},client.network.Connection.prototype.toSession=function(e,t,n){this.handleSessionJoining(e,t,n),this.procedureSocket.send(game.network.Procedure.TREE.LOBBY.JOIN.REQUEST.bind(t))},client.network.Connection.prototype.toLobbyOrSession=function(e){client.network.handlers.login.Main.store(this.player.key);const t=client.params.parseString("sessionKey");if(null!=t)if(game.constraints.string.isSessionKey(t))this.toSession(e,t,function(){const n=this.toSessionJoin(e);n.form.forms[0].set(t),n.form.forms[0].showValidation(client.form.menu.SESSION_UNKNOWN_MESSAGE)}.bind(this));else{this.handleLobby();const n=this.toSessionJoin(e);n.form.forms[0].set(t),n.validate()}else this.handleLobby(),this.toLobby(e)},client.network.Connection.prototype.updateRating=function(e){this.player.rating+=this.player.findResult(e).ratingAdjustment()},client.network.Connection.prototype.otherPlayers=function(e){return e.filter((function(e){return!e.left})).map((function(e){return e.player})).filter(function(e){return e.id!=this.player.id}.bind(this))},client.network.Session.prototype.handleSession=function(e,t,n,i){this.connection.procedureSocket.handler=new client.network.handlers.session.Main(new client.network.Member(this,e),t,n,i)},client.network.Session.prototype.handleStarting=function(e,t,n,i){this.connection.procedureSocket.handler=new client.network.handlers.game.Starting(client.network.Launcher.create(this,performance.now(),t),e,n,i)},client.network.Session.prototype.handleStartingTransition=function(e,t){var n,i=!1;function r(){i&&n&&(client.form.menu.hide(),n())}function o(){i=!0,r()}return this.handleStarting(e,t,(function(e){n=e,r()}),function(e){o(),this.connection.procedureSocket.handler.handle_GAME_END(e)}.bind(this)),o},client.network.Session.prototype.handleGame=function(e,t,n){this.connection.procedureSocket.handler=new client.network.handlers.game.Main(this,e,t,n)},client.network.Session.prototype.toSession=function(e,t){this.handleSession(t,null,(function(){}),(function(){e.hide()})),client.form.utility.close(e,function(){const e=client.form.menu.session(this);this.connection.procedureSocket.handler.sessionForm=e,this.connection.procedureSocket.handler.disableHandler=function(){e.disable()},this.connection.procedureSocket.handler.closeHandler=function(){client.form.utility.close(e)},this.connection.procedureSocket.handler.update(),client.form.utility.open(e)}.bind(this))},client.network.Member.prototype.handleStarting=function(e,t,n){this.session.handleStarting(e,this.playerActions(),t,n)},client.network.Member.prototype.add=function(e){game.utility.assert(e.id!=this.session.connection.player.id,"Cannot add player with self ID"),game.utility.collection.map.setNew(this.idToPlayer,e.id,e)},client.network.Member.prototype.remove=function(e){game.utility.assert(e!=this.session.connection.player.id,"Cannot remove player with self ID"),game.utility.collection.map.deleteExisting(this.idToPlayer,e)},client.network.Member.prototype.players=function(){return game.utility.collection.values(this.idToPlayer)},client.network.Member.prototype.playerActions=function(){return this.players().map((function(e){return client.State.playerDriverWithPlayer(e)}))},client.network.Launcher.create=function(e,t,n){return new client.network.Launcher(e,t,new game.network.Frame(0,0,0,0,n))},client.network.Launcher.join=function(e,t,n,i,r){client.network.Launcher.fromData(e,t,r).launch(performance.now(),i,n).insertEnterAction(i,e.connection.player)},client.network.Launcher.fromData=function(e,t,n){return new client.network.Launcher(e,t,game.network.Frame.fromData(n).mapActions(game.state.drivers.RendererOverride.map))},client.network.Launcher.offline=function(e,t,n){client.network.Launcher.create(new client.network.offline.Session(new client.network.offline.Connection(client.network.offline.ProcedureSocket,t)),e,[client.State.playerDriverWithPlayer(t)]).launch(e,0,n)},client.network.Launcher.gameStartRenderer=function(){const e=document.getElementById("game-start");return client.form.game.renderers.display(e,(function(e){return e.unconditionalDriver.unconditionalDriver.time<game.timing.GAME_START_DURATION}),client.form.game.renderers.textContent(e.getElementsByTagName("div")[1],(function(e){return Math.ceil(game.timing.GAME_START_DURATION-e.unconditionalDriver.unconditionalDriver.time)})),client.form.game.renderers.empty)},client.network.Launcher.gameEndRenderer=function(){const e=document.getElementById("game-end");return client.form.game.renderers.display(e,(function(e){return e.satisfied}),client.form.game.renderers.textContent(e.getElementsByTagName("div")[1],(function(e){return Math.ceil(Math.max(game.timing.GAME_END_DURATION-e.conditionalDriver.time,0))})),client.form.game.renderers.empty)},client.network.Launcher.timerRenderer=function(){return client.form.game.renderers.textContent(document.getElementById("timer"),(function(e){const t=Math.ceil(game.utility.clamp(game.timing.PLAYABLE_END-(e.unconditionalDriver.unconditionalDriver.time*game.constraints.number.FLOAT_TOLERANCE-e.conditionalDriver.time/game.constraints.number.FLOAT_TOLERANCE),0,game.timing.PLAYABLE_DURATION)),n=t%60;return Math.floor(t/60)+":"+(n<10?"0":"")+n}))},client.network.Launcher.rankingPlayerStates=function(e){var t=game.utility.collection.values(e.unconditionalDriver.conditionalDriver.drivers).map((function(e){return e.driver.state}));return e.satisfied&&(t=t.map((function(e){return e.maxStrokes()}))),game.network.PlayerState.sort(t)},client.network.Launcher.playerDriver=function(e,t){const n=game.physics.Ball.SPHERE.model(Math.PI/12),i=t.renderer(client.webgl.game.color.Vertex.fromModel(n,new game.model.Color(1,1,1))),r=t.renderer(client.webgl.game.color.Vertex.fromModel(n,new game.model.Color(1,0,0)));return game.state.drivers.RendererOverride.wrapper(new game.state.drivers.Player(e),(function(e){i(e),t.program.depthFunc("GREATER"),r(e),t.program.depthFunc("LESS")}))},client.network.Launcher.backgroundDriver=function(e){return new game.state.drivers.RendererOverride(game.state.drivers.idle,game.utility.constant(new game.state.renderers.Wrapper(game.geometry.void,(function(){new game.model.Color(.2,.2,.2).glClear(e),e.clear(e.COLOR_BUFFER_BIT)}))))},client.network.Launcher.revisionAction=function(e,t){return client.controls.CameraDriver.map(game.state.drivers.Camera.map(game.state.drivers.Multi.map(new Map([["course",e],["arrow",t],["players",game.utility.identity]]),game.state.drivers.Multi.OTHERS.KEEP,game.state.drivers.Multi.ORDERED.OTHERS_FIRST),game.utility.identity))},client.network.Launcher.simpleShader=function(e){return client.webgl.game.color.Shader.simple(e,client.webgl.game.LIGHT_DEFINITIONS)},client.network.Launcher.checkerShader=function(e){return client.webgl.game.color.Shader.checker(e,game.utility.mergeObjects([client.webgl.game.LIGHT_DEFINITIONS,{CHECKER_SIZE:"2.0",CHECKER_MULTIPLIER:"0.9",CHECKER_SLOPE_MIN:"0.5",CHECKER_SLOPE_MAX:"1.0"}]))},client.network.Launcher.bunkerShader=function(e){return new client.webgl.game.CurveShader(e,game.utility.mergeObjects([client.webgl.game.LIGHT_DEFINITIONS,{CURVE_OFFSET:"0.9",CURVE_SCALE:"0.1",CURVE_REFRAC_INDEX:"0.65",CURVE_REFRAC_Z:"1.0",CURVE_FUNCTION:"sin(                        dot(                            vec3(-0.894, -0.941, 0.994),                            vec3(                                sin(dot(vec2(0.765, 0.932), xy) - 0.225),                                sin(dot(vec2(-0.406, -0.780), xy) + 0.483),                                sin(dot(vec2(-0.501, 0.338), xy) + 0.366)                            )                        ) + dot(vec2(0.512, -0.824), xy) - 0.272                    )"}]))},client.network.Launcher.arrowShader=function(e){return new client.webgl.game.arrow.Shader(e,{INNER_RADIUS:"0.6",HALF_WIDTH:"0.2",TIP_RATIO:"1.75",SECTION_LENGTH:"2.0",SECTION_GAP:"0.075"})},client.network.Launcher.arrowDriver=function(e,t){return new client.webgl.game.arrow.Driver(client.webgl.renderWithoutDepthTest(e,t.renderer(t.extents(1,4))),t.geometryMapper(1,4,new game.model.Color(1,1,0),new game.model.Color(1,0,0),.5),game.geometry.Matrix.IDENTITY,null)},client.network.Launcher.shaders=function(e){return{simple:client.network.Launcher.simpleShader(e),checker:client.network.Launcher.checkerShader(e),curve:client.network.Launcher.bunkerShader(e),arrow:client.network.Launcher.arrowShader(e)}},client.network.Launcher.prototype.correctedNow=function(e){return(this.reference+e)/2},client.network.Launcher.prototype.applyQueue=function(e){this.queue.forEach((function(t){t(e)}))},client.network.Launcher.prototype.queueEnterAction=function(e,t){this.queue.push((function(n){n.insertEnterAction(e,t)}))},client.network.Launcher.prototype.queueLeaveAction=function(e,t){this.queue.push((function(n){n.insertLeaveAction(e,t)}))},client.network.Launcher.prototype.queueResetAction=function(e,t){this.queue.push((function(n){n.insertResetAction(e,t)}))},client.network.Launcher.prototype.queueFrameAction=function(e){this.queue.push((function(t){t.insertFrameAction(e)}))},client.network.Launcher.prototype.queueHitAction=function(e,t,n,i){this.queue.push((function(r){r.insertHitAction(e,t,n,i)}))},client.network.Launcher.prototype.rankingRenderer=function(){return new client.form.Table(document.getElementById("game-ranking")).renderer(this.buildRanking.bind(this))},client.network.Launcher.prototype.buildRanking=function(e){return game.utility.array.flatten(client.network.Launcher.rankingPlayerStates(e).map(function(e,t){return e.map(function(e){var n=[t+1,client.form.utility.playerNameId(e.player),[e.strokes.current," (",e.strokes.total,")"].join(""),e.left?"&varnothing;":e.ended()?e.endedMaxStrokes()?"&cross;":"&check;":""];return e.left&&(n=n.map((function(e){return['<span class="left">',e,"</span>"].join("")}))),client.form.utility.selfColumns(n,e.player.id==this.session.connection.player.id)}.bind(this))}.bind(this)))},client.network.Launcher.prototype.playerEndRenderer=function(){const e=this,t=document.getElementById("player-end"),n=t.querySelectorAll("#player-end > div"),i=n[0].getElementsByTagName("div");function r(t,n){const i=e.selfPlayerState(t.unconditionalDriver.conditionalDriver);return i&&n(i)}function o(e,t){return client.form.game.renderers.display(i[e],(function(e){return t}),client.form.game.renderers.empty,client.form.game.renderers.empty)}return client.form.game.renderers.display(t,(function(e){return e.unconditionalDriver.unconditionalDriver.time>game.timing.PLAYABLE_END||r(e,(function(e){return e.ended()}))}),client.form.game.renderers.multi([client.form.game.renderers.display(i[0],(function(e){return r(e,(function(e){return e.ball.current.isCompleted()}))}),client.form.game.renderers.multi([o(1,!1),o(2,!1)]),client.form.game.renderers.display(i[1],(function(e){return r(e,(function(e){return e.endedMaxStrokes()}))}),o(2,!1),o(2,!0))),client.form.game.renderers.display(n[1],(function(e){return!e.satisfied}),client.form.game.renderers.empty,client.form.game.renderers.empty)]),client.form.game.renderers.empty)},client.network.Launcher.prototype.menuRenderer=function(){return client.form.game.renderers.disabled(document.getElementById("game-menu").getElementsByTagName("button")[0],function(e){const t=this.selfPlayerState(e.unconditionalDriver.conditionalDriver),n=e.unconditionalDriver.unconditionalDriver.time;return!t||!t.isResettable()||n>game.timing.PLAYABLE_END||n<game.timing.GAME_START_DURATION}.bind(this))},client.network.Launcher.prototype.playersDriver=function(e){return game.state.drivers.RendererOverride.discrete(game.timing.driver(new game.state.drivers.Multi(new Map(this.frame.playerActions.map((function(t){const n=t(e);return[n.driver.state.player.id,n]})).sort(game.utility.collection.map.KEY_COMPARATOR))),this.frame.totalTime,this.frame.endTime,(function(e){return game.utility.collection.values(e.drivers).every((function(e){return e.driver.state.ended()}))})),client.form.game.renderers.multi([this.rankingRenderer(),client.network.Launcher.gameStartRenderer(),client.network.Launcher.gameEndRenderer(),this.playerEndRenderer(),client.network.Launcher.timerRenderer(),this.menuRenderer()]))},client.network.Launcher.prototype.selfPlayerState=function(e){const t=this.session.connection.player.id;if(e.drivers.has(t))return e.drivers.get(t).driver.state},client.network.Launcher.prototype.arrowAlignAction=function(e,t){const n=t.driver.driver.drivers.get("players").driver.unconditionalDriver;if(n.satisfied){const i=this.selfPlayerState(n.conditionalDriver);if(i&&i.isHittable())return game.state.actions.merge([game.state.actions.ifExisting(game.utility.identity,game.state.actions.constant(e)),client.controls.ArrowDriver.map(function(e,t){return t.replace({matrix:e})}.bind(null,game.geometry.Matrix.rotationZ(t.driver.camera.pan).dot(i.ball.current.floorMatrix())))])}return function(e){}},client.network.Launcher.prototype.cameraPosition=function(e){const t=this.selfPlayerState(e.drivers.get("players").driver.unconditionalDriver.conditionalDriver);if(t)return t.ball.current.motion.position},client.network.Launcher.prototype.driver=function(e,t,n,i,r){return new game.state.drivers.Actioning(client.controls.CameraDriver.from(new game.state.drivers.Camera(new game.state.drivers.Multi(new Map([["background",e],["course",t],["players",i]])),r,this.cameraPosition.bind(this)),(function(e,t){const n=e.driver.drivers.get("arrow");return n&&null!=n.driver.length?new game.geometry.Vector(t.x,0,t.z):t})),game.state.actions.dynamic(function(e){return client.network.Launcher.revisionAction(client.webgl.game.course.Driver.map(e.driver.camera.position()),this.arrowAlignAction(n,e))}.bind(this)))},client.network.Launcher.prototype.buildState=function(e,t,n){const i=client.network.Launcher.shaders(e),r=client.network.Launcher.arrowDriver(e,i.arrow),o=game.network.COURSES()[n](),a=new game.collision.Index(game.physics.Ball.SPHERE.size());a.addTriangles(o.body.collision);const l=game.physics.Ball.from(o.origin,game.physics.Ball.SPHERE.radius,a),s=game.network.PlayerResult.initial(this.session.connection.player,n).toStateBoth(l),c=client.network.Launcher.playerDriver(s,i.simple),u=new client.Camera(l.motion.position,0,Math.PI/6,1,1),m=client.State.build(t,c,new game.state.Frame(this.frame.index,this.frame.timestamp,this.driver(client.network.Launcher.backgroundDriver(e),client.webgl.game.course.Driver.from(client.webgl.game.course.Driver.renderer(o.body,i)),client.controls.ArrowDriver.from(r),this.playersDriver(c),u)));return this.applyQueue(m),m},client.network.Launcher.prototype.launch=function(e,t,n){const i=client.webgl.game.open(),r=this.buildState(i,this.correctedNow(e)-game.timing.ticksToMs(t),n),o=r.run(),a=new client.controls.Base(this.session.connection,r),l=new client.controls.Resizer(a,i),s=new client.controls.Mouse(a),c=new client.controls.Keyboard(a),u=client.form.game.main(s);return u.enable(),this.session.handleGame(n,r,(function(){o(),l.unregister(),s.unregister(),c.unregister(),u.unregister(),u.disable()})),r},client.form.Parent.prototype.unregister=function(){this.form.unregister()},client.form.Parent.prototype.disable=function(){this.form.disable()},client.form.Parent.prototype.enable=function(){this.form.enable()},client.form.Parent.prototype.hide=function(e){client.form.utility.hide(this.element,this.handler?e?function(){this.handler(),e()}.bind(this):this.handler:e)},client.form.Parent.prototype.show=function(){client.form.utility.show(this.element)},client.form.Parent.prototype.validate=function(){return this.form.validate()},client.form.Multi.prototype.unregister=function(){this.forms.forEach((function(e){e.unregister()}))},client.form.Multi.prototype.disable=function(){this.forms.forEach((function(e){e.disable()}))},client.form.Multi.prototype.enable=function(){this.forms.forEach((function(e){e.enable()}))},client.form.Multi.prototype.validate=function(){return this.forms.map((function(e){return e.validate()})).every(game.utility.identity)},client.form.Input.prototype.assert=function(){game.utility.assert(3==this.element.children.length,"Three children expected");const e=this.element.children[0],t=this.element.children[1],n=this.element.children[2],i=n.getAttribute("id");game.utility.assert(null!=i,"Input expected to have ID"),game.utility.assert("LABEL"==e.tagName,"Label expected"),game.utility.assert(e.getAttribute("for")==i,"Header label should refer input"),game.utility.assert(e.classList.contains("header"),"Header class expected"),game.utility.assert("LABEL"==t.tagName,"Label expected"),game.utility.assert(t.getAttribute("for")==i,"Validation label should refer input"),game.utility.assert(t.classList.contains("validation"),"Validation class expected"),game.utility.assert("INPUT"==n.tagName,"Input expected"),game.utility.assert("text"==n.getAttribute("type"),"Unexpected input type"),game.utility.assert(n.getAttribute("maxlength")==this.maxLength.toString(),"Wrong maxlength")},client.form.Input.prototype.register=function(){this.input.addEventListener("focus",this.focusHandler),this.input.addEventListener("keyup",this.keyupHandler)},client.form.Input.prototype.unregister=function(){this.input.removeEventListener("focus",this.focusHandler),this.input.removeEventListener("keyup",this.keyupHandler)},client.form.Input.prototype.disable=function(){this.hideValidation(),this.input.disabled=!0},client.form.Input.prototype.enable=function(){this.input.disabled=!1},client.form.Input.prototype.validate=function(){const e=this.get(),t=this.validator(e);return null==t||(this.showValidation(t),!1)},client.form.Input.prototype.get=function(){return this.input.value},client.form.Input.prototype.set=function(e){this.input.value=e},client.form.Input.prototype.restore=function(e){const t=window.localStorage.getItem(e);null!=t&&(null==this.validator(t)?this.set(t):window.localStorage.removeItem(e))},client.form.Input.prototype.showValidation=function(e){this.validation.textContent=e,this.validation.style.setProperty("display","block"),this.input.classList.add("invalid")},client.form.Input.prototype.hideValidation=function(){this.validation.textContent="",this.validation.style.removeProperty("display"),this.input.classList.remove("invalid")},client.form.Input.prototype.checkConfirm=function(e){"Enter"==e.key&&(this.input.blur(),this.button.click())},client.form.Range.prototype.register=function(){this.element.addEventListener("input",this.inputHandler),this.element.addEventListener("change",this.changeHandler)},client.form.Range.prototype.unregister=function(){this.element.removeEventListener("input",this.inputHandler),this.element.removeEventListener("change",this.changeHandler)},client.form.Range.prototype.disable=function(){this.element.disabled=!0},client.form.Range.prototype.enable=function(){this.element.disabled=!1},client.form.Range.prototype.update=function(){this.handler(this.normal())},client.form.Range.prototype.default=function(){return this.min+Math.round((this.max-this.min)/(2*this.step))*this.step},client.form.Range.prototype.normal=function(){return(this.get()-this.min)/(this.max-this.min)},client.form.Range.prototype.get=function(){return parseFloat(this.element.value)},client.form.Range.prototype.set=function(e){this.element.value=e},client.form.Range.prototype.validate=function(e){const t=parseFloat(e);return!isNaN(t)&&t.toString()==e&&t>=this.min&&t<=this.max&&(t-this.min)%this.step==0?t:null},client.form.Range.prototype.store=function(){const e=this.get();e==this.default()?window.localStorage.removeItem(this.key):window.localStorage.setItem(this.key,e)},client.form.Range.prototype.restore=function(){const e=window.localStorage.getItem(this.key);if(null!=e){const t=this.validate(e);null!=t&&this.set(t),null!=t&&t!=this.default()||window.localStorage.removeItem(this.key)}},client.form.Button.prototype.register=function(){this.element.addEventListener("click",this.handler)},client.form.Button.prototype.unregister=function(){this.element.removeEventListener("click",this.handler)},client.form.Button.prototype.disable=function(){this.element.disabled=!0},client.form.Button.prototype.enable=function(){this.element.disabled=!1},client.form.Button.prototype.validate=function(){return!0},client.form.Table.prototype.unregister=function(){},client.form.Table.prototype.disable=function(){},client.form.Table.prototype.enable=function(){},client.form.Table.prototype.validate=function(){return!0},client.form.Table.prototype.update=function(e){const t=this.thead.getElementsByTagName("th").length;this.tbody.textContent="",e.forEach(function(e){game.utility.assert(e.length==t,"Wrong number of columns");const n=document.createElement("tr");e.forEach((function(e){const t=document.createElement("td");t.innerHTML=e,n.appendChild(t)})),this.tbody.appendChild(n)}.bind(this))},client.form.Table.prototype.renderer=function(e){var t=[];return function(n){const i=e(n);game.utility.array.equals(i,t,2)||(this.update(i),t=i)}.bind(this)},client.webgl.confetti.Shader.prototype.render=function(e,t){const n=game.utility.array.flatten(e.map((function(e){return e.data(t)})));this.program.bindBuffer("ARRAY_BUFFER",this.buffer),this.program.bufferData("ARRAY_BUFFER",new Float32Array(game.utility.array.flatten(n)),"DYNAMIC_DRAW"),this.attributes.apply(),this.program.use(),this.program.drawArrays("TRIANGLES",0,n.length)},client.webgl.confetti.Particle.GRAVITY=1e-6,client.webgl.confetti.Particle.DRAG=.003,client.webgl.confetti.Particle.GRAVITY_BY_DRAG=client.webgl.confetti.Particle.GRAVITY/client.webgl.confetti.Particle.DRAG,client.webgl.confetti.Particle.FADE_IN=100,client.webgl.confetti.Particle.FADE_OUT=200,client.webgl.confetti.Particle.MIN_INTERVAL=250,client.webgl.confetti.Particle.MAX_INTERVAL=1e3,client.webgl.confetti.Particle.MIN_DURATION=1e3,client.webgl.confetti.Particle.MAX_DURATION=1500,client.webgl.confetti.Particle.MIN_ORIGIN=new game.geometry.Mapping(-.5,0),client.webgl.confetti.Particle.MAX_ORIGIN=new game.geometry.Mapping(.5,.5),client.webgl.confetti.Particle.MIN_VELOCITY=4e-4,client.webgl.confetti.Particle.MAX_VELOCITY=.001,client.webgl.confetti.Particle.MIN_ROTATION=-.01,client.webgl.confetti.Particle.MAX_ROTATION=-client.webgl.confetti.Particle.MIN_ROTATION,client.webgl.confetti.Particle.MIN_COUNT=15,client.webgl.confetti.Particle.MAX_COUNT=25,client.webgl.confetti.Particle.REFLECTION_LOW=new game.model.Color(0,0,0),client.webgl.confetti.Particle.REFLECTION_HIGH=new game.model.Color(1,1,1),client.webgl.confetti.Particle.REFLECTION_MAX=.5,client.webgl.confetti.Particle.COLOR_MAX=1,client.webgl.confetti.Particle.COLOR_MIN=.125,client.webgl.confetti.Particle.run=function(e){const t=new client.webgl.confetti.Shader(e);var n,i=[];function r(e,t){return new client.webgl.confetti.Particle(e,game.utility.random.range(client.webgl.confetti.Particle.MIN_DURATION,client.webgl.confetti.Particle.MAX_DURATION),t,game.geometry.Mapping.angle(game.utility.random.range(0,2*Math.PI)).multiply(game.utility.random.range(client.webgl.confetti.Particle.MIN_VELOCITY,client.webgl.confetti.Particle.MAX_VELOCITY)),game.utility.random.range(client.webgl.confetti.Particle.MIN_ROTATION,client.webgl.confetti.Particle.MAX_ROTATION),game.utility.random.range(client.webgl.confetti.Particle.MIN_ROTATION,client.webgl.confetti.Particle.MAX_ROTATION),game.utility.random.range(client.webgl.confetti.Particle.MIN_ROTATION,client.webgl.confetti.Particle.MAX_ROTATION),new game.geometry.Mapping(.02,.03),game.model.Color.interpolatePrimaries(Math.random()).compress(client.webgl.confetti.Particle.COLOR_MIN,client.webgl.confetti.Particle.COLOR_MAX))}var o=window.requestAnimationFrame((function a(l){!function(e){for(null==n&&(n=e);n<e;){n+=game.utility.random.range(client.webgl.confetti.Particle.MIN_INTERVAL,client.webgl.confetti.Particle.MAX_INTERVAL);const e=game.utility.random.closedRange(client.webgl.confetti.Particle.MIN_COUNT,client.webgl.confetti.Particle.MAX_COUNT),o=client.webgl.confetti.Particle.MIN_ORIGIN.interpolateMapping(client.webgl.confetti.Particle.MAX_ORIGIN,game.geometry.Mapping.random());for(var t=0;t<e;t++)i.push(r(n,o))}}(l),function(e){i=i.filter((function(t){return t.lifetime()>e}))}(l),function(n){e.clear(e.COLOR_BUFFER_BIT),t.render(i.filter((function(e){return e.timestamp<n})),n)}(l),o=window.requestAnimationFrame(a)}));return function(){window.cancelAnimationFrame(o)}},client.webgl.confetti.Particle.rotatorXY=function(e,t){const n=Math.cos(t),i=e.u*e.v*(1-n),r=new game.geometry.Mapping(Math.pow(e.u,2)*(1-n)+n,i),o=new game.geometry.Mapping(i,Math.pow(e.v,2)*(1-n)+n);return function(e){return e.multiply2(r,o)}},client.webgl.confetti.Particle.prototype.lifetime=function(){return this.timestamp+this.duration},client.webgl.confetti.Particle.prototype.positionAt=function(e){const t=1-Math.exp(-e*client.webgl.confetti.Particle.DRAG);return this.position.add(new game.geometry.Mapping(this.velocity.u/client.webgl.confetti.Particle.DRAG*t,(this.velocity.v+client.webgl.confetti.Particle.GRAVITY_BY_DRAG)/client.webgl.confetti.Particle.DRAG*t-e*client.webgl.confetti.Particle.GRAVITY_BY_DRAG))},client.webgl.confetti.Particle.prototype.fadeAt=function(e){return Math.min(e/client.webgl.confetti.Particle.FADE_IN,(this.duration-e)/client.webgl.confetti.Particle.FADE_OUT,1)},client.webgl.confetti.Particle.prototype.data=function(e){const t=e-this.timestamp,n=this.fadeAt(t),i=this.positionAt(t),r=game.geometry.Mapping.rotator(t*this.rotationZ),o=t*this.rotationXY,a=client.webgl.confetti.Particle.rotatorXY(game.geometry.Mapping.angle(t*this.axisXY),o),l=client.webgl.confetti.Particle.REFLECTION_MAX*Math.sin(o),s=this.color.interpolate(l>0?client.webgl.confetti.Particle.REFLECTION_HIGH:client.webgl.confetti.Particle.REFLECTION_LOW,Math.abs(l)),c=this.size.multiply(n/2),u=a(r(c)),m=a(r(new game.geometry.Mapping(c.u,-c.v))),d=u.add(i),h=m.add(i),p=u.negate().add(i),g=m.negate().add(i);return[d.data().concat(s.data()),h.data().concat(s.data()),g.data().concat(s.data()),g.data().concat(s.data()),h.data().concat(s.data()),p.data().concat(s.data())]},client.webgl.game.arrow.Shader.prototype.buildBuffer=function(e){const t=this.program.gl.createBuffer();return this.program.bindBuffer("ARRAY_BUFFER",t),this.program.bufferData("ARRAY_BUFFER",new Float32Array(game.utility.array.flatten([new game.geometry.Vector(-e.v,e.v,0),new game.geometry.Vector(e.v,e.v,0),new game.geometry.Vector(e.v,-Math.max(e.v,e.u),0),new game.geometry.Vector(-e.v,-Math.max(e.v,e.u),0)].map((function(e){return e.data().concat(e.xyMapping().rotate90().data())})))),"STATIC_DRAW"),t},client.webgl.game.arrow.Shader.prototype.render=function(e,t){this.program.bindBuffer("ARRAY_BUFFER",e),this.attributes.apply(),this.program.use(),this.uMatrix.apply(t.matrix),this.uExtents.apply(t.extents),this.uColor.apply(t.alphaColor()),this.program.drawArrays("TRIANGLE_FAN",0,4)},client.webgl.game.arrow.Shader.prototype.renderer=function(e){return this.render.bind(this,this.buildBuffer(e))},client.webgl.game.arrow.Shader.prototype.minLength=function(e){return e*(1+parseFloat(this.definitions.TIP_RATIO)*parseFloat(this.definitions.HALF_WIDTH))},client.webgl.game.arrow.Shader.prototype.maxLength=function(e,t){return e*(parseFloat(this.definitions.INNER_RADIUS)+t*parseFloat(this.definitions.SECTION_LENGTH))},client.webgl.game.arrow.Shader.prototype.extents=function(e,t){return new game.geometry.Mapping(this.maxLength(e,t),e)},client.webgl.game.arrow.Shader.prototype.geometryMapper=function(e,t,n,i,r){const o=this.minLength(e),a=this.maxLength(e,t);return function(){return new client.webgl.game.arrow.Geometry(this.matrix,new game.geometry.Mapping(game.utility.interpolate(o,a,this.length),e),n.interpolate(i,null!=this.length?this.length:0),null==this.length?r:1)}},client.webgl.game.arrow.Geometry.prototype.alphaColor=function(){return this.color.data().concat(this.alpha)},client.webgl.game.arrow.Geometry.prototype.dot=function(e){return new client.webgl.game.arrow.Geometry(this.matrix.dot(e),this.extents,this.color,this.alpha)},client.webgl.game.arrow.Geometry.prototype.interpolate=function(e,t){return new client.webgl.game.arrow.Geometry(this.matrix.interpolate(e.matrix,t),this.extents.interpolate(e.extents,t),this.color.interpolate(e.color,t),game.utility.interpolate(this.alpha,e.alpha,t))},client.webgl.game.arrow.Driver.prototype.delta=function(){return game.timing.NORMAL_DELTA},client.webgl.game.arrow.Driver.prototype.drive=function(e){return this},client.webgl.game.arrow.Driver.prototype.renderer=function(){return new game.state.renderers.Wrapper(this.fGeometry(),this.fRenderer)},client.webgl.game.arrow.Driver.prototype.replace=function(e){const t=game.utility.mergeObjects([this,e]);return new client.webgl.game.arrow.Driver(t.fRenderer,t.fGeometry,t.matrix,t.length)},client.webgl.game.course.Geometry.prototype.dot=function(e){return new client.webgl.game.course.Geometry(this.matrix.dot(e),this.viewpoint)},client.webgl.game.course.Geometry.prototype.interpolate=function(e,t){return new client.webgl.game.course.Geometry(this.matrix.interpolate(e.matrix,t),this.viewpoint.interpolate(e.viewpoint,t))},client.webgl.game.course.Driver.map=function(e){return function(t){return new client.webgl.game.course.Driver(e,t.fRenderer)}},client.webgl.game.course.Driver.from=function(e){return new client.webgl.game.course.Driver(new game.geometry.Vector(0,0,0),e)},client.webgl.game.course.Driver.renderer=function(e,t){const n={};return Object.keys(t).forEach((function(e){n[e]=function(n){return t[e].renderer(game.utility.array.flatten(n))}})),function(e){this.forEach((function(t){t(e.matrix,e.viewpoint)}))}.bind(e.buildByType(client.webgl.game.course.Driver.rendererTypes(n)))},client.webgl.game.course.Driver.rendererTypes=function(e){return new Map([["GREEN",{handler:e.checker,mapper:function(e){return client.webgl.game.color.Vertex.fromTriangle(e,new game.model.Color(.4,.8,.2))}}],["BUNKER",{handler:e.curve,mapper:function(e){return client.webgl.game.color.Vertex.fromTriangle(e,new game.model.Color(.9,.8,0))}}],["WALL",{handler:e.simple,mapper:function(e){return client.webgl.game.color.Vertex.fromTriangle(e,new game.model.Color(.8,.8,.8))}}],["WOOD",{handler:e.simple,mapper:function(e){return client.webgl.game.color.Vertex.fromTriangle(e,new game.model.Color(.7,.5,0))}}],["HOLE",{handler:e.simple,mapper:function(e){return client.webgl.game.color.Vertex.fromTriangle(e,new game.model.Color(0,0,.8))}}]])},client.webgl.game.course.Driver.prototype.delta=function(){return game.timing.NORMAL_DELTA},client.webgl.game.course.Driver.prototype.drive=function(e){return this},client.webgl.game.course.Driver.prototype.renderer=function(){return new game.state.renderers.Wrapper(new client.webgl.game.course.Geometry(game.geometry.Matrix.IDENTITY,this.viewpoint),this.fRenderer)},client.webgl.game.color.Vertex.fromModel=function(e,t){return game.utility.array.flatten(e.map((function(e){return client.webgl.game.color.Vertex.fromTriangle(e,t)})))},client.webgl.game.color.Vertex.fromTriangle=function(e,t){return e.vertices().map((function(e){return new client.webgl.game.color.Vertex(e,t)}))},client.webgl.game.color.Vertex.data=function(e){return game.utility.array.flatten(e.map((function(e){return e.data()})))},client.webgl.game.color.Vertex.prototype.data=function(){return this.vertex.data().concat(this.color.data())},client.webgl.game.color.Shader.simple=function(e,t){return new client.webgl.game.color.Shader(e,"simple",t)},client.webgl.game.color.Shader.checker=function(e,t){return new client.webgl.game.color.Shader(e,"checker",t)},client.webgl.game.color.Shader.curve=function(e){return new client.webgl.game.color.Shader(e,"curve",client.webgl.game.color.Shader.CURVE_DEFINITIONS)},client.webgl.game.color.Shader.prototype.buildBuffer=function(e){const t=this.program.gl.createBuffer();return this.program.bindBuffer("ARRAY_BUFFER",t),this.program.bufferData("ARRAY_BUFFER",new Float32Array(client.webgl.game.color.Vertex.data(e)),"STATIC_DRAW"),t},client.webgl.game.color.Shader.prototype.render=function(e,t,n){this.program.bindBuffer("ARRAY_BUFFER",e),this.attributes.apply(),this.program.use(),this.uMatrix.apply(n),this.program.drawArrays("TRIANGLES",0,t)},client.webgl.game.color.Shader.prototype.renderer=function(e){return this.render.bind(this,this.buildBuffer(e),e.length)},client.webgl.game.CurveShader.prototype.buildBuffer=function(e){const t=this.program.gl.createBuffer();return this.program.bindBuffer("ARRAY_BUFFER",t),this.program.bufferData("ARRAY_BUFFER",new Float32Array(client.webgl.game.color.Vertex.data(e)),"STATIC_DRAW"),t},client.webgl.game.CurveShader.prototype.render=function(e,t,n,i){this.program.bindBuffer("ARRAY_BUFFER",e),this.attributes.apply(),this.program.use(),this.uMatrix.apply(n),this.uViewpoint.apply(i),this.program.drawArrays("TRIANGLES",0,t)},client.webgl.game.CurveShader.prototype.renderer=function(e){return this.render.bind(this,this.buildBuffer(e),e.length)},client.webgl.Program.load=function(e,t,n){const i=e.createProgram(),r=client.webgl.Program.findShaders(t);if(e.attachShader(i,client.webgl.Program.loadShader(e,e.VERTEX_SHADER,r.vertex,n)),e.attachShader(i,client.webgl.Program.loadShader(e,e.FRAGMENT_SHADER,r.fragment,n)),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(i));return new client.webgl.Program(e,i)},client.webgl.Program.findShaders=function(e){const t=document.getElementsByClassName(e),n={};for(var i=0;i<t.length;i++)switch(t[i].getAttribute("type")){case"x-shader/x-vertex":game.utility.assert(!n.vertex,"Multiple vertex shaders found"),n.vertex=t[i];break;case"x-shader/x-fragment":game.utility.assert(!n.fragment,"Multiple fragment shaders found"),n.fragment=t[i]}return game.utility.assert(n.vertex,"No vertex shader found"),game.utility.assert(n.fragment,"No fragment shader found"),n},client.webgl.Program.loadShader=function(e,t,n,i){const r=e.createShader(t);if(e.shaderSource(r,Object.keys(i).map((function(e){return["#define",e,i[e]].join(" ")+"\n"})).join("")+n.textContent),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(r));return r},client.webgl.Program.prototype.use=function(){this.gl.useProgram(this.program)},client.webgl.Program.prototype.getAttribLocation=function(e){return this.gl.getAttribLocation(this.program,e)},client.webgl.Program.prototype.getUniformLocation=function(e){return this.gl.getUniformLocation(this.program,e)},client.webgl.Program.prototype.bindBuffer=function(e,t){this.gl.bindBuffer(this.gl[e],t)},client.webgl.Program.prototype.bufferData=function(e,t,n){this.gl.bufferData(this.gl[e],t,this.gl[n])},client.webgl.Program.prototype.depthFunc=function(e){this.gl.depthFunc(this.gl[e])},client.webgl.Program.prototype.drawArrays=function(e,t,n){this.gl.drawArrays(this.gl[e],t,n)},client.webgl.Program.prototype.floatAttributes=function(){return new client.webgl.Attributes(this,this.gl.FLOAT,Float32Array.BYTES_PER_ELEMENT)},client.webgl.Program.prototype.uniform=function(e,t){return new client.webgl.Uniform(this,e,t)},client.webgl.Attributes.prototype.add=function(e,t,n){const i=this.program.getAttribLocation(e);return this.attributes.push((function(e){return this.program.gl.enableVertexAttribArray(i),this.program.gl.vertexAttribPointer(i,t,this.type,n,this.total*this.size,e*this.size),e+t})),this.total+=t,this},client.webgl.Attributes.prototype.apply=function(){var e=0;this.attributes.forEach((function(t){e=t.call(this,e)}),this)},client.webgl.Uniform.TYPES={"2fv":function(e,t,n){e.uniform2fv(t,n.data())},"3fv":function(e,t,n){e.uniform3fv(t,n.data())},"4fv":function(e,t,n){e.uniform4fv(t,n)},matrix4fv:function(e,t,n){e.uniformMatrix4fv(t,!1,n.data)}},client.webgl.Uniform.prototype.apply=function(e){this.applier(this.gl,this.location,e)},client.controls.Base.ARROW_THRESHOLD=.02,client.controls.Base.prototype.insertCameraAction=function(e){this.state.insertTimeEvent(game.state.drivers.Actioning.map(client.controls.CameraDriver.map(game.state.drivers.Camera.map(game.utility.identity,e))))},client.controls.Base.prototype.insertArrowAction=function(e){const t=this.connection.player;this.state.insertTimeEvent(game.state.drivers.Actioning.map(game.state.actions.dynamic((function(n){const i=n.driver.driver.drivers.get("players").driver.unconditionalDriver;return i.satisfied?client.controls.CameraDriver.map(game.state.drivers.Camera.map(game.state.drivers.Multi.map(new Map([["arrow",game.state.actions.ifExisting(client.controls.ArrowDriver.map((function(n){return n.replace({length:e(n.length,(function(){return i.conditionalDriver.drivers.get(t.id).driver.state.isHittable()}))})})),game.state.actions.constant())]]),game.state.drivers.Multi.OTHERS.KEEP,game.state.drivers.Multi.ORDERED.OTHERS_FIRST),game.utility.identity)):game.utility.identity}))))},client.controls.Base.prototype.insertArrowDisableAction=function(){this.insertArrowAction((function(e,t){return null}))},client.controls.Base.prototype.insertArrowEnableAction=function(){this.insertArrowAction((function(e,t){return null!=e?e:t()?0:void 0}))},client.controls.Base.prototype.insertResetAction=function(){const e=this.state.insertTimeEvent(client.State.playerAction(this.state.playerResetAction(this.connection.player.id)));this.connection.procedureSocket.send(game.network.Procedure.TREE.GAME.RESET.SELF.bind(e.timestamp))},client.controls.Base.prototype.insertBallAction=function(e,t){const n=this.state.insertTimeEvent(game.state.drivers.Actioning.map(client.controls.CameraDriver.map(game.state.drivers.Camera.map(game.state.drivers.Multi.map(new Map([["arrow",game.state.actions.ifExisting(client.controls.ArrowDriver.map((function(e){return e.replace({length:null})})),game.state.actions.constant())],["players",client.State.playerHitAction(this.connection.player.id,e,t)]]),game.state.drivers.Multi.OTHERS.KEEP,game.state.drivers.Multi.ORDERED.OTHERS_FIRST),game.utility.identity))));this.connection.procedureSocket.send(game.network.Procedure.TREE.GAME.HIT.SELF.bind(n.timestamp,e,t))},client.controls.Base.prototype.hitBall=function(){this.state.driveNow();const e=this.state.arrowDriver();if(e){const t=e.driver.length;if(null!=t&&t>=client.controls.Base.ARROW_THRESHOLD)return void this.insertBallAction(this.state.cameraDriver().camera.pan,(t-client.controls.Base.ARROW_THRESHOLD)/(1-client.controls.Base.ARROW_THRESHOLD))}this.insertArrowDisableAction()},client.controls.Resizer.prototype.handleResize=function(){const e=client.webgl.canvasSize(this.gl.canvas);client.webgl.resizeCanvas(this.gl.canvas,e),client.webgl.viewportFull(this.gl,e),this.base.insertCameraAction((function(t){return t.replace({ratio:e.u/e.v})}))},client.controls.Resizer.prototype.register=function(){this.cancelResize=client.webgl.onResize(this.handleResize.bind(this))},client.controls.Resizer.prototype.unregister=function(){this.cancelResize()},client.controls.Mouse.SENSITIVITY={SCALE:5,CENTER:{ANGLE:new game.geometry.Mapping(.0025,.0025),DISTANCE:.002,STRENGTH:.003}},client.controls.Mouse.prototype.insertMoveAction=function(e,t){this.base.state.insertTimeEvent(game.state.drivers.Actioning.map(client.controls.CameraDriver.map(game.state.actions.dynamic((function(n){const i=n.driver.drivers.get("arrow");return i&&null!=i.driver.length?game.state.drivers.Camera.map(game.state.drivers.Multi.map(new Map([["arrow",client.controls.ArrowDriver.map((function(e){return e.replace({length:game.utility.clamp(i.driver.length+t,0,1)})}))]]),game.state.drivers.Multi.OTHERS.KEEP,game.state.drivers.Multi.ORDERED.OTHERS_FIRST),(function(t){return t.adjustPivot(new game.geometry.Mapping(e.u,0))})):game.state.drivers.Camera.map(game.utility.identity,(function(t){return t.adjustPivot(e)}))})))))},client.controls.Mouse.prototype.handleMouseMove=function(e){this.insertMoveAction(this.sensitivity.angle.multiplyMapping(new game.geometry.Mapping(e.movementX,e.movementY)),-this.sensitivity.strength*e.movementY)},client.controls.Mouse.prototype.handleWheel=function(e){this.base.insertCameraAction(function(t,n){return n.adjustZoom(t*e.deltaY)}.bind(null,this.sensitivity.distance))},client.controls.Mouse.prototype.handleLockedClick=function(e){if(2==e.button){this.base.state.driveNow();const e=this.base.state.arrowDriver();e&&null!=e.driver.length?this.base.insertArrowDisableAction():document.exitPointerLock()}},client.controls.Mouse.prototype.handleLockedMouseDown=function(e){0==e.button&&this.base.insertArrowEnableAction()},client.controls.Mouse.prototype.handleLockedMouseUp=function(e){0==e.button&&this.base.hitBall()},client.controls.Mouse.prototype.handleUnlockedClick=function(){client.webgl.game.canvas().requestPointerLock({unadjustedMovement:!0}).catch((function(e){console.warn("Failed to acquire pointer lock",e),alert("Failed to acquire pointer lock. Please try a different browser or use keyboard controls.")}))},client.controls.Mouse.prototype.handleLockChange=function(){document.pointerLockElement?this.registerLocked():this.unregisterLocked()},client.controls.Mouse.prototype.registerLocked=function(){const e=client.webgl.game.canvas();e.removeEventListener("click",this.unlockedClickHandler),e.addEventListener("mousemove",this.mouseMoveHandler),e.addEventListener("wheel",this.wheelHandler),e.addEventListener("click",this.lockedClickHandler),e.addEventListener("mousedown",this.lockedMouseDownHandler),e.addEventListener("mouseup",this.lockedMouseUpHandler)},client.controls.Mouse.prototype.unregisterLocked=function(){const e=client.webgl.game.canvas();e.removeEventListener("mousemove",this.mouseMoveHandler),e.removeEventListener("wheel",this.wheelHandler),e.removeEventListener("click",this.lockedClickHandler),e.removeEventListener("mousedown",this.lockedMouseDownHandler),e.removeEventListener("mouseup",this.lockedMouseUpHandler),e.addEventListener("click",this.unlockedClickHandler)},client.controls.Mouse.prototype.register=function(){document.addEventListener("pointerlockchange",this.lockChangeHandler),client.webgl.game.canvas().addEventListener("click",this.unlockedClickHandler),document.pointerLockElement&&this.registerLocked()},client.controls.Mouse.prototype.unregister=function(){document.pointerLockElement&&this.unregisterLocked(),document.removeEventListener("pointerlockchange",this.lockChangeHandler),client.webgl.game.canvas().removeEventListener("click",this.unlockedClickHandler)},client.controls.Keyboard.CAMERA_ACCELERATION=new game.geometry.Vector(6,6,8),client.controls.Keyboard.ARROW_ACCELERATION=6,client.controls.Keyboard.PAN_DIRECTION=new game.geometry.Vector(1,0,0),client.controls.Keyboard.TILT_DIRECTION=new game.geometry.Vector(0,1,0),client.controls.Keyboard.ZOOM_DIRECTION=new game.geometry.Vector(0,0,1),client.controls.Keyboard.prototype.insertDirectionAction=function(){const e=this.truncate(),t=e.multiplyVector(client.controls.Keyboard.CAMERA_ACCELERATION),n=-e.y*client.controls.Keyboard.ARROW_ACCELERATION;this.base.state.insertTimeEvent(game.state.drivers.Actioning.map(client.controls.CameraDriver.mapWithAcceleration(game.state.actions.dynamic((function(e){return e.driver.drivers.get("arrow")?game.state.drivers.Camera.map(game.state.drivers.Multi.map(new Map([["arrow",client.controls.ArrowDriver.mapWithAcceleration(game.utility.identity,n)]]),game.state.drivers.Multi.OTHERS.KEEP,game.state.drivers.Multi.ORDERED.OTHERS_FIRST),game.utility.identity):game.utility.identity})),t)))},client.controls.Keyboard.prototype.truncate=function(){return new game.geometry.Vector(game.utility.clamp(this.direction.x,-1,1),game.utility.clamp(this.direction.y,-1,1),game.utility.clamp(this.direction.z,-1,1))},client.controls.Keyboard.prototype.up=function(){this.direction=this.direction.subtract(client.controls.Keyboard.TILT_DIRECTION),this.insertDirectionAction()},client.controls.Keyboard.prototype.down=function(){this.direction=this.direction.add(client.controls.Keyboard.TILT_DIRECTION),this.insertDirectionAction()},client.controls.Keyboard.prototype.left=function(){this.direction=this.direction.subtract(client.controls.Keyboard.PAN_DIRECTION),this.insertDirectionAction()},client.controls.Keyboard.prototype.right=function(){this.direction=this.direction.add(client.controls.Keyboard.PAN_DIRECTION),this.insertDirectionAction()},client.controls.Keyboard.prototype.in=function(){this.direction=this.direction.subtract(client.controls.Keyboard.ZOOM_DIRECTION),this.insertDirectionAction()},client.controls.Keyboard.prototype.out=function(){this.direction=this.direction.add(client.controls.Keyboard.ZOOM_DIRECTION),this.insertDirectionAction()},client.controls.Keyboard.prototype.arrow=function(){this.base.insertArrowEnableAction()},client.controls.Keyboard.prototype.ball=function(){this.base.hitBall()},client.controls.Keyboard.prototype.cancel=function(){this.base.insertArrowDisableAction()},client.controls.Keyboard.prototype.buildTracker=function(){const e=new client.controls.KeyTracker;return e.listen(["ArrowUp","KeyW"],[this.up.bind(this)],[this.down.bind(this)]),e.listen(["ArrowDown","KeyS"],[this.down.bind(this)],[this.up.bind(this)]),e.listen(["ArrowLeft","KeyA"],[this.left.bind(this)],[this.right.bind(this)]),e.listen(["ArrowRight","KeyD"],[this.right.bind(this)],[this.left.bind(this)]),e.listen(["Comma","NumpadSubtract"],[this.out.bind(this)],[this.in.bind(this)]),e.listen(["Period","NumpadAdd"],[this.in.bind(this)],[this.out.bind(this)]),e.listen(["Space","ShiftLeft","ShiftRight"],[this.arrow.bind(this)],[this.ball.bind(this)]),e.listen(["Escape","Backspace"],[this.cancel.bind(this)],[]),e},client.controls.Keyboard.prototype.register=function(){window.addEventListener("keydown",this.keyDownHandler),window.addEventListener("keyup",this.keyUpHandler)},client.controls.Keyboard.prototype.unregister=function(){window.removeEventListener("keydown",this.keyDownHandler),window.removeEventListener("keyup",this.keyUpHandler)},client.controls.KeyTracker.prototype.handleDown=function(e){const t=this.map.get(e.code);t&&(e.preventDefault(),t.pressed||(t.pressed=!0,t.handlers.down.forEach((function(t){t(e)}))))},client.controls.KeyTracker.prototype.handleUp=function(e){const t=this.map.get(e.code);t&&(e.preventDefault(),t.pressed&&(t.pressed=!1,t.handlers.up.forEach((function(t){t(e)}))))},client.controls.KeyTracker.prototype.listenDown=function(e,t){this.addOrGet(e).handlers.down.push(t)},client.controls.KeyTracker.prototype.listenUp=function(e,t){this.addOrGet(e).handlers.up.push(t)},client.controls.KeyTracker.prototype.listen=function(e,t,n){e.forEach(function(e){t.forEach(this.listenDown.bind(this,e)),n.forEach(this.listenUp.bind(this,e))}.bind(this))},client.controls.KeyTracker.prototype.addOrGet=function(e){return this.map.has(e)||this.map.set(e,{pressed:!1,handlers:{down:[],up:[]}}),this.map.get(e)},client.controls.CameraDriver.FRICTION=client.controls.Keyboard.CAMERA_ACCELERATION.multiply(.75),client.controls.CameraDriver.MAX_LIMIT=client.controls.Keyboard.CAMERA_ACCELERATION.subtract(client.controls.CameraDriver.FRICTION).multiply(1.5),client.controls.CameraDriver.MIN_LIMIT=client.controls.CameraDriver.MAX_LIMIT.negate(),client.controls.CameraDriver.from=function(e,t){return new client.controls.CameraDriver(e,t,new game.geometry.Vector(0,0,0),new game.geometry.Vector(0,0,0))},client.controls.CameraDriver.map=function(e){return function(t){return new client.controls.CameraDriver(e(t.driver),t.mapper,t.velocity,t.acceleration)}},client.controls.CameraDriver.mapWithAcceleration=function(e,t){return function(n){return new client.controls.CameraDriver(e(n.driver),n.mapper,n.velocity,t)}},client.controls.CameraDriver.prototype.delta=function(){return this.driver.delta()},client.controls.CameraDriver.prototype.drive=function(e){const t=this.driver.drive(e),n=t.camera.adjust(this.mapper(t,this.velocity).multiply(e));var i=this.velocity.add(this.acceleration.multiply(e)).towardsZero(client.controls.CameraDriver.FRICTION.multiply(e)).min(client.controls.CameraDriver.MAX_LIMIT).max(client.controls.CameraDriver.MIN_LIMIT);return(n.tilt==-client.Camera.TILT_RANGE&&i.y<0||n.tilt==client.Camera.TILT_RANGE&&i.y>0)&&(i=new game.geometry.Vector(i.x,0,i.z)),(n.zoom==1/client.Camera.ZOOM_RANGE&&i.z<0||n.zoom==client.Camera.ZOOM_RANGE&&i.z>0)&&(i=new game.geometry.Vector(i.x,i.y,0)),new client.controls.CameraDriver(game.state.drivers.Camera.map(game.utility.identity,(function(){return n}))(t),this.mapper,i,this.acceleration)},client.controls.CameraDriver.prototype.renderer=function(){return this.driver.renderer()},client.controls.ArrowDriver.FRICTION=.75*client.controls.Keyboard.ARROW_ACCELERATION,client.controls.ArrowDriver.LIMIT=client.controls.Keyboard.ARROW_ACCELERATION-client.controls.ArrowDriver.FRICTION,client.controls.ArrowDriver.from=function(e){return new client.controls.ArrowDriver(e,0,0)},client.controls.ArrowDriver.map=function(e){return function(t){return new client.controls.ArrowDriver(e(t.driver),t.velocity,t.acceleration)}},client.controls.ArrowDriver.mapWithAcceleration=function(e,t){return function(n){return new client.controls.ArrowDriver(e(n.driver),n.velocity,t)}},client.controls.ArrowDriver.prototype.delta=function(){return this.driver.delta()},client.controls.ArrowDriver.prototype.drive=function(e){const t=this.driver.drive(e);if(null==t.length)return new client.controls.ArrowDriver(t,this.velocity,this.acceleration);const n=game.utility.clamp(t.length+this.velocity*e,0,1);var i=game.utility.clamp(game.utility.towardsZero(this.velocity+this.acceleration*e,client.controls.ArrowDriver.FRICTION*e),-client.controls.ArrowDriver.LIMIT,client.controls.ArrowDriver.LIMIT);return(0==n&&i<0||1==n&&i>0)&&(i=0),new client.controls.ArrowDriver(t.replace({length:n}),i,this.acceleration)},client.controls.ArrowDriver.prototype.renderer=function(){return this.driver.renderer()},client.State.build=function(e,t,n){const i=new game.state.updaters.TimeEvent,r=new game.state.updaters.IndexEvent,o=new game.state.updaters.TimeSync,a={index:0};return new client.State(e,t,new game.state.Trace(n,game.state.updaters.smoother(game.state.updaters.multi([i.pruner(),r.pruner(),o.pruner()]),game.state.updaters.multi([game.state.updaters.driver,i.applier(),game.state.updaters.ifLastChanged(r.applier(),game.state.updaters.extrapolate),o.applier()]),game.state.updaters.indexPruner(game.state.updaters.indexPruner.reference(a),1,2),5e-4)),o,r,i,a)},client.State.playerMapAction=function(e){return game.state.drivers.RendererOverride.map(game.state.drivers.Conditional.mapUnconditional(game.state.drivers.Conditional.mapConditional(game.state.drivers.Multi.map(e,game.state.drivers.Multi.OTHERS.KEEP,game.state.drivers.Multi.ORDERED.ASCENDING))))},client.State.playerTimestampsAction=function(e,t,n){return game.state.drivers.RendererOverride.map(game.state.drivers.Conditional.mapBoth(game.state.drivers.Conditional.mapBoth(game.state.drivers.Timer.action(e),game.state.actions.constant(new game.state.drivers.Multi(n))),game.state.drivers.Timer.action(t)))},client.State.playerAction=function(e){return game.state.drivers.Actioning.map(client.controls.CameraDriver.map(game.state.drivers.Camera.map(game.state.drivers.Multi.map(new Map([["players",e]]),game.state.drivers.Multi.OTHERS.KEEP,game.state.drivers.Multi.ORDERED.OTHERS_FIRST),game.utility.identity)))},client.State.playerLeaveAction=function(e){return client.State.playerMapAction(new Map([[e,game.state.drivers.RendererOverride.map(game.state.drivers.Player.map((function(e){return e.withLeft(!0)})))]]))},client.State.playerHitAction=function(e,t,n){return client.State.playerMapAction(new Map([[e,client.State.playerDriverHitAction(t,n)]]))},client.State.playerDriverWithPlayer=function(e){return game.state.drivers.RendererOverride.map(game.state.drivers.Player.map((function(t){return t.withPlayer(e)})))},client.State.playerDriverFromResultData=function(e){return game.state.drivers.RendererOverride.map(game.state.drivers.Player.map((function(t){return game.network.PlayerResult.fromData(e).toState(t.ball)})))},client.State.playerDriverHitAction=function(e,t){return game.state.drivers.RendererOverride.map(game.state.drivers.Player.map((function(n){return n.hit(e,t)})))},client.State.prototype.nowS=function(){return game.timing.nowS(this.reference)},client.State.prototype.nowTicks=function(){return game.timing.nowTicks(this.reference)},client.State.prototype.driveNow=function(){this.trace.drive(this.nowTicks())},client.State.prototype.insertTimeEvent=function(e){this.driveNow();const t=this.trace.timeEventAfter(e);return this.timeEvent.insert(t),t},client.State.prototype.run=function(){const e=this;var t=window.requestAnimationFrame((function n(i){const r=game.timing.msToTicks(i-e.reference);e.trace.drive(r),e.trace.render(r),t=window.requestAnimationFrame(n)}));return function(){window.cancelAnimationFrame(t)}},client.State.prototype.cameraDriver=function(){return this.trace.lastFrame().driver.driver.driver.driver},client.State.prototype.arrowDriver=function(){return this.cameraDriver().driver.drivers.get("arrow")},client.State.prototype.originBall=function(){return this.playerDriver.driver.state.ball.current},client.State.prototype.frameActionEntries=function(e){return e.map(function(e){const t=game.state.drivers.RendererOverride.map(e)(this.playerDriver);return[t.driver.state.player.id,t]}.bind(this)).sort(game.utility.collection.map.KEY_COMPARATOR)},client.State.prototype.frameAction=function(e){return client.State.playerAction(client.State.playerTimestampsAction(e.totalTime,e.endTime,new Map(this.frameActionEntries(e.playerActions))))},client.State.prototype.playerEnterAction=function(e){return client.State.playerMapAction(new Map([[e.id,game.state.actions.ifExisting(game.state.drivers.RendererOverride.map(game.state.drivers.Player.map((function(t){return t.withPlayer(e).withLeft(!1)}))),game.state.actions.constant(client.State.playerDriverWithPlayer(e)(this.playerDriver)))]]))},client.State.prototype.playerResetAction=function(e){const t=this.originBall();return client.State.playerMapAction(new Map([[e,game.state.drivers.RendererOverride.map(game.state.drivers.Player.map((function(e){return e.reset(t)})))]]))},client.State.prototype.insertPlayerAction=function(e,t){this.timeEvent.insert(new game.state.TimeEvent(e,client.State.playerAction(t)))},client.State.prototype.insertEnterAction=function(e,t){this.insertPlayerAction(e,this.playerEnterAction(t))},client.State.prototype.insertLeaveAction=function(e,t){this.insertPlayerAction(e,client.State.playerLeaveAction(t))},client.State.prototype.insertResetAction=function(e,t){this.insertPlayerAction(e,this.playerResetAction(t))},client.State.prototype.insertFrameAction=function(e){this.prunerData.index=Math.max(this.prunerData.index,e.index),this.timeSync.insert(new game.state.TimeSync(e.index,e.timestamp)),this.indexEvent.insert(new game.state.IndexEvent(e.index,this.frameAction(e)))},client.State.prototype.insertHitAction=function(e,t,n,i){this.insertPlayerAction(e,client.State.playerHitAction(t,n,i))},client.Camera.GRAVITY=10,client.Camera.TILT_RANGE=.4*Math.PI,client.Camera.ZOOM_RANGE=5,client.Camera.prototype.replace=function(e){const t=game.utility.mergeObjects([this,e]);return new client.Camera(t.center,t.pan,t.tilt,t.zoom,t.ratio)},client.Camera.prototype.follow=function(e,t){return this.replace({center:e.interpolate(this.center,Math.exp(-t*client.Camera.GRAVITY))})},client.Camera.prototype.adjustPivot=function(e){return this.replace({pan:game.utility.modPositive(this.pan+e.u,2*Math.PI),tilt:game.utility.clamp(this.tilt+e.v,-client.Camera.TILT_RANGE,client.Camera.TILT_RANGE)})},client.Camera.prototype.adjustZoom=function(e){return this.replace({zoom:game.utility.clamp(this.zoom*Math.exp(e),1/client.Camera.ZOOM_RANGE,client.Camera.ZOOM_RANGE)})},client.Camera.prototype.adjust=function(e){return this.adjustPivot(e.xyMapping()).adjustZoom(e.z)},client.Camera.prototype.position=function(){return game.geometry.Matrix.translation(new game.geometry.Vector(0,0,-1).multiply(25*this.zoom)).dot(game.geometry.Matrix.rotationX(this.tilt+Math.PI/2)).dot(game.geometry.Matrix.rotationZ(this.pan)).dot(game.geometry.Matrix.translation(this.center)).translation()},client.Camera.prototype.matrix=function(){return game.geometry.Matrix.translation(this.center.negate()).dot(game.geometry.Matrix.rotationZ(-this.pan)).dot(game.geometry.Matrix.rotationX(-this.tilt-Math.PI/2)).dot(game.geometry.Matrix.translation(new game.geometry.Vector(0,0,1).multiply(25*this.zoom))).dot(game.geometry.Matrix.projection(this.ratio,1,1,2e4))},client.params.parseBoolean("trackListeners")){function countEventListeners(){return game.utility.collection.values(Node._listeners).map((function(e){return e._listeners.size})).reduce((function(e,t){return e+t}),0)}Node._listeners=new Set,Node.prototype._addEventListener=Node.prototype.addEventListener,Node.prototype.addEventListener=function(e,t,n){this._addEventListener(e,t,n),this._listeners||(this._listeners=new Map,game.utility.collection.set.addNew(Node._listeners,this)),game.utility.assert(!this._listeners.has(e),"Listener for type already exists"),this._listeners.set(e,t),console.log("total number of listeners increased to "+countEventListeners())},Node.prototype._removeEventListener=Node.prototype.removeEventListener,Node.prototype.removeEventListener=function(e,t,n){this._removeEventListener(e,t,n),game.utility.assert(this._listeners,"There are no listeners to remove"),game.utility.assert(this._listeners.has(e),"There is no listener of the given type"),game.utility.assert(this._listeners.get(e)===t,"Different listener for the given type"),this._listeners.delete(e),0==this._listeners.size&&(delete this._listeners,game.utility.collection.set.deleteExisting(Node._listeners,this)),console.log("total number of listeners decreased to "+countEventListeners())},console.log("listener tracking enabled")}client.TEST_COURSE=client.params.parseInteger("testCourse"),client.TEST_COURSE_ENABLED=null!==client.TEST_COURSE&&client.TEST_COURSE>=0&&client.TEST_COURSE<game.network.COURSES().length,client.TEST_COURSE_ENABLED&&console.log("course testing enabled (course: "+client.TEST_COURSE+")"),window.addEventListener("load",client.load);
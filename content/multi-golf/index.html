<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Multi Golf</title>
		<link rel="stylesheet" href="game.css?1740228973">
		<script src="game.min.js?1740228973"></script>
		<script src="courses.min.js?1740228973"></script>
		<script src="client.min.js?1740228973"></script>
		<script type="x-shader/x-vertex" class="simple">
			attribute vec4 aPosition;
			attribute vec3 aNormal;
			attribute vec3 aColor;

			uniform mat4 uMatrix;

			varying vec3 vColor;

			void main() {
				vColor = aColor * (LIGHT_CENTER + LIGHT_SCALE * dot(aNormal, LIGHT_VECTOR));
				gl_Position = uMatrix * aPosition;
			}
		</script>
		<script type="x-shader/x-fragment" class="simple">
			precision mediump float;

			varying vec3 vColor;

			void main() {
				gl_FragColor = vec4(vColor, 1);
			}
		</script>
		<script type="x-shader/x-vertex" class="checker">
			attribute vec4 aPosition;
			attribute vec3 aNormal;
			attribute vec3 aColor;

			uniform mat4 uMatrix;

			varying vec2 vPosition;
			varying vec2 vNormal;
			varying vec3 vColor;

			void main() {
				vPosition = aPosition.xy;
				vNormal = vec2(length(aNormal.xy), aNormal.z);
				vColor = aColor * (LIGHT_CENTER + LIGHT_SCALE * dot(aNormal, LIGHT_VECTOR));
				gl_Position = uMatrix * aPosition;
			}
		</script>
		<script type="x-shader/x-fragment" class="checker">
			precision mediump float;

			varying vec2 vPosition;
			varying vec2 vNormal;
			varying vec3 vColor;

			void main() {
				float checkerX = floor(vPosition.x / CHECKER_SIZE);
				float checkerY = floor(vPosition.y / CHECKER_SIZE);
				float even = float(mod(checkerX + checkerY, 2.0) < 0.5);
				float slope = clamp(
					(CHECKER_SLOPE_MAX - vNormal.x / vNormal.y)
						/ (CHECKER_SLOPE_MAX - CHECKER_SLOPE_MIN), 0.0, 1.0
				);
				float multiplier = mix(1.0, CHECKER_MULTIPLIER, even * slope);
				gl_FragColor = vec4(vColor * multiplier, 1);
			}
		</script>
		<script type="x-shader/x-vertex" class="curve">
			attribute vec4 aPosition;
			attribute vec3 aNormal;
			attribute vec3 aColor;

			uniform mat4 uMatrix;
			uniform vec3 uViewpoint;

			varying vec2 vPosition;
			varying vec3 vColor;
			varying vec3 vViewpoint;

			vec3 transform(vec3 dViewpoint) {
				return vec3(dViewpoint.xy, dViewpoint.z + dot(dViewpoint.xy, aNormal.xy / aNormal.z));
			}

			void main() {
				vPosition = aPosition.xy;
				vColor = aColor * (LIGHT_CENTER + LIGHT_SCALE * dot(aNormal, LIGHT_VECTOR));
				vViewpoint = transform(uViewpoint - aPosition.xyz);
				gl_Position = uMatrix * aPosition;
			}
		</script>
		<script type="x-shader/x-fragment" class="curve">
			precision mediump float;

			varying vec2 vPosition;
			varying vec3 vColor;
			varying vec3 vViewpoint;

			float curve(vec2 xy) {
				return CURVE_FUNCTION;
			}

			vec2 refraction(float z) {
				float cameraL = length(vViewpoint.xy);
				float index = CURVE_REFRAC_INDEX * cameraL / length(vViewpoint);
				float refracL = z / sqrt(1.0 - index * index) * index;
				return refracL * vViewpoint.xy / cameraL;
			}

			void main() {
				float z = curve(vPosition);
				float refracZ = curve(vPosition + refraction(z - CURVE_REFRAC_Z));
				float multiplier = CURVE_OFFSET + CURVE_SCALE * refracZ;
				gl_FragColor = vec4(vColor * multiplier, 1);
			}
		</script>
		<script type="x-shader/x-vertex" class="arrow">
			attribute vec4 aPosition;
			attribute vec2 aMapping;

			uniform mat4 uMatrix;

			varying vec2 vMapping;

			void main() {
				vMapping = aMapping;
				gl_Position = uMatrix * aPosition;
			}
		</script>
		<script type="x-shader/x-fragment" class="arrow">
			precision mediump float;

			uniform vec2 uExtents;
			uniform vec4 uColor;

			varying vec2 vMapping;

			bool inArrow(float length) {
				return abs(vMapping.y) <= HALF_WIDTH * uExtents.y
					&& vMapping.x >= 0.0
					&& vMapping.x + abs(vMapping.y) * TIP_RATIO <= uExtents.x;
			}

			bool inSection() {
				float section = (vMapping.x - uExtents.y * INNER_RADIUS) / (uExtents.y * SECTION_LENGTH);
				return vMapping.x + TIP_RATIO * HALF_WIDTH >= uExtents.x
					|| abs(section - floor(section + 0.5)) >= SECTION_GAP;
			}

			void main() {
				float length = length(vMapping);
				if (length >= INNER_RADIUS * uExtents.y &&
						(length <= uExtents.y || (inArrow(length) && inSection()))) {
					gl_FragColor = uColor;
				} else {
					discard;
				}
			}
		</script>
		<script type="x-shader/x-vertex" class="confetti">
			attribute vec2 aPosition;
			attribute vec3 aColor;

			varying vec3 vColor;

			void main() {
				vColor = aColor;
				gl_Position = vec4(aPosition, 0, 1);
			}
		</script>
		<script type="x-shader/x-fragment" class="confetti">
			precision mediump float;

			varying vec3 vColor;
			
			void main() {
				gl_FragColor = vec4(vColor, 1);
			}
		</script>
	</head>
	<body>
		<div id="game">
			<canvas></canvas>
			<table id="game-ranking" class="box">
				<thead>
					<tr>
						<th>#</th>
						<th>Name <span class="id">(ID)</span></th>
						<th>Strokes</th>
						<th></th>
					</tr>
				</thead>
				<tbody></tbody>
			</table>
			<div id="timer"></div>
			<div id="game-menu">
				<button class="secondary">Reset Ball</button><button class="secondary">?</button>
				<div>
					<h2>Mouse Sensitivity</h2>
					<table class="sensitivity">
						<tbody>
							<tr>
								<td><label for="angle-sensitivity">Camera angle</label></td>
								<td><input id="angle-sensitivity" type="range"></td>
								<td></td>
							</tr>
							<tr>
								<td><label for="distance-sensitivity">Camera distance</label></td>
								<td><input id="distance-sensitivity" type="range"></td>
								<td></td>
							</tr>
							<tr>
								<td><label for="strength-sensitivity">Hitting strength</label></td>
								<td><input id="strength-sensitivity" type="range"></td>
								<td></td>
							</tr>
						</tbody>
					</table>
					<h2>Controls</h2>
					<table class="controls">
						<thead>
							<tr>
								<th>Mode</th>
								<th>Mouse</th>
								<th>Keyboard</th>
								<th>Type</th>
								<th>Action</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>Unlocked mouse pointer</td>
								<td><em>LMB</em></td>
								<td></td>
								<td>press on canvas</td>
								<td>Lock mouse pointer</td>
							</tr>
							<tr>
								<td>Locked mouse pointer</td>
								<td><em>RMB</em></td>
								<td></td>
								<td>press</td>
								<td>Unlock mouse pointer</td>
							</tr>
							<tr>
								<td>Camera</td>
								<td><em>Move</em></td>
								<td><em>WASD</em> or <em>Arrows</em></td>
								<td></td>
								<td>Adjust camera angle</td>
							</tr>
							<tr>
								<td></td>
								<td><em>Wheel</em></td>
								<td><em>,</em> / <em>.</em> or <em>-</em> / <em>+</em> (Numpad)</td>
								<td></td>
								<td>Adjust camera distance</td>
							</tr>
							<tr>
								<td></td>
								<td><em>LMB</em></td>
								<td><em>Space</em> or <em>Shift</em></td>
								<td>hold</td>
								<td>Start aiming</td>
							</tr>
							<tr>
								<td>Aiming</td>
								<td><em>Move</em></td>
								<td><em>WASD</em> or <em>Arrows</em></td>
								<td></td>
								<td>Adjust hitting angle and strength</td>
							</tr>
							<tr>
								<td></td>
								<td><em>LMB</em></td>
								<td><em>Space</em> or <em>Shift</em></td>
								<td>release</td>
								<td>Hit ball</td>
							</tr>
							<tr>
								<td></td>
								<td><em>RMB</em></td>
								<td><em>Escape</em> or <em>Backspace</em></td>
								<td>press</td>
								<td>End aiming without hitting the ball</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div id="game-start" class="overlay">
				<div class="medium">game starts in</div>
				<div class="large"></div>
			</div>
			<div id="player-end" class="overlay">
				<div class="medium">
					<div>course completed!</div>
					<div>no strokes left!</div>
					<div>time is up!</div>
				</div>
				<div class="small">waiting for other players &hellip;</div>
			</div>
			<div id="game-end" class="overlay">
				<div class="medium">game ends in</div>
				<div class="large"></div>
			</div>
		</div>
		<div id="menu">
			<div class="background"></div>
			<div class="version">Last Update: Sat, 22 Feb 2025 12:56:13 GMT</div>
			<div id="session-ranking" class="panel">
				<div id="session-ranking-place"></div>
				<table class="box">
					<thead>
						<tr>
							<th>#</th>
							<th>Name <span class="id">(ID)</span></th>
							<th>Strokes</th>
							<th>Rating</th>
						</tr>
					</thead>
					<tbody></tbody>
				</table>
				<hr>
				<button id="session-ranking-continue" class="primary">Continue</button>
				<canvas></canvas>
			</div>
			<div id="session" class="panel">
				<div class="left-two-thirds">
					<span id="session-key" class="box">
						<span class="key">Key:</span>
						<span class="value"></span>
					</span>
				</div>
				<div class="right-one-third">
					<button id="session-copy" class="secondary">Copy Link</button>
				</div>
				<div class="clear"></div>
				<hr>
				<table class="box">
					<thead>
						<tr>
							<th>#</th>
							<th>Name <span class="id">(ID)</span></th>
							<th>Rating</th>
						</tr>
					</thead>
					<tbody></tbody>
				</table>
				<hr>
				<div class="left-half">
					<button id="session-leave" class="secondary">Leave</button>
				</div>
				<div class="right-half">
					<button id="session-start" class="primary">Start</button>
				</div>
			</div>
			<div id="session-join" class="panel">
				<div>
					<label for="session-join-input" class="header">Session Key</label>
					<label for="session-join-input" class="validation"></label>
					<input id="session-join-input" type="text" maxlength="8">
				</div>
				<button class="primary">Join</button>
				<button class="secondary">Cancel</button>
			</div>
			<div id="name-change" class="panel">
				<div>
					<label for="name-change-input" class="header">Player Name</label>
					<label for="name-change-input" class="validation"></label>
					<input id="name-change-input" type="text" maxlength="16">
				</div>
				<button class="primary">Change</button>
				<button class="secondary">Cancel</button>
			</div>
			<div id="lobby" class="panel">
				<div class="left-two-thirds">
					<span id="lobby-name" class="box">
						<span class="key" title="Your name as it is shown to other players. Is is not required to be unique, so other players also see your player ID.">Name:</span>
						<span class="value"></span>
					</span>
				</div>
				<div class="right-one-third">
					<button id="lobby-change-name" class="secondary">Change Name</button>
				</div>
				<div class="left-two-thirds">
					<span id="lobby-key" class="box">
						<span class="key" title="This random code allows you to login to this account, so keep it secret. It is stored in your browser for convenience, but you might want to keep a copy of it somewhere else, to not lose your progress.">Key:</span>
						<span class="value"></span>
					</span>
				</div>
				<div class="right-one-third">
					<button id="lobby-toggle-key"></button>
				</div>
				<span id="lobby-id" class="box">
					<span class="key" title="Identifies your account and is shown to other players to help them distinguish different players with the same name.">ID:</span>
					<span class="value"></span>
				</span>
				<span id="lobby-rating" class="box">
					<span class="key" title="This number expresses your skill level compared to other players. After each game, your rating is adjusted according to your placement and the ratings of your opponents. As a new player, you get a rating of 1000. This is also the average rating across all registered players.">Rating:</span>
					<span class="value"></span>
				</span>
				<span id="lobby-registration" class="box">
					<span class="key" title="Date of registration for this account.">Registration:</span>
					<span class="value"></span>
				</span>
				<hr>
				<div class="left-half">
					<button id="lobby-create-session" class="primary">Create Session</button>
				</div>
				<div class="right-half">
					<button id="lobby-join-session" class="primary">Join Session</button>
				</div>
				<div class="clear"></div>
				<hr>
				<button id="lobby-log-out" class="secondary">Log out</button>
			</div>
			<div id="login" class="panel">
				<div>
					<label for="login-key-input" class="header" title="Enter the random code you obtained after registration to log in again.">Player Key</label>
					<label for="login-key-input" class="validation"></label>
					<input id="login-key-input" type="text" maxlength="16">
				</div>
				<button class="primary">Log in</button>
				<hr>
				<button class="secondary">Register as new player</button>
			</div>
			<div id="registration" class="panel">
				<div>
					<label for="registration-name-input" class="header" title="Choose a name that is shown to other players. You can change it later.">Player Name</label>
					<label for="registration-name-input" class="validation"></label>
					<input id="registration-name-input" type="text" maxlength="16">
				</div>
				<button class="primary">Register</button>
				<hr>
				<button class="secondary">Log in as existing player</button>
			</div>
		</div>
	</body>
</html>

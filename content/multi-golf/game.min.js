const game={utility:{collection:{map:{entries:function(t){const e=[];return t.forEach((function(t,r){e.push([r,t])})),e},keys:function(t){const e=[];return t.forEach((function(t,r){e.push(r)})),e},object:function(t){const e={};return t.forEach((function(t,r){e[r]=t})),e},comparingKeys:function(t){return game.utility.comparators.mapped(t,(function(t){return t[0]}))},setNew:function(t,e,r){game.utility.assert(!t.has(e),"Key already exists"),t.set(e,r)},deleteExisting:function(t,e){game.utility.assert(t.delete(e),"Key does not exist")}},set:{addNew:function(t,e){game.utility.assert(!t.has(e),"Value already exists"),t.add(e)},deleteExisting:function(t,e){game.utility.assert(t.delete(e),"Value does not exist")}},values:function(t){const e=[];return t.forEach((function(t){e.push(t)})),e}},json:{isBoolean:function(t){return"boolean"==typeof t},isNumber:function(t){return"number"==typeof t},isString:function(t){return"string"==typeof t},isArray:function(t){return Array.isArray(t)},isObject:function(t){return"object"==typeof t&&!Array.isArray(t)&&null!==t},isPrimitive:function(t){return null===t||game.utility.json.isBoolean(t)||game.utility.json.isNumber(t)||game.utility.json.isString(t)},isAny:function(t){return game.utility.json.isArray(t)||game.utility.json.isObject(t)||game.utility.json.isPrimitive(t)}},random:{integer:function(t){return Math.floor(t*Math.random())},integerRange:function(t,e){return t+game.utility.random.integer(e-t)},closedRange:function(t,e){return game.utility.random.integerRange(t,e+1)},range:function(t,e){return t+(e-t)*Math.random()},character:function(t){return t.charAt(game.utility.random.integer(t.length))},string:function(t,e){const r=[];for(var n=0;n<e;n++)r.push(game.utility.random.character(t));return r.join("")},generate:function(t,e){do{var r=t()}while(!e(r));return r}},comparators:{default:function(t,e){return t<e?-1:t>e?1:0},mapped:function(t,e){return function(r,n){return t(e(r),e(n))}},ordered:function(t){return function(e,r){for(var n=0;n<t.length;n++){const i=t[n](e,r);if(0!=i)return i}return 0}}},array:{assignLastN:function(t,e,r){t[t.length-e]=r},assignLast:function(t,e){game.utility.array.assignLastN(t,1,e)},lastN:function(t,e){return game.utility.assert(e>0&&e<=t.length,"Out of bounds"),t[t.length-e]},last:function(t){return game.utility.array.lastN(t,1)},pushFirst:function(t){return t.push(t[0]),t},equals:function(t,e,r){return 0==r?t===e:t.length==e.length&&t.every((function(t,n){return game.utility.array.equals(t,e[n],r-1)}))},flatten:function(t){const e=[];return t.forEach((function(t){t.forEach((function(t){e.push(t)}))})),e},binarySearch:function(t,e){for(var r=0,n=t.length;r<n;){const i=Math.floor((r+n)/2);e(t[i])?r=i+1:n=i}return r}},assert:function(t,e){if(!t)throw new Error(e)},identity:function(t){return t},constant:function(t){return function(){return t}},lazy:function(t){const e=[];return function(){return 0==e.length&&e.push(t()),e[0]}},discriminate:function(t,e,r,n){const i=new Map;return t.forEach((function(t){const r=e(t);var n=i.get(r);n||(n=[],i.set(r,n)),n.push(t)})),game.utility.collection.map.entries(i).sort(game.utility.collection.map.comparingKeys(r)).map((function(t){return t[1].sort(n)}))},mergeObjects:function(t){const e={};return t.forEach((function(t){Object.keys(t).forEach((function(r){e[r]=t[r]}))})),e},interpolate:function(t,e,r){return t*(1-r)+e*r},clamp:function(t,e,r){return Math.min(Math.max(t,e),r)},towardsZero:function(t,e){return game.utility.assert(e>=0,"Offset must be non-negative"),t<-e?t+e:t>e?t-e:0},modPositive:function(t,e){return t-Math.floor(t/e)*e},parseNumber:function(t,e){const r=t(e);return game.utility.assert(!isNaN(r)&&r.toString()===e,"Invalid number"),r}},geometry:{Vector:function(t,e,r){this.x=t,this.y=e,this.z=r},Mapping:function(t,e){this.u=t,this.v=e},Plane:function(t,e){this.normal=t,this.offset=e},Matrix:function(t){this.data=t},void:{dot:function(t){return this},interpolate:function(t,e){return game.utility.assert(this===t,"Should be both void"),this}}},model:{Color:function(t,e,r){this.r=t,this.g=e,this.b=r},Path:function(t,e){this.mapper=t,this.count=e},Vertex:function(t,e,r,n){this.position=t,this.normal=e,this.color=r,this.checker=n?1:0},Triangle:function(t,e,r){this.a=t,this.b=e,this.c=r}},collision:{handlers:{Collection:function(t){this.handlers=t},Rebound:function(t,e,r,n,i){this.minVelocity=t,this.minAngle=e,this.restitution=r,this.minFriction=n,this.friction=i},Static:function(t){this.callable=t}},Contact:function(t,e,r,n){this.ball=t,this.position=e,this.vector=r,this.length=n},Vertex:function(t,e){this.position=t,this.handler=e},Triangle:function(t,e,r){this.a=t,this.b=e,this.c=r,this.ab=t.position.plane(e.position),this.bc=e.position.plane(r.position),this.ca=r.position.plane(t.position);const n=this.ab.normal.cross(this.bc.normal);this.abT=t.position.planeNormal(r.position,n.cross(this.ab.normal)),this.bcT=e.position.planeNormal(t.position,n.cross(this.bc.normal)),this.caT=r.position.planeNormal(e.position,n.cross(this.ca.normal))},Sphere:function(t,e){this.center=t,this.radius=e,this.sqrRadius=Math.pow(e,2);const r=new game.geometry.Vector(e,e,e);this.min=t.subtract(r),this.max=t.add(r)},Index:function(t){this.size=t,this.map=new Map}},physics:{Motion:function(t,e){this.position=t,this.velocity=e},Ball:function(t,e,r){this.motion=t,this.resting=e,this.properties=r},Body:function(t,e){this.model=t,this.collision=e},Course:function(t,e){this.origin=t,this.body=e}},constraints:{string:{lengthAtLeast:function(t){return function(e){return e.length>=t}},lengthAtMost:function(t){return function(e){return e.length<=t}},charsFrom:function(t){return function(e){for(var r=0;r<e.length;r++)if(t.indexOf(e[r])<0)return!1;return!0}},with:function(t,e,r){return game.constraints.allMatch([game.utility.json.isString,game.constraints.string.lengthAtLeast(t),game.constraints.string.lengthAtMost(e),game.constraints.string.charsFrom(r)])},PLAYER_KEY_CHARS:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",PLAYER_KEY_LENGTH:16,PLAYER_NAME_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",PLAYER_NAME_MAX_LENGTH:16,SESSION_KEY_CHARS:"abcdefghijklmnopqrstuvwxyz",SESSION_KEY_LENGTH:8},number:{isInteger:function(t){return Number.isInteger(t)},isIntegerWith:function(t){return game.constraints.allMatch([game.constraints.number.isInteger,t])},isFloat:function(t){return Number.isFinite(t)},inRange:function(t,e){return function(r){return r>=t&&r<=e}},inFloatRange:function(t,e){return game.constraints.number.inRange(t/game.constraints.number.FLOAT_TOLERANCE,e*game.constraints.number.FLOAT_TOLERANCE)},isFloatWith:function(t){return game.constraints.allMatch([game.constraints.number.isFloat,t])},isAtLeast:function(t){return function(e){return e>=t}},PLAYER_ID_MIN_EXP:2,FLOAT_TOLERANCE:1.000001},array:{isArrayWith:function(t){return game.constraints.allMatch([game.utility.json.isArray,t])},isArrayWithElements:function(t){return game.constraints.array.isArrayWith(game.constraints.array.hasExactlyElements(t))},hasLength:function(t){return function(e){return e.length==t}},hasElements:function(t){return function(e){return t.every((function(t,r){return t(e[r])}))}},hasExactlyElements:function(t){return game.constraints.allMatch([game.constraints.array.hasLength(t.length),game.constraints.array.hasElements(t)])},allElements:function(t){return function(e){return e.every((function(e){return t(e)}))}},isDistinctBy:function(t){return function(e){return new Set(e.map(t)).size==e.length}},andDistinctBy:function(t,e){return game.constraints.allMatch([t,game.constraints.array.isDistinctBy(e)])},tableDistinctBy:function(t,e){return game.constraints.array.isArrayWith(game.constraints.array.andDistinctBy(game.constraints.array.allElements(game.constraints.array.isArrayWithElements(t)),e))}},object:{isObjectWith:function(t){return game.constraints.allMatch([game.utility.json.isObject,t])},hasNumberOfFields:function(t){return function(e){return Object.keys(e).length==t}},hasKey:function(t){return function(e){return e.hasOwnProperty(t)}},hasValue:function(t,e){return function(r){return e(r[t])}},hasField:function(t,e){return game.constraints.allMatch([game.constraints.object.hasKey(t),game.constraints.object.hasValue(t,e)])},hasFields:function(t){return game.constraints.allMatch(Object.keys(t).map((function(e){return game.constraints.object.hasField(e,t[e])})))},hasExactlyFields:function(t){return game.constraints.allMatch([game.constraints.object.hasNumberOfFields(Object.keys(t).length),game.constraints.object.hasFields(t)])}},alwaysTrue:function(){return!0},allMatch:function(t){return function(e){return t.every((function(t){return t(e)}))}},contains:function(t){return function(e){return t.has(e)}}},network:{Procedure:function(t,e){this.name=t,this.constraints=e},Call:function(t,e){this.procedure=t,this.params=t.validate(e)},Parser:function(t){this.procedures=t,this.constraint=this.buildConstraint()},Player:function(t,e,r,n,i){this.id=t,this.key=e,this.name=r,this.rating=n,this.timestamps=i},PlayerState:function(t,e,r,n){this.player=t,this.ball=e,this.strokes=r,this.left=n},PlayerResult:function(t,e,r,n){this.player=t,this.strokes=e,this.left=r,this.rating=n},Frame:function(t,e,r,n,i){this.index=t,this.timestamp=e,this.totalTime=r,this.endTime=n,this.playerActions=i},require:function(t,e,r){return game.utility.assert(e(t),r),t},COURSES:function(){return[course.compositions.simpleStraight,course.compositions.verticalCurveOver,course.compositions.volcano,course.compositions.crossJump,course.compositions.bridgedIslands]},DOMAIN:"4u7lyzh3h0kf7v5d.myfritz.net",PORT:43384},timing:{assertTicks:function(t){game.utility.assert(Number.isInteger(t),"Not an integer")},sToMs:function(t){return t*game.timing.MS_PER_S},sToTicks:function(t){return Math.round(t*game.timing.TICKS_PER_S)},sToTicksGap:function(t){return Math.max(game.timing.sToTicks(t),game.timing.TICKS_PER_GAP)},ticksToS:function(t){return game.timing.assertTicks(t),t/game.timing.TICKS_PER_S},ticksToMs:function(t){return game.timing.sToMs(game.timing.ticksToS(t))},msToS:function(t){return t/game.timing.MS_PER_S},msToTicks:function(t){return game.timing.sToTicks(game.timing.msToS(t))},nowTicks:function(t){return Math.max(game.timing.msToTicks(performance.now()-t),0)},nowS:function(t){return Math.max(game.timing.msToS(performance.now()-t),0)},driver:function(t,e,r,n){return new game.state.drivers.Conditional(new game.state.drivers.Conditional(new game.state.drivers.Timer(e),t,(function(t,e){return t.time>=game.timing.GAME_START_DURATION&&t.time<=game.timing.PLAYABLE_END&&!n(e)})),new game.state.drivers.Timer(r),(function(t,e){return!t.satisfied&&t.unconditionalDriver.time>=game.timing.GAME_START_DURATION}))},GAME_START_DURATION:5,GAME_END_DURATION:3,PLAYABLE_DURATION:120,NORMAL_DELTA:.02,TICKS_PER_S:1e4,TICKS_PER_GAP:1,MS_PER_S:1e3},state:{drivers:{Player:function(t){this.state=t},Camera:function(t,e,r){this.driver=t,this.camera=e,this.position=r},Actioning:function(t,e){this.driver=e(t),this.action=e},RendererWrapper:function(t,e){this.driver=t,this.fRenderer=e},RendererOverride:function(t,e){this.driver=t,this.fRenderer=e,this.dRenderer=e(t)},Timer:function(t){this.time=t},Conditional:function(t,e,r){this.unconditionalDriver=t,this.conditionalDriver=e,this.condition=r,this.satisfied=r(t,e)},Multi:function(t){this.drivers=t},idle:{delta:function(){return game.timing.NORMAL_DELTA},drive:function(t){return this}}},renderers:{Wrapper:function(t,e){this.geometry=t,this.fRenderer=e},Discrete:function(t){this.fRenderer=t},Multi:function(t){this.renderers=t},cross:function(t,e,r,n){return t.interpolate(e.interpolate(r,1/n),n)}},actions:{constant:function(t){return function(){return t}},conditional:function(t,e){return function(r){return e(r)?t(r):r}},ifExisting:function(t,e){return function(r){return(r?t:e)(r)}},illegal:function(t){throw new Error("Illegal action")},merge:function(t){return function(e){return t.forEach((function(t){e=t(e)})),e}},dynamic:function(t){return function(e){return t(e)(e)}}},updaters:{TimeEvent:function(){this.events=[]},IndexEvent:function(){this.events=[]},TimeSync:function(){this.syncs=[]},driver:function(t){t.push(game.utility.array.last(t).drive())},multi:function(t){return function(e){t.forEach((function(t){t(e)}))}},indexPruner:function(t,e,r){return function(n){game.state.Frame.pruneIndex(n,t(n),e,r)}},timestampPruner:function(t,e,r){return function(n){game.state.Frame.pruneTimestamp(n,t(n),e,r)}},ifLastChanged:function(t,e){return function(r){const n=game.utility.array.last(r);t(r);n!=game.utility.array.last(r)&&e(r)}},extrapolate:function(t){if(t.length>=3){const e=game.utility.array.last(t),r=game.utility.array.lastN(t,2),n=game.utility.array.lastN(t,3);game.utility.array.assignLastN(t,2,r.rendererOverride(game.utility.constant(game.state.renderers.cross(r.renderer(),n.renderer(),e.renderer(),2))))}},smoother:function(t,e,r,n){var i;function a(t){const r=game.utility.array.last(t),a=r.timestamp+game.timing.TICKS_PER_GAP;!function(t){for(;game.utility.array.last(i).timestamp<t;)e(i)}(a);const o=game.state.Frame.findByTimestamp(i,r.timestamp);game.utility.assert(o<i.length,"Not enough frames for interpolation");const s=i[o].timestamp<a?o+1:o;game.utility.assert(s<i.length,"Not enough frames for smoothing");const m=i[s];var u,c;game.utility.assert(m.timestamp>=a,"Gap not satisfied"),t.push(new game.state.Frame(r.index+1,m.timestamp,new game.state.drivers.RendererOverride(m.driver,game.utility.constant(game.state.renderers.cross((u=r,i[c=o].timestamp==u.timestamp?i[c].renderer():(game.utility.assert(c>0,"Inner frames are ahead"),i[c-1].interpolateRenderer(i[c],u.timestamp))),r.renderer(),m.renderer(),function(t,e){return Math.pow(n,game.timing.ticksToS(e.timestamp-t.timestamp))+1}(r,m))))))}return function(e){i||(i=e.slice()),t(i),a(e),r(i),e.splice(0,e.length-2)}}},TimeEvent:function(t,e){this.timestamp=t,this.action=e},IndexEvent:function(t,e){this.index=t,this.action=e},TimeSync:function(t,e){this.index=t,this.timestamp=e},Frame:function(t,e,r){this.index=t,this.timestamp=e,this.driver=r},Trace:function(t,e){this.frames=[t],this.updater=e}}};game.utility.collection.map.KEY_COMPARATOR=game.utility.comparators.mapped(game.utility.comparators.default,(function(t){return t[0]})),game.geometry.Vector.fromData=function(t){return new game.geometry.Vector(t[0],t[1],t[2])},game.geometry.Vector.prototype.negate=function(){return new game.geometry.Vector(-this.x,-this.y,-this.z)},game.geometry.Vector.prototype.add=function(t){return new game.geometry.Vector(this.x+t.x,this.y+t.y,this.z+t.z)},game.geometry.Vector.prototype.subtract=function(t){return new game.geometry.Vector(this.x-t.x,this.y-t.y,this.z-t.z)},game.geometry.Vector.prototype.multiply=function(t){return new game.geometry.Vector(this.x*t,this.y*t,this.z*t)},game.geometry.Vector.prototype.multiplyVector=function(t){return new game.geometry.Vector(this.x*t.x,this.y*t.y,this.z*t.z)},game.geometry.Vector.prototype.divide=function(t){return new game.geometry.Vector(this.x/t,this.y/t,this.z/t)},game.geometry.Vector.prototype.divideVector=function(t){return new game.geometry.Vector(this.x/t.x,this.y/t.y,this.z/t.z)},game.geometry.Vector.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},game.geometry.Vector.prototype.cross=function(t){return new game.geometry.Vector(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},game.geometry.Vector.prototype.componentWise=function(t,e){return new game.geometry.Vector(e(this.x,t.x),e(this.y,t.y),e(this.z,t.z))},game.geometry.Vector.prototype.min=function(t){return this.componentWise(t,Math.min)},game.geometry.Vector.prototype.max=function(t){return this.componentWise(t,Math.max)},game.geometry.Vector.prototype.towardsZero=function(t){return this.componentWise(t,game.utility.towardsZero)},game.geometry.Vector.prototype.interpolate=function(t,e){return this.multiply(1-e).add(t.multiply(e))},game.geometry.Vector.prototype.floor=function(){return new game.geometry.Vector(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},game.geometry.Vector.prototype.sqrLength=function(){return this.dot(this)},game.geometry.Vector.prototype.length=function(){return Math.sqrt(this.sqrLength())},game.geometry.Vector.prototype.normalize=function(){return this.divide(this.length())},game.geometry.Vector.prototype.transform=function(t){return game.geometry.Matrix.translation(this).dot(t).translation()},game.geometry.Vector.prototype.planeNormal=function(t,e){return game.geometry.Plane.throughScaled(this,t,e)},game.geometry.Vector.prototype.plane=function(t){return this.planeNormal(t,t.subtract(this))},game.geometry.Vector.prototype.xyMapping=function(){return new game.geometry.Mapping(this.x,this.y)},game.geometry.Vector.prototype.toShader=function(){return["vec3(",this.x.toExponential(),",",this.y.toExponential(),",",this.z.toExponential(),")"].join("")},game.geometry.Vector.prototype.data=function(){return[this.x,this.y,this.z]},game.geometry.Mapping.random=function(){return new game.geometry.Mapping(Math.random(),Math.random())},game.geometry.Mapping.angle=function(t){return new game.geometry.Mapping(Math.cos(t),Math.sin(t))},game.geometry.Mapping.rotator=function(t){const e=game.geometry.Mapping.angle(t),r=e.rotate90();return function(t){return t.multiply2(e,r)}},game.geometry.Mapping.prototype.rotate90=function(){return new game.geometry.Mapping(-this.v,this.u)},game.geometry.Mapping.prototype.negate=function(){return new game.geometry.Mapping(-this.u,-this.v)},game.geometry.Mapping.prototype.add=function(t){return new game.geometry.Mapping(this.u+t.u,this.v+t.v)},game.geometry.Mapping.prototype.subtract=function(t){return new game.geometry.Mapping(this.u-t.u,this.v-t.v)},game.geometry.Mapping.prototype.multiply=function(t){return new game.geometry.Mapping(this.u*t,this.v*t)},game.geometry.Mapping.prototype.multiply2=function(t,e){return t.multiply(this.u).add(e.multiply(this.v))},game.geometry.Mapping.prototype.multiplyMapping=function(t){return new game.geometry.Mapping(this.u*t.u,this.v*t.v)},game.geometry.Mapping.prototype.divide=function(t){return new game.geometry.Mapping(this.u/t,this.v/t)},game.geometry.Mapping.prototype.interpolate=function(t,e){return this.multiply(1-e).add(t.multiply(e))},game.geometry.Mapping.prototype.interpolateMapping=function(t,e){return this.add(t.subtract(this).multiplyMapping(e))},game.geometry.Mapping.prototype.data=function(){return[this.u,this.v]},game.geometry.Plane.x=function(t){return new game.geometry.Plane(new game.geometry.Vector(1,0,0),t)},game.geometry.Plane.y=function(t){return new game.geometry.Plane(new game.geometry.Vector(0,1,0),t)},game.geometry.Plane.z=function(t){return new game.geometry.Plane(new game.geometry.Vector(0,0,1),t)},game.geometry.Plane.through=function(t,e){return new game.geometry.Plane(e,t.dot(e))},game.geometry.Plane.throughScaled=function(t,e,r){return game.geometry.Plane.through(t,r.divide(e.subtract(t).dot(r)))},game.geometry.Plane.prototype.dot=function(t){return this.normal.dot(t)},game.geometry.Plane.prototype.distance=function(t){return this.dot(t)-this.offset},game.geometry.Plane.prototype.section=function(t){return Math.floor(t/this.offset)},game.geometry.Plane.prototype.cut=function(t){const e=t.map(function(t){return this.dot(t)}.bind(this)),r=e.map(function(t){return this.section(t)}.bind(this)),n=new Map,i=r.reduce((function(t,e){return Math.min(t,e)})),a=r.reduce((function(t,e){return Math.max(t,e)}));for(var o=i;o<=a;o++)n.set(o,[]);for(var s=0;s<t.length;s++){const i=(s+1)%t.length;n.get(r[s]).push(t[s]);for(o=r[s];o<r[i];o++){const r=t[s].interpolate(t[i],((o+1)*this.offset-e[s])/(e[i]-e[s]));n.get(o).push(r),n.get(o+1).push(r)}for(o=r[s];o>r[i];o--){const r=t[s].interpolate(t[i],(o*this.offset-e[s])/(e[i]-e[s]));n.get(o).push(r),n.get(o-1).push(r)}}return n},game.geometry.Matrix.SIZE=4,game.geometry.Matrix.IDENTITY=new game.geometry.Matrix([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),game.geometry.Matrix.projection=function(t,e,r,n){const i=Math.pow(t,2),a=n-r;return new game.geometry.Matrix([Math.sqrt(1/i+1)/e,0,0,0,0,Math.sqrt(i+1)/e,0,0,0,0,1+2*r/a,1,0,0,r*n*-2/a,0])},game.geometry.Matrix.translation=function(t){return new game.geometry.Matrix([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1])},game.geometry.Matrix.rotationX=function(t){return new game.geometry.Matrix([1,0,0,0,0,Math.cos(t),Math.sin(t),0,0,-Math.sin(t),Math.cos(t),0,0,0,0,1])},game.geometry.Matrix.rotationY=function(t){return new game.geometry.Matrix([Math.cos(t),0,-Math.sin(t),0,0,1,0,0,Math.sin(t),0,Math.cos(t),0,0,0,0,1])},game.geometry.Matrix.rotationZ=function(t){return new game.geometry.Matrix([Math.cos(t),Math.sin(t),0,0,-Math.sin(t),Math.cos(t),0,0,0,0,1,0,0,0,0,1])},game.geometry.Matrix.indexOf=function(t,e){return game.geometry.Matrix.SIZE*t+e},game.geometry.Matrix.prototype.translation=function(){return new game.geometry.Vector(this.data[game.geometry.Matrix.indexOf(3,0)],this.data[game.geometry.Matrix.indexOf(3,1)],this.data[game.geometry.Matrix.indexOf(3,2)]).divide(this.data[game.geometry.Matrix.indexOf(3,3)])},game.geometry.Matrix.prototype.add=function(t){return new game.geometry.Matrix(this.data.map((function(e,r){return e+t.data[r]})))},game.geometry.Matrix.prototype.dot=function(t){const e=this.data.slice();for(var r=0;r<game.geometry.Matrix.SIZE;r++)for(var n=0;n<game.geometry.Matrix.SIZE;n++){for(var i=0,a=0;a<game.geometry.Matrix.SIZE;a++)i+=this.data[game.geometry.Matrix.indexOf(r,a)]*t.data[game.geometry.Matrix.indexOf(a,n)];e[game.geometry.Matrix.indexOf(r,n)]=i}return new game.geometry.Matrix(e)},game.geometry.Matrix.prototype.multiply=function(t){return new game.geometry.Matrix(this.data.map((function(e){return e*t})))},game.geometry.Matrix.prototype.interpolate=function(t,e){return this.multiply(1-e).add(t.multiply(e))},game.model.Color.WHITE=new game.model.Color(1,1,1),game.model.Color.PRIMARIES=[new game.model.Color(1,0,0),new game.model.Color(1,1,0),new game.model.Color(0,1,0),new game.model.Color(0,1,1),new game.model.Color(0,0,1),new game.model.Color(1,0,1)],game.model.Color.interpolatePrimaries=function(t){const e=(t-Math.floor(t))*game.model.Color.PRIMARIES.length,r=Math.floor(e);return game.model.Color.PRIMARIES[r].interpolate(game.model.Color.PRIMARIES[(r+1)%game.model.Color.PRIMARIES.length],e-r)},game.model.Color.prototype.compress=function(t,e){return this.multiply(e-t).add(game.model.Color.WHITE.multiply(t))},game.model.Color.prototype.add=function(t){return new game.model.Color(this.r+t.r,this.g+t.g,this.b+t.b)},game.model.Color.prototype.subtract=function(t){return new game.model.Color(this.r-t.r,this.g-t.g,this.b-t.b)},game.model.Color.prototype.multiply=function(t){return new game.model.Color(this.r*t,this.g*t,this.b*t)},game.model.Color.prototype.interpolate=function(t,e){return this.multiply(1-e).add(t.multiply(e))},game.model.Color.prototype.round=function(){return new game.model.Color(Math.round(this.r),Math.round(this.g),Math.round(this.b))},game.model.Color.prototype.glClear=function(t){t.clearColor(this.r,this.g,this.b,1)},game.model.Color.prototype.data=function(){return[this.r,this.g,this.b]},game.model.Path.AUTO_START=8,game.model.Path.AUTO_MAX_ERROR=.1,game.model.Path.NORMAL_DELTA=.01,game.model.Path.error=function(t,e){return t.cross(e).length()/t.length()},game.model.Path.auto=function(t){for(var e=new game.model.Path(t,1),r=new game.model.Path(t,game.model.Path.AUTO_START);;){if(r.error()<=game.model.Path.AUTO_MAX_ERROR){for(;e.count<r.count;){const n=new game.model.Path(t,Math.floor((e.count+r.count)/2));n.error()<=game.model.Path.AUTO_MAX_ERROR?r=n:e=new game.model.Path(t,n.count+1)}return r}e=r,r=new game.model.Path(t,2*e.count)}},game.model.Path.autoVertex=function(t){return new game.model.Path(t,game.model.Path.auto(new game.model.Path(t,1).position().mapper).count)},game.model.Path.point=function(t){return new game.model.Path((function(e){return t}),1)},game.model.Path.sphere=function(t,e){return new game.model.Path((function(r){const n=Math.PI*r,i=Math.sin(n);return new game.model.Path((function(e){const r=2*Math.PI*e,a=new game.geometry.Vector(Math.cos(r)*i,Math.sin(r)*i,Math.cos(n));return new game.model.Vertex(a.multiply(t),a)}),Math.ceil(2*Math.PI*i/e))}),Math.ceil(Math.PI/e))},game.model.Path.circle=function(t,e){return game.model.Path.autoVertex((function(r){const n=e*r,i=Math.cos(n),a=Math.sin(n);return new game.model.Vertex(new game.geometry.Vector(t*i,t*a,0),new game.geometry.Vector(-a,i,0).multiply(Math.sign(e)))}))},game.model.Path.prototype.error=function(){const t=this.waypoints();for(var e=0,r=2;r<t.length;r++)e=Math.max(game.model.Path.error(t[r].subtract(t[r-2]),t[r-1].subtract(t[r-2])),e);return e},game.model.Path.prototype.map=function(t){return new game.model.Path(function(e){return t(this.mapper(e))}.bind(this),this.count)},game.model.Path.prototype.transform=function(t){return this.map((function(e){return e.transform(t)}))},game.model.Path.prototype.negateNormals=function(){return this.map((function(t){return t.negateNormal()}))},game.model.Path.prototype.withNormal=function(t){return this.map((function(e){return e.withNormal(t)}))},game.model.Path.prototype.withColor=function(t){return this.map((function(e){return e.withColor(t)}))},game.model.Path.prototype.enableChecker=function(){return this.map((function(t){return t.enableChecker()}))},game.model.Path.prototype.reverse=function(){return new game.model.Path(function(t){return this.mapper(1-t)}.bind(this),this.count)},game.model.Path.prototype.truncate=function(t){return new game.model.Path(function(e){return this.mapper(e*(1-t/this.count))}.bind(this),this.count-t)},game.model.Path.prototype.waypoints=function(){const t=[];for(var e=0;e<=this.count;e++)t.push(this.mapper(e/Math.max(this.count,1)));return t},game.model.Path.prototype.fan=function(){return game.model.Triangle.fan(this.waypoints())},game.model.Path.prototype.stripe=function(t){return game.model.Triangle.stripe(this.normalizedTo(t.position()).waypoints(),t.normalizedTo(this.position()).negateNormals().waypoints())},game.model.Path.prototype.rotateZ=function(t){return this.map((function(e){return e=e.withNormal(e.normal.cross(new game.geometry.Vector(-e.position.y,e.position.x,0)).normalize()),game.model.Path.autoVertex((function(r){return e.transform(game.geometry.Matrix.rotationZ(r*t))}))}))},game.model.Path.prototype.surface=function(){const t=this.waypoints(),e=[];for(var r,n=0;n<t.length;n++){const i=t[n].waypoints();r&&e.push(game.model.Triangle.stripe(r,i)),r=i}return game.utility.array.flatten(e)},game.model.Path.prototype.border=function(t,e,r){return game.model.Path.auto(function(n){const i=this.mapper(n),a=i.normal.cross(i.position.subtract(t.mapper(n))),o=a.cross(i.normal);return i.position.add(o.normalize().multiply(e)).add(a.normalize().multiply(r))}.bind(this))},game.model.Path.prototype.vertex=function(){return this.map((function(t){return new game.model.Vertex(t)}))},game.model.Path.prototype.position=function(){return this.map((function(t){return t.position}))},game.model.Path.prototype.normalize=function(){return new game.model.Path(function(t){return this.mapper(t).withNormal(this.mapper(t+game.model.Path.NORMAL_DELTA).position.subtract(this.mapper(t-game.model.Path.NORMAL_DELTA).position).normalize())}.bind(this),this.count)},game.model.Path.prototype.normalizedTo=function(t){return new game.model.Path(function(e){const r=this.mapper(e);return r.withNormal(r.normal.cross(r.position.subtract(t.mapper(e))).normalize())}.bind(this),this.count)},game.model.Vertex.prototype.transform=function(t){return new game.model.Vertex(this.position.transform(t),this.normal.transform(t).subtract(t.translation()),this.color,this.checker)},game.model.Vertex.prototype.withNormal=function(t){return new game.model.Vertex(this.position,t,this.color,this.checker)},game.model.Vertex.prototype.withColor=function(t){return new game.model.Vertex(this.position,this.normal,t,this.checker)},game.model.Vertex.prototype.enableChecker=function(){return new game.model.Vertex(this.position,this.normal,this.color,!0)},game.model.Vertex.prototype.negateNormal=function(){return new game.model.Vertex(this.position,this.normal.negate(),this.color,this.checker)},game.model.Vertex.prototype.collision=function(t){return new game.collision.Vertex(this.position,t)},game.model.Vertex.prototype.data=function(){return game.utility.array.flatten([this.position.data(),this.normal.data(),this.color.data(),[this.checker]])},game.model.Triangle.vertices=function(t){return game.utility.array.flatten(t.map((function(t){return t.vertices()})))},game.model.Triangle.polygon=function(t){const e=[];for(var r=0;r<t.length;r++)t[r].hasOwnProperty("opposite")&&e.push(new game.model.Triangle(t[r].vertex,t[(r+1)%t.length].vertex,t[t[r].opposite].vertex));return e},game.model.Triangle.stripe=function(t,e){const r=[];for(var n=0,i=0;n+1<t.length||i+1<e.length;)(2*n+1)*(e.length-1)>(2*i+1)*(t.length-1)?(r.push(new game.model.Triangle(e[i],t[n],e[i+1])),i++):(r.push(new game.model.Triangle(e[i],t[n],t[n+1])),n++);return r},game.model.Triangle.fan=function(t){const e=[];for(var r=2;r<t.length;r++)e.push(new game.model.Triangle(t[0],t[r-1],t[r]));return e},game.model.Triangle.transform=function(t,e){return t.map((function(t){return t.transform(e)}))},game.model.Triangle.prototype.transform=function(t){return new game.model.Triangle(this.a.transform(t),this.b.transform(t),this.c.transform(t))},game.model.Triangle.prototype.vertices=function(){return[this.a,this.b,this.c]},game.model.Triangle.prototype.collision=function(t){return new game.collision.Triangle(this.a.collision(t),this.b.collision(t),this.c.collision(t))},game.collision.handlers.Collection.prototype.add=function(t){if(this.handlers.length!==t.handlers.length)throw new Error("Different sizes of collections");return new game.collision.handlers.Collection(this.handlers.map((function(e,r){return e.add(t.handlers[r])})))},game.collision.handlers.Collection.prototype.multiply=function(t){return new game.collision.handlers.Collection(this.handlers.map((function(e){return e.multiply(t)})))},game.collision.handlers.Collection.prototype.handle=function(t){return this.handlers.forEach((function(e){t=t.withBall(e.handle(t))})),t.ball},game.collision.handlers.Rebound.prototype.add=function(t){return new game.collision.handlers.Rebound(this.minVelocity+t.minVelocity,this.minAngle+t.minAngle,this.restitution+t.restitution,this.minFriction+t.minFriction,this.friction+t.friction)},game.collision.handlers.Rebound.prototype.multiply=function(t){return new game.collision.handlers.Rebound(this.minVelocity*t,this.minAngle*t,this.restitution*t,this.minFriction*t,this.friction*t)},game.collision.handlers.Rebound.prototype.threshold=function(t){return Math.max(this.minVelocity,this.minAngle*t)},game.collision.handlers.Rebound.prototype.handle=function(t){const e=t.ball.motion.velocity,r=t.direction(),n=Math.max(-e.dot(r),0),i=this.threshold(e.length()),a=Math.max(n-i,0)*this.restitution,o=a/Math.max(n,i);return t.ball.addMotion(new game.physics.Motion(r.multiply(t.depth()*(1+o)),r.multiply(n+a).subtract(this.frictionVelocity(e,r,n))))},game.collision.handlers.Rebound.prototype.frictionVelocity=function(t,e,r){const n=t.add(e.multiply(r)),i=Math.max(this.friction*r,this.minFriction),a=i/Math.max(n.length(),i);return n.multiply(a)},game.collision.handlers.Static.BALL_COMPLETION=new game.collision.handlers.Static((function(t){return t.ball.complete()})),game.collision.handlers.Static.prototype.add=function(t){return this},game.collision.handlers.Static.prototype.multiply=function(t){return this},game.collision.handlers.Static.prototype.handle=function(t){return this.callable(t)},game.collision.Contact.prototype.depth=function(){return this.ball.properties.radius-this.length},game.collision.Contact.prototype.direction=function(){return this.vector.divide(this.length)},game.collision.Contact.prototype.withBall=function(t){return new game.collision.Contact(t,this.position,this.vector,this.length)},game.collision.Vertex.prototype.transform=function(t){return new game.collision.Vertex(this.position.transform(t),this.handler)},game.collision.Triangle.fromModel=function(t,e){return t.map((function(t){return t.collision(e)}))},game.collision.Triangle.transform=function(t,e){return t.map((function(t){return t.transform(e)}))},game.collision.Triangle.prototype.project=function(t){const e=this.abT.distance(t),r=this.bcT.distance(t),n=this.caT.distance(t),i=Math.min(e,r,n);if(i>=0)return new game.geometry.Vector(r,n,e);if(i==e){const e=game.utility.clamp(this.ab.distance(t),0,1);return new game.geometry.Vector(1-e,e,0)}if(i==r){const e=game.utility.clamp(this.bc.distance(t),0,1);return new game.geometry.Vector(0,1-e,e)}if(i==n){const e=game.utility.clamp(this.ca.distance(t),0,1);return new game.geometry.Vector(e,0,1-e)}},game.collision.Triangle.prototype.interpolatePosition=function(t){return this.a.position.multiply(t.x).add(this.b.position.multiply(t.y)).add(this.c.position.multiply(t.z))},game.collision.Triangle.prototype.interpolateHandler=function(t){return this.a.handler.multiply(t.x).add(this.b.handler.multiply(t.y)).add(this.c.handler.multiply(t.z))},game.collision.Triangle.prototype.vertices=function(){return[this.a,this.b,this.c]},game.collision.Triangle.prototype.positions=function(){return this.vertices().map((function(t){return t.position}))},game.collision.Triangle.prototype.transform=function(t){return new game.collision.Triangle(this.a.transform(t),this.b.transform(t),this.c.transform(t))},game.collision.Sphere.prototype.size=function(){return this.max.subtract(this.min)},game.collision.Sphere.prototype.contains=function(t){return t.subtract(this.center).sqrLength()<this.sqrRadius},game.collision.Sphere.prototype.model=function(t,e){return game.model.Triangle.transform(game.model.Path.sphere(this.radius,t).withColor(e).surface(),game.geometry.Matrix.translation(this.center))},game.collision.Sphere.prototype.renderer=function(t,e,r,n){const i=t.gl,a=t.renderer(this.model(e,r)),o=t.renderer(this.model(e,n));return function(t){a.render(t),i.depthFunc(i.GREATER),o.render(t),i.depthFunc(i.LESS)}},game.collision.Index.key=function(t){return[t.x,t.y,t.z].join(",")},game.collision.Index.prototype.count=function(){return game.utility.collection.values(this.map).map((function(t){return t.size})).reduce((function(t,e){return t+e}),0)},game.collision.Index.prototype.pointCell=function(t){return t.divideVector(this.size).floor()},game.collision.Index.prototype.triangleCells=function(t){const e=[];return game.geometry.Plane.x(this.size.x).cut(t.positions()).forEach(function(t,r){game.geometry.Plane.y(this.size.y).cut(t).forEach(function(t,n){game.geometry.Plane.z(this.size.z).cut(t).forEach((function(t,i){e.push(new game.geometry.Vector(r,n,i))}))}.bind(this))}.bind(this)),e},game.collision.Index.prototype.sphereCells=function(t){const e=[],r=this.pointCell(t.min),n=this.pointCell(t.max),i=this.pointCell(t.center);for(var a=r.x;a<=n.x;a++)for(var o=r.y;o<=n.y;o++)for(var s=r.z;s<=n.z;s++)((a==i.x)+(o==i.y)+(s==i.z)>1||t.contains(new game.geometry.Vector(a+(a<i.x),o+(o<i.y),s+(s<i.z)).multiplyVector(this.size)))&&e.push(new game.geometry.Vector(a,o,s));return e},game.collision.Index.prototype.queryCell=function(t){return this.map.get(game.collision.Index.key(t))},game.collision.Index.prototype.addCell=function(t,e){const r=game.collision.Index.key(t);var n=this.map.get(r);n||(n=new Set,this.map.set(r,n)),n.add(e)},game.collision.Index.prototype.removeCell=function(t,e){const r=game.collision.Index.key(t),n=this.map.get(r);n&&n.delete(e)&&0==n.size&&this.map.delete(r)},game.collision.Index.prototype.queryCells=function(t){const e=new Set;return t.forEach(function(t){const r=this.queryCell(t);r&&r.forEach(e.add.bind(e))}.bind(this)),game.utility.collection.values(e)},game.collision.Index.prototype.addCells=function(t,e){t.forEach(function(t){this.addCell(t,e)}.bind(this))},game.collision.Index.prototype.removeCells=function(t,e){t.forEach(function(t){this.removeCell(t,e)}.bind(this))},game.collision.Index.prototype.addTriangle=function(t){this.addCells(this.triangleCells(t),t)},game.collision.Index.prototype.addTriangles=function(t){t.forEach(this.addTriangle.bind(this))},game.physics.Motion.fromData=function(t){return new game.physics.Motion(game.geometry.Vector.fromData(t[0]),game.geometry.Vector.fromData(t[1]))},game.physics.Motion.prototype.add=function(t){return new game.physics.Motion(this.position.add(t.position),this.velocity.add(t.velocity))},game.physics.Motion.prototype.addPosition=function(t){return new game.physics.Motion(this.position.add(t),this.velocity)},game.physics.Motion.prototype.addVelocity=function(t){return new game.physics.Motion(this.position,this.velocity.add(t))},game.physics.Motion.prototype.integrate=function(t){return this.addPosition(this.velocity.multiply(t))},game.physics.Motion.prototype.data=function(){return[this.position.data(),this.velocity.data()]},game.physics.Ball.GRAVITY=196.2,game.physics.Ball.SPHERE=new game.collision.Sphere(new game.geometry.Vector(0,0,0),.5),game.physics.Ball.MAX_RESOLVE_ITERATIONS=5,game.physics.Ball.MAX_RESOLVE_TOLERANCE=.01,game.physics.Ball.MAX_STEP_PER_RADIUS=1/3,game.physics.Ball.RESTING_DISTANCE=.125,game.physics.Ball.RESTING_DISTANCE_SQR=Math.pow(game.physics.Ball.RESTING_DISTANCE,2),game.physics.Ball.RESTING_DELTA=.25,game.physics.Ball.HIT_MIN=5,game.physics.Ball.HIT_MAX=150,game.physics.Ball.HIT_EXP=1.5,game.physics.Ball.from=function(t,e,r){return game.physics.Ball.fromProperties(t,{radius:e,index:r,moved:!1,completed:!1})},game.physics.Ball.fromProperties=function(t,e){return new game.physics.Ball(t,{position:t.position,delta:game.physics.Ball.RESTING_DELTA},e)},game.physics.Ball.prototype.updateRestingDelta=function(t){return new game.physics.Ball(this.motion,{position:this.resting.position,delta:Math.max(this.resting.delta-t,0)},this.properties)},game.physics.Ball.prototype.resetResting=function(){return game.physics.Ball.fromProperties(this.motion,this.updateMoved(!0))},game.physics.Ball.prototype.escapedResting=function(){return this.motion.position.subtract(this.resting.position).sqrLength()>game.physics.Ball.RESTING_DISTANCE_SQR},game.physics.Ball.prototype.updateResting=function(t){return this.escapedResting()?this.resetResting():this.updateRestingDelta(t)},game.physics.Ball.prototype.isResting=function(){return 0==this.resting.delta},game.physics.Ball.prototype.withMotion=function(t){return new game.physics.Ball(t,this.resting,this.properties)},game.physics.Ball.prototype.addMotion=function(t){return this.withMotion(this.motion.add(t))},game.physics.Ball.prototype.addVelocity=function(t){return this.withMotion(this.motion.addVelocity(t))},game.physics.Ball.prototype.integrate=function(t){return this.isResting()?this:this.withMotion(this.motion.integrate(t))},game.physics.Ball.prototype.delta=function(){const t=this.properties.radius*game.physics.Ball.MAX_STEP_PER_RADIUS,e=this.motion.velocity.length();return t<e*game.timing.NORMAL_DELTA?t/e:game.timing.NORMAL_DELTA},game.physics.Ball.prototype.advance=function(t){const e=this.integrate(t).resolve();if(e&&e.motion.position.z>=-5)return e.applyGravity(t).updateResting(t)},game.physics.Ball.prototype.applyGravity=function(t){return this.isResting()?this:this.addVelocity(new game.geometry.Vector(0,0,-game.physics.Ball.GRAVITY*t))},game.physics.Ball.prototype.isHittable=function(){return this.isResting()&&!this.isCompleted()},game.physics.Ball.prototype.hit=function(t,e){return this.resetResting().addVelocity(new game.geometry.Vector(0,-game.utility.interpolate(game.physics.Ball.HIT_MIN,game.physics.Ball.HIT_MAX,Math.pow(e,game.physics.Ball.HIT_EXP)),0).transform(game.geometry.Matrix.rotationZ(t)))},game.physics.Ball.prototype.isResettable=function(){return this.properties.moved&&!this.isCompleted()},game.physics.Ball.prototype.resolve=function(){for(var t=this,e=0;e<game.physics.Ball.MAX_RESOLVE_ITERATIONS;e++){const e=t.resolveNearest();if(!e)return t;t=e}},game.physics.Ball.prototype.resolveNearest=function(){const t=this.properties.index.queryCells(this.properties.index.sphereCells(this.sphere())).map(function(t){const e={};return e.triangle=t,e.coordinates=t.project(this.motion.position),e.position=t.interpolatePosition(e.coordinates),e.vector=this.motion.position.subtract(e.position),e.length=e.vector.length(),e}.bind(this));if(t.length>0){const e=t.reduce((function(t,e){return t.length>e.length?e:t}));if(e.length+game.physics.Ball.MAX_RESOLVE_TOLERANCE<this.properties.radius)return e.triangle.interpolateHandler(e.coordinates).handle(new game.collision.Contact(this,e.position,e.vector,e.length))}},game.physics.Ball.prototype.updateMoved=function(t){return game.utility.mergeObjects([this.properties,{moved:t}])},game.physics.Ball.prototype.updateCompleted=function(t){return game.utility.mergeObjects([this.properties,{completed:t}])},game.physics.Ball.prototype.complete=function(){return new game.physics.Ball(this.motion,this.resting,this.updateCompleted(!0))},game.physics.Ball.prototype.isCompleted=function(){return this.properties.completed},game.physics.Ball.prototype.sphere=function(){return new game.collision.Sphere(this.motion.position,this.properties.radius)},game.physics.Ball.prototype.centerMatrix=function(){return game.geometry.Matrix.translation(this.motion.position)},game.physics.Ball.prototype.floorMatrix=function(){return game.geometry.Matrix.translation(this.motion.position.subtract(new game.geometry.Vector(0,0,this.properties.radius)))},game.physics.Ball.prototype.fromData=function(t){return new game.physics.Ball(game.physics.Motion.fromData(t[0]),{position:game.geometry.Vector.fromData(t[1]),delta:t[2]},game.utility.mergeObjects([this.properties,{moved:t[3],completed:t[4]}]))},game.physics.Ball.prototype.data=function(){return[this.motion.data(),this.resting.position.data(),this.resting.delta,this.properties.moved,this.properties.completed]},game.physics.Body.EMPTY=new game.physics.Body([],[]),game.physics.Body.fromModel=function(t,e){return new game.physics.Body(t,game.collision.Triangle.fromModel(t,e))},game.physics.Body.merge=function(t){return new game.physics.Body(game.utility.array.flatten(t.map((function(t){return t.model}))),game.utility.array.flatten(t.map((function(t){return t.collision}))))},game.physics.Body.prototype.transform=function(t){return new game.physics.Body(game.model.Triangle.transform(this.model,t),game.collision.Triangle.transform(this.collision,t))},game.physics.Course.prototype.renderer=function(t){const e=t.renderer(this.body.model);return function(t){e.render(t)}},game.constraints.number.isAngle=game.constraints.number.isFloatWith(game.constraints.number.inFloatRange(0,2*Math.PI)),game.constraints.number.isNormal=game.constraints.number.isFloatWith(game.constraints.number.inFloatRange(0,1)),game.constraints.number.isNonNegative=game.constraints.number.isAtLeast(0),game.constraints.number.isNonNegativeInteger=game.constraints.number.isIntegerWith(game.constraints.number.isNonNegative),game.constraints.number.isNonNegativeFloat=game.constraints.number.isFloatWith(game.constraints.number.isNonNegative),game.constraints.number.isTimestamp=game.constraints.number.isNonNegativeInteger,game.constraints.number.isFrameIndex=game.constraints.number.isNonNegativeInteger,game.constraints.number.PLAYER_ID_MIN=Math.pow(10,game.constraints.number.PLAYER_ID_MIN_EXP),game.constraints.number.isPlayerId=game.constraints.number.isIntegerWith(game.constraints.number.isAtLeast(game.constraints.number.PLAYER_ID_MIN)),game.constraints.number.isPlayerRating=game.constraints.number.isInteger,game.constraints.string.isPlayerKey=game.constraints.string.with(game.constraints.string.PLAYER_KEY_LENGTH,game.constraints.string.PLAYER_KEY_LENGTH,game.constraints.string.PLAYER_KEY_CHARS),game.constraints.string.isPlayerName=game.constraints.string.with(1,game.constraints.string.PLAYER_NAME_MAX_LENGTH,game.constraints.string.PLAYER_NAME_CHARS),game.constraints.string.isSessionKey=game.constraints.string.with(game.constraints.string.SESSION_KEY_LENGTH,game.constraints.string.SESSION_KEY_LENGTH,game.constraints.string.SESSION_KEY_CHARS),game.constraints.array.isVector=game.constraints.array.isArrayWithElements([game.constraints.number.isFloat,game.constraints.number.isFloat,game.constraints.number.isFloat]),game.constraints.array.isMotion=game.constraints.array.isArrayWithElements([game.constraints.array.isVector,game.constraints.array.isVector]),game.constraints.array.isBall=game.constraints.array.isArrayWithElements([game.constraints.array.isMotion,game.constraints.array.isVector,game.constraints.number.isNonNegativeFloat,game.utility.json.isBoolean,game.utility.json.isBoolean]),game.constraints.array.PLAYER_PUBLIC=[game.constraints.number.isPlayerId,game.constraints.string.isPlayerName,game.constraints.number.isPlayerRating],game.constraints.array.PLAYER_PRIVATE=game.constraints.array.PLAYER_PUBLIC.concat(game.constraints.number.isTimestamp,game.constraints.number.isTimestamp),game.constraints.array.isPlayerPublic=game.constraints.array.isArrayWithElements(game.constraints.array.PLAYER_PUBLIC),game.constraints.array.isPlayerPrivate=game.constraints.array.isArrayWithElements(game.constraints.array.PLAYER_PRIVATE),game.constraints.array.isPlayerStates=game.constraints.array.tableDistinctBy([game.constraints.array.isPlayerPublic,game.constraints.array.isBall,game.constraints.array.isBall,game.constraints.number.isNonNegativeInteger,game.constraints.number.isNonNegativeInteger,game.utility.json.isBoolean],(function(t){return t[0][0]})),game.constraints.array.isPlayerResults=game.constraints.array.tableDistinctBy([game.constraints.array.isPlayerPublic,game.constraints.number.isNonNegativeInteger,game.utility.json.isBoolean,game.constraints.number.isPlayerRating],(function(t){return t[0][0]})),game.constraints.array.FRAME=[game.constraints.number.isFrameIndex,game.constraints.number.isTimestamp,game.constraints.number.isNonNegativeFloat,game.constraints.number.isNonNegativeFloat,game.constraints.array.isPlayerStates],game.constraints.array.isFrame=game.constraints.array.isArrayWithElements(game.constraints.array.FRAME),game.constraints.array.JOIN_FRAME=[game.constraints.number.isNonNegativeInteger,game.constraints.number.isTimestamp,game.constraints.array.isFrame],game.network.Procedure.PARAM_TREE={REGISTRATION:{REQUEST:[game.constraints.string.isPlayerName],RESPONSE:[game.constraints.number.isPlayerId,game.constraints.string.isPlayerKey,game.constraints.number.isTimestamp]},LOGIN:{REQUEST:[game.constraints.string.isPlayerKey],RESPONSE:{CONFIRM:{LOBBY:game.constraints.array.PLAYER_PRIVATE,GAME:[game.constraints.array.isPlayerPrivate,game.constraints.string.isSessionKey].concat(game.constraints.array.JOIN_FRAME)},MULTIPLE:[],UNKNOWN:[]}},LOBBY:{NAME:{CHANGE:{REQUEST:[game.constraints.string.isPlayerName],RESPONSE:[]}},CREATE:{REQUEST:[],RESPONSE:[game.constraints.string.isSessionKey]},JOIN:{REQUEST:[game.constraints.string.isSessionKey],RESPONSE:{CONFIRM:{SESSION:[game.constraints.array.tableDistinctBy(game.constraints.array.PLAYER_PUBLIC,(function(t){return t[0]}))],GAME:game.constraints.array.JOIN_FRAME},UNKNOWN:[]}}},SESSION:{ENTER:game.constraints.array.PLAYER_PUBLIC,LEAVE:{SELF:{REQUEST:[],RESPONSE:[]},OTHER:[game.constraints.number.isPlayerId]},START:{REQUEST:[],RESPONSE:[]}},GAME:{START:{REQUEST:[],RESPONSE:[game.constraints.number.isTimestamp]},ENTER:[game.constraints.number.isTimestamp,game.constraints.array.isPlayerPublic],LEAVE:{OTHER:[game.constraints.number.isTimestamp,game.constraints.number.isPlayerId]},RESET:{SELF:[game.constraints.number.isTimestamp],OTHER:[game.constraints.number.isTimestamp,game.constraints.number.isPlayerId]},FRAME:game.constraints.array.FRAME,HIT:{SELF:[game.constraints.number.isTimestamp,game.constraints.number.isAngle,game.constraints.number.isNormal],OTHER:[game.constraints.number.isTimestamp,game.constraints.number.isPlayerId,game.constraints.number.isAngle,game.constraints.number.isNormal]},END:[game.constraints.array.isPlayerResults]}},game.network.Procedure.mapTree=function(t,e,r){if(Array.isArray(t)){const n=new game.network.Procedure(r.join("_"),t);return e.push(n),n}const n={};return Object.keys(t).forEach((function(i){r.push(i),n[i]=game.network.Procedure.mapTree(t[i],e,r),r.pop()})),n},game.network.Procedure.LIST=[],game.network.Procedure.TREE=game.network.Procedure.mapTree(game.network.Procedure.PARAM_TREE,game.network.Procedure.LIST,[]),game.network.Procedure.map=function(t){return new Map(t.map((function(t){return[t.name,t]})))},game.network.Procedure.prototype.validate=function(t){return game.utility.assert(t.length==this.constraints.length,"Wrong number of parameters"),this.constraints.forEach((function(e,r){game.network.require(t[r],e,"Illegal value for parameter "+r)})),t},game.network.Procedure.prototype.bind=function(){return this.bindArray(Array.prototype.slice.call(arguments))},game.network.Procedure.prototype.bindArray=function(t){return new game.network.Call(this,t)},game.network.Call.METHOD_PREFIX="handle_",game.network.Call.prototype.json=function(){return{name:this.procedure.name,params:this.params}},game.network.Call.prototype.handle=function(t){const e=game.network.Call.METHOD_PREFIX+this.procedure.name;game.utility.assert(e in t,"No handler for procedure '"+this.procedure.name+"'"),t[e].apply(t,this.params)},game.network.Parser.prototype.buildConstraint=function(){return game.constraints.object.isObjectWith(game.constraints.object.hasExactlyFields({name:game.constraints.contains(this.procedures),params:game.utility.json.isArray}))},game.network.Parser.prototype.parse=function(t,e){const r=game.network.require(JSON.parse(t,e),this.constraint,"Invalid JSON for parsing");return this.procedures.get(r.name).bindArray(r.params)},game.network.Parser.prototype.unparse=function(t,e){return JSON.stringify(game.network.require(t.json(),this.constraint,"Invalid JSON for unparsing"),e)},game.network.Parser.INSTANCE=new game.network.Parser(game.network.Procedure.map(game.network.Procedure.LIST)),game.network.Player.AVERAGE_RATING=1e3,game.network.Player.COMPARATOR=game.utility.comparators.ordered([game.utility.comparators.mapped(game.utility.comparators.default,(function(t){return t.name})),game.utility.comparators.mapped(game.utility.comparators.default,(function(t){return t.id}))]),game.network.Player.fromDataPublic=function(t){return new game.network.Player(t[0],null,t[1],t[2],null)},game.network.Player.fromDataPrivate=function(t){return game.network.Player.fromDataPublic(t).withTimestamps({registration:t[3],login:t[4]})},game.network.Player.prototype.withKey=function(t){return new game.network.Player(this.id,t,this.name,this.rating,this.timestamps)},game.network.Player.prototype.withTimestamps=function(t){return new game.network.Player(this.id,this.key,this.name,this.rating,t)},game.network.Player.prototype.findResult=function(t){const e=t.filter(function(t){return t.player.id==this.id}.bind(this));return game.utility.assert(1==e.length,"Self expected exactly once"),e[0]},game.network.Player.prototype.dataPublic=function(){return[this.id,this.name,this.rating]},game.network.Player.prototype.dataPrivate=function(){return this.dataPublic().concat(this.timestamps.registration,this.timestamps.login)},game.network.PlayerState.MAX_STROKES=10,game.network.PlayerState.MAX_STROKES_PENALTY=1,game.network.PlayerState.MAX_STROKES_WITH_PENALTY=game.network.PlayerState.MAX_STROKES+game.network.PlayerState.MAX_STROKES_PENALTY,game.network.PlayerState.PLAYER_COMPARATOR=game.utility.comparators.mapped(game.network.Player.COMPARATOR,(function(t){return t.player})),game.network.PlayerState.sort=function(t){return game.utility.discriminate(t,(function(t){return t.strokes.total}),game.utility.comparators.default,game.network.PlayerState.PLAYER_COMPARATOR)},game.network.PlayerState.prototype.withPlayer=function(t){return new game.network.PlayerState(t,this.ball,this.strokes,this.left)},game.network.PlayerState.prototype.withBall=function(t){return new game.network.PlayerState(this.player,t,this.strokes,this.left)},game.network.PlayerState.prototype.withBallCurrent=function(t){return this.withBall({current:t,last:this.ball.last})},game.network.PlayerState.prototype.withBallBoth=function(t){return this.withBall({current:t,last:t})},game.network.PlayerState.prototype.withStrokes=function(t){return new game.network.PlayerState(this.player,this.ball,t,this.left)},game.network.PlayerState.prototype.withLeft=function(t){return new game.network.PlayerState(this.player,this.ball,this.strokes,t)},game.network.PlayerState.prototype.maxStrokes=function(){if(this.ball.current.isCompleted())return this;const t=game.network.PlayerState.MAX_STROKES_WITH_PENALTY-this.strokes.current;return this.withStrokes({total:this.strokes.total+t,current:this.strokes.current+t})},game.network.PlayerState.prototype.hasMaxStrokes=function(){return this.strokes.current>=game.network.PlayerState.MAX_STROKES},game.network.PlayerState.prototype.endedMaxStrokes=function(){return this.hasMaxStrokes()&&this.ball.current.isResting()},game.network.PlayerState.prototype.ended=function(){return this.ball.current.isCompleted()||this.endedMaxStrokes()},game.network.PlayerState.prototype.advance=function(t){const e=this.ball.current.advance(t);return e?e.isResting()?this.withBallBoth(e):this.withBallCurrent(e):this.withBallCurrent(this.ball.last)},game.network.PlayerState.prototype.isHittable=function(){return this.ball.current.isHittable()&&!this.hasMaxStrokes()},game.network.PlayerState.prototype.hit=function(t,e){return this.isHittable()?new game.network.PlayerState(this.player,{current:this.ball.current.hit(t,e),last:this.ball.last},{total:this.strokes.total+1,current:this.strokes.current+1},this.left):this},game.network.PlayerState.prototype.isResettable=function(){return this.ball.current.isResettable()&&!this.hasMaxStrokes()},game.network.PlayerState.prototype.reset=function(t){return this.isResettable()?this.withBallBoth(t):this},game.network.PlayerState.prototype.toResult=function(){return new game.network.PlayerResult(this.player,this.strokes.total,this.left,this.player.rating)},game.network.PlayerState.prototype.fromData=function(t){return new game.network.PlayerState(game.network.Player.fromDataPublic(t[0]),{current:this.ball.current.fromData(t[1]),last:this.ball.last.fromData(t[2])},{total:t[3],current:t[4]},t[5])},game.network.PlayerState.prototype.data=function(){return[this.player.dataPublic(),this.ball.current.data(),this.ball.last.data(),this.strokes.total,this.strokes.current,this.left]},game.network.PlayerResult.PLAYER_COMPARATOR=game.utility.comparators.mapped(game.network.Player.COMPARATOR,(function(t){return t.player})),game.network.PlayerResult.sort=function(t){return game.utility.discriminate(t,(function(t){return t.strokes}),game.utility.comparators.default,game.network.PlayerResult.PLAYER_COMPARATOR)},game.network.PlayerResult.initial=function(t,e){return new game.network.PlayerResult(t,e*game.network.PlayerState.MAX_STROKES_WITH_PENALTY,!1,t.rating)},game.network.PlayerResult.fromData=function(t){return new game.network.PlayerResult(game.network.Player.fromDataPublic(t[0]),t[1],t[2],t[3])},game.network.PlayerResult.prototype.ratingAdjustment=function(){return this.player.rating-this.rating},game.network.PlayerResult.prototype.toStateBoth=function(t){return this.toState({current:t,last:t})},game.network.PlayerResult.prototype.toState=function(t){return new game.network.PlayerState(this.player,t,{total:this.strokes,current:0},this.left)},game.network.PlayerResult.prototype.data=function(){return[this.player.dataPublic(),this.strokes,this.left,this.rating]},game.network.Frame.from=function(t,e,r,n,i){return new game.network.Frame(t,e,r,n,i.map((function(t){return game.state.drivers.Player.map((function(e){return e.fromData(t)}))})))},game.network.Frame.fromData=function(t){return game.network.Frame.from(t[0],t[1],t[2],t[3],t[4])},game.network.Frame.prototype.mapActions=function(t){return new game.network.Frame(this.index,this.timestamp,this.totalTime,this.endTime,this.playerActions.map(t))},game.timing.PLAYABLE_END=game.timing.GAME_START_DURATION+game.timing.PLAYABLE_DURATION,game.state.drivers.Player.map=function(t){return function(e){return new game.state.drivers.Player(t(e.state))}},game.state.drivers.Player.prototype.delta=function(){return this.state.ball.current.delta()},game.state.drivers.Player.prototype.drive=function(t){return new game.state.drivers.Player(this.state.advance(t))},game.state.drivers.Player.prototype.geometry=function(){return this.state.ball.current.centerMatrix()},game.state.drivers.Camera.map=function(t,e){return function(r){return new game.state.drivers.Camera(t(r.driver),e(r.camera),r.position)}},game.state.drivers.Camera.prototype.delta=function(){return this.driver.delta()},game.state.drivers.Camera.prototype.drive=function(t){const e=this.driver.drive(t),r=this.position(e);return new game.state.drivers.Camera(e,r?this.camera.follow(r,t):this.camera,this.position)},game.state.drivers.Camera.prototype.renderer=function(){return this.driver.renderer().dot(this.camera.matrix())},game.state.drivers.Actioning.map=function(t){return function(e){return new game.state.drivers.Actioning(t(e.driver),e.action)}},game.state.drivers.Actioning.prototype.delta=function(){return this.driver.delta()},game.state.drivers.Actioning.prototype.drive=function(t){return new game.state.drivers.Actioning(this.driver.drive(t),this.action)},game.state.drivers.Actioning.prototype.renderer=function(){return this.driver.renderer()},game.state.drivers.RendererWrapper.map=function(t){return function(e){return new game.state.drivers.RendererWrapper(t(e.driver),e.fRenderer)}},game.state.drivers.RendererWrapper.prototype.delta=function(){return this.driver.delta()},game.state.drivers.RendererWrapper.prototype.drive=function(t){return new game.state.drivers.RendererWrapper(this.driver.drive(t),this.fRenderer)},game.state.drivers.RendererWrapper.prototype.renderer=function(){return new game.state.renderers.Wrapper(this.driver.geometry(),this.fRenderer)},game.state.drivers.RendererOverride.map=function(t){return function(e){return new game.state.drivers.RendererOverride(t(e.driver),e.fRenderer)}},game.state.drivers.RendererOverride.empty=function(t){return new game.state.drivers.RendererOverride(t,game.utility.constant(game.state.renderers.Wrapper.EMPTY))},game.state.drivers.RendererOverride.discrete=function(t,e){return new game.state.drivers.RendererOverride(t,(function(t){return new game.state.renderers.Multi(new Map([["driver",t.renderer()],["discrete",new game.state.renderers.Discrete(e.bind(null,t))]]))}))},game.state.drivers.RendererOverride.prototype.delta=function(){return this.driver.delta()},game.state.drivers.RendererOverride.prototype.drive=function(t){return new game.state.drivers.RendererOverride(this.driver.drive(t),this.fRenderer)},game.state.drivers.RendererOverride.prototype.renderer=function(){return this.dRenderer},game.state.drivers.Timer.action=function(t){return game.state.actions.ifExisting((function(){return new game.state.drivers.Timer(t)}),game.state.actions.illegal)},game.state.drivers.Timer.prototype.delta=function(){return game.timing.NORMAL_DELTA},game.state.drivers.Timer.prototype.drive=function(t){return new game.state.drivers.Timer(this.time+t)},game.state.drivers.Timer.prototype.renderer=function(){return game.state.renderers.Wrapper.EMPTY},game.state.drivers.Conditional.mapUnconditional=function(t){return function(e){return new game.state.drivers.Conditional(t(e.unconditionalDriver),e.conditionalDriver,e.condition)}},game.state.drivers.Conditional.mapConditional=function(t){return function(e){return new game.state.drivers.Conditional(e.unconditionalDriver,t(e.conditionalDriver),e.condition)}},game.state.drivers.Conditional.mapBoth=function(t,e){return function(r){return new game.state.drivers.Conditional(t(r.unconditionalDriver),e(r.conditionalDriver),r.condition)}},game.state.drivers.Conditional.ifSatisfied=function(t){return game.state.actions.conditional(t,(function(t){return game.utility.assert(game.utility.json.isBoolean(t.satisfied),"Flag not valid"),t.satisfied}))},game.state.drivers.Conditional.prototype.delta=function(){return Math.min(this.unconditionalDriver.delta(),this.conditionalDriver.delta())},game.state.drivers.Conditional.prototype.drive=function(t){return new game.state.drivers.Conditional(this.unconditionalDriver.drive(t),this.satisfied?this.conditionalDriver.drive(t):this.conditionalDriver,this.condition)},game.state.drivers.Conditional.prototype.renderer=function(){return new game.state.renderers.Multi(new Map([["unconditional",this.unconditionalDriver.renderer()],["conditional",this.conditionalDriver.renderer()]]))},game.state.drivers.Multi.OTHERS={KEEP:function(t){return t},DISCARD:function(t){return[t[0],null]},ASSERT_NONE:function(t){throw new Error("No other entry allowed")}},game.state.drivers.Multi.ORDERED={OTHERS_FIRST:function(t,e){return!1},ASCENDING:function(t,e){return t<e}},game.state.drivers.Multi.map=function(t,e,r){return function(n){const i=new Map,a=game.utility.collection.map.entries(t),o=game.utility.collection.map.entries(n.drivers);for(var s=0,m=0;s<a.length||m<o.length;){var u;s<a.length&&m<o.length&&a[s][0]===o[m][0]?(u=[a[s][0],a[s][1](o[m][1])],s++,m++):m==o.length||t.has(o[m][0])||s<a.length&&r(a[s][0],o[m][0])?(game.utility.assert(!n.drivers.has(a[s][0]),"Keys out of order"),u=[a[s][0],a[s][1]()],s++):(u=e(o[m]),m++),u[1]&&i.set(u[0],u[1])}return new game.state.drivers.Multi(i)}},game.state.drivers.Multi.prototype.delta=function(){return game.utility.collection.values(this.drivers).map((function(t){return t.delta()})).reduce((function(t,e){return Math.min(t,e)}),game.timing.NORMAL_DELTA)},game.state.drivers.Multi.prototype.drive=function(t){return new game.state.drivers.Multi(new Map(game.utility.collection.map.entries(this.drivers).map((function(e){return[e[0],e[1].drive(t)]}))))},game.state.drivers.Multi.prototype.renderer=function(){return new game.state.renderers.Multi(new Map(game.utility.collection.map.entries(this.drivers).map((function(t){return[t[0],t[1].renderer()]}))))},game.state.renderers.Wrapper.EMPTY=new game.state.renderers.Wrapper(game.geometry.void,(function(){})),game.state.renderers.Wrapper.prototype.dot=function(t){return new game.state.renderers.Wrapper(this.geometry.dot(t),this.fRenderer)},game.state.renderers.Wrapper.prototype.interpolate=function(t,e){return new game.state.renderers.Wrapper(this.geometry.interpolate(t.geometry,e),this.fRenderer)},game.state.renderers.Wrapper.prototype.render=function(){this.fRenderer(this.geometry)},game.state.renderers.Discrete.prototype.dot=function(t){return this},game.state.renderers.Discrete.prototype.interpolate=function(t,e){return t},game.state.renderers.Discrete.prototype.render=function(){this.fRenderer()},game.state.renderers.Multi.prototype.dot=function(t){return new game.state.renderers.Multi(new Map(game.utility.collection.map.entries(this.renderers).map((function(e){return[e[0],e[1].dot(t)]}))))},game.state.renderers.Multi.prototype.interpolate=function(t,e){return new game.state.renderers.Multi(new Map(game.utility.collection.map.entries(t.renderers).map(function(t){return[t[0],this.renderers.has(t[0])?this.renderers.get(t[0]).interpolate(t[1],e):t[1]]}.bind(this))))},game.state.renderers.Multi.prototype.render=function(){this.renderers.forEach((function(t){t.render()}))},game.state.updaters.TimeEvent.prototype.pruner=function(){return this.prune.bind(this)},game.state.updaters.TimeEvent.prototype.applier=function(){return this.apply.bind(this)},game.state.updaters.TimeEvent.prototype.prune=function(t){if(this.events.splice(0,this.find(t[0].timestamp)),null!=this.lastInsert){const e=game.state.Frame.findByTimestamp(t,this.lastInsert);t.splice(Math.max(e,1)),this.lastInsert=null}},game.state.updaters.TimeEvent.prototype.apply=function(t){const e=game.utility.array.last(t),r=game.utility.array.lastN(t,2);game.utility.array.assignLast(t,e.apply(game.state.actions.merge(this.events.slice(this.find(r.timestamp),this.find(e.timestamp)).map((function(t){return t.action})))))},game.state.updaters.TimeEvent.prototype.find=function(t){return game.utility.array.binarySearch(this.events,(function(e){return e.timestamp<t}))},game.state.updaters.TimeEvent.prototype.insert=function(t){this.events.splice(this.find(t.timestamp+1),0,t),(null==this.lastInsert||t.timestamp<this.lastInsert)&&(this.lastInsert=t.timestamp)},game.state.updaters.TimeEvent.prototype.driveLast=function(t){this.events.length&&t.drive(game.utility.array.last(this.events).timestamp)},game.state.updaters.IndexEvent.prototype.pruner=function(){return this.pruner.bind(this)},game.state.updaters.IndexEvent.prototype.applier=function(){return this.apply.bind(this)},game.state.updaters.IndexEvent.prototype.prune=function(t){if(this.events.splice(0,this.find(t[0].index)),null!=this.lastInsert){const e=game.state.Frame.findByIndex(t,this.lastInsert);game.utility.assert(e>0,"Index event occurred before first frame"),t.splice(e),this.lastInsert=null}},game.state.updaters.IndexEvent.prototype.apply=function(t){for(var e=game.utility.array.last(t),r=this.find(e.index);r<this.events.length&&this.events[r].index==e.index;)e=e.apply(this.events[r].action),r++;game.utility.array.assignLast(t,e)},game.state.updaters.IndexEvent.prototype.find=function(t){return game.utility.array.binarySearch(this.events,(function(e){return e.index<t}))},game.state.updaters.IndexEvent.prototype.insert=function(t){this.events.splice(this.find(t.index+1),0,t),(null==!this.lastInsert||t.index<this.lastInsert)&&(this.lastInsert=t.index)},game.state.updaters.TimeSync.prototype.pruner=function(){return this.prune.bind(this)},game.state.updaters.TimeSync.prototype.applier=function(){return this.apply.bind(this)},game.state.updaters.TimeSync.prototype.prune=function(t){if(this.syncs.splice(0,this.find(t[0].index)),this.lastInsert){var e=game.state.Frame.findByIndex(t,this.lastInsert.index);for(game.utility.assert(e>0,"Time sync occurred before first frame");e>0&&this.lastInsert.affectsFrame(t[e-1]);)e--;t.splice(e),this.lastInsert=null}},game.state.updaters.TimeSync.prototype.apply=function(t){const e=game.utility.array.last(t),r=this.find(e.index);r<this.syncs.length&&(game.utility.array.assignLast(t,this.syncs[r].apply(e)),game.utility.assert(1==t.length||game.utility.array.lastN(t,2).isConsecutive(game.utility.array.last(t)),"Only the last frame may be affected"))},game.state.updaters.TimeSync.prototype.find=function(t){return game.utility.array.binarySearch(this.syncs,(function(e){return e.index<t}))},game.state.updaters.TimeSync.prototype.insert=function(t){const e=this.find(t.index);game.utility.assert(e==this.syncs.length||this.syncs[e].index!=t.index,"Sync for index already exists"),game.utility.assert(0==e||!t.affectsOther(this.syncs[e-1]),"Sync timestamp affects previous one"),game.utility.assert(e==this.syncs.length||!this.syncs[e].affectsOther(t),"Next sync timestamp affects new one"),this.syncs.splice(e,0,t),(!this.lastInsert||t.index<this.lastInsert.index)&&(this.lastInsert=t)},game.state.updaters.indexPruner.reference=function(t){return function(e){return t.index}},game.state.updaters.timestampPruner.delta=function(t){return function(e){return game.utility.array.last(e).timestamp-t}},game.state.TimeSync.prototype.maxTimestamp=function(t){return game.utility.assert(this.index>=t,"Cannot compute for greater index"),this.timestamp-(this.index-t)*game.timing.TICKS_PER_GAP},game.state.TimeSync.prototype.affectsOther=function(t){return t.timestamp>this.maxTimestamp(t.index)},game.state.TimeSync.prototype.affectsFrame=function(t){return t.timestamp>this.maxTimestamp(t.index)},game.state.TimeSync.prototype.apply=function(t){return new game.state.Frame(t.index,this.index==t.index?this.timestamp:Math.min(t.timestamp,this.maxTimestamp(t.index)),t.driver)},game.state.Frame.zero=function(t){return new game.state.Frame(0,0,t)},game.state.Frame.findByIndex=function(t,e){return game.utility.array.binarySearch(t,(function(t){return t.index<e}))},game.state.Frame.findByTimestamp=function(t,e){return game.utility.array.binarySearch(t,(function(t){return t.timestamp<e}))},game.state.Frame.pruneIndex=function(t,e,r,n){e>t[0].index&&t.splice(0,Math.min(game.state.Frame.findByIndex(t,e)-r,t.length-n))},game.state.Frame.pruneTimestamp=function(t,e,r,n){e>t[0].timestamp&&t.splice(0,Math.min(game.state.Frame.findByTimestamp(t,e)-r,t.length-n))},game.state.Frame.prototype.isConsecutive=function(t){return this.index+1==t.index&&this.timestamp+game.timing.TICKS_PER_GAP<=t.timestamp},game.state.Frame.prototype.renderer=function(){return this.driver.renderer()},game.state.Frame.prototype.render=function(){this.renderer().render()},game.state.Frame.prototype.interpolateRenderer=function(t,e){return game.utility.assert(this.isConsecutive(t),"Frames not consecutive"),e==this.timestamp?this.renderer():e==t.timestamp?t.renderer():this.renderer().interpolate(t.renderer(),(e-this.timestamp)/(t.timestamp-this.timestamp))},game.state.Frame.prototype.drive=function(){const t=game.timing.sToTicksGap(this.driver.delta());return new game.state.Frame(this.index+1,this.timestamp+t,this.driver.drive(game.timing.ticksToS(t)))},game.state.Frame.prototype.apply=function(t){return new game.state.Frame(this.index,this.timestamp,t(this.driver))},game.state.Frame.prototype.rendererOverride=function(t){return new game.state.Frame(this.index,this.timestamp,new game.state.drivers.RendererOverride(this.driver,t))},game.state.Trace.prototype.minTimestamp=function(){return this.frames[0].timestamp+1},game.state.Trace.prototype.maxTimestamp=function(){return this.lastFrame().timestamp+1},game.state.Trace.prototype.timeEventAfter=function(t){return new game.state.TimeEvent(this.maxTimestamp(),t)},game.state.Trace.prototype.timeEventClamped=function(t,e,r){return new game.state.TimeEvent(game.utility.clamp(e,this.minTimestamp(),this.maxTimestamp()+t),r)},game.state.Trace.prototype.lastFrame=function(){return game.utility.array.last(this.frames)},game.state.Trace.prototype.findByTimestamp=function(t){return game.state.Frame.findByTimestamp(this.frames,t)},game.state.Trace.prototype.drive=function(t){for(;this.lastFrame().timestamp<t;)this.updater(this.frames)},game.state.Trace.prototype.renderer=function(t){const e=this.findByTimestamp(t);return 0==e?this.frames[e]:e==this.frames.length?this.frames[e-1]:this.frames[e-1].interpolateRenderer(this.frames[e],t)},game.state.Trace.prototype.render=function(t){this.renderer(t).render()},"undefined"!=typeof exports&&(module.exports=game);
'use strict';const vehicles={utility:{Setup:function(){this.height=this.damping=this.stiffness=this.traction=this.acceleration=this.speed=0},Builder:function(a,b,c,d){this.matchers=a;this.locator=b;this.motor=c;this.setup=d;this.bundle=new physics.collections.Bundle;this.updaters=[]}},cargoBike:{build:function(a){const b=this.newChassis(),c=b[0].particle.motion.position.translation.negate(),d=this.newWheel(new physics.dynamics.Vector(1565,612)),e=this.newWheel(new physics.dynamics.Vector(318,592)),
g=new physics.dynamics.Particle(physics.dynamics.Motion.ZERO,e[0].particle.invMass);a.addCollisions([b],[d,e],.5).addVerticalSpringBasic(b,d,(new game.utility.Range(30,60)).multiply(this.SCALING()),new physics.interaction.Elasticity(.045,.15)).addWheelJoint(b,e).addMotor(b,e,2E5,7).addWheelFriction(b,d).addAngleLinkParticles(e[0].particle,g,1,2).addTaillights().addBackgroundBodyImage(resources.vehicles.cargoBike.chassis,c.add((new physics.dynamics.Vector(1122,51)).multiply(this.SCALING())),b).addForegroundGraphics([a.newBodyGraphics(this.newLeg(a,
g,c,resources.vehicles.cargoBike.cyclist.back.shank,resources.vehicles.cargoBike.cyclist.back.thigh,Math.PI).reverse(),b),a.newWheelImage(resources.vehicles.cargoBike.wheel,e),a.newBodyGraphics([].concat(a.bodyImageWithTaillights(resources.vehicles.cargoBike.body.back,c,resources.vehicles.cargoBike.taillight.off,resources.vehicles.cargoBike.taillight.on,c.add((new physics.dynamics.Vector(35,335)).multiply(this.SCALING()))),this.newLeg(a,g,c,resources.vehicles.cargoBike.cyclist.front.shank,resources.vehicles.cargoBike.cyclist.front.thigh,
0),a.newImage(resources.vehicles.cargoBike.body.front,c.add((new physics.dynamics.Vector(419,-792)).multiply(this.SCALING())))),b),a.newWheelImage(resources.vehicles.cargoBike.wheel,d)]).addRepeatingSound(b,[e],c.add((new physics.dynamics.Vector(568,601)).multiply(this.SCALING())),resources.vehicles.cargoBike.chain,1,.1).addCollisionSounds(resources.vehicles.cargoBike.collision).addBodies([b,d,e],0).addParticle(g).addCameraScaling(1)},newChassis:function(){return physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(46,
335),new physics.dynamics.Vector(.33,461.33),new physics.dynamics.Vector(666,698),new physics.dynamics.Vector(1145.67,615),new physics.dynamics.Vector(1145.67,51),new physics.dynamics.Vector(210.38,265.5)],this.SCALING(),2),game.utility.scaledPolygonBody([new physics.dynamics.Vector(2008,615),new physics.dynamics.Vector(2008,592),new physics.dynamics.Vector(517,592),new physics.dynamics.Vector(666,698),new physics.dynamics.Vector(1237,698)],this.SCALING(),1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(2008,
100),new physics.dynamics.Vector(2008,592),new physics.dynamics.Vector(1983.64,609),new physics.dynamics.Vector(1983.64,100)],this.SCALING(),1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(385.33,415.67),new physics.dynamics.Vector(454,-447.36),new physics.dynamics.Vector(503,-736.5),new physics.dynamics.Vector(554,-782),new physics.dynamics.Vector(632,-793.67),new physics.dynamics.Vector(695,-764.5),new physics.dynamics.Vector(722,-721),new physics.dynamics.Vector(592.5,424.5)],this.SCALING(),
3),game.utility.scaledPolygonBody([new physics.dynamics.Vector(1111,-16),new physics.dynamics.Vector(1111,327),new physics.dynamics.Vector(500,423),new physics.dynamics.Vector(561.67,-324),new physics.dynamics.Vector(949,-242.5)],this.SCALING(),1)])},newWheel:function(a){return vehicles.utility.Builder.newWheel(a,614,this.SCALING(),1)},newLeg:function(a,b,c,d,e,g){return[a.newTransformator(a.newImage(resources.vehicles.cargoBike.crank,this.CRANK_ORIGIN().negate()),b,function(k){return new physics.dynamics.Transformation(c.add(this.CRANK_OFFSET()),
k.rotation+g)}.bind(this)),a.newTransformator(a.newImage(d,this.SHANK_BOTTOM_ORIGIN().negate()),b,this.newLegMapper(c,g,1,0,this.SHANK_LENGTH(),this.SHANK_ANGLE())),a.newTransformator(a.newImage(e,this.THIGH_TOP_ORIGIN().negate()),b,this.newLegMapper(c,g,-1,1,this.THIGH_LENGTH(),this.THIGH_ANGLE()))]},newLegMapper:function(a,b,c,d,e,g){const k=c*(this.SHANK_LENGTH_2()-this.THIGH_LENGTH_2());return function(h){h=this.CRANK_OFFSET().add(physics.dynamics.Vector.fromRotation(h.rotation+b).multiply(this.CRANK_LENGTH()));
const f=this.BODY_THIGH_ORIGIN().subtract(h).multiply(c);var l=f.square();l=(l+k)/(2*Math.sqrt(l));return new physics.dynamics.Transformation(a.add(h.interpolate(this.BODY_THIGH_ORIGIN(),d)),f.angle()+c*Math.acos(l/e)-g)}.bind(this)}},vintagePickup:{build:function(a){const b=this.newChassis(),c=b[0].particle.motion.position.translation.negate(),d=this.newWheel(new physics.dynamics.Vector(1018,410)),e=this.newWheel(new physics.dynamics.Vector(265,412));a.addCollisions([b],[d,e],.5).addVerticalSpringBasic(b,
d,this.SPRING_RANGE(),new physics.interaction.Elasticity(.025,.15)).addVerticalSpringBasic(b,e,this.SPRING_RANGE(),new physics.interaction.Elasticity(.025,.15)).addMotor(b,e,28E4,12).addWheelFriction(b,d).addTaillights().addBackgroundBodyImage(resources.vehicles.vintagePickup.chassis.background,c.add((new physics.dynamics.Vector(8,44)).multiply(this.SCALING())),b).addForegroundGraphics([a.newBodyImage(resources.vehicles.vintagePickup.chassis.foreground,c.add((new physics.dynamics.Vector(133,286)).multiply(this.SCALING())),
b),a.newWheelImage(resources.vehicles.vintagePickup.wheel,d),a.newWheelImage(resources.vehicles.vintagePickup.wheel,e),a.newBodyGraphics(a.bodyImageWithTaillights(resources.vehicles.vintagePickup.body,c,resources.vehicles.vintagePickup.taillight.off,resources.vehicles.vintagePickup.taillight.on,c.add((new physics.dynamics.Vector(0,284)).multiply(this.SCALING()))),b)]).addEngineSound(b,[e],c.add((new physics.dynamics.Vector(979,240)).multiply(this.SCALING())),resources.vehicles.vintagePickup.engine,
.5,.05,.5).addCollisionSounds(resources.vehicles.vintagePickup.collision).addBodies([b,d,e],0).addCameraScaling(1.4)},newChassis:function(){return physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(1216.88,394.88),new physics.dynamics.Vector(1218.73,259.36),new physics.dynamics.Vector(1170.18,186.82),new physics.dynamics.Vector(1109.82,168.09),new physics.dynamics.Vector(863,153),new physics.dynamics.Vector(390,358),new physics.dynamics.Vector(542,414),new physics.dynamics.Vector(863,
414)],this.SCALING(),3),game.utility.scaledPolygonBody([new physics.dynamics.Vector(938.5,280.5),new physics.dynamics.Vector(783.09,20.45),new physics.dynamics.Vector(740.36,.82),new physics.dynamics.Vector(596.18,3),new physics.dynamics.Vector(567.64,26.64),new physics.dynamics.Vector(533.38,333.62)],this.SCALING(),2),game.utility.scaledPolygonBody([new physics.dynamics.Vector(1078.36,267),new physics.dynamics.Vector(18.33,251),new physics.dynamics.Vector(11,293.03),new physics.dynamics.Vector(11,
390),new physics.dynamics.Vector(542,414)],this.SCALING(),2),game.utility.scaledPolygonBody([new physics.dynamics.Vector(11,183),new physics.dynamics.Vector(11,293),new physics.dynamics.Vector(36,366)],this.SCALING(),1)])},newWheel:function(a){return vehicles.utility.Builder.newWheel(a,190,this.SCALING(),1)}},flatbedSemiTruck:{build:function(a){const b=this.newTractorChassis(),c=this.newTrailerChassis(),d=b[0].particle.motion.position.translation.negate(),e=c[0].particle.motion.position.translation.negate(),
g=this.newWheel(new physics.dynamics.Vector(1072,781)),k=this.newWheel(new physics.dynamics.Vector(155,781)),h=this.newWheel(new physics.dynamics.Vector(629,499)),f=this.newWheel(new physics.dynamics.Vector(311,499));a.addCollisions([b,c],[g,k,h,f],.5).addVerticalSpringBasic(b,g,this.FRONT_SPRING_RANGE(),new physics.interaction.Elasticity(.02,.15)).addVerticalSpringBasic(b,k,this.BACK_SPRING_RANGE(),new physics.interaction.Elasticity(.025,.15)).addVerticalSpringSeesaw(c,[h,f],this.BACK_SPRING_RANGE(),
new physics.interaction.Elasticity(.012,.15),1,.9).addJoint(new physics.interaction.Fixture(b[0].particle,d.add((new physics.dynamics.Vector(337,631)).multiply(this.SCALING()))),new physics.interaction.Fixture(c[0].particle,e.add((new physics.dynamics.Vector(2231,349)).multiply(this.SCALING()))),[c,h,f]).addAngle(b,c,-Math.PI/20,Math.PI/20).addMotor(b,k,6E5,8).addWheelFriction(b,g).addWheelFriction(c,f).addWheelFriction(c,h).addTaillights().addForegroundGraphics([a.newBodyImage(resources.vehicles.flatbedSemiTruck.tractor.chassis,
d.add((new physics.dynamics.Vector(-4,549)).multiply(this.SCALING())),b),a.newBodyImage(resources.vehicles.flatbedSemiTruck.trailer.chassis,e.add((new physics.dynamics.Vector(0,303)).multiply(this.SCALING())),c),a.newWheelImage(resources.vehicles.flatbedSemiTruck.wheels.front,g),a.newWheelImage(resources.vehicles.flatbedSemiTruck.wheels.back,k),a.newWheelImage(resources.vehicles.flatbedSemiTruck.wheels.back,h),a.newWheelImage(resources.vehicles.flatbedSemiTruck.wheels.back,f),a.newBodyGraphics(a.bodyImageWithTaillights(resources.vehicles.flatbedSemiTruck.tractor.body,
d,resources.vehicles.flatbedSemiTruck.taillights.off,resources.vehicles.flatbedSemiTruck.taillights.on,d.add((new physics.dynamics.Vector(-13,701)).multiply(this.SCALING()))),b),a.newBodyGraphics(a.bodyImageWithTaillights(resources.vehicles.flatbedSemiTruck.trailer.body,e,resources.vehicles.flatbedSemiTruck.taillights.off,resources.vehicles.flatbedSemiTruck.taillights.on,e.add((new physics.dynamics.Vector(37,430)).multiply(this.SCALING()))),c)]).addEngineSound(b,[k],d.add((new physics.dynamics.Vector(1045,
684)).multiply(this.SCALING())),resources.vehicles.flatbedSemiTruck.tractor.engine,.8,.04,.5).addCollisionSounds(resources.vehicles.flatbedSemiTruck.collision).addBodies([b,g,k,c,h,f],3).addCameraScaling(2.1)},newTractorChassis:function(){return physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(-4,700.25),new physics.dynamics.Vector(-4,762.82),new physics.dynamics.Vector(107,810),new physics.dynamics.Vector(925.62,810),new physics.dynamics.Vector(1244.5,659),
new physics.dynamics.Vector(61.75,659)],this.SCALING(),7),game.utility.scaledPolygonBody([new physics.dynamics.Vector(812,759.25),new physics.dynamics.Vector(925.72,810),new physics.dynamics.Vector(1381,795.62),new physics.dynamics.Vector(1392,572),new physics.dynamics.Vector(1393,456),new physics.dynamics.Vector(1326.33,168.33),new physics.dynamics.Vector(1274.67,117.33),new physics.dynamics.Vector(836.67,6),new physics.dynamics.Vector(815,255.5)],this.SCALING(),5)])},newTrailerChassis:function(){return physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(1890,
343.67),new physics.dynamics.Vector(2531,333),new physics.dynamics.Vector(2565,318),new physics.dynamics.Vector(2531,290),new physics.dynamics.Vector(18,290)],this.SCALING(),2),game.utility.scaledPolygonBody([new physics.dynamics.Vector(18,290),new physics.dynamics.Vector(0,346),new physics.dynamics.Vector(0,409),new physics.dynamics.Vector(1619.5,409),new physics.dynamics.Vector(1996.55,318)],this.SCALING(),3),game.utility.scaledPolygonBody([new physics.dynamics.Vector(0,147),new physics.dynamics.Vector(0,
346),new physics.dynamics.Vector(34.06,384.78),new physics.dynamics.Vector(34.02,146.98)],this.SCALING(),1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(2531,0),new physics.dynamics.Vector(2531,290),new physics.dynamics.Vector(2565,318),new physics.dynamics.Vector(2565,0)],this.SCALING(),1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(45.75,395),new physics.dynamics.Vector(45.76,490.77),new physics.dynamics.Vector(239.61,499),new physics.dynamics.Vector(700.18,499),new physics.dynamics.Vector(784.94,
395)],this.SCALING(),2)])},newWheel:function(a){return vehicles.utility.Builder.newWheel(a,242,this.SCALING(),3)}},agriculturalTractor:{build:function(a){const b=this.newTractorChassis(),c=this.newTrailerChassis(),d=b[0].particle.motion.position.translation.negate(),e=c[0].particle.motion.position.translation.negate(),g=this.newTractorFrontWheel(new physics.dynamics.Vector(997,654)),k=this.newTractorBackWheel(new physics.dynamics.Vector(259,594)),h=this.newTrailerWheel(new physics.dynamics.Vector(1080,
554)),f=this.newTrailerWheel(new physics.dynamics.Vector(290,554)),l=new physics.interaction.Fixture(b[0].particle,d.add((new physics.dynamics.Vector(70,594)).multiply(this.SCALING()))),m=new physics.interaction.Fixture(c[0].particle,e.add((new physics.dynamics.Vector(1355,408)).multiply(this.SCALING())));a.addCollisions([b,c],[g,k,h,f],.9).addVerticalSpringBasic(b,g,(new game.utility.Range(30,55)).multiply(this.SCALING()),new physics.interaction.Elasticity(.023,.15)).addVerticalSpringBasic(b,k,(new game.utility.Range(40,
65)).multiply(this.SCALING()),new physics.interaction.Elasticity(.018,.15)).addVerticalSpringBasic(c,h,this.TRAILER_SPRING_RANGE(),new physics.interaction.Elasticity(.018,.15)).addVerticalSpringBasic(c,f,this.TRAILER_SPRING_RANGE(),new physics.interaction.Elasticity(.014,.15)).addAlignDistanceJoint([c,h,f],[b,g,k],m,l,500*this.SCALING(),Math.PI/6,Math.PI/6).addMotor(b,k,12E5,5).addWheelFriction(b,g).addWheelFriction(c,f).addWheelFriction(c,h).addTaillights().addBackgroundBodyImage(resources.vehicles.agriculturalTractor.trailer.chassis,
e.add((new physics.dynamics.Vector(20,141)).multiply(this.SCALING())),c).addForegroundGraphics([a.newJointImage(resources.vehicles.agriculturalTractor.trailer.drawbar,m,l),a.newBodyImage(resources.vehicles.agriculturalTractor.tractor.chassis,d.add((new physics.dynamics.Vector(0,281)).multiply(this.SCALING())),b),a.newBodyGraphics(a.bodyImageWithTaillights(resources.vehicles.agriculturalTractor.trailer.body,e,resources.vehicles.agriculturalTractor.trailer.taillight.off,resources.vehicles.agriculturalTractor.trailer.taillight.on,
e.add((new physics.dynamics.Vector(0,383)).multiply(this.SCALING()))),c),a.newWheelImage(resources.vehicles.agriculturalTractor.tractor.wheels.front,g),a.newWheelImage(resources.vehicles.agriculturalTractor.tractor.wheels.back,k),a.newWheelImage(resources.vehicles.agriculturalTractor.trailer.wheel,h),a.newWheelImage(resources.vehicles.agriculturalTractor.trailer.wheel,f),a.newBodyGraphics(a.bodyImageWithTaillights(resources.vehicles.agriculturalTractor.tractor.body,d,resources.vehicles.agriculturalTractor.tractor.taillight.off,
resources.vehicles.agriculturalTractor.tractor.taillight.on,d.add((new physics.dynamics.Vector(129,296)).multiply(this.SCALING()))),b)]).addEngineSound(b,[k],d.add((new physics.dynamics.Vector(868,478)).multiply(this.SCALING())),resources.vehicles.agriculturalTractor.tractor.engine,.8,.04,.5).addCollisionSounds(resources.vehicles.agriculturalTractor.collision).addBodies([b,g,k,c,h,f],3).addCameraScaling(1.9)},newTractorChassis:function(){return physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(641,
622),new physics.dynamics.Vector(406.5,622),new physics.dynamics.Vector(.48,479.52),new physics.dynamics.Vector(23.5,413.5),new physics.dynamics.Vector(103.75,333.5),new physics.dynamics.Vector(204,294.75),new physics.dynamics.Vector(643.5,281.25),new physics.dynamics.Vector(887.5,288.5),new physics.dynamics.Vector(1114.45,326.91),new physics.dynamics.Vector(1142.82,344),new physics.dynamics.Vector(1144.45,367.64),new physics.dynamics.Vector(1131.73,420.73),new physics.dynamics.Vector(1095.33,518.67)],
this.SCALING(),8),game.utility.scaledPolygonBody([new physics.dynamics.Vector(252,411),new physics.dynamics.Vector(261.33,187.33),new physics.dynamics.Vector(281.5,76.25),new physics.dynamics.Vector(627.5,82.5),new physics.dynamics.Vector(639,199.33),new physics.dynamics.Vector(651,437.33)],this.SCALING(),3),game.utility.scaledPolygonBody([new physics.dynamics.Vector(236.09,53.09),new physics.dynamics.Vector(439,55.33),new physics.dynamics.Vector(661.36,64),new physics.dynamics.Vector(672.12,79.38),
new physics.dynamics.Vector(663.5,102.38),new physics.dynamics.Vector(387,147.25),new physics.dynamics.Vector(244,80.5)],this.SCALING(),1)])},newTrailerChassis:function(){return physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(0,141),new physics.dynamics.Vector(20,141),new physics.dynamics.Vector(20,353.5),new physics.dynamics.Vector(0,339.5)],this.SCALING(),1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(0,365),new physics.dynamics.Vector(0,
339.52),new physics.dynamics.Vector(10,325),new physics.dynamics.Vector(1370,325),new physics.dynamics.Vector(1390,337.18),new physics.dynamics.Vector(1390,365)],this.SCALING(),3),game.utility.scaledPolygonBody([new physics.dynamics.Vector(1350,0),new physics.dynamics.Vector(1370,0),new physics.dynamics.Vector(1370,345.36),new physics.dynamics.Vector(1350,345.18)],this.SCALING(),1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(1390,247),new physics.dynamics.Vector(1363.5,209.75),new physics.dynamics.Vector(1370,
353),new physics.dynamics.Vector(1390,337.16)],this.SCALING(),1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(0,383),new physics.dynamics.Vector(0,427.67),new physics.dynamics.Vector(290,513),new physics.dynamics.Vector(460,463.75),new physics.dynamics.Vector(460,345.33),new physics.dynamics.Vector(120,345.33)],this.SCALING(),1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(1370,345.33),new physics.dynamics.Vector(910,345.33),new physics.dynamics.Vector(910,464.25),new physics.dynamics.Vector(1099.67,
519),new physics.dynamics.Vector(1370,419.67)],this.SCALING(),1)])},newTractorFrontWheel:function(a){return vehicles.utility.Builder.newWheel(a,374,this.SCALING(),2)},newTractorBackWheel:function(a){return vehicles.utility.Builder.newWheel(a,494,this.SCALING(),4)},newTrailerWheel:function(a){return vehicles.utility.Builder.newWheel(a,264,this.SCALING(),3)}},trackedDumpTruck:{build:function(a){const b=this.newChassis(),c=b[0].particle.motion.position.translation.negate(),d=this.newFrontWheel(new physics.dynamics.Vector(1279,
655)),e=this.newBackWheel(new physics.dynamics.Vector(306,655)),g=vehicles.trackedDumpTruck.SUPPORT_ORIGINS.map(function(f){return[this.newSupportWheel(f.add(vehicles.trackedDumpTruck.SUPPORT_BACK_OFFSET)),this.newSupportWheel(f.add(vehicles.trackedDumpTruck.SUPPORT_FRONT_OFFSET))]}.bind(this)),k=physics.utility.flatten(g);k.forEach(function(f,l){a.addVerticalSpringBasic(b,f,(new game.utility.Range(35,65)).multiply(this.SCALING()),new physics.interaction.Elasticity(.015,.15)).addMotor(b,f,1E5,5);
l&&a.addAngleLink(k[l-1],f,1,1)}.bind(this));const h=[!1,!0,!0,!1].concat(k.map(function(f){return!0}));a.addCollisions([b],[d,e].concat(k),1).addVerticalSpringBasic(b,d,this.MAIN_SPRING_RANGE(),new physics.interaction.Elasticity(.025,.1)).addVerticalSpringBasic(b,e,this.MAIN_SPRING_RANGE(),new physics.interaction.Elasticity(.02,.1)).addAngleLink(d,e,8,7).addAngleLink(e,k[0],3,4).addBackgroundBodyImage(resources.vehicles.trackedDumpTruck.chassis,c.add((new physics.dynamics.Vector(20,0)).multiply(this.SCALING())),
b).addForegroundGraphics([a.newBodyImage(resources.vehicles.trackedDumpTruck.body,c,b),a.newWheelImage(resources.vehicles.trackedDumpTruck.wheels.front,d),a.newWheelImage(resources.vehicles.trackedDumpTruck.wheels.back,e),a.newGraphicCallable(function(f){const l=this.newChainCircle(f.bodyShape(d[0])),m=this.newChainCircle(f.bodyShape(e[0]));this.renderChain(f,[l,this.newTopWheelCircle(l,m,new physics.dynamics.Vector(670,-56)),this.newTopWheelCircle(l,m,new physics.dynamics.Vector(310,-56)),m].concat(k.map(function(n){return this.newChainCircle(f.bodyShape(n[0]))}.bind(this))),
h,f.position(d[0].particle).rotation/physics.utility.PI_2)}.bind(this)),a.newBiTransformator(a.newImage(resources.vehicles.trackedDumpTruck.track,(new physics.dynamics.Vector(-516.5,-86)).multiply(this.SCALING())),physics.interaction.Fixture.centroid(e[0].particle),physics.interaction.Fixture.centroid(d[0].particle),.5),a.newHeightGraphic(this.MAIN_SPRING_RANGE(),function(f,l){return a.newBodyImage(resources.vehicles.trackedDumpTruck.mounts,f.add(new physics.dynamics.Vector(0,l)),b)}.bind(null,c.add((new physics.dynamics.Vector(441,
639)).multiply(this.SCALING()))))].concat(g.map(function(f){return a.newBiTransformator(a.newImage(resources.vehicles.trackedDumpTruck.wheels.support,(new physics.dynamics.Vector(-93,-16)).multiply(this.SCALING())),physics.interaction.Fixture.centroid(f[0][0].particle),physics.interaction.Fixture.centroid(f[1][0].particle),.5)}.bind(this)))).addEngineSound(b,k,c.add((new physics.dynamics.Vector(1112,449)).multiply(this.SCALING())),resources.vehicles.trackedDumpTruck.engine,.6,.06,.5).addRepeatingSound(b,
k,c.add((new physics.dynamics.Vector(784,666)).multiply(this.SCALING())),resources.vehicles.trackedDumpTruck.chain,.75,.5).addCollisionSounds(resources.vehicles.trackedDumpTruck.collision).addBodies([b,d,e].concat(k),0).addCameraScaling(1.6)},newChassis:function(){return physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(106,603),new physics.dynamics.Vector(106,516),new physics.dynamics.Vector(1518,516),new physics.dynamics.Vector(1544.81,605.19),new physics.dynamics.Vector(1517.88,
634),new physics.dynamics.Vector(1367.33,655)],this.SCALING(),3),game.utility.scaledPolygonBody([new physics.dynamics.Vector(0,290),new physics.dynamics.Vector(0,401),new physics.dynamics.Vector(19.45,458.91),new physics.dynamics.Vector(45,470),new physics.dynamics.Vector(23,290)],this.SCALING(),1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(45,516),new physics.dynamics.Vector(45,470),new physics.dynamics.Vector(976,470),new physics.dynamics.Vector(976,516)],this.SCALING(),2),game.utility.scaledPolygonBody([new physics.dynamics.Vector(925,
345),new physics.dynamics.Vector(1049,0),new physics.dynamics.Vector(1127,0),new physics.dynamics.Vector(925,568)],this.SCALING(),3),game.utility.scaledPolygonBody([new physics.dynamics.Vector(1612.25,494.5),new physics.dynamics.Vector(1576.82,123.82),new physics.dynamics.Vector(1506.5,29.5),new physics.dynamics.Vector(1080.67,32),new physics.dynamics.Vector(925,568),new physics.dynamics.Vector(1603.88,568)],this.SCALING(),5)])},newFrontWheel:function(a){return vehicles.utility.Builder.newWheel(a,
172+this.CHAIN_WHEEL_MARGIN,this.SCALING(),2)},newBackWheel:function(a){return vehicles.utility.Builder.newWheel(a,150+this.CHAIN_WHEEL_MARGIN,this.SCALING(),2)},newSupportWheel:function(a){return vehicles.utility.Builder.newWheel(a,188+this.CHAIN_WHEEL_MARGIN,this.SCALING(),1)},newTopWheelCircle:function(a,b,c){a=a.center.subtract(b.center);const d=a.rotate90();return new physics.collisions.shapes.Circle(b.center.add(a.multiply(c.x).add(d.multiply(c.y)).divide(973)),(30+vehicles.trackedDumpTruck.CHAIN_WIDTH_TREAD/
2)*this.SCALING())},newChainCircle:function(a){return new physics.collisions.shapes.Circle(a.center,a.radius-vehicles.trackedDumpTruck.CHAIN_WIDTH/2*this.SCALING())},renderChain:function(a,b,c,d){a.context2d.beginPath();var e=0;const g=b.map(function(h,f){f=b[(f+1)%b.length];const l=f.center.subtract(h.center);return l.rotate(Math.acos((h.radius-f.radius)/l.length())).angle()});g.forEach(function(h,f){var l=(f+1)%g.length;const m=g[l],n=b[f];f=b[l];const p=physics.dynamics.Vector.fromRotation(h);
l=(c[l]?physics.utility.modSymmetric:physics.utility.modPositive)(h-m,physics.utility.PI_2);e+=n.center.add(p.multiply(n.radius-f.radius)).subtract(f.center).length();0<=l?(e+=Math.abs(l)*f.radius,a.context2d.arc(f.center.x,f.center.y,f.radius,h,m,!0)):(h=physics.dynamics.Vector.fromRotation(m+l/2),h=f.center.add(h.multiply(f.radius/Math.cos(l/2))),e+=2*Math.tan(l/2)*f.radius,a.context2d.lineTo(h.x,h.y))});const k=e/vehicles.trackedDumpTruck.CHAIN_SEGMENTS;a.context2d.closePath();a.context2d.strokeStyle=
"black";a.context2d.lineCap="butt";a.context2d.lineWidth=vehicles.trackedDumpTruck.CHAIN_WIDTH*this.SCALING();a.context2d.lineDashOffset=vehicles.trackedDumpTruck.CHAIN_SEGMENTS_PER_ROTATION*k*d;a.context2d.setLineDash([k/2,k/2]);a.context2d.stroke();a.context2d.lineWidth=vehicles.trackedDumpTruck.CHAIN_WIDTH_TREAD*this.SCALING();a.context2d.setLineDash([]);a.context2d.stroke()}},carWithTrailer:{build:function(a){const b=this.newCarChassis(),c=this.newTrailerChassis(),d=b[0].particle.motion.position.translation.negate(),
e=c[0].particle.motion.position.translation.negate(),g=this.newCarWheel(new physics.dynamics.Vector(916,296)),k=this.newCarWheel(new physics.dynamics.Vector(266,296)),h=this.newTrailerWheel(new physics.dynamics.Vector(259,141));a.addCollisions([b,c],[g,k,h],.8).addVerticalSpringBasic(b,g,this.SPRING_RANGE(),new physics.interaction.Elasticity(.033,.15)).addVerticalSpringBasic(b,k,this.SPRING_RANGE(),new physics.interaction.Elasticity(.019,.15)).addVerticalSpringBasic(c,h,this.SPRING_RANGE(),new physics.interaction.Elasticity(.031,
.15)).addJoint(new physics.interaction.Fixture(b[0].particle,d.add((new physics.dynamics.Vector(-21,244)).multiply(this.SCALING()))),new physics.interaction.Fixture(c[0].particle,e.add((new physics.dynamics.Vector(714,85)).multiply(this.SCALING()))),[c,h]).addAngle(b,c,-Math.PI/4,Math.PI/4).addMotor(b,g,3E5,13).addWheelFriction(b,k).addWheelFriction(c,h).addTaillights().addBackgroundBodyImage(resources.vehicles.carWithTrailer.trailer.chassis,e.add((new physics.dynamics.Vector(3,0)).multiply(this.SCALING())),
c).addForegroundGraphics([a.newBodyImage(resources.vehicles.carWithTrailer.car.chassis,d.add((new physics.dynamics.Vector(-27,188)).multiply(this.SCALING())),b),a.newWheelImage(resources.vehicles.carWithTrailer.car.wheel,g),a.newWheelImage(resources.vehicles.carWithTrailer.car.wheel,k),a.newBodyGraphics(a.bodyImageWithTaillights(resources.vehicles.carWithTrailer.car.body,d,resources.vehicles.carWithTrailer.car.taillight.off,resources.vehicles.carWithTrailer.car.taillight.on,d.add((new physics.dynamics.Vector(17,
213)).multiply(this.SCALING()))),b),a.newBodyGraphics(a.bodyImageWithTaillights(resources.vehicles.carWithTrailer.trailer.body,e,resources.vehicles.carWithTrailer.trailer.taillight.off,resources.vehicles.carWithTrailer.trailer.taillight.on,e.add((new physics.dynamics.Vector(-8,98)).multiply(this.SCALING()))),c),a.newWheelImage(resources.vehicles.carWithTrailer.trailer.wheel,h),a.newBodyImage(resources.vehicles.carWithTrailer.trailer.fender,e.add((new physics.dynamics.Vector(172,38)).multiply(this.SCALING())),
c)]).addEngineSound(b,[k],d.add((new physics.dynamics.Vector(915,196)).multiply(this.SCALING())),resources.vehicles.carWithTrailer.car.engine,.7,.04,.5).addCollisionSounds(resources.vehicles.carWithTrailer.collision).addBodies([b,g,k,c,h],0).addCameraScaling(1.45)},newCarChassis:function(){return physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(1.09,236.55),new physics.dynamics.Vector(7.64,274.55),new physics.dynamics.Vector(74.36,292.18),new physics.dynamics.Vector(1079,
292.12),new physics.dynamics.Vector(1138.12,272),new physics.dynamics.Vector(1147.55,253),new physics.dynamics.Vector(1147.55,238.18),new physics.dynamics.Vector(1108.5,209.75)],this.SCALING(),2),game.utility.scaledPolygonBody([new physics.dynamics.Vector(29.25,253),new physics.dynamics.Vector(13.06,199.5),new physics.dynamics.Vector(18.55,170.64),new physics.dynamics.Vector(50,143.45),new physics.dynamics.Vector(311.45,13.27),new physics.dynamics.Vector(408,1.5),new physics.dynamics.Vector(631.67,
1),new physics.dynamics.Vector(689.09,10.18),new physics.dynamics.Vector(711.09,23.64),new physics.dynamics.Vector(936,250)],this.SCALING(),3),game.utility.scaledPolygonBody([new physics.dynamics.Vector(756.67,250),new physics.dynamics.Vector(716.67,109.33),new physics.dynamics.Vector(968.33,134.33),new physics.dynamics.Vector(1104.55,166.18),new physics.dynamics.Vector(1123.64,185.27),new physics.dynamics.Vector(1136.25,253.25)],this.SCALING(),7)])},newTrailerChassis:function(){return physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(0,
0),new physics.dynamics.Vector(5,0),new physics.dynamics.Vector(5,124),new physics.dynamics.Vector(0,124)],this.SCALING(),1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(528,0),new physics.dynamics.Vector(533,0),new physics.dynamics.Vector(533,98),new physics.dynamics.Vector(528,92.57)],this.SCALING(),1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(5,88),new physics.dynamics.Vector(530.35,88),new physics.dynamics.Vector(533,98),new physics.dynamics.Vector(5,98)],this.SCALING(),
2)])},newCarWheel:function(a){return vehicles.utility.Builder.newWheel(a,154,this.SCALING(),2)},newTrailerWheel:function(a){return vehicles.utility.Builder.newWheel(a,146,this.SCALING(),2)}},pickup6x6:{build:function(a){const b=this.newChassis(),c=b[0].particle.motion.position.translation.negate(),d=this.newWheel(new physics.dynamics.Vector(1458,487)),e=this.newWheel(new physics.dynamics.Vector(495,487)),g=this.newWheel(new physics.dynamics.Vector(191,487));a.addCollisions([b],[d,e,g],.6).addVerticalSpringBasic(b,
d,this.SPRING_RANGE(),new physics.interaction.Elasticity(.017,.2)).addVerticalSpringSeesaw(b,[e,g],this.SPRING_RANGE(),new physics.interaction.Elasticity(.01,.15),.2,.8).addMotor(b,d,2E5,11).addMotor(b,e,2E5,11).addMotor(b,g,2E5,11).addAngleLink(d,e,1,1).addAngleLink(e,g,1,1).addTaillights().addBackgroundBodyImage(resources.vehicles.pickup6x6.chassis,c.add((new physics.dynamics.Vector(36,136)).multiply(this.SCALING())),b).addForegroundGraphics([a.newBodyGraphics(a.bodyImageWithTaillights(resources.vehicles.pickup6x6.body,
c,resources.vehicles.pickup6x6.taillight.off,resources.vehicles.pickup6x6.taillight.on,c.add((new physics.dynamics.Vector(31,195)).multiply(this.SCALING()))),b),a.newWheelImage(resources.vehicles.pickup6x6.wheel,d),a.newWheelImage(resources.vehicles.pickup6x6.wheel,e),a.newWheelImage(resources.vehicles.pickup6x6.wheel,g)]).addEngineSound(b,[d,e,g],c.add((new physics.dynamics.Vector(1456,283)).multiply(this.SCALING())),resources.vehicles.pickup6x6.engine,.4,.07,.5).addCollisionSounds(resources.vehicles.pickup6x6.collision).addBodies([b,
d,e,g],0).addCameraScaling(1.4)},newChassis:function(){return physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(47.5,148.25),new physics.dynamics.Vector(25.64,173.73),new physics.dynamics.Vector(27.25,294.25),new physics.dynamics.Vector(52.25,396.5)],this.SCALING(),1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(1653,319),new physics.dynamics.Vector(1335.67,453.67),new physics.dynamics.Vector(612.33,445.67),new physics.dynamics.Vector(51,394.33),
new physics.dynamics.Vector(39.67,298.67)],this.SCALING(),2),game.utility.scaledPolygonBody([new physics.dynamics.Vector(.55,332.45),new physics.dynamics.Vector(.5,377.88),new physics.dynamics.Vector(5.62,413.38),new physics.dynamics.Vector(69.73,449.55),new physics.dynamics.Vector(1096,343)],this.SCALING(),2),game.utility.scaledPolygonBody([new physics.dynamics.Vector(661,47.75),new physics.dynamics.Vector(670.45,19.91),new physics.dynamics.Vector(694,7.88),new physics.dynamics.Vector(859.36,6.45),
new physics.dynamics.Vector(1114.82,13.64),new physics.dynamics.Vector(1265.67,95.33),new physics.dynamics.Vector(1632,346),new physics.dynamics.Vector(649.5,377)],this.SCALING(),2),game.utility.scaledPolygonBody([new physics.dynamics.Vector(1362.18,153.09),new physics.dynamics.Vector(1537.55,164.27),new physics.dynamics.Vector(1647.25,187.12),new physics.dynamics.Vector(1671.38,209.38),new physics.dynamics.Vector(1684.09,326.09),new physics.dynamics.Vector(1682.36,385.82),new physics.dynamics.Vector(1671.09,
401.27),new physics.dynamics.Vector(1571,449.25),new physics.dynamics.Vector(1293,409)],this.SCALING(),4)])},newWheel:function(a){return vehicles.utility.Builder.newWheel(a,268,this.SCALING(),2)}},baggageTractor:{build:function(a){const b=this.newTractorChassis(),c=this.newTrailerChassis(),d=this.newTrailerChassis(),e=b[0].particle.motion.position.translation.negate(),g=c[0].particle.motion.position.translation.negate(),k=this.newTractorFrontWheel(new physics.dynamics.Vector(673,563)),h=this.newTractorBackWheel(new physics.dynamics.Vector(168,
546)),f=this.newTrailerWheel(this.TRAILER_FRONT_WHEEL_ORIGIN),l=this.newTrailerWheel(this.TRAILER_BACK_WHEEL_ORIGIN),m=this.newTrailerWheel(this.TRAILER_FRONT_WHEEL_ORIGIN),n=this.newTrailerWheel(this.TRAILER_BACK_WHEEL_ORIGIN),p=new physics.interaction.Fixture(b[0].particle,e.add(this.TRACTOR_JOINT_ORIGIN())),t=new physics.interaction.Fixture(c[0].particle,g.add(this.TRAILER_FRONT_JOINT_ORIGIN())),r=new physics.interaction.Fixture(c[0].particle,g.add(this.TRAILER_BACK_JOINT_ORIGIN())),q=new physics.interaction.Fixture(d[0].particle,
g.add(this.TRAILER_FRONT_JOINT_ORIGIN()));a.addCollisions([b,c,d],[k,h,f,l,m,n],.8).addVerticalSpringBasic(b,k,this.SPRING_RANGE(),new physics.interaction.Elasticity(.036,.15)).addVerticalSpringBasic(b,h,this.SPRING_RANGE(),new physics.interaction.Elasticity(.023,.15)).addVerticalSpringBasic(c,f,this.SPRING_RANGE(),new physics.interaction.Elasticity(.028,.15)).addVerticalSpringBasic(c,l,this.SPRING_RANGE(),new physics.interaction.Elasticity(.03,.15)).addVerticalSpringBasic(d,m,this.SPRING_RANGE(),
new physics.interaction.Elasticity(.028,.15)).addVerticalSpringBasic(d,n,this.SPRING_RANGE(),new physics.interaction.Elasticity(.03,.15)).addAlignDistanceJoint([d,m,n],[c,f,l],q,r,this.JOINT_DISTANCE(),Math.PI/4,Math.PI/4).addAlignDistanceJoint([c,f,l],[b,k,h],t,p,this.JOINT_DISTANCE(),Math.PI/4,Math.PI/4).addMotor(b,k,2E5,8).addMotor(b,h,2E5,8).addWheelFriction(c,f).addWheelFriction(c,l).addWheelFriction(d,m).addWheelFriction(d,n).addForegroundGraphics([a.newJointImage(resources.vehicles.baggageTractor.trailer.drawbar,
t,p),a.newBodyImage(resources.vehicles.baggageTractor.trailer.chassis,g.add(this.TRAILER_GRAPHIC_ORIGIN()),c),a.newJointImage(resources.vehicles.baggageTractor.trailer.drawbar,q,r),a.newBodyImage(resources.vehicles.baggageTractor.trailer.chassis,g.add(this.TRAILER_GRAPHIC_ORIGIN()),d),a.newBodyImage(resources.vehicles.baggageTractor.tractor.chassis,e.add((new physics.dynamics.Vector(40,406)).multiply(this.SCALING())),b),a.newWheelImage(resources.vehicles.baggageTractor.tractor.wheels.front,k),a.newWheelImage(resources.vehicles.baggageTractor.tractor.wheels.back,
h),a.newWheelImage(resources.vehicles.baggageTractor.trailer.wheel,f),a.newWheelImage(resources.vehicles.baggageTractor.trailer.wheel,l),a.newWheelImage(resources.vehicles.baggageTractor.trailer.wheel,m),a.newWheelImage(resources.vehicles.baggageTractor.trailer.wheel,n),a.newBodyImage(resources.vehicles.baggageTractor.tractor.body,e,b),a.newBodyImage(resources.vehicles.baggageTractor.trailer.body,g,c),a.newBodyImage(resources.vehicles.baggageTractor.trailer.body,g,d)]).addEngineSound(b,[k,h],e.add((new physics.dynamics.Vector(429,
517)).multiply(this.SCALING())),resources.vehicles.baggageTractor.engine,0,.1,.5).addCollisionSounds(resources.vehicles.baggageTractor.collision).addBodies([b,k,h,c,f,l,d,m,n],3).addCameraScaling(2)},newTractorChassis:function(){return physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(954.67,546),new physics.dynamics.Vector(550.37,261.88),new physics.dynamics.Vector(51.7,270.91),new physics.dynamics.Vector(2.18,481.36),new physics.dynamics.Vector(.57,566.52),
new physics.dynamics.Vector(27.82,578.27),new physics.dynamics.Vector(305.45,592.45),new physics.dynamics.Vector(551.87,594.52),new physics.dynamics.Vector(812.25,590.75)],this.SCALING(),9),game.utility.scaledPolygonBody([new physics.dynamics.Vector(552.56,36.94),new physics.dynamics.Vector(545,563),new physics.dynamics.Vector(812.38,590.75),new physics.dynamics.Vector(981.33,571.67),new physics.dynamics.Vector(995.35,490.04),new physics.dynamics.Vector(998.81,389.5),new physics.dynamics.Vector(978.03,
279.66),new physics.dynamics.Vector(893.75,96.5),new physics.dynamics.Vector(859.5,53.75),new physics.dynamics.Vector(829.52,41.61)],this.SCALING(),4)])},newTrailerChassis:function(){return physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(0,0),new physics.dynamics.Vector(19,0),new physics.dynamics.Vector(19,316.62),new physics.dynamics.Vector(0,304.38)],this.SCALING(),1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(1037,0),new physics.dynamics.Vector(1056,
0),new physics.dynamics.Vector(1056,302.75),new physics.dynamics.Vector(1037,315.38)],this.SCALING(),1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(7,292),new physics.dynamics.Vector(0,304.25),new physics.dynamics.Vector(0,322),new physics.dynamics.Vector(1056,322),new physics.dynamics.Vector(1056,302.62),new physics.dynamics.Vector(1050.73,292)],this.SCALING(),2),game.utility.scaledPolygonBody([new physics.dynamics.Vector(172,322),new physics.dynamics.Vector(252,408),new physics.dynamics.Vector(332,
322)],this.SCALING(),1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(813,322),new physics.dynamics.Vector(813,354),new physics.dynamics.Vector(869,408),new physics.dynamics.Vector(958,322)],this.SCALING(),1)])},newTractorFrontWheel:function(a){return vehicles.utility.Builder.newWheel(a,186,this.SCALING(),2)},newTractorBackWheel:function(a){return vehicles.utility.Builder.newWheel(a,220,this.SCALING(),2)},newTrailerWheel:function(a){return vehicles.utility.Builder.newWheel(a,150,this.SCALING(),
1)}}};vehicles.utility.Setup.prototype.tuneExponential=function(a,b,c){return Math.pow(a,1-c*b)};vehicles.utility.Setup.prototype.tuneLinear=function(a,b,c){return a*Math.pow(c,b)};vehicles.utility.Setup.prototype.tuneSpeed=function(a){return this.tuneLinear(a,this.speed,4)};vehicles.utility.Setup.prototype.tuneAcceleration=function(a){return this.tuneLinear(a,this.acceleration,8)};vehicles.utility.Setup.prototype.tuneTraction=function(a){return this.tuneLinear(a,this.traction,4)};
vehicles.utility.Setup.prototype.tuneElasticity=function(a){return new physics.interaction.Elasticity(this.tuneExponential(a.stiffness,this.stiffness,.5),this.tuneExponential(a.damping,this.damping,.5))};vehicles.utility.Setup.prototype.tuneHeight=function(a){return Math.max(a.interpolate(this.height),0)};vehicles.utility.Builder.JOINT_ELASTICITY=function(){return physics.interaction.handlers.elasticity(game.Engine.STIFF_ELASTICITY)};
vehicles.utility.Builder.WHEEL_FRICTIONAL=new physics.interaction.Frictional(new physics.interaction.Elasticity(0,.5),2500);vehicles.utility.Builder.ENGINE_SOUND_FADE_DURATION=.1;vehicles.utility.Builder.ENGINE_SOUND_MOTOR_MULTIPLIER=2;vehicles.utility.Builder.REPEATING_SOUND_DELAY=3;vehicles.utility.Builder.newWheel=function(a,b,c,d){return[physics.collisions.Body.uniform(physics.dynamics.Particle.fromMass(d),new physics.collisions.shapes.Circle(a.multiply(c),b/2*c,game.Engine.SINGULARITY),1)]};
vehicles.utility.Builder.wheelVelocity=function(a,b){return a[0].particle.motion.velocity.rotation-b.map(function(c){return c[0].particle.motion.velocity.rotation}).reduce(physics.utility.add,0)/b.length};
vehicles.utility.Builder.prototype.addCollisions=function(a,b,c){const d=new physics.collections.Bundle;this.bundle.addAll(this.matchers.view.collisions,[].concat(physics.utility.flatten(a).map(function(e){return new physics.collisions.Collider(e,this.matchers.chassis)}.bind(this)),physics.utility.flatten(b).map(function(e){return new physics.collisions.Collider(e,this.matchers.wheel)}.bind(this)))).addBundle(d);this.addUpdater(function(){d.release();d.add(this.matchers.frictionMultipliers,this.setup.tuneTraction(c))});
return this};
vehicles.utility.Builder.prototype.addVerticalSpring=function(a,b,c){const d=new physics.collections.Ordered,e=this.setup.tuneHeight(c);b[0].particle.move(physics.dynamics.Motion.fromPosition(physics.dynamics.Transformation.fromTranslation(new physics.dynamics.Vector(0,e-c.min))));this.bundle.addAll(this.matchers.view.engine.actors,[physics.actors.projection(physics.interaction.Rail.absolute(a[0].particle,physics.interaction.Axis.throughY(b[0].particle.motion.position.translation.y-e)),physics.interaction.Fixture.centroid(b[0].particle),
physics.interaction.handlers.merge(d)),physics.actors.projection(physics.interaction.Rail.absolute(a[0].particle,physics.interaction.Axis.throughX(b[0].particle.motion.position.translation.x)),physics.interaction.Fixture.centroid(b[0].particle),vehicles.utility.Builder.JOINT_ELASTICITY())]);return d};
vehicles.utility.Builder.prototype.addVerticalSpringBasic=function(a,b,c,d){const e=this.addVerticalSpring(a,b,c),g=new physics.collections.Bundle;this.addUpdater(function(){g.release();g.addAll(e,[physics.interaction.handlers.center(physics.interaction.handlers.mergeArray([physics.interaction.handlers.elasticity(this.setup.tuneElasticity(d)),physics.interaction.handlers.upper(vehicles.utility.Builder.JOINT_ELASTICITY(),0)]),this.setup.tuneHeight(c)),physics.interaction.handlers.lower(vehicles.utility.Builder.JOINT_ELASTICITY(),
0)])});return this};
vehicles.utility.Builder.prototype.addVerticalSpringSeesaw=function(a,b,c,d,e,g){const k=new physics.collections.Bundle,h=b.map(function(f){return this.addVerticalSpring(a,f,c)}.bind(this));this.addUpdater(function(){const f=this.setup.tuneHeight(c);k.release();physics.interaction.handlers.correlate(b.map(function(l){return physics.interaction.handlers.elasticity(this.setup.tuneElasticity(d))}.bind(this)),b.map(function(l,m){return b.map(function(n,p){return g/b.length+(m==p?1-g:0)})})).forEach(function(l,
m){k.addAll(h[m],[physics.interaction.handlers.center(l,f),physics.interaction.handlers.lower(vehicles.utility.Builder.JOINT_ELASTICITY(),0),physics.interaction.handlers.center(physics.interaction.handlers.upper(vehicles.utility.Builder.JOINT_ELASTICITY(),0),(1+e)*f)])})});return this};
vehicles.utility.Builder.prototype.addWheelJoint=function(a,b){return this.addJoint(physics.interaction.Fixture.absolute(a[0].particle,b[0].particle.motion.position.translation),physics.interaction.Fixture.centroid(b[0].particle),[])};vehicles.utility.Builder.prototype.addJoint=function(a,b,c){this.bundle.add(this.matchers.view.engine.actors,physics.actors.projection2(a,b,vehicles.utility.Builder.JOINT_ELASTICITY()));this.moveBodies(c,a.transformOrigin().subtract(b.transformOrigin()));return this};
vehicles.utility.Builder.prototype.addDistanceJoint=function(a,b,c){this.bundle.add(this.matchers.view.engine.actors,physics.actors.distance(a,b,physics.interaction.handlers.center(vehicles.utility.Builder.JOINT_ELASTICITY(),c),game.Engine.SINGULARITY));return this};
vehicles.utility.Builder.prototype.addAlignDistanceJoint=function(a,b,c,d,e,g,k){a=physics.collisions.Body.bounds(physics.utility.flatten(a));const h=physics.collisions.Body.bounds(physics.utility.flatten(b)),f=c.transformOrigin(),l=d.transformOrigin();return this.moveBodies(b,new physics.dynamics.Vector(f.x-l.x+Math.sqrt(Math.pow(e,2)-Math.pow(f.y-a.max.y-(l.y-h.max.y),2)),a.max.y-h.max.y)).addDistanceJoint(c,d,e).addFixtureAngleLower(c,d,Math.PI-g).addFixtureAngleUpper(c,d,Math.PI+g).addFixtureAngleLower(d,
c,-k).addFixtureAngleUpper(d,c,k)};
vehicles.utility.Builder.prototype.addAngle=function(a,b,c,d){this.bundle.add(this.matchers.view.engine.actors,physics.actors.angle(a[0].particle,b[0].particle,1,1,physics.interaction.handlers.angular(physics.interaction.handlers.mergeArray([physics.interaction.handlers.center(physics.interaction.handlers.lower(vehicles.utility.Builder.JOINT_ELASTICITY(),0),c),physics.interaction.handlers.center(physics.interaction.handlers.upper(vehicles.utility.Builder.JOINT_ELASTICITY(),0),d)]))));return this};
vehicles.utility.Builder.prototype.addAngleLinkParticles=function(a,b,c,d){this.bundle.add(this.matchers.view.engine.actors,physics.actors.angle(a,b,c,d,physics.interaction.handlers.angular(vehicles.utility.Builder.JOINT_ELASTICITY())));return this};vehicles.utility.Builder.prototype.addAngleLink=function(a,b,c,d){return this.addAngleLinkParticles(a[0].particle,b[0].particle,c,d)};
vehicles.utility.Builder.prototype.addFixtureAngleLower=function(a,b,c){this.bundle.add(this.matchers.view.engine.actors,physics.actors.projection(a.rail(physics.dynamics.Vector.Y_UNIT.rotate(-c)),b,physics.interaction.handlers.lower(vehicles.utility.Builder.JOINT_ELASTICITY(),0)));return this};
vehicles.utility.Builder.prototype.addFixtureAngleUpper=function(a,b,c){this.bundle.add(this.matchers.view.engine.actors,physics.actors.projection(a.rail(physics.dynamics.Vector.Y_UNIT.rotate(-c)),b,physics.interaction.handlers.upper(vehicles.utility.Builder.JOINT_ELASTICITY(),0)));return this};
vehicles.utility.Builder.prototype.addMotor=function(a,b,c,d){const e=new physics.collections.Bundle;this.bundle.addBundle(e);this.addUpdater(function(){e.release();e.add(this.matchers.view.engine.actors,this.motor.actor(b[0].particle,a[0].particle,this.setup.tuneAcceleration(c),this.setup.tuneSpeed(d)))});return this};
vehicles.utility.Builder.prototype.addWheelFriction=function(a,b){this.bundle.add(this.matchers.view.engine.actors,physics.actors.angle(b[0].particle,a[0].particle,1,1,physics.interaction.handlers.friction(vehicles.utility.Builder.WHEEL_FRICTIONAL)));return this};vehicles.utility.Builder.prototype.newHeightGraphic=function(a,b){const c=new physics.collections.Ordered,d=new physics.collections.Bundle;this.addUpdater(function(){d.release();d.add(c,b(this.setup.tuneHeight(a)-a.min))});return physics.rendering.graphics.Container.variable(c)};
vehicles.utility.Builder.prototype.newBodyGraphic=function(a,b){return physics.rendering.graphics.Transformator.identity(this.matchers.view.engine.rendering,a,b[0].particle)};vehicles.utility.Builder.prototype.newBodyGraphics=function(a,b){return this.newBodyGraphic(physics.rendering.graphics.Container.fixed(a),b)};vehicles.utility.Builder.prototype.newBodyImage=function(a,b,c){return this.newBodyGraphic(this.newImage(a,b),c)};
vehicles.utility.Builder.prototype.newImage=function(a,b){return physics.rendering.graphics.Image.fromOrigin(this.matchers.view.engine.rendering,a(),b)};vehicles.utility.Builder.prototype.newCenteredImage=function(a){return this.newImage(a,physics.dynamics.Vector.ZERO).addRelative(physics.rendering.graphics.Image.CENTER)};vehicles.utility.Builder.prototype.newTransformator=function(a,b,c){return new physics.rendering.graphics.Transformator(this.matchers.view.engine.rendering,a,b,c)};
vehicles.utility.Builder.prototype.newBiTransformator=function(a,b,c,d){return new physics.rendering.graphics.BiTransformator(this.matchers.view.engine.rendering,a,b,c,d)};vehicles.utility.Builder.prototype.newJointImage=function(a,b,c){return this.newBiTransformator(this.newCenteredImage(a),b,c,.5)};vehicles.utility.Builder.prototype.newWheelImage=function(a,b){return this.newBodyGraphic(this.newCenteredImage(a),b)};
vehicles.utility.Builder.prototype.newGraphicCallable=function(a){return{render:a.bind(null,this.matchers.view.engine.rendering)}};vehicles.utility.Builder.prototype.addGraphic=function(a,b){this.bundle.add(this.matchers.view.graphics.collector,new physics.rendering.perspective.View(a,b));return this};vehicles.utility.Builder.prototype.addBackgroundBodyImage=function(a,b,c){return this.addGraphic(this.newBodyImage(a,b,c),game.graphics.depths.VEHICLE.BACKGROUND)};
vehicles.utility.Builder.prototype.addForegroundGraphics=function(a){return this.addGraphic(physics.rendering.graphics.Container.fixed(a),game.graphics.depths.VEHICLE.FOREGROUND)};vehicles.utility.Builder.prototype.addTaillights=function(){this.taillight=new physics.actors.Toggle;this.bundle.add(this.matchers.view.engine.actors,this.taillight.unlockActor(function(a){this.taillight.reset(-.5>this.motor.target);return[]}.bind(this)));return this};
vehicles.utility.Builder.prototype.bodyImageWithTaillights=function(a,b,c,d,e){return[this.newImage(a,b),new physics.rendering.graphics.Toggled(this.matchers.view.engine.rendering,this.taillight,this.newImage(d,e),this.newImage(c,e))]};vehicles.utility.Builder.prototype.audioContext=function(){return this.matchers.view.engine.avContext.audio};
vehicles.utility.Builder.prototype.addEngineSound=function(a,b,c,d,e,g,k){const h=new GainNode(this.audioContext(),{gain:0});physics.utility.fadeAudio(h,vehicles.utility.Builder.ENGINE_SOUND_FADE_DURATION,1);const f=new AudioBufferSourceNode(this.audioContext(),{buffer:d(),playbackRate:0});f.loop=!0;f.connect(h);c=physics.actors.spatialAudio(this.audioContext(),this.matchers.view.camera,new physics.interaction.Fixture(a[0].particle,c),game.View.NORMAL_DISTANCE*k);h.connect(c.input);c.output.connect(this.audioContext().destination);
this.bundle.addCustom(function(){f.onended=function(){h.disconnect()};f.stop(physics.utility.fadeAudio(h,vehicles.utility.Builder.ENGINE_SOUND_FADE_DURATION,0))}.bind(this)).addAll(this.matchers.view.engine.actors,[function(l){f.playbackRate.linearRampToValueAtTime(e+g*(Math.abs(vehicles.utility.Builder.wheelVelocity(a,b))+vehicles.utility.Builder.ENGINE_SOUND_MOTOR_MULTIPLIER*Math.abs(this.motor.target)),this.audioContext().currentTime+l);return[]}.bind(this),c.actor]);f.start();return this};
vehicles.utility.Builder.prototype.addRepeatingSound=function(a,b,c,d,e,g){function k(){0==--l&&m.output.disconnect()}var h=0,f=-e/2,l=1;const m=physics.actors.spatialAudio(this.audioContext(),this.matchers.view.camera,new physics.interaction.Fixture(a[0].particle,c),game.View.NORMAL_DISTANCE*g);m.output.connect(this.audioContext().destination);this.bundle.addAll(this.matchers.view.engine.actors,[function(n){const p=this.audioContext().currentTime,t=Math.max(h+vehicles.utility.Builder.REPEATING_SOUND_DELAY*
n,p);n=Math.min(p-h,vehicles.utility.Builder.REPEATING_SOUND_DELAY*n);const r=n*Math.abs(vehicles.utility.Builder.wheelVelocity(a,b));for(;0<=f+r;){const q=new AudioBufferSourceNode(this.audioContext(),{buffer:d()});q.onended=function(){q.disconnect();k()};q.connect(m.input);q.start(t-f/r*n);l++;f-=e}f+=r;h=p;return[]}.bind(this),m.actor]).addCustom(k);return this};
vehicles.utility.Builder.prototype.addCollisionSounds=function(a){this.bundle.add(this.matchers.chassisEnvironmentHandlers,this.matchers.view.audioHandler(a.environment));this.bundle.add(this.matchers.chassisObstacleHandlers,this.matchers.view.audioHandler(a.object));this.bundle.add(this.matchers.chassisCargoHandlers,this.matchers.view.audioHandler(a.object));this.bundle.add(this.matchers.wheelEnvironmentHandlers,this.matchers.view.audioHandler(a.wheel));this.bundle.add(this.matchers.wheelObstacleHandlers,
this.matchers.view.audioHandler(a.wheel));return this};vehicles.utility.Builder.prototype.addBodies=function(a,b){var c=physics.utility.flatten(a);const d=physics.utility.distinct(c.map(function(e){return e.particle}));c=physics.collisions.Body.bounds(c);a=physics.interaction.Fixture.absolute(a[b][0].particle,c.interpolate(new physics.dynamics.Vector(.5,.5)));return this.addGravityParticles(d).alignParticles(c,d).follow(a)};
vehicles.utility.Builder.prototype.addParticle=function(a){this.bundle.add(this.matchers.view.engine.particles,a);return this};vehicles.utility.Builder.prototype.addGravityParticles=function(a){a.forEach(function(b){this.bundle.addBundle(this.matchers.view.addDefaultGravityParticle(b))}.bind(this));return this};
vehicles.utility.Builder.prototype.moveBodies=function(a,b){a.forEach(function(c){c[0].particle.move(physics.dynamics.Motion.fromPosition(physics.dynamics.Transformation.fromTranslation(b)))});return this};vehicles.utility.Builder.prototype.alignParticles=function(a,b){const c=physics.dynamics.Motion.fromPosition(physics.dynamics.Transformation.fromTranslation(this.locator.origin().subtract(a.interpolate(new physics.dynamics.Vector(.5,1)))));b.forEach(function(d){d.move(c)});return this};
vehicles.utility.Builder.prototype.follow=function(a){this.bundle.addBundle(this.locator.follow(a));return this};vehicles.utility.Builder.prototype.addCameraScaling=function(a){this.bundle.add(this.matchers.view.scalings,a);return this};vehicles.utility.Builder.prototype.addUpdater=function(a){this.updaters.push(a);a.call(this)};vehicles.utility.Builder.prototype.update=function(){this.updaters.forEach(function(a){a.call(this)}.bind(this))};
vehicles.utility.Builder.prototype.release=function(){this.bundle.release();this.updaters=[]};vehicles.cargoBike.COST=5E3;vehicles.cargoBike.TUNING_COST_OFFSET=0;vehicles.cargoBike.PROPERTY_PATH=["cargo","bike"];vehicles.cargoBike.SCALING=function(){return game.View.PX_PER_M/934.31};vehicles.cargoBike.BODY_THIGH_ORIGIN=function(){return(new physics.dynamics.Vector(517,-16)).multiply(vehicles.cargoBike.SCALING())};vehicles.cargoBike.CRANK_OFFSET=function(){return(new physics.dynamics.Vector(722,615)).multiply(vehicles.cargoBike.SCALING())};
vehicles.cargoBike.CRANK_ORIGIN=function(){return(new physics.dynamics.Vector(15,15)).multiply(vehicles.cargoBike.SCALING())};vehicles.cargoBike.CRANK_LENGTH=function(){return 150*vehicles.cargoBike.SCALING()};vehicles.cargoBike.THIGH_TOP_ORIGIN=function(){return(new physics.dynamics.Vector(98,97)).multiply(vehicles.cargoBike.SCALING())};vehicles.cargoBike.THIGH_BOTTOM_ORIGIN=function(){return(new physics.dynamics.Vector(247,440)).multiply(vehicles.cargoBike.SCALING())};
vehicles.cargoBike.THIGH_VECTOR=function(){return vehicles.cargoBike.THIGH_BOTTOM_ORIGIN().subtract(vehicles.cargoBike.THIGH_TOP_ORIGIN())};vehicles.cargoBike.THIGH_LENGTH_2=function(){return vehicles.cargoBike.THIGH_VECTOR().square()};vehicles.cargoBike.THIGH_LENGTH=function(){return Math.sqrt(vehicles.cargoBike.THIGH_LENGTH_2())};vehicles.cargoBike.THIGH_ANGLE=function(){return vehicles.cargoBike.THIGH_VECTOR().angle()};
vehicles.cargoBike.SHANK_TOP_ORIGIN=function(){return(new physics.dynamics.Vector(130,64)).multiply(vehicles.cargoBike.SCALING())};vehicles.cargoBike.SHANK_BOTTOM_ORIGIN=function(){return(new physics.dynamics.Vector(186,523)).multiply(vehicles.cargoBike.SCALING())};vehicles.cargoBike.SHANK_VECTOR=function(){return vehicles.cargoBike.SHANK_TOP_ORIGIN().subtract(vehicles.cargoBike.SHANK_BOTTOM_ORIGIN())};vehicles.cargoBike.SHANK_LENGTH_2=function(){return vehicles.cargoBike.SHANK_VECTOR().square()};
vehicles.cargoBike.SHANK_LENGTH=function(){return Math.sqrt(vehicles.cargoBike.SHANK_LENGTH_2())};vehicles.cargoBike.SHANK_ANGLE=function(){return vehicles.cargoBike.SHANK_VECTOR().angle()};vehicles.vintagePickup.COST=7500;vehicles.vintagePickup.TUNING_COST_OFFSET=1;vehicles.vintagePickup.PROPERTY_PATH=["vintage","pickup"];vehicles.vintagePickup.SCALING=function(){return game.View.PX_PER_M/263.62};vehicles.vintagePickup.SPRING_RANGE=function(){return(new game.utility.Range(40,80)).multiply(vehicles.vintagePickup.SCALING())};
vehicles.flatbedSemiTruck.COST=7E4;vehicles.flatbedSemiTruck.TUNING_COST_OFFSET=4;vehicles.flatbedSemiTruck.PROPERTY_PATH=["flatbed","semi","truck"];vehicles.flatbedSemiTruck.SCALING=function(){return game.View.PX_PER_M/264.64};vehicles.flatbedSemiTruck.FRONT_SPRING_RANGE=function(){return(new game.utility.Range(50,75)).multiply(vehicles.flatbedSemiTruck.SCALING())};vehicles.flatbedSemiTruck.BACK_SPRING_RANGE=function(){return(new game.utility.Range(25,50)).multiply(vehicles.flatbedSemiTruck.SCALING())};
vehicles.agriculturalTractor.COST=5E4;vehicles.agriculturalTractor.TUNING_COST_OFFSET=3;vehicles.agriculturalTractor.PROPERTY_PATH=["agricultural","tractor"];vehicles.agriculturalTractor.SCALING=function(){return game.View.PX_PER_M/267.02};vehicles.agriculturalTractor.TRAILER_SPRING_RANGE=function(){return(new game.utility.Range(30,55)).multiply(vehicles.agriculturalTractor.SCALING())};vehicles.trackedDumpTruck.COST=12E4;vehicles.trackedDumpTruck.TUNING_COST_OFFSET=4;
vehicles.trackedDumpTruck.PROPERTY_PATH=["tracked","dump","truck"];vehicles.trackedDumpTruck.SCALING=function(){return game.View.PX_PER_M/255.96};vehicles.trackedDumpTruck.MAIN_SPRING_RANGE=function(){return(new game.utility.Range(15,25)).multiply(vehicles.trackedDumpTruck.SCALING())};vehicles.trackedDumpTruck.SUPPORT_ORIGINS=[new physics.dynamics.Vector(475,695),new physics.dynamics.Vector(683,695),new physics.dynamics.Vector(891,695),new physics.dynamics.Vector(1099,695)];
vehicles.trackedDumpTruck.SUPPORT_FRONT_OFFSET=new physics.dynamics.Vector(48,0);vehicles.trackedDumpTruck.SUPPORT_BACK_OFFSET=new physics.dynamics.Vector(-48,0);vehicles.trackedDumpTruck.CHAIN_WIDTH=32;vehicles.trackedDumpTruck.CHAIN_WIDTH_TREAD=16;vehicles.trackedDumpTruck.CHAIN_WHEEL_MARGIN=vehicles.trackedDumpTruck.CHAIN_WIDTH+vehicles.trackedDumpTruck.CHAIN_WIDTH_TREAD;vehicles.trackedDumpTruck.CHAIN_SEGMENTS=64;vehicles.trackedDumpTruck.CHAIN_SEGMENTS_PER_ROTATION=16;
vehicles.carWithTrailer.COST=1E4;vehicles.carWithTrailer.TUNING_COST_OFFSET=2;vehicles.carWithTrailer.PROPERTY_PATH=["car","with","trailer"];vehicles.carWithTrailer.SCALING=function(){return game.View.PX_PER_M/252.53};vehicles.carWithTrailer.SPRING_RANGE=function(){return(new game.utility.Range(25,50)).multiply(vehicles.carWithTrailer.SCALING())};vehicles.pickup6x6.COST=4E4;vehicles.pickup6x6.TUNING_COST_OFFSET=3;vehicles.pickup6x6.PROPERTY_PATH=["pickup","6x6"];
vehicles.pickup6x6.SCALING=function(){return game.View.PX_PER_M/286.44};vehicles.pickup6x6.SPRING_RANGE=function(){return(new game.utility.Range(70,105)).multiply(vehicles.pickup6x6.SCALING())};vehicles.baggageTractor.COST=2E4;vehicles.baggageTractor.TUNING_COST_OFFSET=2;vehicles.baggageTractor.PROPERTY_PATH=["baggage","tractor"];vehicles.baggageTractor.SCALING=function(){return game.View.PX_PER_M/334.93};vehicles.baggageTractor.TRAILER_FRONT_WHEEL_ORIGIN=new physics.dynamics.Vector(869,408);
vehicles.baggageTractor.TRAILER_BACK_WHEEL_ORIGIN=new physics.dynamics.Vector(252,408);vehicles.baggageTractor.JOINT_DISTANCE=function(){return 319*vehicles.baggageTractor.SCALING()};vehicles.baggageTractor.TRACTOR_JOINT_ORIGIN=function(){return(new physics.dynamics.Vector(12,515)).multiply(vehicles.baggageTractor.SCALING())};vehicles.baggageTractor.TRAILER_FRONT_JOINT_ORIGIN=function(){return(new physics.dynamics.Vector(1156,342)).multiply(vehicles.baggageTractor.SCALING())};
vehicles.baggageTractor.TRAILER_BACK_JOINT_ORIGIN=function(){return(new physics.dynamics.Vector(-26,329)).multiply(vehicles.baggageTractor.SCALING())};vehicles.baggageTractor.TRAILER_GRAPHIC_ORIGIN=function(){return(new physics.dynamics.Vector(-37,309)).multiply(vehicles.baggageTractor.SCALING())};vehicles.baggageTractor.SPRING_RANGE=function(){return(new game.utility.Range(30,55)).multiply(vehicles.baggageTractor.SCALING())};
'use strict';const sceneries={utility:{Setup:function(){this.obstacles=this.alternation=this.downhill=this.uphill=this.distance=0},Builder:function(a,b,c,d){this.loader=a;this.obstacles=b;this.locator=c;this.setup=d;this.track=new sceneries.utility.Track;this.bundle=new physics.collections.Bundle},Track:function(){this.segments=[]},Segment:function(a,b,c){this.mapper=a;this.derivation=b;this.length=c},Sampling:function(a){this.samples=a}},grassland:{build:function(a){this.addTrack(a);this.addCargoes(a);
this.addObstacles(a);this.addGrass(a);this.addTree(a,this.TREE_OFFSET());this.addTree(a,-this.TREE_OFFSET());a.addTerrain(resources.sceneries.grassland.soil,"#090",.7).addLocatorOrigin(a.track.evaluateSingle(this.VEHICLE_OFFSET())).addLoadingAreas(this.BARN_OFFSET(),this.DOOR_RECTANGLE(),this.addBarn.bind(this)).addBackgroundGraphics([a.newBackgroundFiller("#95cef6"),a.generateClouds(240,10,2,.35,2,4,resources.sceneries.grassland.clouds,resources.sceneries.grassland.backgrounds[0])].concat(this.newBackgroundLayers(a))).addEmitter(new game.collisions.EmitterParams(resources.sceneries.grassland.emitter,
game.utility.Range.symmetric(physics.utility.PI_2),100,1,.6,.6,600,200,800,100,.75*game.View.GRAVITY,.1,.4,.6)).addCollisionSound(resources.sceneries.grassland.collision).addAmbience(resources.sceneries.grassland.ambience)},addTrack:function(a){a.track.addZero(this.TRACK_OFFSET());a.addWhileLengthLess(function(){a.addRandomDiffPolynomial2()}.bind(this));a.addRandomZeroPolynomial2();a.track.addZero(this.TRACK_OFFSET())},newBackgroundLayers:function(a){const b=a.addAnimationParticle(this.BIRDS_DURATION);
return physics.utility.flatten(resources.sceneries.grassland.backgrounds.map(function(c,d){return[a.newParallaxRepeatedImageX(c,this.BACKGROUND_MULTIPLIER*(d+.5)),this.newBirdsLayer(a,b,resources.sceneries.grassland.birds[d],this.BIRDS_PARALLAX_SIZE.multiplyVector(new physics.dynamics.Vector(.5*d+1,1)),.25*d+1,this.BACKGROUND_MULTIPLIER*(d+1))]}.bind(this)))},newBirdsLayer:function(a,b,c,d,e,f){return a.newParallaxBackground(new game.graphics.RepeatedGraphic(a.rendering(),physics.rendering.graphics.Container.fixed(game.utility.arrayOfSize(5).map(this.newBird.bind(this,
a,b,c,d,e))),d),d,new physics.dynamics.Vector(f,0))},newBird:function(a,b,c,d,e){return new physics.rendering.graphics.Transformator(a.rendering(),physics.rendering.graphics.Image.fromOrigin(a.rendering(),c(),physics.dynamics.Vector.ZERO).addRelative(physics.rendering.graphics.Image.CENTER),b,function(f,g,h,k){return physics.dynamics.Transformation.fromTranslation(d.multiplyVector(new physics.dynamics.Vector(physics.utility.modPositive(h*k.rotation/physics.utility.PI_2+f,1),g)))}.bind(this,Math.random(),
e*this.BIRDS_HEIGHT_RANGE().random(),(2*game.utility.randomInt(2)-1)*(4+game.utility.randomInt(3))))},newGrass:function(a,b,c){return new physics.rendering.graphics.Offset(a.rendering(),new physics.rendering.graphics.Rotator(a.rendering(),game.utility.randomFromArray(this.GRASS_IMAGES)(a),b,physics.rendering.mappers.waveUnit(.2,game.utility.Range.PI_2.random())),c)},addGrass:function(a){const b=a.track.length();a.track.evaluateMultiple(game.utility.arrayOfSize(Math.ceil(b/400)).map(function(){return b*
Math.random()})).forEach(function(c,d){a.addGraphic(new physics.rendering.perspective.View(this.newGrass(a,c,d),game.graphics.depths.SCENERY.PLANTING))}.bind(this,a.addAnimationParticle(this.GRASS_DURATION)))},addTree:function(a,b){b=a.track.evaluateSingle(b);const c=a.addAnimationParticle(this.TREE_DURATION);a.addTrackLimit(b,160*this.TREE_SCALING);a.addGraphic(new physics.rendering.perspective.View(physics.rendering.graphics.Container.fixed([this.newTreeTop(a,b,c,0,.02),physics.rendering.graphics.Image.fromOrigin(a.rendering(),
resources.sceneries.grassland.tree.trunk(),b.subtract(this.TRUNK_ORIGIN)),this.newTreeTop(a,b,c,1,.03),this.newTreeTop(a,b,c,2,.04)]),game.graphics.depths.SCENERY.BOUND))},newTreeTop:function(a,b,c,d,e){return new physics.rendering.graphics.Offset(a.rendering(),new physics.rendering.graphics.Rotator(a.rendering(),physics.rendering.graphics.Image.fromOrigin(a.rendering(),resources.sceneries.grassland.tree.tops[d](),this.TREE_TOP_ORIGIN.subtract(this.TREE_TOP_OFFSETS[d])),c,physics.rendering.mappers.waveUnit(e,
game.utility.Range.PI_2.random())),b.subtract(this.TREE_TOP_ORIGIN))},addBarn:function(a,b){a.addGraphic(new physics.rendering.perspective.View(physics.rendering.graphics.Container.fixed([physics.rendering.graphics.Image.fromOrigin(a.rendering(),resources.sceneries.grassland.barn.background(),b).addRelative(new physics.dynamics.Vector(-.5,-1)),a.newParallaxImage(b,resources.sceneries.grassland.barn.haystacks[0],new physics.dynamics.Vector(20,0),game.utility.Range.rectangleX(this.DOOR_RECTANGLE()),
.1),a.newParallaxImage(b,resources.sceneries.grassland.barn.haystacks[1],new physics.dynamics.Vector(-160,0),game.utility.Range.rectangleX(this.DOOR_RECTANGLE()),.05),physics.rendering.graphics.Image.fromOrigin(a.rendering(),resources.sceneries.grassland.barn.foreground(),b).addRelative(new physics.dynamics.Vector(-.5,-1))]),game.graphics.depths.SCENERY.LOADING))},addCargoes:function(a){a.addCircularCargo(resources.sceneries.grassland.cargoes.hayBale,5,100).addRectangularCargo(resources.sceneries.grassland.cargoes.crate,
!0,3,50).addPolygonalCargo(resources.sceneries.grassland.cargoes.sack,[new physics.dynamics.Vector(4.52,28.29),new physics.dynamics.Vector(29.83,9.15),new physics.dynamics.Vector(52.01,.28),new physics.dynamics.Vector(155.04,1.01),new physics.dynamics.Vector(172.16,6.24),new physics.dynamics.Vector(194.98,28.33),new physics.dynamics.Vector(173.95,42.66),new physics.dynamics.Vector(150.86,49.91),new physics.dynamics.Vector(51.55,54.73),new physics.dynamics.Vector(23.27,46.74)],[0,Math.PI],Math.PI/
10,2,30)},addObstacles:function(a){a.addObstacleSpawner([a.newCircularObstacle(resources.sceneries.grassland.obstacles.trunk,6),{factory:function(b){const c=game.utility.scaledPolygonBody([new physics.dynamics.Vector(.67,38),new physics.dynamics.Vector(72.67,82.67),new physics.dynamics.Vector(190,59),new physics.dynamics.Vector(138.67,6),new physics.dynamics.Vector(78.33,0)],sceneries.grassland.ROCK_SCALING,7);c.particle.move(physics.dynamics.Motion.fromPosition(physics.dynamics.Transformation.fromRotation(Math.random()*
physics.utility.PI_2)));return game.collisions.Obstacles.singleBody(c,physics.rendering.graphics.Image.fromOrigin(b,resources.sceneries.grassland.obstacles.rock.image(),c.particle.motion.position.translation.negate()))},sound:resources.sceneries.grassland.obstacles.rock.sound},{factory:function(b){const c=physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(-.64,185.91),new physics.dynamics.Vector(4.09,225.73),new physics.dynamics.Vector(115,200.25),new physics.dynamics.Vector(312.5,
121.75)],sceneries.grassland.BRANCH_SCALING,1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(128,177.25),new physics.dynamics.Vector(195.25,82),new physics.dynamics.Vector(212,90.38),new physics.dynamics.Vector(177,160.82)],sceneries.grassland.BRANCH_SCALING,1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(373,134.57),new physics.dynamics.Vector(374.96,124.22),new physics.dynamics.Vector(318.75,104),new physics.dynamics.Vector(163,143.67)],sceneries.grassland.BRANCH_SCALING,
1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(426.31,78.44),new physics.dynamics.Vector(421.38,64.12),new physics.dynamics.Vector(343.12,69.12),new physics.dynamics.Vector(288.25,116.25)],sceneries.grassland.BRANCH_SCALING,1),game.utility.scaledPolygonBody([new physics.dynamics.Vector(186.44,200.88),new physics.dynamics.Vector(132.38,175.88),new physics.dynamics.Vector(88.88,189.12),new physics.dynamics.Vector(179.78,210.82)],sceneries.grassland.BRANCH_SCALING,1)]);c[0].particle.move(physics.dynamics.Motion.fromPosition(physics.dynamics.Transformation.fromRotation(game.utility.randomInt(2)*
Math.PI)));return game.collisions.Obstacles.singleGraphic(c,physics.rendering.graphics.Image.fromOrigin(b,resources.sceneries.grassland.obstacles.branch.image(),c[0].particle.motion.position.translation.negate()))},sound:resources.sceneries.grassland.obstacles.branch.sound}],this.TRACK_OFFSET())}},city:{build:function(a){this.addTrack(a);this.addCargoes(a);this.addObstacles(a);this.addRoadblock(a,this.ROADBLOCK_OFFSET());this.addRoadblock(a,-this.ROADBLOCK_OFFSET());a.addTerrain(resources.sceneries.city.soil,
"#4d4d4d",1).addLocatorOrigin(a.track.evaluateSingle(this.VEHICLE_OFFSET())).addLoadingAreas(this.WAREHOUSE_OFFSET(),this.GATE_RECTANGLE(),this.addWarehouse.bind(this)).addBackgroundGraphics([a.newBackgroundFiller("#c9d7ed")].concat(a.generateClouds(300,15,2,.45,2,2,resources.sceneries.city.clouds,resources.sceneries.city.backgrounds[0]),a.newParallaxRepeatedImageX(resources.sceneries.city.backgrounds[0],this.BACKGROUND_MULTIPLIER),this.newCarsLayer(a,resources.sceneries.city.backgrounds[1]),a.newParallaxRepeatedImageX(resources.sceneries.city.backgrounds[2],
3*this.BACKGROUND_MULTIPLIER))).addEmitter(new game.collisions.EmitterParams(resources.sceneries.city.emitter,game.utility.Range.ZERO,100,0,0,0,0,400,2E3,100,-100,.25,.5,.8)).addCollisionSound(resources.sceneries.city.collision).addAmbience(resources.sceneries.city.ambience)},addTrack:function(a){var b=0;a.track.addZero(this.TRACK_OFFSET());a.addWhileLengthLess(function(){this.TRACK_ADD_FUNCTIONS[b](a);b=(b+1)%this.TRACK_ADD_FUNCTIONS.length}.bind(this));this.TRACK_ADD_FUNCTIONS[1](a);a.track.addZero(this.TRACK_OFFSET())},
newCarsLayer:function(a,b){const c=a.addAnimationParticle(this.CARS_DURATION),d=new physics.dynamics.Vector(b().width*this.CARS_REPEAT,b().width);return a.newParallaxBackground(physics.rendering.graphics.Container.fixed([new game.graphics.RepeatedImageX(a.rendering(),b,d),new game.graphics.RepeatedGraphic(a.rendering(),physics.rendering.graphics.Container.fixed([].concat(this.generateCars(a,c,-35,this.newCarLeft),this.generateCars(a,c,0,this.newCarRight))),d)]),d,new physics.dynamics.Vector(2*this.BACKGROUND_MULTIPLIER,
0))},generateCars:function(a,b,c,d){return this.generateCarOffsets(4,.06).map(function(e){return d.call(this,a,b,game.utility.randomFromArray(resources.sceneries.city.cars),e,c)}.bind(this))},generateCarOffsets:function(a,b){const c=1-b*a,d=Math.random();return[0].concat(game.utility.arrayOfSize(a-1).map(function(){return Math.random()*c}).sort().map(function(e,f){return e+(f+1)*b})).map(function(e){return physics.utility.modPositive(e+d,1)})},newCarRight:function(a,b,c,d,e){return this.newCar(a,
b,this.newCarImage(a,c),d,1,e)},newCarLeft:function(a,b,c,d,e){return this.newCar(a,b,new physics.rendering.graphics.FlippedX(a.rendering(),this.newCarImage(a,c)),d,-1,e)},newCar:function(a,b,c,d,e,f){return new physics.rendering.graphics.Transformator(a.rendering(),c,b,function(g,h){var k=this.CARS_REPEAT*physics.utility.modPositive(e*h.rotation/physics.utility.PI_2+d,1);h=Math.floor(k);k=(k-h)*(g.length-1);const l=Math.floor(k);return g[g.length-1].subtract(g[0]).multiply(h).add(g[l].interpolate(g[l+
1],k-l))}.bind(this,this.newCarsPathTransformations(f)))},newCarImage:function(a,b){return physics.rendering.graphics.Image.fromOrigin(a.rendering(),b(),new physics.dynamics.Vector(0,20)).addRelative(new physics.dynamics.Vector(-.5,-1))},newCarsPathTransformations:function(a){return this.CARS_PATH.map(function(b,c){const d=this.CARS_PATH.length-1;c=this.CARS_PATH[physics.utility.modPositive(c,d)+1].subtract(this.CARS_PATH[physics.utility.modPositive(c,d)]).add(this.CARS_PATH[physics.utility.modPositive(c-
1,d)+1]).subtract(this.CARS_PATH[physics.utility.modPositive(c-1,d)]);return new physics.dynamics.Transformation(b.add(new physics.dynamics.Vector(0,a)),c.angle())}.bind(this))},addRoadblock:function(a,b){b=a.track.evaluateSingle(b);const c=a.addAnimationParticle(1),d=resources.sceneries.city.roadblock.background().width/2,e=resources.sceneries.city.roadblock.background().height;a.addTrackLimit(b,d);a.addGraphic(new physics.rendering.perspective.View(physics.rendering.graphics.Container.fixed([physics.rendering.graphics.Image.fromOrigin(a.rendering(),
resources.sceneries.city.roadblock.background(),b).addRelative(new physics.dynamics.Vector(-.5,-1)),new physics.rendering.graphics.Alpha(a.rendering(),physics.rendering.graphics.Image.fromOrigin(a.rendering(),resources.sceneries.city.roadblock.lights(),b.subtract(new physics.dynamics.Vector(d-this.ROADBLOCK_LIGHTS_OFFSET,e))),c,function(f){return f.rotation<this.ROADBLOCK_FLASH_DURATION?1:0}.bind(this))]),game.graphics.depths.SCENERY.BOUND))},addWarehouse:function(a,b){a.addGraphic(new physics.rendering.perspective.View(physics.rendering.graphics.Container.fixed([].concat(physics.rendering.graphics.Image.fromOrigin(a.rendering(),
resources.sceneries.city.warehouse.background(),b.add(this.GATE_BACKGROUND_OFFSET)),this.newRackLayer(a,b,2),this.newRackLayer(a,b,1),this.newRackLayer(a,b,0),physics.rendering.graphics.Image.fromOrigin(a.rendering(),resources.sceneries.city.warehouse.foreground(),b).addRelative(new physics.dynamics.Vector(-.5,-1)))),game.graphics.depths.SCENERY.LOADING))},newRackLayer:function(a,b,c){const d=(sceneries.city.RACK_MULTIPLIER-1)*resources.sceneries.city.warehouse.racks[c]().width/resources.sceneries.city.warehouse.racks[0]().width+
1;return[a.newParallaxImage(b,resources.sceneries.city.warehouse.racks[c],new physics.dynamics.Vector(-800,this.RACK_OFFSET_Y),game.utility.Range.rectangleX(this.GATE_RECTANGLE_RAW),d),a.newParallaxImage(b,resources.sceneries.city.warehouse.racks[c],new physics.dynamics.Vector(0,this.RACK_OFFSET_Y),game.utility.Range.rectangleX(this.GATE_RECTANGLE_RAW),d),a.newParallaxImage(b,resources.sceneries.city.warehouse.racks[c],new physics.dynamics.Vector(800,this.RACK_OFFSET_Y),game.utility.Range.rectangleX(this.GATE_RECTANGLE_RAW),
d)]},addCargoes:function(a){a.addCircularCargo(resources.sceneries.city.cargoes.barrel,4,70).addRectangularCargo(resources.sceneries.city.cargoes.parcel,!0,2,50).addRectangularCargo(resources.sceneries.city.cargoes.bottlePallet,!1,5,120)},addObstacles:function(a){a.addObstacleSpawner([{factory:function(b){const c=physics.collisions.Body.uniform(physics.dynamics.Particle.fromMass(7),physics.collisions.shapes.CircularSegment.from(new physics.collisions.shapes.Circle((new physics.dynamics.Vector(154,
225)).multiply(sceneries.city.SPEED_BUMP_SCALING),225*sceneries.city.SPEED_BUMP_SCALING,game.Engine.SINGULARITY),new physics.interaction.Axis(new physics.dynamics.Vector(0,1),-165*sceneries.city.SPEED_BUMP_SCALING)),1);return game.collisions.Obstacles.singleBody(c,physics.rendering.graphics.Image.fromOrigin(b,resources.sceneries.city.obstacles.speedBump.image(),c.particle.motion.position.translation.negate()))},sound:resources.sceneries.city.obstacles.speedBump.sound},{factory:function(b){const c=
physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(30,300),new physics.dynamics.Vector(120,0),new physics.dynamics.Vector(160,0),new physics.dynamics.Vector(250,300)],sceneries.city.PYLON_SCALING,2),game.utility.scaledPolygonBody([new physics.dynamics.Vector(0,300),new physics.dynamics.Vector(280,300),new physics.dynamics.Vector(280,325),new physics.dynamics.Vector(0,325)],sceneries.city.PYLON_SCALING,2)]);return game.collisions.Obstacles.singleGraphic(c,physics.rendering.graphics.Image.fromOrigin(b,
resources.sceneries.city.obstacles.pylon.image(),c[0].particle.motion.position.translation.negate()))},sound:resources.sceneries.city.obstacles.pylon.sound},{factory:function(b){const c=physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(0,0),new physics.dynamics.Vector(35,0),new physics.dynamics.Vector(85,69),new physics.dynamics.Vector(35,139),new physics.dynamics.Vector(0,139)],sceneries.city.COBBLESTONE_SCALING,2),game.utility.scaledPolygonBody([new physics.dynamics.Vector(162,
0),new physics.dynamics.Vector(127,0),new physics.dynamics.Vector(77,69),new physics.dynamics.Vector(127,139),new physics.dynamics.Vector(162,139)],sceneries.city.COBBLESTONE_SCALING,2),game.utility.scaledPolygonBody([new physics.dynamics.Vector(35,21),new physics.dynamics.Vector(127,21),new physics.dynamics.Vector(127,118),new physics.dynamics.Vector(35,118)],sceneries.city.COBBLESTONE_SCALING,3)]);c[0].particle.move(physics.dynamics.Motion.fromPosition(physics.dynamics.Transformation.fromRotation(game.utility.randomInt(4)*
Math.PI/2)));return game.collisions.Obstacles.singleGraphic(c,physics.rendering.graphics.Image.fromOrigin(b,resources.sceneries.city.obstacles.cobblestone.image(),c[0].particle.motion.position.translation.negate()))},sound:resources.sceneries.city.obstacles.cobblestone.sound}],this.TRACK_OFFSET())}},snowscape:{build:function(a){this.addTrack(a);this.addCargoes(a);this.addObstacles(a);this.addStonewall(a,this.STONEWALL_OFFSET());this.addStonewall(a,-this.STONEWALL_OFFSET());a.addTerrain(resources.sceneries.snowscape.soil,
"#e6eaf2",.5).addLocatorOrigin(a.track.evaluateSingle(this.VEHICLE_OFFSET())).addLoadingAreas(this.STABBUR_OFFSET(),this.DOOR_RECTANGLE(),this.addStabbur.bind(this)).addBackgroundGraphics([].concat(this.addLightningBackground(a),game.utility.zipArrays([a.newArrayParallaxRepeatedImageX(resources.sceneries.snowscape.backgrounds,sceneries.snowscape.BACKGROUND_MULTIPLIER),this.newSnowfall(a)]))).addEmitter(new game.collisions.EmitterParams(resources.sceneries.snowscape.emitter,game.utility.Range.ZERO,
100,1,.3,.6,500,100,1E3,50,.5*game.View.GRAVITY,.1,.4,.7)).addCollisionSound(resources.sceneries.snowscape.collision).addAmbience(resources.sceneries.snowscape.ambience)},addTrack:function(a){a.track.addZero(this.TRACK_OFFSET());a.addWhileLengthLess(function(){a.addRandomCornerPolynomial2()}.bind(this));a.track.addZero(this.TRACK_OFFSET())},addLightningBackground:function(a){const b=new physics.collections.Ordered,c=new physics.collections.Bundle,d=new physics.collections.Bundle;a.bundle.addBundle(c).addBundle(d);
this.waitForLightning(a,c,d,b);return physics.rendering.graphics.Container.variable(b)},waitForLightning:function(a,b,c,d){const e=new physics.actors.animation.Timer((new game.utility.Range(8,24)).random(),0);a.addActor(b,e.elapsedActor(function(){b.release()&&this.fadeOutLightning(a,b,c,d)}.bind(this)));b.add(d,a.newBackgroundFiller(sceneries.snowscape.BACKGROUND_COLOR_STR))},fadeOutLightning:function(a,b,c,d){const e=new physics.actors.animation.Timer(1,0),f=physics.dynamics.Particle.infiniteMass(physics.dynamics.Motion.ZERO),
g=physics.actors.animation.Transition.zeroPi(e,f),h=Math.random();a.addParticle(b,f).addActor(b,e.elapsedActor(function(){b.release()&&this.waitForLightning(a,b,c,d)}.bind(this))).addActor(c,(new physics.actors.animation.Timer((new game.utility.Range(2,3)).random(),0)).elapsedActor(function(){c.release()&&this.playThunder(a,h)}.bind(this))).addActor(b,g.actor());b.addAll(d,this.newLightningGraphics(a,f,h))},newLightningGraphics:function(a,b,c){return[new physics.rendering.graphics.path.Beginner(a.rendering()),
new physics.rendering.graphics.Background(a.rendering()),new physics.rendering.graphics.ColorProperty(a.rendering(),b,physics.rendering.mappers.WAVE_01,"fillStyle",sceneries.snowscape.BACKGROUND_LIGHTNING_COLOR,sceneries.snowscape.BACKGROUND_COLOR),new physics.rendering.graphics.path.Filler(a.rendering()),new physics.rendering.graphics.Alpha(a.rendering(),a.newBackgroundOffset(physics.rendering.graphics.Image.fromOrigin(a.rendering(),game.utility.randomFromArray(resources.sceneries.snowscape.lightnings)(),
physics.dynamics.Vector.ZERO).addRelative(new physics.dynamics.Vector(-c,0)),sceneries.snowscape.BACKGROUND_HEIGHT,new physics.dynamics.Vector(c,0)),b,physics.rendering.mappers.WAVE_10)]},playThunder:function(a,b){const c=new StereoPannerNode(a.audioContext(),{pan:b-.5});c.connect(a.audioContext().destination);a=new AudioBufferSourceNode(a.audioContext(),{buffer:game.utility.randomFromArray(resources.sceneries.snowscape.thunders)()});a.onended=function(){c.disconnect()};a.connect(c);a.start()},newSnowfall:function(a){const b=
a.addAnimationParticle(30);return resources.sceneries.snowscape.snowfall.map(function(c,d){return a.newParallaxRepeatedImage(c,sceneries.snowscape.BACKGROUND_HEIGHT/c().width,physics.dynamics.Vector.fromOne((d+1.5)*sceneries.snowscape.BACKGROUND_MULTIPLIER),b,function(e,f,g,h,k){return(new physics.dynamics.Vector(-2,5)).multiply(k.rotation/physics.utility.PI_2).add(new physics.dynamics.Vector(e.x*Math.sin(k.rotation*f.x+g.x),e.y*Math.sin(k.rotation*f.y+g.y))).multiplyVector(h)}.bind(null,new physics.dynamics.Vector((new game.utility.Range(.03,
.05)).random(),(new game.utility.Range(.01,.02)).random()),new physics.dynamics.Vector(5+game.utility.randomInt(20),3+game.utility.randomInt(10)),new physics.dynamics.Vector(Math.random()*physics.utility.PI_2,Math.random()*physics.utility.PI_2),physics.dynamics.Vector.fromImage(c())))})},addStonewall:function(a,b){b=a.track.evaluateSingle(b);a.addTrackLimit(b,this.STONEWALL_WIDTH_2());a.addGraphic(new physics.rendering.perspective.View(physics.rendering.graphics.Image.fromOrigin(a.rendering(),resources.sceneries.snowscape.stonewall(),
b).addRelative(new physics.dynamics.Vector(-.5,-.95)),game.graphics.depths.SCENERY.BOUND))},addStabbur:function(a,b){a.addGraphic(new physics.rendering.perspective.View(physics.rendering.graphics.Container.fixed([].concat(physics.rendering.graphics.Image.fromOrigin(a.rendering(),resources.sceneries.snowscape.stabbur.background(),b.add(this.DOOR_BACKGROUND_OFFSET)),this.newBarrelLayer(a,b,2),this.newBarrelLayer(a,b,1),this.newBarrelLayer(a,b,0),physics.rendering.graphics.Image.fromOrigin(a.rendering(),
resources.sceneries.snowscape.stabbur.foreground(),b).addRelative(new physics.dynamics.Vector(-.5,-1)))),game.graphics.depths.SCENERY.LOADING))},newBarrelLayer:function(a,b,c){const d=(sceneries.snowscape.BARREL_MULTIPLIER-1)*resources.sceneries.snowscape.stabbur.barrels[c]().width/resources.sceneries.snowscape.stabbur.barrels[0]().width+1;return[a.newParallaxImage(b,resources.sceneries.snowscape.stabbur.barrels[c],new physics.dynamics.Vector(this.DOOR_RECTANGLE().min.x+c*this.BARREL_OFFSET,this.DOOR_RECTANGLE().max.y),
game.utility.Range.rectangleX(this.DOOR_RECTANGLE_RAW),d),a.newParallaxImage(b,resources.sceneries.snowscape.stabbur.barrels[c],new physics.dynamics.Vector(this.DOOR_RECTANGLE().max.x-c*this.BARREL_OFFSET,this.DOOR_RECTANGLE().max.y),game.utility.Range.rectangleX(this.DOOR_RECTANGLE_RAW),d)]},addCargoes:function(a){a.addCircularCargo(resources.sceneries.snowscape.cargoes.barrel,3,70).addRectangularCargo(resources.sceneries.snowscape.cargoes.iceBlock,!0,4,90).addPolygonalCargo(resources.sceneries.snowscape.cargoes.firewood,
[new physics.dynamics.Vector(8.99,-.23),new physics.dynamics.Vector(.04,56.21),new physics.dynamics.Vector(60.81,59.26),new physics.dynamics.Vector(101.47,58.56),new physics.dynamics.Vector(150.07,51.56),new physics.dynamics.Vector(141.78,11.03),new physics.dynamics.Vector(72.94,4.16)],[0],Math.PI,1,30)},addObstacles:function(a){a.addObstacleSpawner([a.newCircularObstacle(resources.sceneries.snowscape.obstacles.snowball,5),{factory:function(b){const c=game.utility.scaledPolygonBody([new physics.dynamics.Vector(172.12,
541.62),new physics.dynamics.Vector(28,431.67),new physics.dynamics.Vector(-10.73,247.27),new physics.dynamics.Vector(76.73,52.91),new physics.dynamics.Vector(171.82,-14),new physics.dynamics.Vector(267.12,52.75),new physics.dynamics.Vector(357.27,255.45),new physics.dynamics.Vector(313.27,440.55)],sceneries.snowscape.CONE_SCALING,3);c.particle.move(physics.dynamics.Motion.fromPosition(physics.dynamics.Transformation.fromRotation((game.utility.randomInt(2)+.5)*Math.PI)));return game.collisions.Obstacles.singleBody(c,
physics.rendering.graphics.Image.fromOrigin(b,resources.sceneries.snowscape.obstacles.cone.image(),c.particle.motion.position.translation.negate()))},sound:resources.sceneries.snowscape.obstacles.cone.sound},{factory:function(b){const c=physics.collisions.Body.merge([game.utility.scaledPolygonBody([new physics.dynamics.Vector(323.33,394),new physics.dynamics.Vector(49.82,394),new physics.dynamics.Vector(0,353.27),new physics.dynamics.Vector(0,308),new physics.dynamics.Vector(194.25,138.25),new physics.dynamics.Vector(701.5,
139)],sceneries.snowscape.ROCK_SCALING,4),game.utility.scaledPolygonBody([new physics.dynamics.Vector(322,394),new physics.dynamics.Vector(81.5,344.5),new physics.dynamics.Vector(492,29.5),new physics.dynamics.Vector(753,92.5),new physics.dynamics.Vector(900,247.67),new physics.dynamics.Vector(900,298.5),new physics.dynamics.Vector(850,357.27),new physics.dynamics.Vector(746.73,394)],sceneries.snowscape.ROCK_SCALING,6)]);return game.collisions.Obstacles.singleGraphic(c,physics.rendering.graphics.Image.fromOrigin(b,
resources.sceneries.snowscape.obstacles.rock.image(),c[0].particle.motion.position.translation.negate()))},sound:resources.sceneries.snowscape.obstacles.rock.sound}],this.TRACK_OFFSET())}}};sceneries.utility.Setup.MAX_TUNING=10;sceneries.utility.Setup.prototype.tuneDistance=function(a,b){return a*Math.pow(b,this.distance/sceneries.utility.Setup.MAX_TUNING)};sceneries.utility.Setup.prototype.tuneFirstRange=function(a){return(new game.utility.Range(-this.uphill,this.downhill)).multiply(a/sceneries.utility.Setup.MAX_TUNING)};
sceneries.utility.Setup.prototype.tuneSecondRange=function(a,b){return game.utility.Range.symmetric(a*Math.pow(b,this.alternation/sceneries.utility.Setup.MAX_TUNING))};sceneries.utility.Setup.prototype.tuneInverseObstacles=function(a,b){return Math.pow(this.obstacles/sceneries.utility.Setup.MAX_TUNING,b)/a};sceneries.utility.Builder.SAMPLE_TOLERANCE=function(){return Math.pow(.025*game.View.PX_PER_M,2)};sceneries.utility.Builder.SAMPLE_DISTANCE=function(){return.25*game.View.PX_PER_M};
sceneries.utility.Builder.TERRAIN_HEIGHT=new physics.dynamics.Vector(0,1E4);sceneries.utility.Builder.CHAIN_SPAN=function(){return(new physics.dynamics.Vector(0,3)).multiply(game.View.PX_PER_M)};sceneries.utility.Builder.TRACK_LIMIT_EXTENT=function(){return 10*game.View.PX_PER_M};sceneries.utility.Builder.LOADING_MARGIN=function(){return physics.dynamics.Rectangle.symmetric(physics.dynamics.Vector.fromOne(game.loading.Loader.TOGGLE_LINE_WIDTH/4))};
sceneries.utility.Builder.LOADING_MARGIN_ZERO=function(){const a=sceneries.utility.Builder.LOADING_MARGIN();return new physics.dynamics.Rectangle(a.min,new physics.dynamics.Vector(a.max.x,0))};sceneries.utility.Builder.LOADING_ORIGIN=new physics.dynamics.Vector(.5,.5);sceneries.utility.Builder.AMBIENCE_GAIN=.15;sceneries.utility.Builder.AMBIENCE_FADE_DURATION=.1/sceneries.utility.Builder.AMBIENCE_GAIN;sceneries.utility.Builder.CARGO_MASS_FACTOR=.2;sceneries.utility.Builder.OBSTACLE_MASS_FACTOR=1.5;
sceneries.utility.Builder.scaleCargoMass=function(a){return function(b,c){b=a(b,c);b.body=new physics.collisions.Body(new physics.dynamics.Particle(b.body.particle.motion,b.body.particle.invMass.multiply(1/sceneries.utility.Builder.CARGO_MASS_FACTOR)),b.body.shape);return b}};
sceneries.utility.Builder.scaleObstacleMass=function(a){return function(b){const c=[],d=[];return a(b).map(function(e){var f=c.indexOf(e.body.particle);0>f&&(f=c.push(e.body.particle)-1,d.push(new physics.dynamics.Particle(e.body.particle.motion,e.body.particle.invMass.multiply(1/sceneries.utility.Builder.OBSTACLE_MASS_FACTOR))));return{body:new physics.collisions.Body(d[f],e.body.shape),graphic:e.graphic}})}};sceneries.utility.Builder.prototype.rendering=function(){return this.loader.matchers.view.engine.rendering};
sceneries.utility.Builder.prototype.camera=function(){return this.loader.matchers.view.camera};sceneries.utility.Builder.prototype.audioContext=function(){return this.loader.matchers.view.engine.avContext.audio};sceneries.utility.Builder.prototype.sample=function(){return this.track.sample(sceneries.utility.Builder.SAMPLE_DISTANCE()).reduce(sceneries.utility.Builder.SAMPLE_TOLERANCE())};sceneries.utility.Builder.prototype.tuneFirstRange=function(){return this.setup.tuneFirstRange(.75)};
sceneries.utility.Builder.prototype.tuneSecondRange=function(){return this.setup.tuneSecondRange(6E-7*game.View.PX_PER_M,16)};sceneries.utility.Builder.prototype.addWhileLengthLess=function(a){this.track.addWhileLengthLess(this.setup.tuneDistance(25,20)*game.View.PX_PER_M,a);return this};sceneries.utility.Builder.prototype.addRandomPolynomial1=function(){this.track.addRandomPolynomial1(this.tuneFirstRange(),this.tuneSecondRange());return this};
sceneries.utility.Builder.prototype.addRandomDiffPolynomial2=function(){this.track.addRandomDiffPolynomial2(this.tuneFirstRange(),this.tuneSecondRange());return this};sceneries.utility.Builder.prototype.addRandomDiffAtLeastPolynomial2=function(a){const b=this.tuneFirstRange(),c=new game.utility.Range(b.min,b.min*a);a=new game.utility.Range(b.max*a,b.max);this.track.addRandomDiffPolynomial2(Math.random()*a.length()<.5*c.length()?c:a,this.tuneSecondRange());return this};
sceneries.utility.Builder.prototype.addRandomZeroPolynomial2=function(){this.track.addRandomDiffPolynomial2(game.utility.Range.ZERO,this.tuneSecondRange());return this};sceneries.utility.Builder.prototype.addRandomCornerPolynomial2=function(){this.track.addRandomCornerPolynomial2(this.tuneFirstRange(),this.tuneSecondRange());return this};sceneries.utility.Builder.prototype.addGraphic=function(a){this.bundle.add(this.loader.matchers.view.graphics,a);return this};
sceneries.utility.Builder.prototype.addCollision=function(a){this.bundle.add(this.loader.matchers.view.collisions,a);return this};sceneries.utility.Builder.prototype.addParticle=function(a,b){a.add(this.loader.matchers.view.engine.particles,b);return this};sceneries.utility.Builder.prototype.addActor=function(a,b){a.add(this.loader.matchers.view.engine.actors,b);return this};
sceneries.utility.Builder.prototype.addRectangleCollision=function(a,b){this.addCollision(new physics.collisions.Collider(physics.collisions.Body.stationary(physics.collisions.shapes.Polygon.convexHull(a.vertices())),b));return this};sceneries.utility.Builder.prototype.addFrictionMultiplier=function(a){this.bundle.add(this.loader.matchers.frictionMultipliers,a);return this};
sceneries.utility.Builder.prototype.addAnimationParticle=function(a){a=physics.dynamics.Particle.rotating(physics.utility.PI_2/a);this.addParticle(this.bundle,a);return a};sceneries.utility.Builder.prototype.addBackgroundGraphics=function(a){this.bundle.addAll(this.loader.matchers.view.background,a);return this};sceneries.utility.Builder.prototype.newBackgroundFiller=function(a){return this.loader.matchers.view.engine.newBackgroundFiller(a)};
sceneries.utility.Builder.prototype.addTerrain=function(a,b,c){const d=this.sample().samples,e=d.slice(1).map(function(g,h){return new physics.rendering.graphics.path.Polygon(this.rendering(),new physics.collisions.shapes.Polygon([d[h],g,g.add(sceneries.utility.Builder.TERRAIN_HEIGHT),d[h].add(sceneries.utility.Builder.TERRAIN_HEIGHT)]))}.bind(this)),f=d.slice(1).map(function(g,h){return new physics.rendering.graphics.Margin(new physics.rendering.graphics.path.Line(this.rendering(),new physics.collisions.shapes.Line(d[h],
g)),physics.dynamics.Rectangle.symmetric(physics.dynamics.Vector.fromOne(game.loading.Loader.TOGGLE_LINE_WIDTH/2)))}.bind(this));[].concat(physics.rendering.perspective.View.enclosed(new physics.rendering.graphics.path.Beginner(this.rendering()),e,physics.rendering.graphics.Container.fixed([new physics.rendering.graphics.Properties(this.rendering(),{fillStyle:this.rendering().context2d.createPattern(a(),"repeat")}),new physics.rendering.graphics.path.Filler(this.rendering())]),game.graphics.depths.SCENERY.UNDERGROUND),
physics.rendering.perspective.View.enclosed(new physics.rendering.graphics.path.Beginner(this.rendering()),f,physics.rendering.graphics.Container.fixed([new physics.rendering.graphics.Properties(this.rendering(),{strokeStyle:b,lineCap:"round",lineWidth:game.loading.Loader.TOGGLE_LINE_WIDTH}),new physics.rendering.graphics.path.Stroker(this.rendering())]),game.graphics.depths.SCENERY.OVERGROUND)).forEach(this.addGraphic.bind(this));physics.collisions.shapes.chain(d,sceneries.utility.Builder.CHAIN_SPAN(),
8).forEach(function(g){this.addCollision(new physics.collisions.Collider(physics.collisions.Body.stationary(g),this.loader.matchers.environment))}.bind(this));this.addFrictionMultiplier(c);return this};
sceneries.utility.Builder.prototype.generateClouds=function(a,b,c,d,e,f,g,h){const k=this.addAnimationParticle(a),l=new physics.dynamics.Vector(h().width*c,h().width);return this.newParallaxBackground(new game.graphics.RepeatedGraphic(this.rendering(),physics.rendering.graphics.Container.fixed(game.utility.arrayOfSize(b).map(function(){return new physics.rendering.graphics.Translator(this.rendering(),physics.rendering.graphics.Image.fromOrigin(this.rendering(),game.utility.randomFromArray(g)(),physics.dynamics.Vector.ZERO).addRelative(new physics.dynamics.Vector(0,
-1)),k,function(m,n,p,q){return(new physics.dynamics.Vector(physics.utility.modPositive(p*q.rotation/physics.utility.PI_2+m,1),d*n)).multiplyVector(l)}.bind(this,Math.random(),Math.random(),e+game.utility.randomInt(f)))}.bind(this))),l),l,new physics.dynamics.Vector(.01,0))};
sceneries.utility.Builder.prototype.addTrackLimit=function(a,b){this.addCollision(new physics.collisions.Collider(physics.collisions.Body.stationary(physics.collisions.shapes.Polygon.convexHull(physics.dynamics.Rectangle.symmetric(new physics.dynamics.Vector(b,sceneries.utility.Builder.TRACK_LIMIT_EXTENT())).vertices()).transform(physics.dynamics.Transformation.fromTranslation(a))),this.loader.matchers.environment));return this};
sceneries.utility.Builder.prototype.addLoadingAreas=function(a,b,c){a=this.track.evaluateMultiple([a,-a]);this.addLoadingAreasOrigins(a[0],a[1],b,c);return this};
sceneries.utility.Builder.prototype.addLoadingAreasOrigins=function(a,b,c,d){const e=this.extLoadingArea(c);d(this,a);d(this,b);this.addRectangleLoaderBounds(c.add(a));this.addRectangleCollision(e.add(a),this.loader.matchers.load);this.addRectangleCollision(e.add(b),this.loader.matchers.unload);this.addLocatorRange(new game.utility.Range(a.x,b.x));return this};
sceneries.utility.Builder.prototype.extLoadingArea=function(a){return new physics.dynamics.Rectangle(new physics.dynamics.Vector(a.min.x,2*a.min.y),new physics.dynamics.Vector(a.max.x,-a.min.y))};sceneries.utility.Builder.prototype.newParallaxImage=function(a,b,c,d,e){return new game.graphics.ParallaxImage(this.camera(),b,a.add(c).subtract(new physics.dynamics.Vector(b().width/2*(1+e),b().height)),d.add(a.x),e)};
sceneries.utility.Builder.prototype.newParallaxRepeatedImageX=function(a,b){const c=physics.dynamics.Vector.fromOne(a().width);return new game.graphics.BackgroundGraphic(this.rendering(),new game.graphics.ParallaxBackground(this.camera(),new game.graphics.RepeatedImageX(this.rendering(),a,c),c,new physics.dynamics.Vector(b,0)),c.y)};
sceneries.utility.Builder.prototype.newParallaxRepeatedImage=function(a,b,c,d,e){const f=physics.dynamics.Vector.fromImage(a());b*=f.y;return new game.graphics.BackgroundGraphic(this.rendering(),new game.graphics.ParallaxBackground(this.camera(),new game.graphics.RepeatedImage(this.rendering(),a,b,f,d,e),f,c),b)};sceneries.utility.Builder.prototype.newArrayParallaxRepeatedImageX=function(a,b){return a.map(function(c,d){return this.newParallaxRepeatedImageX(c,(d+1)*b)}.bind(this))};
sceneries.utility.Builder.prototype.newParallaxBackground=function(a,b,c){return new game.graphics.BackgroundGraphic(this.rendering(),new game.graphics.ParallaxBackground(this.camera(),a,b,c),b.y)};sceneries.utility.Builder.prototype.newBackgroundOffset=function(a,b,c){return new game.graphics.BackgroundGraphic(this.rendering(),new game.graphics.BackgroundOffset(this.rendering(),a,b,c),b)};sceneries.utility.Builder.prototype.addLocatorOrigin=function(a){this.bundle.add(this.locator.origins,a);return this};
sceneries.utility.Builder.prototype.addLocatorRange=function(a){this.bundle.add(this.locator.ranges,a);return this};sceneries.utility.Builder.prototype.addLoaderBounds=function(a){this.bundle.add(this.loader.bounds,a);return this};
sceneries.utility.Builder.prototype.addRectangleLoaderBounds=function(a){this.addLoaderBounds(function(b,c){b.origin||(b.origin=a.interpolate(sceneries.utility.Builder.LOADING_ORIGIN));c=c.bounds();return physics.actors.containerArray([b.boundActor(physics.interaction.Axis.throughX(a.min.x-c.min.x)),b.boundActor(physics.interaction.Axis.throughY(a.min.y-c.max.y-game.loading.Loader.TOGGLE_LINE_WIDTH/2)),b.boundActor(physics.interaction.Axis.throughX(a.max.x-c.max.x).negate()),b.boundActor(physics.interaction.Axis.throughY(a.max.y-
c.max.y).negate())])}.bind(this));return this};sceneries.utility.Builder.prototype.addCargo=function(a,b,c){this.bundle.addBundle(this.loader.addCargoFactory(sceneries.utility.Builder.scaleCargoMass(a),b,c));return this};
sceneries.utility.Builder.prototype.addCircularCargo=function(a,b,c){return this.addCargo(function(d,e){return{body:physics.collisions.Body.uniform(new physics.dynamics.Particle(physics.dynamics.Motion.fromPosition(new physics.dynamics.Transformation(e,Math.random()*physics.utility.PI_2)),physics.dynamics.Mass.fromInverse(b)),new physics.collisions.shapes.Circle(physics.dynamics.Vector.ZERO,(a.image().width+a.image().height)/4,game.Engine.SINGULARITY),0),graphic:physics.rendering.graphics.Image.fromOrigin(d,
a.image(),physics.dynamics.Vector.ZERO).addRelative(physics.rendering.graphics.Image.CENTER)}},c,a.sound)};
sceneries.utility.Builder.prototype.addPolygonalCargo=function(a,b,c,d,e,f){return this.addCargo(function(g,h){const k=physics.collisions.Body.uniform(physics.dynamics.Particle.fromMass(e),physics.collisions.shapes.Polygon.convexHull(b),1),l=k.particle.motion.position.translation.negate();k.particle.reset(physics.dynamics.Motion.fromPosition(new physics.dynamics.Transformation(h,game.utility.randomFromArray(c)+(2*Math.random()-1)*d)));return{body:k,graphic:physics.rendering.graphics.Image.fromOrigin(g,
a.image(),l)}},f,a.sound)};sceneries.utility.Builder.prototype.addRectangularCargo=function(a,b,c,d){return this.addPolygonalCargo(a,(new physics.dynamics.Rectangle(physics.dynamics.Vector.ZERO,physics.dynamics.Vector.fromImage(a.image()))).vertices(),b?[0,.5*Math.PI,Math.PI,1.5*Math.PI]:[0],0,c,d)};
sceneries.utility.Builder.prototype.addObstacleSpawner=function(a,b){const c=this.setup.tuneInverseObstacles(500,1.5);0<c&&this.bundle.addBundle(this.obstacles.addSpawner(1/c,game.collisions.Obstacles.limitedSpawner(this.obstacles.randomSpawner(this.sample(),a.map(function(d){return{factory:sceneries.utility.Builder.scaleObstacleMass(d.factory),matcher:this.loader.matchers.addObstacleMatcher(this.bundle,d.sound)}}.bind(this))),new game.utility.Range(b,this.track.length()-b))));return this};
sceneries.utility.Builder.prototype.newCircularObstacle=function(a,b){return{factory:function(c){return game.collisions.Obstacles.singleBody(physics.collisions.Body.uniform(new physics.dynamics.Particle(physics.dynamics.Motion.fromPosition(physics.dynamics.Transformation.fromRotation(Math.random()*physics.utility.PI_2)),physics.dynamics.Mass.fromInverse(b)),new physics.collisions.shapes.Circle(physics.dynamics.Vector.ZERO,(a.image().width+a.image().height)/4,game.Engine.SINGULARITY),0),physics.rendering.graphics.Image.fromOrigin(c,
a.image(),physics.dynamics.Vector.ZERO).addRelative(physics.rendering.graphics.Image.CENTER))},sound:a.sound}};sceneries.utility.Builder.prototype.addEmitter=function(a){a=new game.collisions.EmitterContext(a,this.audioContext(),this.loader.matchers.view);this.bundle.addBundle(this.loader.matchers.addEmitter(a)).addCustom(a.stop.bind(a)).add(this.loader.matchers.view.engine.actors,a.actor());return this};
sceneries.utility.Builder.prototype.addCollisionSound=function(a){this.bundle.add(this.loader.matchers.chassisEnvironmentHandlers,this.loader.matchers.view.audioHandler(a));this.bundle.add(this.loader.matchers.wheelEnvironmentHandlers,this.loader.matchers.view.audioHandler(a));this.bundle.add(this.loader.matchers.environmentCargoHandlers,this.loader.matchers.view.audioHandler(a));this.bundle.add(this.loader.matchers.environmentObstacleHandlers,this.loader.matchers.view.audioHandler(a));return this};
sceneries.utility.Builder.prototype.addAmbience=function(a){const b=new GainNode(this.audioContext(),{gain:0});physics.utility.fadeAudio(b,sceneries.utility.Builder.AMBIENCE_FADE_DURATION,sceneries.utility.Builder.AMBIENCE_GAIN);b.connect(this.audioContext().destination);const c=new AudioBufferSourceNode(this.audioContext(),{buffer:a()});c.loop=!0;c.onended=function(){b.disconnect()};c.connect(b);c.start();this.bundle.addCustom(function(){c.stop(physics.utility.fadeAudio(b,sceneries.utility.Builder.AMBIENCE_FADE_DURATION,
0))});return this};sceneries.utility.Builder.prototype.release=function(){this.track=new sceneries.utility.Track;this.bundle.release()};sceneries.utility.Track.MIN_LENGTH=1;sceneries.utility.Track.prototype.deriveEnd=function(){return 0<this.segments.length?this.segments[this.segments.length-1].deriveEnd():0};sceneries.utility.Track.prototype.length=function(){return this.segments.map(function(a){return a.length}).reduce(physics.utility.add,0)};
sceneries.utility.Track.prototype.addZero=function(a){this.segments.push(new sceneries.utility.Segment(function(b){return 0},function(b){return 0},a));return this};sceneries.utility.Track.prototype.addPolynomial1=function(a,b){this.segments.push(new sceneries.utility.Segment(function(c){return a*c},function(c){return a},b));return this};
sceneries.utility.Track.prototype.addPolynomial2=function(a,b,c){this.segments.push(new sceneries.utility.Segment(function(d){return d*(a*d+b)},function(d){return 2*a*d+b},c));return this};sceneries.utility.Track.prototype.addRandomPolynomial1=function(a,b){return this.addPolynomial1(this.deriveEnd(),Math.max(sceneries.utility.Track.MIN_LENGTH,a.max/b.max,a.min/b.min))};
sceneries.utility.Track.prototype.addRandomDiffPolynomial2=function(a,b){return this.addRandomStartPolynomial2(this.deriveEnd(),a,b)};sceneries.utility.Track.prototype.addRandomCornerPolynomial2=function(a,b){return this.addRandomStartPolynomial2(a.random(),a,b)};
sceneries.utility.Track.prototype.addRandomStartPolynomial2=function(a,b,c){const d=Math.max(sceneries.utility.Track.MIN_LENGTH,(b.min-a)/c.min,(b.max-a)/c.max);b=b.subtract(a).divide(d).intersect(c).divide(2).random();return this.addPolynomial2(b,a,d)};sceneries.utility.Track.prototype.addWhileLengthLess=function(a,b){for(var c=this.segments.length,d=0;d<a;)for(b();c<this.segments.length;)d+=this.segments[c++].length;return this};sceneries.utility.Track.prototype.evaluateSingle=function(a){return this.evaluateMultiple([a])[0]};
sceneries.utility.Track.prototype.evaluateMultiple=function(a){const b=this.length(),c=a.map(function(h){return physics.utility.modPositive(h,b)});a=game.utility.arrayOfSize(c.length).map(function(h,k){return k}).sort(function(h,k){return c[h]-c[k]});const d=game.utility.arrayOfSize(c.length);for(var e=physics.dynamics.Vector.ZERO,f=0,g=0;g<c.length;)c[a[g]]<e.x+this.segments[f].length?(d[a[g]]=e.add(this.segments[f].evaluate(c[a[g]]-e.x)),g++):(e=e.add(this.segments[f].size()),f++);return d};
sceneries.utility.Track.prototype.sample=function(a){const b=[];for(var c=physics.dynamics.Vector.ZERO,d=0;d<this.segments.length;d++){const f=Math.ceil(this.segments[d].length/a);for(var e=0;e<f;e++)b.push(c.add(this.segments[d].evaluateAlpha(e/f)));c=c.add(this.segments[d].size())}return new sceneries.utility.Sampling(b)};sceneries.utility.Segment.prototype.size=function(){return this.evaluate(this.length)};
sceneries.utility.Segment.prototype.evaluate=function(a){return new physics.dynamics.Vector(a,this.mapper(a))};sceneries.utility.Segment.prototype.evaluateAlpha=function(a){return this.evaluate(a*this.length)};sceneries.utility.Segment.prototype.deriveEnd=function(){return this.derivation(this.length)};sceneries.utility.Sampling.prototype.reduce=function(a){return new sceneries.utility.Sampling(physics.dynamics.Vector.reduceChain(this.samples,a))};
sceneries.utility.Sampling.prototype.search=function(a){return physics.utility.binarySearch(this.samples,function(b){return a>b.x})};sceneries.utility.Sampling.prototype.interpolate=function(a,b){if(0==a)return this.samples[a].y;if(a==this.samples.length)return this.samples[a-1].y;const c=this.samples[a-1];a=this.samples[a];return c.interpolate(a,(b-c.x)/(a.x-c.x))};sceneries.utility.Sampling.prototype.evaluate=function(a){return this.interpolate(this.search(a),a)};
sceneries.utility.Sampling.prototype.minProduct=function(a,b){const c=this.search(a.min),d=this.search(a.max),e=this.samples.slice(c,d);e.push(this.interpolate(c,a.min));e.push(this.interpolate(d,a.max));return e.map(function(f){return b.dot(f)}).reduce(physics.utility.min)};
sceneries.utility.Sampling.prototype.alignParticles=function(a,b,c,d){const e=b.interpolate(new physics.dynamics.Vector(.5,.5));b=b.size();var f=b.length();c=new game.utility.Range(c-f*d,c+f*(1-d));d=this.evaluate(c.max).subtract(this.evaluate(c.min));const g=d.angle();f=d.rotate90();const h=c.interpolate(.5),k=new physics.dynamics.Vector(h,(this.minProduct(c,f)-f.x*h)/f.y-.5*b.y*d.length()/d.x);a.forEach(function(l){l.move(physics.dynamics.Motion.fromPosition(new physics.dynamics.Transformation(k.add(l.motion.position.translation.subtract(e).rotate(g)).subtract(l.motion.position.translation),
g)))})};sceneries.grassland.COST=1E4;sceneries.grassland.TUNING_COST_OFFSET=0;sceneries.grassland.TUNING_MAX_MULTIPLIER=3;sceneries.grassland.PROPERTY_PATH=["grassland"];sceneries.grassland.TRACK_OFFSET=function(){return 50*game.View.PX_PER_M};sceneries.grassland.TREE_OFFSET=function(){return 20*game.View.PX_PER_M};sceneries.grassland.VEHICLE_OFFSET=function(){return 30*game.View.PX_PER_M};sceneries.grassland.BARN_OFFSET=function(){return 40*game.View.PX_PER_M};
sceneries.grassland.BIRDS_DURATION=600;sceneries.grassland.BIRDS_PARALLAX_SIZE=new physics.dynamics.Vector(2500,1E3);sceneries.grassland.BACKGROUND_MULTIPLIER=.04;sceneries.grassland.BIRDS_HEIGHT_RANGE=function(){return new game.utility.Range(.25,.5)};sceneries.grassland.GRASS_DURATION=2;sceneries.grassland.TREE_DURATION=5;
sceneries.grassland.GRASS_IMAGES=[function(a){return physics.rendering.graphics.Image.fromOrigin(a.rendering(),resources.sceneries.grassland.grasses[0](),new physics.dynamics.Vector(-27,-78))},function(a){return physics.rendering.graphics.Image.fromOrigin(a.rendering(),resources.sceneries.grassland.grasses[1](),new physics.dynamics.Vector(-21,-89))}];
sceneries.grassland.DOOR_RECTANGLE=function(){return(new physics.dynamics.Rectangle(new physics.dynamics.Vector(-500,-900),new physics.dynamics.Vector(500,-1))).multiply(640/900).subtractRectangle(sceneries.utility.Builder.LOADING_MARGIN_ZERO())};sceneries.grassland.TREE_SCALING=.8;sceneries.grassland.TRUNK_ORIGIN=(new physics.dynamics.Vector(358,1080)).multiply(sceneries.grassland.TREE_SCALING);
sceneries.grassland.TREE_TOP_OFFSETS=[(new physics.dynamics.Vector(431,1085)).multiply(sceneries.grassland.TREE_SCALING),(new physics.dynamics.Vector(633,1269)).multiply(sceneries.grassland.TREE_SCALING),(new physics.dynamics.Vector(662,1572)).multiply(sceneries.grassland.TREE_SCALING)];sceneries.grassland.TREE_TOP_ORIGIN=(new physics.dynamics.Vector(0,947)).multiply(sceneries.grassland.TREE_SCALING);sceneries.grassland.ROCK_SCALING=.5;sceneries.grassland.BRANCH_SCALING=.5;sceneries.city.COST=1E5;
sceneries.city.TUNING_COST_OFFSET=1;sceneries.city.TUNING_MAX_MULTIPLIER=3.25;sceneries.city.PROPERTY_PATH=["city"];sceneries.city.TRACK_OFFSET=function(){return 65*game.View.PX_PER_M};sceneries.city.ROADBLOCK_OFFSET=function(){return 20*game.View.PX_PER_M};sceneries.city.VEHICLE_OFFSET=function(){return 30*game.View.PX_PER_M};sceneries.city.WAREHOUSE_OFFSET=function(){return 50*game.View.PX_PER_M};
sceneries.city.TRACK_ADD_FUNCTIONS=[function(a){a.addRandomDiffAtLeastPolynomial2(.5);a.addRandomPolynomial1()},function(a){a.addRandomZeroPolynomial2()},function(a){a.addRandomPolynomial1()}];sceneries.city.GATE_BACKGROUND_OFFSET=new physics.dynamics.Vector(-1160,-800);sceneries.city.GATE_RECTANGLE_RAW=new physics.dynamics.Rectangle(new physics.dynamics.Vector(-1160,-800),new physics.dynamics.Vector(1160,-200));sceneries.city.GATE_RECTANGLE=function(){return sceneries.city.GATE_RECTANGLE_RAW.subtractRectangle(sceneries.utility.Builder.LOADING_MARGIN())};
sceneries.city.RACK_MULTIPLIER=.08;sceneries.city.RACK_OFFSET_Y=sceneries.city.GATE_RECTANGLE_RAW.max.y;sceneries.city.BACKGROUND_MULTIPLIER=.04;sceneries.city.CARS_DURATION=30;sceneries.city.CARS_REPEAT=3;
sceneries.city.CARS_PATH=[new physics.dynamics.Vector(0,640.92),new physics.dynamics.Vector(25,639.96),new physics.dynamics.Vector(50,642.07),new physics.dynamics.Vector(75,649.09),new physics.dynamics.Vector(100,661.1),new physics.dynamics.Vector(125,675.83),new physics.dynamics.Vector(150,689.98),new physics.dynamics.Vector(175,700.96),new physics.dynamics.Vector(200,708.64),new physics.dynamics.Vector(225,713.48),new physics.dynamics.Vector(250,715.55),new physics.dynamics.Vector(275,714.59),new physics.dynamics.Vector(300,
711.02),new physics.dynamics.Vector(325,705),new physics.dynamics.Vector(350,696.15),new physics.dynamics.Vector(375,683.92),new physics.dynamics.Vector(400,670.48),new physics.dynamics.Vector(425,656.79),new physics.dynamics.Vector(450,642.79),new physics.dynamics.Vector(475,628.5),new physics.dynamics.Vector(500,615.49),new physics.dynamics.Vector(525,603.78),new physics.dynamics.Vector(550,594.82),new physics.dynamics.Vector(575,589.55),new physics.dynamics.Vector(600,587.59),new physics.dynamics.Vector(625,
589.06),new physics.dynamics.Vector(650,593.94),new physics.dynamics.Vector(675,602.09),new physics.dynamics.Vector(700,612.47),new physics.dynamics.Vector(725,625.53),new physics.dynamics.Vector(750,640.03),new physics.dynamics.Vector(775,653.7),new physics.dynamics.Vector(800,664.11),new physics.dynamics.Vector(825,670.39),new physics.dynamics.Vector(850,672.99),new physics.dynamics.Vector(875,671.34),new physics.dynamics.Vector(900,666.4),new physics.dynamics.Vector(925,658.65),new physics.dynamics.Vector(950,
649.54),new physics.dynamics.Vector(975,644.07),new physics.dynamics.Vector(1E3,640.92)];sceneries.city.ROADBLOCK_LIGHTS_OFFSET=30;sceneries.city.ROADBLOCK_FLASH_DURATION=physics.utility.PI_2/4;sceneries.city.SPEED_BUMP_SCALING=.75;sceneries.city.PYLON_SCALING=.3;sceneries.city.COBBLESTONE_SCALING=.35;sceneries.snowscape.COST=25E4;sceneries.snowscape.TUNING_COST_OFFSET=2;sceneries.snowscape.TUNING_MAX_MULTIPLIER=3.5;sceneries.snowscape.PROPERTY_PATH=["snowscape"];
sceneries.snowscape.TRACK_OFFSET=function(){return 50*game.View.PX_PER_M};sceneries.snowscape.BACKGROUND_MULTIPLIER=.02;sceneries.snowscape.BACKGROUND_COLOR_STR="#525666";sceneries.snowscape.BACKGROUND_COLOR=physics.rendering.Color.fromCss(sceneries.snowscape.BACKGROUND_COLOR_STR);sceneries.snowscape.BACKGROUND_LIGHTNING_COLOR=physics.rendering.Color.fromCss("#7b8199");sceneries.snowscape.BACKGROUND_HEIGHT=1E3;sceneries.snowscape.STONEWALL_OFFSET=function(){return 20*game.View.PX_PER_M};
sceneries.snowscape.STONEWALL_WIDTH_2=function(){return.375*resources.sceneries.snowscape.stonewall().width};sceneries.snowscape.VEHICLE_OFFSET=function(){return 30*game.View.PX_PER_M};sceneries.snowscape.STABBUR_OFFSET=function(){return 40*game.View.PX_PER_M};sceneries.snowscape.STABBUR_SCALING=.7;sceneries.snowscape.BARREL_MULTIPLIER=.03;sceneries.snowscape.BARREL_OFFSET=20*sceneries.snowscape.STABBUR_SCALING;sceneries.snowscape.DOOR_BACKGROUND_OFFSET=(new physics.dynamics.Vector(-300,-930)).multiply(sceneries.snowscape.STABBUR_SCALING);
sceneries.snowscape.DOOR_RECTANGLE_RAW=(new physics.dynamics.Rectangle(new physics.dynamics.Vector(-290,-920),new physics.dynamics.Vector(290,-380))).multiply(sceneries.snowscape.STABBUR_SCALING);sceneries.snowscape.DOOR_RECTANGLE=function(){return sceneries.snowscape.DOOR_RECTANGLE_RAW.subtractRectangle(sceneries.utility.Builder.LOADING_MARGIN())};sceneries.snowscape.CONE_SCALING=.15;sceneries.snowscape.ROCK_SCALING=.2;
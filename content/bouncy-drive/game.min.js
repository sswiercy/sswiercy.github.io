'use strict';const game={Engine:function(a,b){this.canvas=a;this.avContext=b;this.preUpdateQueue=[];this.particles=new physics.collections.Ordered;this.actors=new physics.collections.Ordered;this.graphics=physics.collections.Sorted.byOrder();this.pulseAnimation=physics.dynamics.Particle.rotating(physics.utility.PI_2/game.Engine.PULSE_DURATION);this.rendering=this.newRendering();this.addParticle()},View:function(a){this.engine=a;this.collisions=physics.collisions.builder(new physics.tracking.Tracker(game.View.COLLISION_TRACKING_SIZE,
game.View.COLLISION_TRACKING_MARGIN));this.graphics=physics.rendering.perspective.builder(new physics.tracking.Tracker(game.View.GRAPHIC_TRACKING_SIZE,game.View.GRAPHIC_TRACKING_MARGIN));this.background=new physics.collections.Ordered;this.scalings=new physics.collections.Ordered;this.camera=this.newCamera();this.addCamera()},utility:{Range:function(a,b){this.min=a;this.max=b},randomInt:function(a){return Math.floor(a*Math.random())},randomIntWeighted:function(a){for(var b=a.reduce(physics.utility.add,
0)*Math.random(),c=0;c<a.length&&0<=b;c++)b-=a[c];return c-1},randomFromArray:function(a){return a[this.randomInt(a.length)]},arrayOfSize:function(a){return Array.apply(null,Array(a))},zipArrays:function(a){const b=[];for(;a.length;)a=a.filter(function(c){return c.length}),a.forEach(function(c){b.push(c.shift())});return b},scaledPolygonBody:function(a,b,c){return physics.collisions.Body.uniform(physics.dynamics.Particle.fromMass(c),physics.collisions.shapes.Polygon.convexHull(a.map(function(d){return d.multiply(b)})),
1)}},bootstrap:{attach:function(){window.addEventListener("load",this.runLoadResources.bind(this,this.AvContext.build()))},loadFonts:function(){return Promise.all(Object.keys(game.Engine.FONT_PROPERTIES).map(function(a){return document.fonts.load(game.Engine.FONT_PROPERTIES[a].font)}))},runLoadResources:function(a){Promise.all([this.loadFonts(),resources.utility.ImageLoader.INSTANCE.run(),resources.utility.AudioLoader.INSTANCE.run(a.audio)]).then(this.runCheckAudio.bind(this,a))},runCheckAudio:function(a){if("suspended"==
a.audio.state){const b=document.getElementsByTagName("div")[0],c=function(){window.removeEventListener("click",c);b.style.display="none";(new this.Runner(a)).run()}.bind(this);b.style.display="initial";window.addEventListener("click",c)}else(new this.Runner(a)).run()},AvContext:function(){this.audio=new AudioContext},CapturedAvContext:function(a,b,c){this.fps=a;this.sampleRate=b;this.duration=c;this.audio=new OfflineAudioContext(2,b*c,b)},Runner:function(a){this.motor=new physics.actors.Motor;this.engine=
this.newEngine(a);this.filters=new physics.collections.Ordered;this.keyboardControls=this.newKeyboardControls();this.tutorial=this.newTutorial();this.confirmer=this.newConfirmer();this.loader=this.newLoader();this.obstacles=this.newObstacles();this.locator=this.newLocator();this.menu=this.newMenu();this.cargoTracker=this.newCargoTracker();this.setUp()}},collisions:{Matchers:function(a){this.view=a;this.emitterQueues=new physics.collections.Ordered;this.clearanceToggle=new physics.actors.Toggle;this.loadToggle=
new physics.actors.Toggle;this.obstacleToggle=new physics.actors.Toggle;this.clearanceMerger=physics.collisions.mergers.collision(this.clearanceToggle.handler(!0));this.loadMerger=physics.collisions.mergers.collision(this.loadToggle.handler(!0));this.obstacleCheckMerger=physics.collisions.mergers.collision(this.obstacleToggle.handler(!0));this.frictionMultipliers=new physics.collections.Ordered;this.frictionalsVehicleScenery=game.collisions.Matchers.newFrictionalsVehicleScenery();this.chassisEnvironmentHandlers=
new physics.collections.Ordered;this.chassisEnvironmentHandlers.add(this.frictionalsVehicleScenery.CHASSIS_ENVIRONMENT.handler());this.chassisObstacleHandlers=new physics.collections.Ordered;this.chassisObstacleHandlers.add(this.frictionalsVehicleScenery.CHASSIS_OBSTACLE.handler());this.chassisCargoHandlers=new physics.collections.Ordered;this.chassisCargoHandlers.add(this.frictionalsVehicleScenery.CHASSIS_CARGO.handler());this.wheelEnvironmentHandlers=new physics.collections.Ordered;this.wheelEnvironmentHandlers.add(this.frictionalsVehicleScenery.WHEEL_ENVIRONMENT.handler());
this.wheelObstacleHandlers=new physics.collections.Ordered;this.wheelObstacleHandlers.add(this.frictionalsVehicleScenery.WHEEL_OBSTACLE.handler());this.environmentCargoHandlers=new physics.collections.Ordered;this.environmentCargoHandlers.add(game.collisions.Matchers.FRICTIONALS.ENVIRONMENT_CARGO.handler());this.environmentObstacleHandlers=new physics.collections.Ordered;this.environmentObstacleHandlers.add(physics.interaction.handlers.cast(game.collisions.Matchers.FRICTIONALS.ENVIRONMENT_OBSTACLE.handler(),
.02));this.chassis=new physics.tracking.matchers.Mapping;this.wheel=new physics.tracking.matchers.Mapping;this.cargoes=new physics.collections.Ordered;this.environment=new physics.tracking.matchers.Mapping;this.clearance=new physics.tracking.matchers.Mapping;this.load=new physics.tracking.matchers.Mapping;this.unload=new physics.tracking.matchers.Mapping;this.obstacles=new physics.collections.Ordered;this.obstacleCheck=new physics.tracking.matchers.Mapping;this.define()},Obstacles:function(a){this.matchers=
a;this.reset()},EmitterParams:function(a,b,c,d,e,f,g,h,k,l,m,n,p,q){this.resources=a;this.rotation=b;this.dispersion=c;this.strengthHorizontalAbs=d;this.strengthHorizontalRel=e;this.strengthVertical=f;this.strengthLimit=g;this.intensityThreshold=h;this.intensityLimit=k;this.interval=l;this.gravity=m;this.inDuration=n;this.outDuration=p;this.gain=q},EmitterContext:function(a,b,c){this.params=a;this.audioContext=b;this.view=c;this.start()}},loading:{Loader:function(a,b,c,d){this.matchers=a;this.credits=
b;this.keyboardControls=c;this.tutorial=d;this.fixture=physics.interaction.Fixture.stationary(physics.dynamics.Vector.ZERO);this.animation=physics.dynamics.Particle.infiniteMass(physics.dynamics.Motion.ZERO);this.animators=new physics.collections.Ordered;this.bounds=new physics.collections.Ordered;this.cargoes=new physics.collections.Ordered;this.bundle=new physics.collections.Bundle;this.controlsBundle=new physics.collections.Bundle},Animator:function(a,b,c){this.loader=a;this.cargo=b;this.cargoData=
c;this.graphics=new physics.collections.Ordered;this.animation=physics.dynamics.Particle.infiniteMass(physics.dynamics.Motion.ZERO);this.cancelable=new physics.actors.animation.Cancelable},Animation:function(a,b,c){this.fillStyle=a;this.inDuration=b;this.outDuration=c}},hud:{Menu:function(a,b,c,d){this.loader=a;this.obstacles=b;this.locator=c;this.motor=d;this.flash=new game.hud.Flash(c.view.engine,.5);this.tunings=game.hud.Menu.newTunings();this.difficulties=game.hud.Menu.newDifficulties();this.vehicleSelector=
game.hud.Menu.newVehicleSelector();this.scenerySelector=game.hud.Menu.newScenerySelector();this.vehicleBuilder=this.newVehicleBuilder();this.sceneryBuilder=this.newSceneryBuilder();this.deliveries=game.hud.Menu.newDeliveries();this.deliveryBundle=new physics.collections.Bundle;this.unlockedBundle=new physics.collections.Bundle;this.lockedBundle=new physics.collections.Bundle;this.tuningBundle=new physics.collections.Bundle;this.titleBundle=new physics.collections.Bundle;this.background=new physics.collections.Ordered;
this.foreground=new physics.collections.Ordered;this.rightGraphics=this.newRightGraphics();this.verifyDeliveryTargets();this.addMultiplierGraphics();this.removeTitleGraphics();this.tutorials()},Flash:function(a,b){this.engine=a;this.animation=physics.dynamics.Particle.infiniteMass(physics.dynamics.Motion.ZERO);this.timer=new physics.actors.animation.Timer(b,0);this.bundle=new physics.collections.Bundle},Property:function(a,b,c,d){this.path=a;this.serializer=b;this.deserializer=c;this.original=d;game.hud.Property.MAP.set(game.hud.Property.joinPath(a),
this)},Selector:function(a,b,c){this.title=a;this.list=b;this.property=c;this.reset()},Tuning:function(a,b,c,d,e,f,g){this.name=a;this.title=b;this.maxValue=c;this.allowNegative=d;this.valueProperty=e;this.lockedProperty=f;this.costEvaluator=g;this.reset()},Difficulty:function(a,b,c,d,e){this.name=a;this.maxValue=b;this.maxMultiplier=c;this.target=d;this.property=e;this.confirm()},CargoTracker:function(a){this.menu=a;this.bundle=new physics.collections.Bundle;this.reset()},Credits:function(a){this.engine=
a;this.property=game.hud.Property.integerRange(["credits"],game.hud.Credits.MIN_AMOUNT,game.hud.Credits.MAX_AMOUNT,0);this.graphics=new physics.collections.Ordered;this.outlines=new physics.collections.Ordered;this.multiplier=1;this.digits=[];this.coins=this.newCoins();this.updateDigits()},Coin:function(a,b){this.credits=a;this.origin=b.y;this.particle=a.newParticle(b);this.addParticle();this.addGraphics();this.groundY(b.y)},Digit:function(a,b,c){this.credits=a;this.character=b;this.origin=c.y;this.particle=
a.newParticle(c);this.bundleX=new physics.collections.Bundle;this.bundle=new physics.collections.Bundle;this.addBundle();this.groundX(c.x);this.groundY(c.y)},Locator:function(a){this.view=a;this.origins=new physics.collections.Ordered;this.ranges=new physics.collections.Ordered;this.graphics=new physics.collections.Ordered;this.bundle=new physics.collections.Bundle;this.addTrack()},Confirmer:function(a){this.engine=a;this.cancelable=new physics.actors.animation.Cancelable},Button:function(a,b,c,d,
e){this.engine=a;this.graphic=c.graphic;this.filter=physics.actors.input.filters.bounds(this.graphic);this.button=this.newButton(d);this.handler=this.newHandler(this.filterOverlapping.bind(this),e);this.registrator=this.handler.registrator();this.bundle=(new physics.collections.Bundle).add(b,this.filter).addBundle(c.bundle);this.register()},Pedal:function(a,b,c,d,e,f,g){this.engine=a;this.motor=e;this.shift=0;this.particle=physics.dynamics.Particle.oneMass(physics.dynamics.Motion.ZERO);this.graphic=
this.newGraphic(c.graphic,d);this.button=this.newButton(e,f);this.handler=this.newHandler(g);this.registrator=this.handler.registrator();this.bundle=(new physics.collections.Bundle).add(b,physics.actors.input.filters.bounds(this.graphic)).addBundle(c.bundle);this.linkBundle=new physics.collections.Bundle;this.link(0);this.add()},KeyboardControls:function(a){this.engine=a;this.collection=new physics.collections.Ordered;this.active=!1;this.animation=physics.dynamics.Particle.infiniteMass(physics.dynamics.Motion.ZERO);
this.timer=new physics.actors.animation.Timer(game.Engine.FADE_DURATION,0);this.cancelable=new physics.actors.animation.Cancelable;this.activationListener=this.activate.bind(this);this.deactivationListener=this.deactivate.bind(this)},Tutorial:function(a,b,c){this.engine=a;this.filters=b;this.keyboardControls=c;this.queue=[]},TutorialBox:function(a,b,c,d,e,f,g,h){this.id=a;this.order=b;this.image=c;this.absolute=d;this.relative=e;this.margin=f;this.alignment=g;this.keysAbsolute=h;game.hud.TutorialBox.property(a)}},
graphics:{BackgroundGraphic:function(a,b,c){this.context=a;this.graphic=b;this.height=c},BackgroundOffset:function(a,b,c,d){this.context=a;this.graphic=b;this.height=c;this.alpha=d},ParallaxBackground:function(a,b,c,d){this.camera=a;this.graphic=b;this.size=c;this.multiplier=d},ParallaxImage:function(a,b,c,d,e){this.camera=a;this.image=b();this.origin=c;this.range=d;this.multiplier=e;this.pattern=a.context.context2d.createPattern(b(),"no-repeat")},RepeatedGraphic:function(a,b,c){this.context=a;this.graphic=
b;this.size=c},RepeatedImageX:function(a,b,c){this.context=a;this.image=b();this.size=c;this.pattern=a.context2d.createPattern(b(),"repeat-x")},RepeatedImage:function(a,b,c,d,e,f){this.context=a;this.height=c;this.size=d;this.particle=e;this.mapper=f;this.pattern=a.context2d.createPattern(b(),"repeat")},depthsOf:function(a){const b={};a.forEach(function(c,d){for(var e=b,f=0;f<c.length-1;f++)e.hasOwnProperty(c[f])||(e[c[f]]={}),e=e[c[f]];e[c[c.length-1]]=d});return b}}};
game.Engine.STIFF_ELASTICITY=new physics.interaction.Elasticity(.2,.5);game.Engine.SINGULARITY=new physics.interaction.Singularity(.01);game.Engine.FADE_DURATION=.2;game.Engine.TAP_DISTANCE=16;game.Engine.TAP_DURATION=.25;game.Engine.PULSE_DURATION=.5;game.Engine.AUDIO_GAIN=.6;game.Engine.COLORS={WHITE:"#fff",BLACK:"#000",RED:"#f44",BLUE:"#44f",GRAY:"#666"};game.Engine.FONT_FAMILY="'New Era Casual Regular'";
game.Engine.FONT_PROPERTIES={DEBUGGING:{font:"36px "+game.Engine.FONT_FAMILY,fillStyle:game.Engine.COLORS.BLACK,textAlign:"left",textBaseline:"middle"},CREDITS:{font:"112px "+game.Engine.FONT_FAMILY,fillStyle:game.Engine.COLORS.WHITE,strokeStyle:game.Engine.COLORS.BLACK,lineWidth:16,textAlign:"center",textBaseline:"middle"},UNLOCK:{font:"bold 72px "+game.Engine.FONT_FAMILY,fillStyle:game.Engine.COLORS.GRAY,textAlign:"center",textBaseline:"middle"},MENU_LARGE:{font:"72px "+game.Engine.FONT_FAMILY,
fillStyle:game.Engine.COLORS.WHITE,strokeStyle:game.Engine.COLORS.BLACK,lineWidth:16,textAlign:"center",textBaseline:"middle"},MENU_SMALL:{font:"56px "+game.Engine.FONT_FAMILY,fillStyle:game.Engine.COLORS.WHITE,strokeStyle:game.Engine.COLORS.BLACK,lineWidth:16,textBaseline:"middle"}};
game.Engine.FONT_WIDTH_PER_PX={0:.5302734375,1:.3193359375,2:.4619140625,3:.462890625,4:.53173828125,5:.4677734375,6:.517578125,7:.439453125,8:.50634765625,9:.517578125," ":.18994140625,"!":.22216796875,'"':.34326171875,"#":.7685546875,$:.49658203125,"%":.767578125,"\x26":.64794921875,"'":.17724609375,"(":.29248046875,")":.29248046875,"*":.443359375,"+":.4609375,",":.2060546875,"-":.34423828125,".":.18505859375,"/":.3046875,":":.18505859375,";":.21533203125,"\x3c":.47314453125,"\x3d":.3447265625,
"\x3e":.47802734375,"?":.4755859375,"@":.85546875,A:.4765625,B:.4814453125,C:.4951171875,D:.49853515625,E:.423828125,F:.40087890625,G:.505859375,H:.49365234375,I:.17626953125,J:.43994140625,K:.46923828125,L:.423828125,M:.6923828125,N:.5185546875,O:.5400390625,P:.494140625,Q:.5302734375,R:.48779296875,S:.49658203125,T:.48388671875,U:.5107421875,V:.46630859375,W:.74169921875,X:.49951171875,Y:.52001953125,Z:.44921875,"[":.2841796875,"\\":.3046875,"]":.2890625,"^":.51220703125,_:.39306640625,"`":.26220703125,
a:.470703125,b:.4873046875,c:.4443359375,d:.4765625,e:.46044921875,f:.427734375,g:.50634765625,h:.4755859375,i:.197265625,j:.2353515625,k:.44287109375,l:.17626953125,m:.7529296875,n:.46484375,o:.466796875,p:.4765625,q:.4873046875,r:.35546875,s:.42724609375,t:.408203125,u:.46484375,v:.39453125,w:.66064453125,x:.4677734375,y:.47021484375,z:.4013671875,"{":.4375,"|":.16064453125,"}":.4375,"~":.53271484375};
game.Engine.extractFontSize=function(a){return a.font.split(" ").filter(function(b){return b.endsWith("px")}).map(function(b){return parseInt(b.slice(0,-2))}).filter(function(b){return!isNaN(b)})[0]};game.Engine.measureWidth=function(a,b){for(var c=0,d=0;d<a.length;d++)c+=game.Engine.FONT_WIDTH_PER_PX[a[d]]||0;return c*game.Engine.extractFontSize(b)};game.Engine.stiffFrictional=function(a){return new physics.interaction.Frictional(game.Engine.STIFF_ELASTICITY,a)};
game.Engine.orderedControlSurface=function(a,b){physics.collections.Sorted.withOrder(a.graphic,b);return a};game.Engine.prototype.newRendering=function(){return new physics.rendering.Context(this.canvas.getContext("2d"),new physics.Context(.005,this.particles,physics.actors.nonZero(physics.actors.container(this.actors))))};game.Engine.prototype.addParticle=function(){this.particles.add(this.pulseAnimation)};
game.Engine.prototype.addDebugging=function(){this.originalActor=this.rendering.physics.actor;this.rendering.physics.actor=physics.actors.warnDangling(this.originalActor,this.particles)};game.Engine.prototype.removeDebugging=function(){this.rendering.physics.actor=this.originalActor;delete this.originalActor};game.Engine.prototype.addGraphics=function(){this.graphics.add(physics.collections.Sorted.withOrder(new physics.rendering.graphics.Clearer(this.rendering),game.graphics.depths.GAME))};
game.Engine.prototype.newTextGraphic=function(a,b){return physics.rendering.graphics.Container.fixed([new physics.rendering.graphics.text.Stroker(this.rendering,a,b),new physics.rendering.graphics.text.Filler(this.rendering,a,b)])};
game.Engine.prototype.newPulseTextGraphic=function(a,b){return physics.rendering.graphics.Container.fixed([new physics.rendering.graphics.ColorProperty(this.rendering,this.pulseAnimation,physics.rendering.mappers.WAVE_01,"fillStyle",physics.rendering.Color.fromCss(game.Engine.COLORS.WHITE),physics.rendering.Color.fromCss(game.Engine.COLORS.RED)),this.newTextGraphic(a,b)])};
game.Engine.prototype.newPulseGraphic=function(a,b){return new physics.rendering.graphics.Alpha(this.rendering,a,this.pulseAnimation,b)};game.Engine.prototype.newBackgroundFiller=function(a){return physics.rendering.graphics.Container.fixed([new physics.rendering.graphics.path.Beginner(this.rendering),new physics.rendering.graphics.Background(this.rendering),new physics.rendering.graphics.Properties(this.rendering,{fillStyle:a}),new physics.rendering.graphics.path.Filler(this.rendering)])};
game.Engine.prototype.newFittedControlSurface=function(a,b){return{graphic:new physics.rendering.graphics.Fitted(this.rendering,a.graphic,game.View.REF_SIZE,b),bundle:a.bundle}};
game.Engine.prototype.newFadingControlSurfaceFactory=function(a){const b=physics.dynamics.Particle.infiniteMass(physics.dynamics.Motion.ZERO),c=new physics.actors.animation.Timer(a,0),d=new physics.collections.Bundle;return function(e){d.release();return{graphic:new physics.rendering.graphics.Alpha(this.rendering,e.graphic,b,physics.rendering.mappers.WAVE_01),bundle:e.bundle.addBundle(d.add(this.particles,b).addAll(this.actors,[c.elapsedActor(function(){d.release()}),physics.actors.animation.Transition.zeroPi(c,
b).actor()]))}}.bind(this)};game.Engine.prototype.newControlSurface=function(a,b,c,d,e,f,g){const h=a.bounds();a=new physics.rendering.graphics.Margin(a,b);b=new physics.collections.Ordered;b.add(a);return{graphic:new physics.rendering.graphics.Separator(a,physics.rendering.graphics.Container.variable(b)),bundle:c.add(this.newImage(d,h.min.add(e).add(h.size().multiplyVector(g)),f),b)}};
game.Engine.prototype.newImage=function(a,b,c){return physics.rendering.graphics.Image.fromOrigin(this.rendering,a(),b).addRelative(c)};game.Engine.prototype.fireAudio=function(a){const b=new GainNode(this.avContext.audio,{gain:game.Engine.AUDIO_GAIN});b.connect(this.avContext.audio.destination);a=new AudioBufferSourceNode(this.avContext.audio,{buffer:a()});a.connect(b);a.onended=function(){b.disconnect()};a.start()};
game.Engine.prototype.queueUpdateSize=function(){this.preUpdateQueue.push(function(){this.canvas.width=window.innerWidth*window.devicePixelRatio;this.canvas.height=window.innerHeight*window.devicePixelRatio}.bind(this))};game.Engine.prototype.preUpdate=function(){for(;this.preUpdateQueue.length;)this.preUpdateQueue.pop().call(null)};
game.Engine.prototype.attach=function(){this.queueUpdateSize();var a=null,b=this.avContext.run(this);window.addEventListener("resize",this.queueUpdateSize.bind(this));window.addEventListener("visibilitychange",function(){"visible"==document.visibilityState?a&&(b=a(),a=null):b&&(a=b(),b=null)}.bind(this))};game.View.REF_SIZE=new physics.dynamics.Vector(1920,1080);game.View.PX_PER_M=200;game.View.GRAVITY=9.81*game.View.PX_PER_M;game.View.MOTION_SCALING=2E-4;game.View.NORMAL_DISTANCE=10*game.View.PX_PER_M;
game.View.CAMERA_OFFSET=new physics.dynamics.Vector(.515,.63);game.View.COLLISION_TRACKING_SIZE=(new physics.dynamics.Vector(.5,.5)).multiply(game.View.PX_PER_M);game.View.GRAPHIC_TRACKING_SIZE=(new physics.dynamics.Vector(game.View.REF_SIZE.x/4,0)).add(sceneries.utility.Builder.TERRAIN_HEIGHT);game.View.COLLISION_TRACKING_MARGIN=physics.dynamics.Rectangle.symmetric(physics.dynamics.Vector.fromOne(.1).multiply(game.View.PX_PER_M));game.View.GRAPHIC_TRACKING_MARGIN=physics.dynamics.Rectangle.symmetric(physics.dynamics.Vector.fromOne(25));
game.View.prototype.sceneryScaling=function(){return this.scalings.values().reduce(physics.utility.multiply,1)};game.View.prototype.scaledRefSize=function(){return this.sceneryScaling()*game.View.REF_SIZE.length()};game.View.prototype.cameraDepth=function(a){return game.View.NORMAL_DISTANCE*(this.sceneryScaling()+game.View.MOTION_SCALING*a.velocity.translation.length())};game.View.prototype.cameraScale=function(a){return game.View.REF_SIZE.length()/(game.View.NORMAL_DISTANCE*a.length())};
game.View.prototype.audioHandler=function(a){return physics.interaction.handlers.audio(this.engine.avContext.audio,this.camera,a(),game.View.NORMAL_DISTANCE,.2,1*game.View.PX_PER_M,8*game.View.PX_PER_M)};game.View.prototype.fireAudio=function(a,b){this.camera.fireAudio(this.engine.avContext.audio,a,.8*game.View.NORMAL_DISTANCE,b())};
game.View.prototype.newGravity=function(a,b){return physics.actors.constant([new physics.interaction.Action(a,physics.dynamics.Transformation.fromTranslation(new physics.dynamics.Vector(0,b)))])};game.View.prototype.newDefaultGravity=function(a){return this.newGravity(a,game.View.GRAVITY)};game.View.prototype.addGravityParticle=function(a,b){return(new physics.collections.Bundle).add(this.engine.particles,a).add(this.engine.actors,this.newGravity(a,b))};
game.View.prototype.addDefaultGravityParticle=function(a){return this.addGravityParticle(a,game.View.GRAVITY)};game.View.prototype.newCamera=function(){return new physics.rendering.perspective.Camera(this.engine.rendering,physics.dynamics.Particle.oneMass(physics.dynamics.Motion.ZERO),this.cameraDepth.bind(this),this.cameraScale.bind(this),game.View.CAMERA_OFFSET)};game.View.prototype.addCamera=function(){this.engine.particles.add(this.camera.particle);this.graphics.add(this.camera)};
game.View.prototype.addGraphics=function(){physics.collections.addAll(this.engine.graphics,[physics.collections.Sorted.withOrder(physics.rendering.graphics.Container.variable(this.background),game.graphics.depths.GAME),physics.collections.Sorted.withOrder(new physics.rendering.perspective.Transformer(this.graphics.graphic(),this.camera),game.graphics.depths.GAME)])};game.View.prototype.centerCamera=function(a){this.camera.particle.reset(physics.dynamics.Motion.fromPosition(physics.dynamics.Transformation.fromTranslation(a.transformOrigin())))};
game.View.prototype.follow=function(a){const b=new physics.collections.Ordered,c=physics.interaction.Fixture.stationary(physics.dynamics.Vector.ZERO);this.centerCamera(a);return(new physics.collections.Bundle).add(this.engine.actors,physics.actors.container(b)).addAll(b,[physics.actors.tracer(a,c,200,1.5),physics.actors.projection2(c,physics.interaction.Fixture.centroid(this.camera.particle),physics.interaction.handlers.elasticity(new physics.interaction.Elasticity(.02,1)))])};
game.bootstrap.AvContext.CAPTURED_REG_EXP=/capture\((\d+),(\d+),(\d+)\)/;game.bootstrap.AvContext.build=function(){const a=window.location.search.match(game.bootstrap.AvContext.CAPTURED_REG_EXP);return a?new game.bootstrap.CapturedAvContext(parseInt(a[1]),parseInt(a[2]),parseInt(a[3])):new game.bootstrap.AvContext};
game.bootstrap.AvContext.prototype.run=function(a){const b=function(c){this.audio.resume();return function(d){this.audio.suspend();d();return b}.bind(this,a.rendering.run(c,a.preUpdate.bind(a)))}.bind(this,physics.rendering.graphics.Container.variable(a.graphics));return b()};game.bootstrap.CapturedAvContext.READY_COUNT=3;
game.bootstrap.CapturedAvContext.audioBufferToPcm=function(a){const b=[];for(var c=0;c<a.numberOfChannels;c++)b.push(a.getChannelData(c));const d=new Float32Array(a.length*a.numberOfChannels);for(c=0;c<a.length;c++)b.forEach(function(e,f){d[c*a.numberOfChannels+f]=e[c]});return d};game.bootstrap.CapturedAvContext.downloadBlobs=function(a){a=new Blob(a,{type:"application/octet-stream"});window.open(URL.createObjectURL(a));URL.revokeObjectURL(a)};
game.bootstrap.CapturedAvContext.prototype.makeReady=function(a){++a.readyCount>=game.bootstrap.CapturedAvContext.READY_COUNT&&this.step(a)};game.bootstrap.CapturedAvContext.prototype.toggleCanvasCapture=function(a,b){"F9"===b.code&&(a.doCaptureCanvas=!a.doCaptureCanvas)};
game.bootstrap.CapturedAvContext.prototype.prepare=function(a){a.engine.preUpdate();a.engine.canvas.toBlob(function(b){a.emptyBlob=b;this.makeReady(a)}.bind(this));this.audio.suspend(a.currentTime).then(this.makeReady.bind(this,a));this.audio.startRendering().then(function(b){game.bootstrap.CapturedAvContext.downloadBlobs(a.canvasBlobs);game.bootstrap.CapturedAvContext.downloadBlobs([game.bootstrap.CapturedAvContext.audioBufferToPcm(b)]);a.readyCount--})};
game.bootstrap.CapturedAvContext.prototype.step=function(a){a.readyCount-=game.bootstrap.CapturedAvContext.READY_COUNT;a.engine.preUpdate();a.engine.rendering.update(1/this.fps);a.engine.rendering.render(a.graphic);a.currentTime+=1/this.fps;a.currentTime<this.duration&&this.audio.suspend(a.currentTime).then(this.makeReady.bind(this,a));this.audio.resume();a.doCaptureCanvas?a.engine.canvas.toBlob(function(b){a.canvasBlobs.push(b);this.makeReady(a)}.bind(this)):(a.canvasBlobs.push(a.emptyBlob),this.makeReady(a));
setTimeout(this.makeReady.bind(this,a),1E3/this.fps)};game.bootstrap.CapturedAvContext.prototype.alert=function(){alert(["Capture video at ",this.fps," fps and audio at ",this.sampleRate," Hz for ",this.duration," seconds"].join(""))};
game.bootstrap.CapturedAvContext.prototype.run=function(a){const b={engine:a,graphic:physics.rendering.graphics.Container.variable(a.graphics),currentTime:this.audio.currentTime,canvasBlobs:[],readyCount:0,doCaptureCanvas:!1};this.alert();this.prepare(b);const c=this.toggleCanvasCapture.bind(this,b),d=function(){window.addEventListener("keydown",c);this.makeReady(b);return function(){window.removeEventListener("keydown",c);b.readyCount--;return d}}.bind(this);return d()};
game.bootstrap.Runner.UNLOCK_BUTTON_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x/2,320);game.bootstrap.Runner.prototype.setUp=function(){this.initializeFading();this.addGraphics();this.addParticles();this.addActors();this.addGameGraphics();this.tutorial.open(game.hud.TutorialBox.INTRO);this.menu.update();this.menu.resetScenery()};game.bootstrap.Runner.prototype.newEngine=function(a){return new game.Engine(document.getElementsByTagName("canvas")[0],a)};
game.bootstrap.Runner.prototype.newKeyboardControls=function(){return new game.hud.KeyboardControls(this.engine)};game.bootstrap.Runner.prototype.newTutorial=function(){return new game.hud.Tutorial(this.engine,this.filters,this.keyboardControls)};game.bootstrap.Runner.prototype.newConfirmer=function(){return new game.hud.Confirmer(this.engine)};
game.bootstrap.Runner.prototype.newLoader=function(){return new game.loading.Loader(new game.collisions.Matchers(new game.View(this.engine)),new game.hud.Credits(this.engine),this.keyboardControls,this.tutorial)};game.bootstrap.Runner.prototype.newObstacles=function(){return new game.collisions.Obstacles(this.loader.matchers)};game.bootstrap.Runner.prototype.newLocator=function(){return new game.hud.Locator(this.loader.matchers.view)};
game.bootstrap.Runner.prototype.newMenu=function(){return new game.hud.Menu(this.loader,this.obstacles,this.locator,this.motor)};game.bootstrap.Runner.prototype.newCargoTracker=function(){return new game.hud.CargoTracker(this.menu)};game.bootstrap.Runner.prototype.addGameGraphics=function(){this.addMenuButton();this.addRestartButton();this.addBrakePedal();this.addGasPedal();this.resetFading();this.locator.addGraphics();this.loader.addControls(this.cargoTracker,this.newLoaderFilter())};
game.bootstrap.Runner.prototype.removeGameGraphics=function(){this.loader.removeControls();this.locator.removeGraphics();this.menuButton.release();this.restartButton.release();this.brakePedal.release();this.gasPedal.release()};
game.bootstrap.Runner.prototype.addMainModeButtons=function(){this.addExitButton();this.addExportButton();this.addImportButton();this.tutorial.open(game.hud.TutorialBox.IO);this.mainModeButtons=this.newButtonGrid([[{image:resources.hud.buttons.mode.main.vehicle,label:this.menu.vehicleSelector.countUnlockable(this.menu.loader.credits),action:this.addSelector.bind(this,this.menu.vehicleSelector,this.menuUpdateVehicle.bind(this))},{image:resources.hud.buttons.mode.main.scenery,label:this.menu.scenerySelector.countUnlockable(this.menu.loader.credits),
action:this.addSelector.bind(this,this.menu.scenerySelector,this.menuUpdateScenery.bind(this))},{image:resources.hud.buttons.mode.main.tuning,label:this.menu.selectedTunings().filter(function(a){return 0<a.countUnlockable(this.menu.loader.credits)}.bind(this)).length,action:function(){this.removeMainModeButtons();this.addTuningModeButtons()}}]]);this.resetFading()};
game.bootstrap.Runner.prototype.removeMainModeButtons=function(){this.exitButton.release();this.exportButton.release();this.importButton.release();this.confirmer.cancel();this.tutorial.close(game.hud.TutorialBox.IO);this.removeButtonGrid(this.mainModeButtons)};
game.bootstrap.Runner.prototype.addTuningModeButtons=function(){this.addBackButton(function(){this.removeTuningModeButtons();this.addMainModeButtons()});this.tuningModeButtons=this.newButtonGrid([[this.newTuningCell(resources.hud.buttons.mode.tuning.speed,0),this.newTuningCell(resources.hud.buttons.mode.tuning.stiffness,3),this.newTuningCell(resources.hud.buttons.mode.tuning.traction,2)],[this.newTuningCell(resources.hud.buttons.mode.tuning.acceleration,1),this.newTuningCell(resources.hud.buttons.mode.tuning.damping,
4),this.newTuningCell(resources.hud.buttons.mode.tuning.height,5)]]);this.resetFading()};game.bootstrap.Runner.prototype.removeTuningModeButtons=function(){this.backButton.release();this.removeButtonGrid(this.tuningModeButtons)};
game.bootstrap.Runner.prototype.addSelector=function(a,b){this.removeMainModeButtons();this.menu.addTitleGraphics("Select "+a.title);this.addBackButton(function(){const c=a.index;a.reset();c!=a.index&&b();this.backButton.release();this.leftButton.release();this.rightButton.release();this.menu.removeTitleGraphics();this.addMainModeButtons()});this.addLeftButton(resources.hud.buttons.select.previous,function(){a.previous();b()});this.addRightButton(resources.hud.buttons.select.next,function(){a.next();
b()});this.resetFading()};game.bootstrap.Runner.prototype.newTuningCell=function(a,b){b=this.menu.selectedTunings()[b];return{image:a,label:b.countUnlockable(this.menu.loader.credits),action:this.addTuning.bind(this,b)}};
game.bootstrap.Runner.prototype.addTuning=function(a){delete this.leftButton;delete this.rightButton;this.removeTuningModeButtons();this.menu.addTitleGraphics("Tune "+a.title);this.addBackButton(function(){const b=a.value;a.reset();b!=a.value&&(this.menu.resetVehicle(),this.menu.update(),this.removeUnlockButton());this.backButton.release();this.leftButton&&this.leftButton.release();this.rightButton&&this.rightButton.release();this.menu.removeTuningGraphics();this.menu.removeTitleGraphics();this.addTuningModeButtons()});
a.canDecrement()&&this.addTuningLeftButton(a);a.canIncrement()&&this.addTuningRightButton(a);this.menu.addTuningGraphics(a);this.resetFading()};game.bootstrap.Runner.prototype.updateTuning=function(a){this.menu.updateVehicleSetupSingle(a);this.menu.updateTuningGraphics(a);this.updateUnlockButton(a,this.menu.updateTuningGraphics.bind(this.menu,a));this.resetFading()};
game.bootstrap.Runner.prototype.addTuningLeftButton=function(a){this.addLeftButton(resources.hud.buttons.select.decrement,function(){a.canIncrement()||this.addTuningRightButton(a);a.decrement();a.canDecrement()||(this.leftButton.release(),delete this.leftButton);this.updateTuning(a)})};
game.bootstrap.Runner.prototype.addTuningRightButton=function(a){this.addRightButton(resources.hud.buttons.select.increment,function(){a.canDecrement()||this.addTuningLeftButton(a);a.increment();a.canIncrement()||(this.rightButton.release(),delete this.rightButton);this.updateTuning(a)})};game.bootstrap.Runner.prototype.menuUpdateVehicle=function(){this.menu.resetVehicle();this.menu.update();this.updateUnlockButton(this.menu.vehicleSelector,function(){});this.resetFading()};
game.bootstrap.Runner.prototype.menuUpdateScenery=function(){this.menu.flash.doWaiting(function(){this.menu.resetScenery();this.menu.update();this.updateUnlockButton(this.menu.scenerySelector,function(){});this.resetFading()}.bind(this))};game.bootstrap.Runner.prototype.initializeFading=function(){this.controlSurfaceFading=function(a){return a}};game.bootstrap.Runner.prototype.resetFading=function(){this.controlSurfaceFading=this.engine.newFadingControlSurfaceFactory(game.Engine.FADE_DURATION)};
game.bootstrap.Runner.prototype.newButton=function(a,b,c,d,e,f,g,h,k,l){return new game.hud.Button(this.engine,this.filters,game.Engine.orderedControlSurface(this.controlSurfaceFading(this.engine.newFittedControlSurface(this.engine.newControlSurface(a,game.hud.Button.MARGIN,this.keyboardControls,e,f,g,h),k)),c),function(m){(m=l.call(this)||b)&&this.engine.fireAudio(m);return[]}.bind(this),d)};
game.bootstrap.Runner.prototype.newButtonLabel=function(a,b){return physics.rendering.graphics.Container.separated([a,new physics.rendering.graphics.Properties(this.engine.rendering,{textAlign:"center"}),this.engine.newPulseTextGraphic(a.bounds().min.add(physics.dynamics.Vector.fromOne(16)),function(c){return c}.bind(null,"("+b+")"))],0)};
game.bootstrap.Runner.prototype.addRestartButton=function(){this.restartButton=this.newButton(this.engine.newImage(resources.hud.buttons.game.restart,new physics.dynamics.Vector(304,-game.hud.Button.MARGIN.min.y),physics.dynamics.Vector.ZERO),resources.hud.buttons.game.sound,game.graphics.depths.HUD.GAME,["Enter","Tab"],resources.hud.keys.enterTab,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-.5,-1),new physics.dynamics.Vector(1,1.1),physics.rendering.graphics.Fitted.UPPER_LEFT,function(){if(this.confirmer.showCargoLost(this.cargoTracker,
"restart"))this.cargoTracker.confirmRestartTutorial(),game.hud.Difficulty.confirmAll(this.menu.selectedDifficulties()),this.menu.update(),this.menu.flash.doWaiting(this.menu.resetScenery.bind(this.menu));else return resources.hud.buttons.game.confirm})};
game.bootstrap.Runner.prototype.addMenuButton=function(){this.menuButton=this.newButton(this.engine.newImage(resources.hud.buttons.game.menu,game.hud.Button.MARGIN.min.negate(),physics.dynamics.Vector.ZERO),resources.hud.buttons.game.sound,game.graphics.depths.HUD.GAME,["Escape","Backspace"],resources.hud.keys.escapeBackspace,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-.5,-1),new physics.dynamics.Vector(1,1.1),physics.rendering.graphics.Fitted.UPPER_LEFT,function(){if(this.confirmer.showCargoLost(this.cargoTracker,
"open menu"))this.cargoTracker.confirmRestartTutorial(),game.hud.Difficulty.confirmAll(this.menu.selectedDifficulties()),this.menu.resetVehicle(),this.menu.addGraphics(),this.menu.update(),this.removeGameGraphics(),this.addMainModeButtons(),this.menu.flash.trigger(game.hud.Flash.RESET_FILL_STYLE);else return resources.hud.buttons.game.confirm})};
game.bootstrap.Runner.prototype.newLeaveButton=function(a,b,c){return this.newButton(this.engine.newImage(a,game.hud.Button.MARGIN.min.negate(),physics.dynamics.Vector.ZERO),b,game.graphics.depths.HUD.MENU.FOREGROUND,["Escape","Backspace"],resources.hud.keys.escapeBackspace,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-.5,-1),new physics.dynamics.Vector(1,1.1),physics.rendering.graphics.Fitted.UPPER_LEFT,c)};
game.bootstrap.Runner.prototype.addExitButton=function(){this.exitButton=this.newLeaveButton(resources.hud.buttons.exit.image,resources.hud.buttons.exit.sound,function(){this.menu.flash.doWaiting(function(){this.removeMainModeButtons();this.addGameGraphics();this.menu.resetScenery();this.menu.removeGraphics()}.bind(this))})};game.bootstrap.Runner.prototype.addBackButton=function(a){this.backButton=this.newLeaveButton(resources.hud.buttons.back.image,resources.hud.buttons.back.sound,a)};
game.bootstrap.Runner.prototype.addExportButton=function(){this.exportButton=this.newButton(this.engine.newImage(resources.hud.buttons.io.export,game.View.REF_SIZE.subtract(new physics.dynamics.Vector(game.hud.Button.MARGIN.max.x,304)),new physics.dynamics.Vector(-1,-1)),resources.hud.cargo.unload,game.graphics.depths.HUD.GAME,["Delete"],resources.hud.keys.delete,physics.dynamics.Vector.ZERO,physics.rendering.graphics.Image.CENTER,new physics.dynamics.Vector(0,1),physics.rendering.graphics.Fitted.LOWER_RIGHT,
function(){this.tutorial.confirm(game.hud.TutorialBox.IO);navigator.clipboard.writeText(game.hud.Property.serialize());this.menu.flash.trigger(game.hud.Flash.SUCCESS_FILL_STYLE)})};
game.bootstrap.Runner.prototype.addImportButton=function(){this.importButton=this.newButton(this.engine.newImage(resources.hud.buttons.io.import,game.View.REF_SIZE.subtract(game.hud.Button.MARGIN.max),new physics.dynamics.Vector(-1,-1)),null,game.graphics.depths.HUD.GAME,["Insert"],resources.hud.keys.insert,physics.dynamics.Vector.ZERO,physics.rendering.graphics.Image.CENTER,new physics.dynamics.Vector(0,1),physics.rendering.graphics.Fitted.LOWER_RIGHT,function(){this.tutorial.confirm(game.hud.TutorialBox.IO);
this.confirmer.showImportOverwrite()&&navigator.clipboard.readText().then(function(a,b){game.hud.Property.deserialize(a)?location.reload():b()}.bind(this)).catch(function(){this.menu.flash.trigger(game.hud.Flash.FAILURE_FILL_STYLE);this.engine.fireAudio(resources.hud.buttons.unlock.sound.failure)}.bind(this))})};
game.bootstrap.Runner.prototype.newButtonGrid=function(a){const b=a.reduce(function(d,e){return Math.max(d,e.length)},0),c=a.length;return a.map(function(d,e){return d.map(function(f,g){const h=e*b+g;g=this.engine.newImage(f.image,new physics.dynamics.Vector(960+360*(g-(b-1)/2),720+360*(e-(c-1)/2)),physics.rendering.graphics.Image.CENTER);f.label&&(g=this.newButtonLabel(g,f.label));return this.newButton(g,resources.hud.buttons.mode.sound,game.graphics.depths.HUD.MENU.FOREGROUND,["Digit"+(h+1),"Numpad"+
(h+1)],resources.hud.keys.digits[h],physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-.75,-.75),new physics.dynamics.Vector(1,1),physics.rendering.graphics.Fitted.CENTER,f.action)}.bind(this))}.bind(this))};game.bootstrap.Runner.prototype.removeButtonGrid=function(a){a.forEach(function(b){b.forEach(function(c){c.release()})})};
game.bootstrap.Runner.prototype.addLeftButton=function(a,b){this.leftButton=this.newButton(this.engine.newImage(a,new physics.dynamics.Vector(-game.hud.Button.MARGIN.min.x,game.View.REF_SIZE.y-game.hud.Button.MARGIN.max.y),new physics.dynamics.Vector(0,-1)),resources.hud.buttons.select.sound,game.graphics.depths.HUD.MENU.FOREGROUND,["ArrowDown","ArrowLeft"],resources.hud.keys.arrowDownLeft,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-1,-1),new physics.dynamics.Vector(1,1),physics.rendering.graphics.Fitted.LOWER_LEFT,
b)};game.bootstrap.Runner.prototype.addRightButton=function(a,b){this.rightButton=this.newButton(this.engine.newImage(a,game.View.REF_SIZE.subtract(game.hud.Button.MARGIN.max),new physics.dynamics.Vector(-1,-1)),resources.hud.buttons.select.sound,game.graphics.depths.HUD.MENU.FOREGROUND,["ArrowUp","ArrowRight"],resources.hud.keys.arrowUpRight,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(0,-1),new physics.dynamics.Vector(0,1),physics.rendering.graphics.Fitted.LOWER_RIGHT,b)};
game.bootstrap.Runner.prototype.updateUnlockButton=function(a,b){a.isUnlocked()?this.removeUnlockButton():this.addUnlockButton(a.cost(),function(){a.unlock();b.call(this)})};
game.bootstrap.Runner.prototype.addUnlockButton=function(a,b){this.removeUnlockButton();const c=a<=this.menu.loader.credits.property.get();this.unlockButton=this.newButton(physics.rendering.graphics.Container.separated([this.engine.newImage(resources.hud.buttons.unlock.background,game.bootstrap.Runner.UNLOCK_BUTTON_ORIGIN,physics.rendering.graphics.Image.CENTER),new physics.rendering.graphics.Properties(this.engine.rendering,game.Engine.FONT_PROPERTIES.UNLOCK),new physics.rendering.graphics.text.Filler(this.engine.rendering,
game.bootstrap.Runner.UNLOCK_BUTTON_ORIGIN.add(new physics.dynamics.Vector(-48,4)),function(){return a}),this.engine.newImage(resources.hud.buttons.unlock.foreground,game.bootstrap.Runner.UNLOCK_BUTTON_ORIGIN,physics.rendering.graphics.Image.CENTER)],0),c?resources.hud.buttons.unlock.sound.success:resources.hud.buttons.unlock.sound.failure,game.graphics.depths.HUD.MENU.FOREGROUND,["ShiftLeft","ShiftRight"],resources.hud.keys.shift,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-.5,-1),new physics.dynamics.Vector(1,
1),physics.rendering.graphics.Fitted.UPPER_CENTER,c?function(){b.call(this);this.menu.loader.credits.addAmount(-a);this.menu.update();this.unlockButton.release();this.menu.flash.trigger(game.hud.Flash.SUCCESS_FILL_STYLE)}:function(){this.menu.flash.trigger(game.hud.Flash.FAILURE_FILL_STYLE)})};game.bootstrap.Runner.prototype.removeUnlockButton=function(){this.unlockButton&&(this.unlockButton.release(),delete this.unlockButton)};
game.bootstrap.Runner.prototype.addBrakePedal=function(){this.brakePedal=new game.hud.Pedal(this.engine,this.filters,this.controlSurfaceFading(this.engine.newControlSurface(this.engine.newImage(resources.hud.pedals.brake,new physics.dynamics.Vector(-game.hud.Button.MARGIN.min.x,game.View.REF_SIZE.y),new physics.dynamics.Vector(0,-1)),game.hud.Pedal.MARGIN,this.keyboardControls,resources.hud.keys.arrowDownLeft,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-.75,-.5),new physics.dynamics.Vector(1,
.4))),physics.rendering.graphics.Fitted.LOWER_LEFT,this.motor,-1,["ArrowDown","ArrowLeft"])};
game.bootstrap.Runner.prototype.addGasPedal=function(){this.gasPedal=new game.hud.Pedal(this.engine,this.filters,this.controlSurfaceFading(this.engine.newControlSurface(this.engine.newImage(resources.hud.pedals.gas,game.View.REF_SIZE.subtract(new physics.dynamics.Vector(game.hud.Button.MARGIN.max.x,0)),new physics.dynamics.Vector(-1,-1)),game.hud.Pedal.MARGIN,this.keyboardControls,resources.hud.keys.arrowUpRight,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-.55,-.5),new physics.dynamics.Vector(0,
.55))),physics.rendering.graphics.Fitted.LOWER_RIGHT,this.motor,1,["ArrowUp","ArrowRight"])};game.bootstrap.Runner.prototype.newLoaderFilter=function(){return physics.actors.input.filters.not(physics.actors.input.filters.anyOf(this.filters))};game.bootstrap.Runner.prototype.addParticles=function(){this.loader.addParticle()};game.bootstrap.Runner.prototype.addActors=function(){this.loader.addActors();this.obstacles.addBeforeActors();this.obstacles.matchers.addActors();this.obstacles.addAfterActors()};
game.bootstrap.Runner.prototype.addGraphics=function(){this.loader.matchers.view.engine.addGraphics();this.loader.matchers.view.addGraphics();this.loader.credits.addGraphics()};game.bootstrap.Runner.prototype.run=function(){this.engine.attach();this.keyboardControls.attachActivation();this.menu.attach()};game.utility.Range.ZERO=new game.utility.Range(0,0);game.utility.Range.ONE=new game.utility.Range(0,1);game.utility.Range.PI_2=new game.utility.Range(0,physics.utility.PI_2);
game.utility.Range.rectangleX=function(a){return new game.utility.Range(a.min.x,a.max.x)};game.utility.Range.symmetric=function(a){return new game.utility.Range(-a,a)};game.utility.Range.prototype.contains=function(a){return a>=this.min&&a<this.max};game.utility.Range.prototype.intersects=function(a){return this.max>a.min&&this.min<a.max};game.utility.Range.prototype.intersect=function(a){return new game.utility.Range(Math.max(this.min,a.min),Math.min(this.max,a.max))};
game.utility.Range.prototype.length=function(){return this.max-this.min};game.utility.Range.prototype.alpha=function(a){return(a-this.min)/this.length()};game.utility.Range.prototype.interpolate=function(a){return physics.utility.interpolate(this.min,this.max,a)};game.utility.Range.prototype.random=function(){return this.interpolate(Math.random())};game.utility.Range.prototype.add=function(a){return new game.utility.Range(this.min+a,this.max+a)};
game.utility.Range.prototype.subtract=function(a){return new game.utility.Range(this.min-a,this.max-a)};game.utility.Range.prototype.multiply=function(a){return new game.utility.Range(this.min*a,this.max*a)};game.utility.Range.prototype.divide=function(a){return new game.utility.Range(this.min/a,this.max/a)};game.utility.Range.prototype.clamp=function(a){return physics.utility.clamp(a,this.min,this.max)};
game.collisions.Matchers.newFrictionalsVehicleScenery=function(){const a={};Object.keys(game.collisions.Matchers.FRICTIONALS.VEHICLE_SCENERY).forEach(function(b){a[b]=new physics.interaction.Frictional(game.collisions.Matchers.FRICTIONALS.VEHICLE_SCENERY[b].elasticity,game.collisions.Matchers.FRICTIONALS.VEHICLE_SCENERY[b].friction)}.bind(this));return a};
game.collisions.Matchers.prototype.define=function(){this.chassis.defineSymmetric(this.environment,physics.collisions.mergers.collision(physics.interaction.handlers.merge(this.chassisEnvironmentHandlers)));this.wheel.defineDirectedMerger(this.environment,physics.collisions.mergers.collision(physics.interaction.handlers.merge(this.wheelEnvironmentHandlers)));this.load.defineSymmetric(this.chassis,this.loadMerger);this.load.defineSymmetric(this.wheel,this.loadMerger);this.obstacleCheck.defineSymmetric(this.obstacleCheck,
this.obstacleCheckMerger)};game.collisions.Matchers.prototype.defineCargo=function(a,b,c){a.defineSymmetric(b,physics.collisions.mergers.collision(c));this.clearance.defineSymmetric(b,this.clearanceMerger)};game.collisions.Matchers.prototype.defineObstacle=function(a,b,c){a.defineSymmetric(b,physics.collisions.mergers.collision(c));this.obstacleCheck.defineSymmetric(b,this.obstacleCheckMerger)};
game.collisions.Matchers.prototype.defineCargoObstacle=function(a,b,c,d){a.defineSymmetric(c,physics.collisions.mergers.collision(physics.interaction.handlers.mergeArray([game.collisions.Matchers.FRICTIONALS.OBSTACLE_CARGO.handler(),this.view.audioHandler(b),this.view.audioHandler(d)])));this.clearance.defineSymmetric(c,this.clearanceMerger);this.obstacleCheck.defineSymmetric(a,this.obstacleCheckMerger)};
game.collisions.Matchers.prototype.updateFrictions=function(){const a=this.frictionMultipliers.values().reduce(physics.utility.multiply,1);Object.keys(this.frictionalsVehicleScenery).forEach(function(b){this.frictionalsVehicleScenery[b].friction=a*game.collisions.Matchers.FRICTIONALS.VEHICLE_SCENERY[b].friction}.bind(this))};
game.collisions.Matchers.prototype.addActors=function(){physics.collections.addAll(this.view.engine.actors,[this.clearanceToggle.resetActor(!1),this.loadToggle.resetActor(!1),this.obstacleToggle.resetActor(!1),this.clearanceToggle.unlockActor(this.loadToggle.unlockActor(this.obstacleToggle.unlockActor(physics.actors.maximizer(this.view.collisions.actor(),game.Engine.SINGULARITY))))])};
game.collisions.Matchers.prototype.addEmitter=function(a){const b=[];return(new physics.collections.Bundle).add(this.wheelEnvironmentHandlers,a.collisionHandler(b)).add(this.emitterQueues,b)};game.collisions.Matchers.prototype.newHandlers=function(a,b){return physics.interaction.handlers.mergeArray([physics.interaction.handlers.merge(a),this.view.audioHandler(b)])};
game.collisions.Matchers.prototype.addCargoMatcher=function(a,b){const c=new physics.tracking.matchers.Mapping;a.add(this.cargoes,{sound:b,matcher:c});this.defineCargo(c,this.chassis,this.newHandlers(this.chassisCargoHandlers,b));this.cargoes.values().forEach(function(d){this.defineCargo(c,d.matcher,physics.interaction.handlers.mergeArray([game.collisions.Matchers.FRICTIONALS.CARGO_SELF.handler(),this.view.audioHandler(b),this.view.audioHandler(d.sound)]))}.bind(this));this.obstacles.values().forEach(function(d){this.defineCargoObstacle(c,
b,d.matcher,d.sound)}.bind(this));return c};
game.collisions.Matchers.prototype.addCargoCollisions=function(a,b,c,d,e){c=new physics.tracking.matchers.MappingOverride(c);c.defineSymmetric(this.environment,physics.collisions.mergers.collision(physics.interaction.handlers.mergeArray([physics.interaction.handlers.merge(this.environmentCargoHandlers),this.view.audioHandler(b),function(f,g,h){d();return[]}])));c.defineDirectedMerger(this.unload,physics.collisions.mergers.ifContains(function(f){e();return[]}));return(new physics.collections.Bundle).add(this.view.collisions,
new physics.collisions.Collider(a,c))};
game.collisions.Matchers.prototype.addObstacleMatcher=function(a,b){const c=new physics.tracking.matchers.Mapping;a.add(this.obstacles,{sound:b,matcher:c});this.defineObstacle(c,this.environment,this.newHandlers(this.environmentObstacleHandlers,b));this.defineObstacle(c,this.wheel,this.newHandlers(this.wheelObstacleHandlers,b));this.defineObstacle(c,this.chassis,this.newHandlers(this.chassisObstacleHandlers,b));this.obstacles.values().forEach(function(d){this.defineObstacle(c,d.matcher,physics.interaction.handlers.mergeArray([game.collisions.Matchers.FRICTIONALS.OBSTACLE_SELF.handler(),
this.view.audioHandler(b),this.view.audioHandler(d.sound)]))}.bind(this));this.cargoes.values().forEach(function(d){this.defineCargoObstacle(d.matcher,d.sound,c,b)}.bind(this));return c};
game.collisions.Matchers.FRICTIONALS={VEHICLE_SCENERY:{CHASSIS_ENVIRONMENT:game.Engine.stiffFrictional(.1),CHASSIS_OBSTACLE:game.Engine.stiffFrictional(.5),CHASSIS_CARGO:game.Engine.stiffFrictional(.5),WHEEL_ENVIRONMENT:game.Engine.stiffFrictional(1),WHEEL_OBSTACLE:game.Engine.stiffFrictional(1)},ENVIRONMENT_OBSTACLE:game.Engine.stiffFrictional(1),ENVIRONMENT_CARGO:game.Engine.stiffFrictional(1),OBSTACLE_SELF:game.Engine.stiffFrictional(.5),OBSTACLE_CARGO:game.Engine.stiffFrictional(.5),CARGO_SELF:game.Engine.stiffFrictional(1)};
game.collisions.Obstacles.SPAWN_OVERSCAN=1.2;game.collisions.Obstacles.PRUNE_OVERSCAN=1.5;game.collisions.Obstacles.SPAWN_MARGIN=physics.dynamics.Rectangle.symmetric(physics.dynamics.Vector.ONE);game.collisions.Obstacles.singleBody=function(a,b){return game.collisions.Obstacles.singleGraphic([a],b)};game.collisions.Obstacles.singleGraphic=function(a,b){return a.map(function(c,d){return{body:c,graphic:0==d?b:null}})};
game.collisions.Obstacles.limitedSpawner=function(a,b){return function(c,d){b.contains(c)&&a(c,d)}};game.collisions.Obstacles.prototype.reset=function(){this.queued=[];this.active=[];this.positiveLoad=this.negativeLoad=0};game.collisions.Obstacles.prototype.addBeforeActors=function(){this.matchers.view.engine.actors.add(function(a){this.bundle=this.performCheck();return[]}.bind(this))};
game.collisions.Obstacles.prototype.addAfterActors=function(){this.matchers.view.engine.actors.add(function(a){this.bundle&&(this.bundle.release(),delete this.bundle,this.evaluateCheck());return[]}.bind(this))};game.collisions.Obstacles.prototype.performCheck=function(){return this.queued.length?(new physics.collections.Bundle).addAll(this.matchers.view.collisions,physics.utility.flatten(this.queued.map(function(a){return this.newColliders(this.matchers.obstacleCheck,a.bodies)}.bind(this)))):null};
game.collisions.Obstacles.prototype.evaluateCheck=function(){if(this.matchers.obstacleToggle.active)this.listener&&this.listener(this.queued);else{const a=this.queued.map(function(b){return(new physics.collections.Bundle).addAll(this.matchers.view.collisions,this.newColliders(b.matcher,b.bodies))}.bind(this));this.queued.forEach(function(b,c){this.active.push({bodies:b.bodies,bundle:b.handler().addBundle(a[c])})}.bind(this))}this.queued=[]};
game.collisions.Obstacles.prototype.newColliders=function(a,b){const c=new physics.tracking.matchers.Distinct(a);return b.map(function(d){return new physics.collisions.Collider(d,c)})};game.collisions.Obstacles.prototype.addObstacle=function(a,b,c){this.queued.push({bodies:a,handler:b,matcher:c})};
game.collisions.Obstacles.prototype.addSpawner=function(a,b){return(new physics.collections.Bundle).add(this.matchers.view.engine.actors,function(c){var d=this.matchers.view.camera.particle;c=d.motion.position.translation.x;d=d.trace.position.translation.x;this.prune(c);this.spawn(a,b,c,d);return[]}.bind(this))};game.collisions.Obstacles.prototype.sightRange=function(a){a*=this.matchers.view.scaledRefSize();return new game.utility.Range(-a*game.View.CAMERA_OFFSET.x,a*(1-game.View.CAMERA_OFFSET.x))};
game.collisions.Obstacles.prototype.prune=function(a){a=this.sightRange(game.collisions.Obstacles.PRUNE_OVERSCAN).add(a);for(var b=0;b<this.active.length;b++){const c=physics.collisions.Body.bounds(this.active[b].bodies);a.intersects(game.utility.Range.rectangleX(c))||(this.active[b].bundle.release(),this.active.splice(b,1),b--)}};game.collisions.Obstacles.prototype.clear=function(){this.active.forEach(function(a){a.bundle.release()});this.reset()};
game.collisions.Obstacles.prototype.spawn=function(a,b,c,d){d=c-d;const e=this.sightRange(game.collisions.Obstacles.PRUNE_OVERSCAN),f=this.sightRange(game.collisions.Obstacles.SPAWN_OVERSCAN);this.positiveLoad=physics.utility.clamp(this.positiveLoad-d,0,e.max-f.max);this.negativeLoad=physics.utility.clamp(this.negativeLoad-d,e.min-f.min,0);0<d?0==this.positiveLoad&&0<physics.utility.randomPoisson(d/a,1)&&b(c+f.max,0):0==this.negativeLoad&&0<physics.utility.randomPoisson(-d/a,1)&&b(c+f.min,1)};
game.collisions.Obstacles.prototype.randomSpawner=function(a,b){return function(c,d){const e=game.utility.randomFromArray(b),f=e.factory(this.matchers.view.engine.rendering),g=physics.utility.distinct(f.map(function(h){return h.body.particle}));a.alignParticles(g,physics.collisions.Body.bounds(f.map(function(h){return h.body})).addRectangle(game.collisions.Obstacles.SPAWN_MARGIN),c,d);this.addObstacle(f.map(function(h){return h.body}),function(){return g.reduce(function(h,k){return h.addBundle(this.matchers.view.addDefaultGravityParticle(k))}.bind(this),
new physics.collections.Bundle).addAll(this.matchers.view.graphics,f.filter(function(h){return h.graphic}).map(function(h){return new physics.rendering.perspective.View(physics.rendering.graphics.Transformator.identity(this.matchers.view.engine.rendering,h.graphic,h.body.particle),game.graphics.depths.OBSTACLE)}.bind(this)))}.bind(this),e.matcher)}.bind(this)};
game.collisions.EmitterParams.prototype.collisionHandler=function(a,b,c){return function(d,e,f,g){const h=e.rotate();f=Math.min(Math.abs(h.velocity()*f),this.intensityLimit);f>this.intensityThreshold&&(this.randomPoisson(d,e,h,f,g),b.collect(h,f));return[]}.bind(this,this.randomHandler(a,c))};game.collisions.EmitterParams.prototype.intensityAlpha=function(a){return Math.max(Math.min((a-this.intensityThreshold)/(this.intensityLimit-this.intensityThreshold),1),0)};
game.collisions.EmitterParams.prototype.computeVelocity=function(a,b){const c=a.first.pivot.particle.motion.velocity.translation.dot(b.first.direction),d=(b.first.velocity-c)*this.strengthHorizontalRel,e=Math.abs(d)*this.strengthVertical;return b.first.direction.multiply(d).add(a.first.direction.multiply(e)).maxLength(this.strengthLimit).add(b.first.direction.multiply(c*this.strengthHorizontalAbs))};
game.collisions.EmitterParams.prototype.randomPoisson=function(a,b,c,d,e){if(d=physics.utility.randomPoisson(e*d/this.interval,2))for(b=a.bind(this,c.first.pivot.origin,this.computeVelocity(b,c)),a=0;a<d;a++)b()};
game.collisions.EmitterParams.prototype.randomHandler=function(a,b){const c=new physics.collections.Ordered,d=this.inDuration+this.outDuration,e=.5*physics.utility.PI_2/d,f=physics.dynamics.Particle.rotating(e);return function(g,h){const k=f.motion.position.rotation;g=physics.dynamics.Particle.oneMass(new physics.dynamics.Motion(new physics.dynamics.Transformation(g,game.utility.Range.PI_2.random()),new physics.dynamics.Transformation(h.add(physics.dynamics.Vector.X_UNIT.rotate(game.utility.Range.PI_2.random()).multiply(this.dispersion*
Math.random())),this.rotation.random())));g=(new physics.collections.Bundle).addBundle(a.addGravityParticle(g,this.gravity)).add(c,physics.rendering.graphics.Transformator.identity(a.engine.rendering,new physics.rendering.graphics.Alpha(a.engine.rendering,a.engine.newImage(game.utility.randomFromArray(this.resources.images),physics.dynamics.Vector.ZERO,physics.rendering.graphics.Image.CENTER),f,function(l){l=physics.utility.modPositive(l.rotation-k,physics.utility.PI_2)/e;return l<this.inDuration?
Math.max(l/this.inDuration,0):Math.max(1-(l-this.inDuration)/this.outDuration,0)}.bind(this)),g));if(!b.length){const l=(new physics.collections.Bundle).add(a.engine.particles,f).add(a.engine.actors,function(m){for(;b.length;)if(m=physics.utility.modPositive(f.motion.position.rotation-b[0].start,physics.utility.PI_2)/e,0>m||m>=d)b[0].bundle.release(),b.shift(),b.length||l.release();else break;return[]}).add(a.graphics.collector,new physics.rendering.perspective.View(physics.rendering.graphics.Container.variable(c),
game.graphics.depths.EMITTER))}b.push({start:k,bundle:g})}.bind(this)};game.collisions.EmitterContext.SOUND_FADE_DURATION=.1;game.collisions.EmitterContext.ALPHA_THRESHOLD=.01;
game.collisions.EmitterContext.prototype.start=function(){this.fixture=physics.interaction.Fixture.stationary(physics.dynamics.Vector.ZERO);const a=physics.actors.spatialAudio(this.audioContext,this.view.camera,this.fixture,game.View.NORMAL_DISTANCE/2);this.spatialActor=a.actor;a.output.connect(this.audioContext.destination);this.intensityNode=new GainNode(this.audioContext,{gain:0});this.intensityNode.connect(a.input);this.fadeNode=new GainNode(this.audioContext,{gain:0});physics.utility.fadeAudio(this.fadeNode,
game.collisions.EmitterContext.SOUND_FADE_DURATION,1);this.fadeNode.connect(this.intensityNode);this.sourceNode=new AudioBufferSourceNode(this.audioContext,{buffer:this.params.resources.sound()});this.sourceNode.loop=!0;this.sourceNode.onended=function(){a.output.disconnect()};this.sourceNode.connect(this.fadeNode);this.sourceNode.start();this.collector=[]};
game.collisions.EmitterContext.prototype.stop=function(){this.sourceNode.stop(physics.utility.fadeAudio(this.fadeNode,game.collisions.EmitterContext.SOUND_FADE_DURATION,0))};
game.collisions.EmitterContext.prototype.actor=function(){return physics.actors.containerArray([function(a){const b=this.collector.map(function(c){return c.alpha}).reduce(physics.utility.add,0);b>game.collisions.EmitterContext.ALPHA_THRESHOLD&&(this.fixture.origin=this.collector.map(function(c){return c.origin.multiply(c.alpha)}).reduce(physics.utility.addMethod,physics.dynamics.Vector.ZERO).divide(b));this.intensityNode.gain.linearRampToValueAtTime(b*this.params.gain,this.audioContext.currentTime+
a);this.collector=[];return[]}.bind(this),this.spatialActor])};game.collisions.EmitterContext.prototype.collect=function(a,b){this.collector.push({origin:a.first.pivot.origin,alpha:this.params.intensityAlpha(b)})};game.collisions.EmitterContext.prototype.collisionHandler=function(a){return this.params.collisionHandler(this.view,this,a)};game.loading.Loader.FADE_DURATION=game.Engine.FADE_DURATION;game.loading.Loader.TOGGLE_LINE_WIDTH=.15*game.View.PX_PER_M;
game.loading.Loader.KEYS_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x/2,248);
game.loading.Loader.newHandler=function(a,b,c){return new physics.actors.input.handlers.Merger([new physics.actors.input.handlers.movers.KeyMover(a,"KeyA","KeyD","KeyW","KeyS",2E3,.01),new physics.actors.input.handlers.movers.MouseMover(a),new physics.actors.input.handlers.movers.TouchMover(a,c),new physics.actors.input.handlers.pressers.KeyPresser(b,"Space"),new physics.actors.input.handlers.pressers.MousePresser(b,c,0),new physics.actors.input.handlers.pressers.TouchPresser(b,c,game.Engine.TAP_DISTANCE,
game.Engine.TAP_DURATION)])};game.loading.Loader.prototype.rendering=function(){return this.matchers.view.engine.rendering};game.loading.Loader.prototype.newToggleProperties=function(a){return new physics.rendering.graphics.Properties(this.rendering(),{fillStyle:a,strokeStyle:a,lineJoin:"round",lineWidth:game.loading.Loader.TOGGLE_LINE_WIDTH})};
game.loading.Loader.prototype.newToggleGraphic=function(a){return physics.rendering.graphics.Container.separated([new physics.rendering.graphics.path.Beginner(this.rendering()),a,new physics.rendering.graphics.Toggled(this.rendering(),this.matchers.clearanceToggle,this.newToggleProperties(game.Engine.COLORS.RED),this.newToggleProperties(game.Engine.COLORS.BLUE)),new physics.rendering.graphics.path.Stroker(this.rendering()),new physics.rendering.graphics.path.Filler(this.rendering())],1)};
game.loading.Loader.prototype.addParticle=function(){this.matchers.view.engine.particles.add(this.animation)};
game.loading.Loader.prototype.addActors=function(){const a=new physics.actors.animation.Timer(game.loading.Loader.FADE_DURATION,0);var b=!1;physics.collections.addAll(this.matchers.view.engine.actors,[a.toggledActor(this.matchers.loadToggle),physics.actors.animation.Transition.zeroPi(a,this.animation).actor(),function(c){!b&&this.matchers.loadToggle.active&&(b=!0,this.tutorial.confirm(game.hud.TutorialBox.INTRO),this.tutorial.open(game.hud.TutorialBox.LOADING));b&&!this.matchers.loadToggle.active&&
(b=!1,this.tutorial.close(game.hud.TutorialBox.LOADING));return[]}.bind(this)])};
game.loading.Loader.prototype.addBody=function(){return(new physics.collections.Bundle).add(this.matchers.view.engine.particles,this.cargoData.body.particle).addAll(this.matchers.view.engine.actors,this.bounds.values().map(function(a){return a(this.fixture,this.cargoData.body.shape.transform(physics.dynamics.Transformation.fromRotation(this.cargoPosition().rotation)))}.bind(this)).concat(physics.actors.projection2(this.fixture,physics.interaction.Fixture.centroid(this.cargoData.body.particle),physics.interaction.handlers.elasticity(physics.interaction.Elasticity.MAX)))).add(this.matchers.view.collisions,
new physics.collisions.Collider(this.cargoData.body,this.matchers.clearance)).add(this.matchers.view.graphics,new physics.rendering.perspective.View(physics.rendering.graphics.Transformator.identity(this.rendering(),new physics.rendering.graphics.Alpha(this.rendering(),physics.rendering.graphics.Container.fixed([this.newToggleGraphic(this.cargoData.body.shape.graphic(this.rendering())),this.cargoData.graphic]),this.animation,physics.rendering.mappers.WAVE_01),this.cargoData.body.particle),game.graphics.depths.LOADER))};
game.loading.Loader.prototype.addCargoFactory=function(a,b,c){const d=new physics.collections.Bundle;d.add(this.cargoes,{factory:a,cost:b,sound:c,matcher:this.matchers.addCargoMatcher(d,c)});return d};game.loading.Loader.prototype.resetCargo=function(){this.fixture.origin=null;this.addCargoAt(physics.dynamics.Vector.ZERO)};game.loading.Loader.prototype.cargoPosition=function(){return this.cargoData.body.particle.motion.position};game.loading.Loader.prototype.replaceCargo=function(){this.addCargoAt(this.cargoPosition().translation)};
game.loading.Loader.prototype.addCargoAt=function(a){this.cargo=game.utility.randomFromArray(this.cargoes.values());this.cargoData=this.cargo.factory(this.rendering(),a);this.bundle.release();this.bundle=this.addBody()};game.loading.Loader.prototype.spawn=function(a){this.matchers.loadToggle.active&&!this.matchers.clearanceToggle.active&&(this.unload(),this.replaceCargo(),this.matchers.view.fireAudio(this.cargoPosition().translation,resources.hud.cargo.spawn));return[]};
game.loading.Loader.prototype.unload=function(){const a=this.cargo.factory(this.rendering(),physics.dynamics.Vector.ZERO);a.body.particle.reset(physics.dynamics.Motion.fromPosition(this.cargoPosition()));(new game.loading.Animator(this,this.cargo,a)).animate()};game.loading.Loader.prototype.clear=function(){this.animators.values().forEach(function(a){a.release()});this.cargoTracker&&this.cargoTracker.reset()};
game.loading.Loader.prototype.addKeysGraphic=function(){this.controlsBundle.addBundle(this.keyboardControls.add(physics.collections.Sorted.withOrder(new physics.rendering.graphics.Fitted(this.rendering(),new physics.rendering.graphics.Alpha(this.rendering(),this.matchers.view.engine.newImage(resources.hud.keys.wasdSpace,game.loading.Loader.KEYS_ORIGIN,physics.rendering.graphics.Image.CENTER),this.animation,physics.rendering.mappers.WAVE_01),game.View.REF_SIZE,physics.rendering.graphics.Fitted.UPPER_CENTER),
game.graphics.depths.HUD.GAME),this.matchers.view.engine.graphics))};
game.loading.Loader.prototype.addControls=function(a,b){const c=new physics.actors.input.Anchor(this.matchers.view.camera,this.fixture),d=new physics.actors.input.Button(physics.actors.constant([]),physics.actors.constant([]),this.spawn.bind(this));b=game.loading.Loader.newHandler(c,d,b);this.controlsBundle.addAll(this.matchers.view.engine.actors,[b.actor(),c.actor(),d.actor()]);this.addKeysGraphic();this.registrator=b.registrator();this.registrator.register();this.cargoTracker=a};
game.loading.Loader.prototype.removeControls=function(){this.controlsBundle.release();this.registrator.unregister();delete this.registrator;delete this.cargoTracker};game.loading.Animator.prototype.release=function(){this.cancelable.cancel()};game.loading.Animator.prototype.rendering=function(){return this.loader.matchers.view.engine.rendering};
game.loading.Animator.prototype.newFadeGraphic=function(a){return physics.rendering.graphics.Transformator.identity(this.rendering(),new physics.rendering.graphics.Alpha(this.rendering(),physics.rendering.graphics.path.Filler.wrap(this.rendering(),this.cargoData.body.shape.graphic(this.rendering()),{fillStyle:a}),this.animation,physics.rendering.mappers.WAVE_01),this.cargoData.body.particle)};
game.loading.Animator.prototype.newCollisionAction=function(){return this.animateOut.bind(this,game.loading.Animation.COLLISION,this.fireAudio.bind(this,resources.hud.cargo.collision),function(){this.loader.cargoTracker.addReward(-this.cargoReward());this.loader.cargoTracker.refresh()}.bind(this))};
game.loading.Animator.prototype.newUnloadAction=function(){return this.animateOut.bind(this,game.loading.Animation.UNLOAD,this.fireAudio.bind(this,resources.hud.cargo.unload),function(){const a=this.cargoReward();this.loader.credits.addAmount(a);this.loader.cargoTracker.addReward(-a);this.loader.cargoTracker.addDelivery(a);this.loader.cargoTracker.refresh();this.loader.tutorial.confirm(game.hud.TutorialBox.CARGO)}.bind(this))};
game.loading.Animator.prototype.animateIn=function(a){const b=new physics.actors.animation.Timer(a.inDuration,0),c=physics.actors.animation.Transition.zeroPi(b,this.animation);this.cancelable.run(function(d,e){d.add(this.graphics,this.newFadeGraphic(a.fillStyle)).addAll(this.loader.matchers.view.engine.actors,[b.elapsedActor(e),c.actor()]);this.attach(d);this.addAnimation(d);this.addBody(d);this.addPhysicsWithoutActions(d)}.bind(this),function(){b.duration=a.outDuration;b.elapse();this.cancelable.run(function(d,
e){this.addBodyGraphic(d);d.add(this.graphics,this.newFadeGraphic(a.fillStyle)).addAll(this.loader.matchers.view.engine.actors,[b.reverseActor(e),c.actor()]);this.attach(d);this.addAnimation(d);this.addBody(d);this.addPhysicsWithoutActions(d)}.bind(this),function(){this.cancelable.run(function(d,e){this.attach(d);this.addAnimation(d);this.addBodyGraphic(d);this.addBody(d);this.addPhysicsWithActions(d)}.bind(this),function(){})}.bind(this))}.bind(this))};
game.loading.Animator.prototype.animateOut=function(a,b,c){b();const d=new physics.actors.animation.Timer(a.inDuration,0),e=physics.actors.animation.Transition.zeroPi(d,this.animation);this.cancelable.run(function(f,g){this.addBodyGraphic(f);f.add(this.graphics,this.newFadeGraphic(a.fillStyle)).addAll(this.loader.matchers.view.engine.actors,[d.elapsedActor(g),e.actor()]);this.attach(f);this.addAnimation(f);this.addBody(f);this.addPhysicsWithoutActions(f)}.bind(this),function(){c();d.duration=a.outDuration;
d.elapse();this.cancelable.run(function(f,g){f.add(this.graphics,this.newFadeGraphic(a.fillStyle)).addAll(this.loader.matchers.view.engine.actors,[d.reverseActor(g),e.actor()]);this.attach(f);this.addAnimation(f);this.addBody(f)}.bind(this),function(){})}.bind(this))};game.loading.Animator.prototype.fireAudio=function(a){this.loader.matchers.view.fireAudio(this.cargoData.body.particle.motion.position.translation,a)};game.loading.Animator.prototype.attach=function(a){a.add(this.loader.animators,this)};
game.loading.Animator.prototype.addAnimation=function(a){a.add(this.loader.matchers.view.engine.particles,this.animation)};game.loading.Animator.prototype.addBody=function(a){a.add(this.loader.matchers.view.engine.particles,this.cargoData.body.particle).add(this.loader.matchers.view.graphics,new physics.rendering.perspective.View(physics.rendering.graphics.Container.variable(this.graphics),game.graphics.depths.CARGO))};
game.loading.Animator.prototype.addBodyGraphic=function(a){a.add(this.graphics,physics.rendering.graphics.Transformator.identity(this.rendering(),this.cargoData.graphic,this.cargoData.body.particle))};game.loading.Animator.prototype.addPhysics=function(a,b,c){a.addBundle(this.loader.matchers.addCargoCollisions(this.cargoData.body,this.cargo.sound,this.cargo.matcher,b,c)).add(this.loader.matchers.view.engine.actors,this.loader.matchers.view.newDefaultGravity(this.cargoData.body.particle))};
game.loading.Animator.prototype.addPhysicsWithoutActions=function(a){this.addPhysics(a,function(){},function(){})};game.loading.Animator.prototype.addPhysicsWithActions=function(a){this.addPhysics(a,this.newCollisionAction(),this.newUnloadAction())};
game.loading.Animator.prototype.animate=function(){this.animateIn(game.loading.Animation.SPAWN);this.loader.credits.addAmount(-this.cargo.cost);this.loader.cargoTracker.addReward(this.cargoReward());this.loader.cargoTracker.resetDelivery();this.loader.cargoTracker.refresh();this.loader.tutorial.confirm(game.hud.TutorialBox.LOADING)};game.loading.Animator.prototype.cargoReward=function(){return Math.ceil(this.cargo.cost*this.loader.credits.multiplier)};
game.loading.Animation.SPAWN=new game.loading.Animation(game.Engine.COLORS.WHITE,game.Engine.FADE_DURATION,game.Engine.FADE_DURATION);game.loading.Animation.UNLOAD=new game.loading.Animation(game.Engine.COLORS.WHITE,game.Engine.FADE_DURATION,game.Engine.FADE_DURATION);game.loading.Animation.COLLISION=new game.loading.Animation(game.Engine.COLORS.RED,3*game.Engine.FADE_DURATION,3*game.Engine.FADE_DURATION);game.hud.Menu.UNLOCKED_ORIGIN=new physics.dynamics.Vector(196,320);
game.hud.Menu.UNLOCKED_ICON_ORIGIN=new physics.dynamics.Vector(104,316);game.hud.Menu.DELIVERY_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x-256,292);game.hud.Menu.DELIVERY_ICON_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x-160,288);game.hud.Menu.MULTIPLIER_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x-256,420);game.hud.Menu.MULTIPLIER_ICON_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x-160,416);game.hud.Menu.TUNING_BAR_Y=game.View.REF_SIZE.y-164;
game.hud.Menu.TUNING_NUMBER_Y=game.View.REF_SIZE.y-72;game.hud.Menu.TUNING_STEP_X=64;game.hud.Menu.TITLE_Y=128;game.hud.Menu.BASE_MULTIPLIER=2;game.hud.Menu.MAX_DELIVERY=function(){return game.hud.Credits.MAX_AMOUNT};game.hud.Menu.VEHICLES=[vehicles.vintagePickup,vehicles.carWithTrailer,vehicles.agriculturalTractor,vehicles.pickup6x6,vehicles.flatbedSemiTruck,vehicles.trackedDumpTruck,vehicles.baggageTractor,vehicles.cargoBike];game.hud.Menu.SCENERIES=[sceneries.grassland,sceneries.city,sceneries.snowscape];
game.hud.Menu.DELIVERY_TARGETS=[[{cost:150,difficulties:[10,8,8,10,2]},{cost:260,difficulties:[10,10,10,7,0]},{cost:510,difficulties:[10,7,7,7,5]},{cost:150,difficulties:[10,10,10,10,10]},{cost:1280,difficulties:[10,6,8,2,0]},{cost:280,difficulties:[10,10,10,8,10]},{cost:560,difficulties:[10,8,8,8,0]},{cost:130,difficulties:[10,10,10,10,0]}],[{cost:240,difficulties:[10,10,10,10,0]},{cost:360,difficulties:[10,10,10,7,0]},{cost:530,difficulties:[10,6,8,7,3]},{cost:260,difficulties:[10,10,10,10,10]},
{cost:1840,difficulties:[10,6,10,2,0]},{cost:360,difficulties:[10,8,10,8,10]},{cost:860,difficulties:[10,8,10,8,0]},{cost:120,difficulties:[10,10,10,10,0]}],[{cost:250,difficulties:[10,8,8,10,0]},{cost:280,difficulties:[10,5,5,7,0]},{cost:590,difficulties:[10,5,7,5,2]},{cost:230,difficulties:[10,10,10,10,10]},{cost:2490,difficulties:[10,6,6,2,0]},{cost:370,difficulties:[10,8,10,10,5]},{cost:870,difficulties:[10,7,7,8,0]},{cost:210,difficulties:[10,6,6,10,0]}]];
game.hud.Menu.DELIVERY_TARGET_PERCENTAGE=.9;game.hud.Menu.DELIVERY_TARGET_ROUNDING=100;game.hud.Menu.unlockedText=function(a,b){return a+"/"+b+" ("+Math.floor(100*a/b)+"%)"};game.hud.Menu.deliveryText=function(a,b){return a+"/"+b};game.hud.Menu.newDeliveries=function(){return game.hud.Menu.SCENERIES.map(function(a){return game.hud.Menu.VEHICLES.map(function(b){return game.hud.Property.integerRange([].concat("delivery",a.PROPERTY_PATH,b.PROPERTY_PATH),0,game.hud.Menu.MAX_DELIVERY(),0)})})};
game.hud.Menu.newTuning=function(a,b,c,d){return game.hud.Tuning.fromPath(a.PROPERTY_PATH,b,c,10,d,game.hud.Tuning.COST_LADDER,a.TUNING_COST_OFFSET)};
game.hud.Menu.newTunings=function(){return game.hud.Menu.VEHICLES.map(function(a){return[game.hud.Menu.newTuning(a,"speed","Speed",!1),game.hud.Menu.newTuning(a,"acceleration","Acceleration",!1),game.hud.Menu.newTuning(a,"traction","Traction",!1),game.hud.Menu.newTuning(a,"stiffness","Stiffness",!0),game.hud.Menu.newTuning(a,"damping","Damping",!0),game.hud.Menu.newTuning(a,"height","Height",!0)]})};
game.hud.Menu.newDifficulty=function(a,b,c,d,e){return game.hud.Difficulty.fromPath(game.hud.Menu.SCENERIES[a].PROPERTY_PATH.concat(game.hud.Menu.VEHICLES[b].PROPERTY_PATH),d,10,Math.pow(game.hud.Menu.SCENERIES[a].DIFFICULTY_MAX_MULTIPLIER,e),game.hud.Menu.DELIVERY_TARGETS[a][b].difficulties[c])};
game.hud.Menu.newDifficulties=function(){return game.hud.Menu.SCENERIES.map(function(a,b){return game.hud.Menu.VEHICLES.map(function(c,d){return[game.hud.Menu.newDifficulty(b,d,0,"distance",1.25),game.hud.Menu.newDifficulty(b,d,1,"uphill",1),game.hud.Menu.newDifficulty(b,d,2,"downhill",.5),game.hud.Menu.newDifficulty(b,d,3,"alternation",1),game.hud.Menu.newDifficulty(b,d,4,"obstacles",1.5)]})})};
game.hud.Menu.newVehicleSelector=function(){return game.hud.Selector.fromType("vehicle","Vehicle",game.hud.Menu.VEHICLES.map(function(a){return{name:game.hud.Property.joinPath(a.PROPERTY_PATH),cost:a.COST}}))};game.hud.Menu.newScenerySelector=function(){return game.hud.Selector.fromType("scenery","Scenery",game.hud.Menu.SCENERIES.map(function(a){return{name:game.hud.Property.joinPath(a.PROPERTY_PATH),cost:a.COST}}))};
game.hud.Menu.prototype.newVehicleBuilder=function(){return new vehicles.utility.Builder(this.loader.matchers,this.locator,this.motor,new vehicles.utility.Setup)};game.hud.Menu.prototype.newSceneryBuilder=function(){return new sceneries.utility.Builder(this.loader,this.obstacles,this.locator,new sceneries.utility.Setup)};game.hud.Menu.prototype.rendering=function(){return this.locator.view.engine.rendering};
game.hud.Menu.prototype.tutorials=function(){return[game.hud.TutorialBox.UNLOCKED(this),game.hud.TutorialBox.DELIVERY(this),game.hud.TutorialBox.MULTIPLIER(this)]};game.hud.Menu.prototype.openTutorial=function(){this.tutorials().forEach(this.loader.tutorial.open.bind(this.loader.tutorial))};game.hud.Menu.prototype.closeTutorial=function(){this.tutorials().forEach(this.loader.tutorial.close.bind(this.loader.tutorial))};
game.hud.Menu.prototype.addDebugging=function(a){return(new physics.collections.Bundle).add(this.locator.view.engine.graphics,physics.collections.Sorted.withOrder(new physics.rendering.graphics.Fitted(this.rendering(),physics.rendering.graphics.Container.fixed([].concat(new physics.rendering.graphics.Properties(this.rendering(),game.Engine.FONT_PROPERTIES.DEBUGGING),[physics.rendering.text.keyValue(physics.rendering.text.constant("fps"),physics.rendering.text.fps()),physics.rendering.text.keyValue(physics.rendering.text.constant("camera"),
physics.rendering.text.camera(this.locator.view.camera)),physics.rendering.text.keyValue(physics.rendering.text.constant("particles"),physics.rendering.text.count(this.locator.view.engine.particles)),physics.rendering.text.keyValue(physics.rendering.text.constant("actors"),physics.rendering.text.count(this.locator.view.engine.actors)),physics.rendering.text.keyValue(physics.rendering.text.constant("collision"),physics.rendering.text.tracking(this.locator.view.collisions)),physics.rendering.text.keyValue(physics.rendering.text.constant("graphic"),
physics.rendering.text.tracking(this.locator.view.graphics)),physics.rendering.text.keyValue(physics.rendering.text.constant("buttons"),physics.rendering.text.count(game.hud.Button.COLLECTION)),physics.rendering.text.keyValue(physics.rendering.text.constant("properties"),function(){return game.hud.Property.MAP.size}),physics.rendering.text.keyValue(physics.rendering.text.constant("cargoes"),physics.rendering.text.count(this.loader.animators)),physics.rendering.text.keyValue(physics.rendering.text.constant("obstacles"),
function(){return this.obstacles.active.length+" / failed: "+a.single+" single, "+a.multiple+" multiple / load: "+Math.round(this.obstacles.negativeLoad)+", "+Math.round(this.obstacles.positiveLoad)}.bind(this)),physics.rendering.text.keyValue(physics.rendering.text.constant("emitters"),function(){return this.loader.matchers.emitterQueues.values().map(function(b){return b.length}).join(", ")}.bind(this))].map(function(b,c,d){return new physics.rendering.graphics.text.Filler(this.rendering(),new physics.dynamics.Vector(32,
game.View.REF_SIZE.y/2+40*(c-d.length/2)),b)}.bind(this)))),game.View.REF_SIZE,physics.rendering.graphics.Fitted.CENTER_LEFT),game.graphics.depths.HUD.DEBUGGING))};
game.hud.Menu.prototype.verifyDeliveryTargets=function(){game.hud.Menu.DELIVERY_TARGETS.length!=game.hud.Menu.SCENERIES.length&&console.warn("Number of delivery targets does not match number of sceneries");for(var a=0;a<game.hud.Menu.SCENERIES.length;a++){game.hud.Menu.DELIVERY_TARGETS[a].length!=game.hud.Menu.VEHICLES.length&&console.warn("Number of delivery targets does not match number of vehicles",a);for(var b=0;b<game.hud.Menu.VEHICLES.length;b++)game.hud.Menu.DELIVERY_TARGETS[a][b].difficulties.length!=
this.difficulties[a][b].length&&console.warn("Wrong number of tunings for delivery target",a,b)}};game.hud.Menu.prototype.newRightGraphics=function(){const a=new physics.collections.Ordered;a.add(new physics.rendering.graphics.Properties(this.rendering(),{textAlign:"right"}));return a};
game.hud.Menu.prototype.addGraphics=function(){this.graphicsBundle=(new physics.collections.Bundle).addAll(this.locator.view.engine.graphics,[physics.collections.Sorted.withOrder(physics.rendering.graphics.Container.variable(this.background),game.graphics.depths.HUD.MENU.BACKGROUND),physics.collections.Sorted.withOrder(physics.rendering.graphics.Container.variable(this.foreground),game.graphics.depths.HUD.MENU.FOREGROUND),physics.collections.Sorted.withOrder(new physics.rendering.graphics.Fitted(this.rendering(),
physics.rendering.graphics.Container.variable(this.rightGraphics),game.View.REF_SIZE,physics.rendering.graphics.Fitted.UPPER_RIGHT),game.graphics.depths.HUD.MENU.FOREGROUND)]);this.loader.tutorial.confirm(game.hud.TutorialBox.INTRO);this.openTutorial()};game.hud.Menu.prototype.removeGraphics=function(){this.graphicsBundle.release();delete this.graphicsBundle;this.closeTutorial()};game.hud.Menu.prototype.totalDeliveryUnlocks=function(){return game.hud.Menu.SCENERIES.length*game.hud.Menu.VEHICLES.length};
game.hud.Menu.prototype.actualDeliveryUnlocks=function(){for(var a=0,b=0;b<game.hud.Menu.SCENERIES.length;b++)for(var c=0;c<game.hud.Menu.VEHICLES.length;c++)this.deliveries[b][c].get()>=this.deliveryTarget(b,c)&&a++;return a};game.hud.Menu.prototype.countTotalUnlocks=function(){return physics.utility.flatten(this.tunings).map(function(a){return a.maxValue}).reduce(physics.utility.add,0)+(this.tunings.length-1)+this.totalDeliveryUnlocks()};
game.hud.Menu.prototype.countActualUnlocks=function(){return physics.utility.flatten(this.tunings).map(function(a){return a.lockedProperty.get()}).reduce(physics.utility.add,0)+(this.vehicleSelector.countUnlocked()-1)+this.actualDeliveryUnlocks()};game.hud.Menu.prototype.updateCompletedTutorial=function(){this.unlockedTextFactory(this.countActualUnlocks(),this.countTotalUnlocks())};
game.hud.Menu.prototype.unlockedTextFactory=function(a,b){return a==b?(this.loader.tutorial.confirm(game.hud.TutorialBox.INTRO),this.loader.tutorial.open(game.hud.TutorialBox.COMPLETED),this.locator.view.engine.newPulseTextGraphic):this.locator.view.engine.newTextGraphic};
game.hud.Menu.prototype.updateUnlockedGraphics=function(){const a=this.countActualUnlocks(),b=this.countTotalUnlocks();this.unlockedBundle.release();this.unlockedBundle.add(this.foreground,new physics.rendering.graphics.Fitted(this.rendering(),physics.rendering.graphics.Container.fixed([new physics.rendering.graphics.Properties(this.rendering(),game.Engine.FONT_PROPERTIES.MENU_SMALL),new physics.rendering.graphics.Properties(this.rendering(),{textAlign:"left"}),this.unlockedTextFactory(a,b).call(this.locator.view.engine,
game.hud.Menu.UNLOCKED_ORIGIN,game.hud.Menu.unlockedText.bind(this,a,b)),this.locator.view.engine.newImage(resources.hud.lock.open,game.hud.Menu.UNLOCKED_ICON_ORIGIN,physics.rendering.graphics.Image.CENTER)]),game.View.REF_SIZE,physics.rendering.graphics.Fitted.UPPER_LEFT))};game.hud.Menu.prototype.measureUnlockedText=function(){return game.Engine.measureWidth(game.hud.Menu.unlockedText(this.countActualUnlocks(),this.countTotalUnlocks()),game.Engine.FONT_PROPERTIES.MENU_SMALL)};
game.hud.Menu.prototype.selectedDelivery=function(){return this.deliveries[this.scenerySelector.index][this.vehicleSelector.index]};game.hud.Menu.prototype.selectedDeliveryTarget=function(){return this.deliveryTarget(this.scenerySelector.index,this.vehicleSelector.index)};
game.hud.Menu.prototype.deliveryTarget=function(a,b){const c=game.hud.Menu.DELIVERY_TARGETS[a][b];a=this.difficulties[a][b].map(function(d,e){return d.multiplierOf(c.difficulties[e])}).reduce(physics.utility.multiply,game.hud.Menu.BASE_MULTIPLIER*c.cost);return Math.floor(a*game.hud.Menu.DELIVERY_TARGET_PERCENTAGE/game.hud.Menu.DELIVERY_TARGET_ROUNDING)*game.hud.Menu.DELIVERY_TARGET_ROUNDING};game.hud.Menu.prototype.updateDelivery=function(a){const b=this.selectedDelivery();a>b.get()&&(b.set(a),this.updateCompletedTutorial())};
game.hud.Menu.prototype.updateDeliveryGraphics=function(){const a=this.selectedDelivery().get(),b=this.selectedDeliveryTarget();this.deliveryBundle.release();this.deliveryBundle.addAll(this.rightGraphics,[new physics.rendering.graphics.Properties(this.rendering(),game.Engine.FONT_PROPERTIES.MENU_SMALL),(a>=b?this.locator.view.engine.newPulseTextGraphic:this.locator.view.engine.newTextGraphic).call(this.locator.view.engine,game.hud.Menu.DELIVERY_ORIGIN,game.hud.Menu.deliveryText.bind(null,a,b)),this.locator.view.engine.newImage(resources.hud.cargo.tracker,
game.hud.Menu.DELIVERY_ICON_ORIGIN,physics.rendering.graphics.Image.CENTER)])};game.hud.Menu.prototype.measureDeliveryText=function(){return game.Engine.measureWidth(game.hud.Menu.deliveryText(this.selectedDelivery().get(),this.selectedDeliveryTarget()),game.Engine.FONT_PROPERTIES.MENU_SMALL)};
game.hud.Menu.prototype.addMultiplierGraphics=function(){physics.collections.addAll(this.rightGraphics,[new physics.rendering.graphics.Properties(this.rendering(),game.Engine.FONT_PROPERTIES.MENU_SMALL),this.locator.view.engine.newTextGraphic(game.hud.Menu.MULTIPLIER_ORIGIN,this.multiplierText.bind(this)),this.locator.view.engine.newImage(resources.hud.multiplier,game.hud.Menu.MULTIPLIER_ICON_ORIGIN,physics.rendering.graphics.Image.CENTER)])};game.hud.Menu.prototype.multiplierText=function(){return this.loader.credits.multiplier.toFixed(1)};
game.hud.Menu.prototype.measureMultiplierText=function(){return game.Engine.measureWidth(this.multiplierText(),game.Engine.FONT_PROPERTIES.MENU_SMALL)};
game.hud.Menu.prototype.updateLockedGraphic=function(){this.lockedBundle.release();this.isUnlocked()||(this.lockedBundle=(new physics.collections.Bundle).add(this.foreground,new physics.rendering.graphics.Fitted(this.rendering(),this.locator.view.engine.newPulseGraphic(this.locator.view.engine.newImage(resources.hud.lock.closed,game.View.REF_SIZE.divide(2).add(new physics.dynamics.Vector(0,80)),physics.rendering.graphics.Image.CENTER),physics.rendering.mappers.wave(.25,.5,1,Math.PI/2)),game.View.REF_SIZE,
physics.rendering.graphics.Fitted.CENTER)))};game.hud.Menu.prototype.updateTuningGraphics=function(a){this.addTuningGraphics(a);this.update()};
game.hud.Menu.prototype.addTuningGraphics=function(a){this.removeTuningGraphics();const b=a.minValue(),c=a.maxValue-b,d=game.View.REF_SIZE.x/2+game.hud.Menu.TUNING_STEP_X*(a.value-b-c/2),e=[];for(var f=b;f<a.maxValue;f++){const g=0>f!=f<a.value?resources.hud.tuning.active:resources.hud.tuning.inactive;e.push(this.locator.view.engine.newImage(Math.max(f+1,-f)<=a.lockedProperty.get()?g.unlocked:g.locked,new physics.dynamics.Vector(game.View.REF_SIZE.x/2+game.hud.Menu.TUNING_STEP_X*(f-b-(c-1)/2),game.hud.Menu.TUNING_BAR_Y),
physics.rendering.graphics.Image.CENTER))}e.push(this.locator.view.engine.newImage(resources.hud.tuning.pointer,new physics.dynamics.Vector(d,game.hud.Menu.TUNING_BAR_Y),physics.rendering.graphics.Image.CENTER),new physics.rendering.graphics.Properties(this.rendering(),game.Engine.FONT_PROPERTIES.MENU_SMALL),new physics.rendering.graphics.Properties(this.rendering(),{textAlign:"center"}),this.locator.view.engine.newTextGraphic(new physics.dynamics.Vector(d,game.hud.Menu.TUNING_NUMBER_Y),function(){return a.value}));
this.tuningBundle.add(this.foreground,new physics.rendering.graphics.Fitted(this.rendering(),physics.rendering.graphics.Container.fixed(e),game.View.REF_SIZE,physics.rendering.graphics.Fitted.LOWER_CENTER))};game.hud.Menu.prototype.removeTuningGraphics=function(){this.tuningBundle.release()};
game.hud.Menu.prototype.addTitleGraphics=function(a){this.titleBundle.release();this.titleBundle.addAll(this.foreground,[new physics.rendering.graphics.Properties(this.rendering(),game.Engine.FONT_PROPERTIES.MENU_LARGE),new physics.rendering.graphics.Fitted(this.rendering(),this.locator.view.engine.newPulseTextGraphic(new physics.dynamics.Vector(game.View.REF_SIZE.x/2,game.hud.Menu.TITLE_Y),function(){return a}),game.View.REF_SIZE,physics.rendering.graphics.Fitted.UPPER_CENTER)])};
game.hud.Menu.prototype.removeTitleGraphics=function(){this.titleBundle.release();this.titleBundle.add(this.background,physics.rendering.graphics.Alpha.constant(this.rendering(),this.locator.view.engine.newBackgroundFiller(game.Engine.COLORS.BLACK),.25))};
game.hud.Menu.prototype.update=function(){this.updateUnlockedGraphics();this.updateDeliveryGraphics();this.updateLockedGraphic();this.loader.credits.multiplier=this.selectedDifficulties().map(function(a){return a.multiplier()}).reduce(physics.utility.multiply,game.hud.Menu.BASE_MULTIPLIER);this.graphicsBundle&&this.openTutorial()};game.hud.Menu.prototype.isUnlocked=function(){return this.vehicleSelector.isUnlocked()&&this.scenerySelector.isUnlocked()&&this.selectedTunings().every(function(a){return a.isUnlocked()})};
game.hud.Menu.prototype.selectedVehicle=function(){return game.hud.Menu.VEHICLES[this.vehicleSelector.index]};game.hud.Menu.prototype.selectedTunings=function(){return this.tunings[this.vehicleSelector.index]};game.hud.Menu.prototype.resetVehicle=function(){this.loader.clear();this.obstacles.clear();this.vehicleBuilder.release();this.updateVehicleSetup();this.selectedVehicle().build(this.vehicleBuilder);this.loader.matchers.updateFrictions()};game.hud.Menu.prototype.updateVehicleSetup=function(){this.selectedTunings().forEach(function(a){a.apply(this.vehicleBuilder.setup)}.bind(this))};
game.hud.Menu.prototype.updateVehicleSetupSingle=function(a){a.apply(this.vehicleBuilder.setup);this.vehicleBuilder.update()};game.hud.Menu.prototype.selectedScenery=function(){return game.hud.Menu.SCENERIES[this.scenerySelector.index]};game.hud.Menu.prototype.selectedDifficulties=function(){return this.difficulties[this.scenerySelector.index][this.vehicleSelector.index]};
game.hud.Menu.prototype.resetScenery=function(){this.sceneryBuilder.release();this.updateScenerySetup();this.selectedScenery().build(this.sceneryBuilder);this.loader.resetCargo();this.resetVehicle()};game.hud.Menu.prototype.updateScenerySetup=function(){game.hud.Difficulty.applyAll(this.selectedDifficulties(),this.sceneryBuilder.setup)};
game.hud.Menu.prototype.attach=function(){var a=null;window.addEventListener("keydown",function(b){if("F10"===b.code){if(a)delete this.obstacles.listener,a.release(),a=null,this.locator.view.engine.removeDebugging();else{const c={single:0,multiple:0};this.obstacles.listener=function(d){c[1<d.length?"multiple":"single"]++};a=this.addDebugging(c);this.locator.view.engine.addDebugging()}b.preventDefault()}}.bind(this))};game.hud.Flash.FAILURE_FILL_STYLE=game.Engine.COLORS.RED;
game.hud.Flash.SUCCESS_FILL_STYLE=game.Engine.COLORS.BLUE;game.hud.Flash.RESET_FILL_STYLE=game.Engine.COLORS.WHITE;
game.hud.Flash.prototype.trigger=function(a){const b=(new physics.collections.Bundle).add(this.engine.particles,this.animation).addAll(this.engine.actors,[this.timer.reverseActor(function(){b.release()}),physics.actors.animation.Transition.zeroPi(this.timer,this.animation).actor()]).add(this.engine.graphics,physics.collections.Sorted.withOrder(new physics.rendering.graphics.Alpha(this.engine.rendering,this.engine.newBackgroundFiller(a),this.animation,physics.rendering.mappers.waveZeroMax(.5)),game.graphics.depths.HUD.FLASH));
this.timer.elapse();this.animation.reset(physics.dynamics.Motion.fromPosition(physics.dynamics.Transformation.PI));this.bundle.release();this.bundle=b};
game.hud.Flash.prototype.doWaiting=function(a){this.trigger(game.hud.Flash.RESET_FILL_STYLE);const b=(new physics.collections.Bundle).add(this.engine.graphics,physics.collections.Sorted.withOrder(new physics.rendering.graphics.Fitted(this.engine.rendering,this.engine.newImage(resources.hud.hourglass,game.View.REF_SIZE.divide(2),physics.rendering.graphics.Image.CENTER),game.View.REF_SIZE,physics.rendering.graphics.Fitted.CENTER),game.graphics.depths.HUD.FLASH));this.engine.preUpdateQueue.push(function(){b.release();
a()})};game.hud.Property.PREFIX_PATH=["bouncy","drive"];game.hud.Property.MAP=new Map;game.hud.Property.string=function(a,b,c){return new game.hud.Property(a,function(d){d=d.toString();if(b(d))return d},function(d){if(b(d))return d},c)};game.hud.Property.boolean=function(a,b){return new game.hud.Property(a,function(c){if(!1===c)return"false";if(!0===c)return"true"},function(c){if("false"===c)return!1;if("true"===c)return!0},b)};
game.hud.Property.integer=function(a,b,c){return new game.hud.Property(a,function(d){const e=parseInt(d,10);if(e===d&&b(e))return e.toString()},function(d){d=parseInt(d,10);if(!isNaN(d)&&b(d))return d},c)};game.hud.Property.integerRange=function(a,b,c,d){return game.hud.Property.integer(a,function(e){return e>=b&&e<=c},d)};game.hud.Property.joinPath=function(a){return a.join("-")};game.hud.Property.PREFIX=game.hud.Property.joinPath(game.hud.Property.PREFIX_PATH);
game.hud.Property.serialize=function(){const a={prefix:game.hud.Property.PREFIX};game.hud.Property.MAP.forEach(function(b,c){b.isOriginal()||(a[c]=b.serializedValue())});return btoa(JSON.stringify(a))};game.hud.Property.deserialize=function(a){try{const b=JSON.parse(atob(a));if(b.prefix!=game.hud.Property.PREFIX)return!1;game.hud.Property.MAP.forEach(function(c,d){b.hasOwnProperty(d)?window.localStorage.setItem(c.key(),b[d]):window.localStorage.removeItem(c.key())});return!0}catch(b){return!1}};
game.hud.Property.prototype.key=function(){return game.hud.Property.joinPath(game.hud.Property.PREFIX_PATH.concat(this.path))};game.hud.Property.prototype.get=function(){if(!this.hasOwnProperty("value")){const a=window.localStorage.getItem(this.key());if(null==a)this.value=this.original;else{const b=this.deserializer(a);null==b?(this.value=this.original,console.warn("Trying to restore invalid value",a)):this.value=b;this.value===this.original&&window.localStorage.removeItem(this.key())}}return this.value};
game.hud.Property.prototype.set=function(a){const b=this.serializer(a);null==b?console.warn("Trying to store invalid value",a):(this.value=a,a===this.original?window.localStorage.removeItem(this.key()):window.localStorage.setItem(this.key(),b))};game.hud.Property.prototype.isValid=function(a){return null!=this.serializer(a)};game.hud.Property.prototype.isOriginal=function(){return this.get()===this.original};game.hud.Property.prototype.serializedValue=function(){return this.serializer(this.value)};
game.hud.Selector.fromType=function(a,b,c){c.forEach(function(d,e){d.property=game.hud.Property.boolean([a,"unlocked",d.name],0==e)});return new game.hud.Selector(b,c,game.hud.Property.string([a,"selected"],function(d){d=game.hud.Selector.find(c,d);return null!=d&&c[d].property.get()},c[0].name))};game.hud.Selector.find=function(a,b){for(var c=0;c<a.length;c++)if(a[c].name==b)return c};game.hud.Selector.prototype.countUnlocked=function(){return this.list.filter(function(a){return a.property.get()}).length};
game.hud.Selector.prototype.countUnlockable=function(a){return this.list.filter(function(b){return!b.property.get()&&b.cost<=a.property.get()}).length};game.hud.Selector.prototype.isUnlocked=function(){return this.list[this.index].property.get()};game.hud.Selector.prototype.cost=function(){return this.list[this.index].cost};game.hud.Selector.prototype.unlock=function(){this.list[this.index].property.set(!0);this.update()};
game.hud.Selector.prototype.reset=function(){this.index=game.hud.Selector.find(this.list,this.property.get())};game.hud.Selector.prototype.update=function(){this.isUnlocked()&&this.property.set(this.list[this.index].name)};game.hud.Selector.prototype.previous=function(){0>--this.index&&(this.index+=this.list.length);this.update()};game.hud.Selector.prototype.next=function(){++this.index>=this.list.length&&(this.index-=this.list.length);this.update()};
game.hud.Tuning.COST_LADDER=[100,200,400,600,800,1E3,2E3,4E3,6E3,8E3,1E4,2E4,4E4,6E4,8E4];game.hud.Tuning.fromPath=function(a,b,c,d,e,f,g){d+g>f.length&&console.warn("Cost ladder out of bounds",a,b,f,g);const h=game.hud.Property.integerRange([].concat("tuning",a,b,"unlocked"),0,d,0);return new game.hud.Tuning(b,c,d,e,game.hud.Property.integer([].concat("tuning",a,b,"selected"),function(k){return Math.abs(k)<=h.get()},0),h,function(k){return f[k+g-1]})};
game.hud.Tuning.prototype.minValue=function(){return this.allowNegative?-this.maxValue:0};game.hud.Tuning.prototype.apply=function(a){a[this.name]=this.value/this.maxValue};game.hud.Tuning.prototype.isUnlocked=function(){return Math.abs(this.value)<=this.lockedProperty.get()};game.hud.Tuning.prototype.countUnlockable=function(a){for(var b=0,c=0,d=this.lockedProperty.get();d<this.maxValue;d++){b+=this.costEvaluator(d+1);if(b>a.property.get())break;c++}return c};
game.hud.Tuning.prototype.cost=function(){for(var a=0,b=this.lockedProperty.get();b<Math.abs(this.value);b++)a+=this.costEvaluator(b+1);return a};game.hud.Tuning.prototype.unlock=function(){this.lockedProperty.set(Math.abs(this.value));this.update()};game.hud.Tuning.prototype.reset=function(){this.value=this.valueProperty.get()};game.hud.Tuning.prototype.update=function(){this.isUnlocked()&&this.valueProperty.set(this.value)};game.hud.Tuning.prototype.canDecrement=function(){return this.value>this.minValue()};
game.hud.Tuning.prototype.decrement=function(){this.value--;this.update()};game.hud.Tuning.prototype.canIncrement=function(){return this.value<this.maxValue};game.hud.Tuning.prototype.increment=function(){this.value++;this.update()};game.hud.Difficulty.DECREASE_COUNT=3;game.hud.Difficulty.TARGET_WEIGHT=.1;game.hud.Difficulty.TARGET_WEIGHT_LOG=Math.log(game.hud.Difficulty.TARGET_WEIGHT);game.hud.Difficulty.TARGET_WEIGHT_ZERO=game.hud.Difficulty.TARGET_WEIGHT/5;
game.hud.Difficulty.TARGET_WEIGHT_ZERO_LOG=Math.log(game.hud.Difficulty.TARGET_WEIGHT_ZERO);game.hud.Difficulty.fromPath=function(a,b,c,d,e){return new game.hud.Difficulty(b,c,d,e,game.hud.Property.integerRange([].concat("difficulty",a,b),0,c,0))};
game.hud.Difficulty.increase=function(a){game.hud.Difficulty.resetAll(a);a=a.filter(function(b){return b.property.get()<b.maxValue});if(a.length){const b=game.utility.randomIntWeighted(a.map(function(c){return c.weightOf(c.property.get()+1)}));a[b].property.set(a[b].property.get()+1)}};
game.hud.Difficulty.decrease=function(a){game.hud.Difficulty.resetAll(a);for(var b=0;b<game.hud.Difficulty.DECREASE_COUNT;b++){const c=a.filter(function(e){return 0<e.property.get()});if(!c.length)break;const d=game.utility.randomIntWeighted(c.map(function(e){return 1-e.weightOf(e.property.get())}));c[d].property.set(c[d].property.get()-1)}};game.hud.Difficulty.applyAll=function(a,b){a.forEach(function(c){c.apply(b)})};game.hud.Difficulty.allConfirmed=function(a){return a.every(function(b){return b.isConfirmed()})};
game.hud.Difficulty.confirmAll=function(a){a.forEach(function(b){b.confirm()})};game.hud.Difficulty.resetAll=function(a){a.forEach(function(b){b.reset()})};game.hud.Difficulty.prototype.weightOf=function(a){return 0<this.target?Math.exp(game.hud.Difficulty.TARGET_WEIGHT_LOG/this.target*a):Math.exp(game.hud.Difficulty.TARGET_WEIGHT_ZERO_LOG*a)};game.hud.Difficulty.prototype.multiplierOf=function(a){return Math.pow(this.maxMultiplier,a/this.maxValue)};game.hud.Difficulty.prototype.multiplier=function(){return this.multiplierOf(this.unconfirmed)};
game.hud.Difficulty.prototype.apply=function(a){a[this.name]=this.unconfirmed/this.maxValue};game.hud.Difficulty.prototype.isConfirmed=function(){return this.unconfirmed==this.property.get()};game.hud.Difficulty.prototype.confirm=function(){this.unconfirmed=this.property.get()};game.hud.Difficulty.prototype.reset=function(){this.property.set(this.unconfirmed)};
game.hud.CargoTracker.prototype.addGraphics=function(){this.bundle.release();this.bundle.add(this.menu.locator.view.engine.graphics,physics.collections.Sorted.withOrder(new physics.rendering.graphics.Fitted(this.menu.rendering(),physics.rendering.graphics.Container.fixed([new physics.rendering.graphics.Properties(this.menu.rendering(),game.Engine.FONT_PROPERTIES.MENU_SMALL),new physics.rendering.graphics.Properties(this.menu.rendering(),{textAlign:"right"}),(this.improving?this.menu.locator.view.engine.newPulseTextGraphic:
this.menu.locator.view.engine.newTextGraphic).call(this.menu.locator.view.engine,game.hud.Menu.DELIVERY_ORIGIN,function(){return this.delivery+"/"+(this.reward+this.delivery)}.bind(this)),this.menu.locator.view.engine.newImage(resources.hud.cargo.tracker,game.hud.Menu.DELIVERY_ICON_ORIGIN,physics.rendering.graphics.Image.CENTER)]),game.View.REF_SIZE,physics.rendering.graphics.Fitted.UPPER_RIGHT),game.graphics.depths.HUD.GAME));this.menu.loader.tutorial.open(game.hud.TutorialBox.CARGO);0==this.reward&&
this.menu.loader.tutorial.open(game.hud.TutorialBox.RESTART)};game.hud.CargoTracker.prototype.removeGraphics=function(){this.bundle.release();this.menu.loader.tutorial.close(game.hud.TutorialBox.CARGO);this.menu.loader.tutorial.close(game.hud.TutorialBox.RESTART)};game.hud.CargoTracker.prototype.reset=function(){this.reward=0;this.improving=!1;this.resetDelivery();this.removeGraphics()};game.hud.CargoTracker.prototype.resetDelivery=function(){this.delivery=0};
game.hud.CargoTracker.prototype.refresh=function(){const a=this.isImproving();!this.improving&&a&&this.menu.locator.view.engine.fireAudio(resources.hud.buttons.unlock);this.improving=a;0<this.reward||0<this.delivery?this.addGraphics():this.removeGraphics();this.menu.updateDelivery(this.delivery)};game.hud.CargoTracker.prototype.confirmRestartTutorial=function(){0<this.delivery&&0==this.reward&&this.menu.loader.tutorial.confirm(game.hud.TutorialBox.RESTART)};
game.hud.CargoTracker.prototype.addReward=function(a){this.reward+=a;0<a&&(a=this.menu.selectedDifficulties(),game.hud.Difficulty.allConfirmed(a)&&game.hud.Difficulty.decrease(a))};game.hud.CargoTracker.prototype.addDelivery=function(a){0==this.delivery&&game.hud.Difficulty.increase(this.menu.selectedDifficulties());this.delivery+=a};game.hud.CargoTracker.prototype.isImproving=function(){return this.delivery>=Math.max(this.menu.selectedDelivery().get()+1,this.menu.selectedDeliveryTarget())};
game.hud.Credits.MAX_AMOUNT=999999;game.hud.Credits.MIN_AMOUNT=-999;game.hud.Credits.TEXT_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x-256,128);game.hud.Credits.COIN_ORIGINS=[new physics.dynamics.Vector(game.View.REF_SIZE.x-96,160),new physics.dynamics.Vector(game.View.REF_SIZE.x-160,128),new physics.dynamics.Vector(game.View.REF_SIZE.x-128,80)];game.hud.Credits.GROUND_ELASTICITY=new physics.interaction.Elasticity(.001,.02);
game.hud.Credits.LINK_ELASTICITY=new physics.interaction.Elasticity(.005,.005);game.hud.Credits.prototype.newParticle=function(a){return new physics.dynamics.Particle(physics.dynamics.Motion.fromPosition(physics.dynamics.Transformation.fromTranslation(a)),physics.dynamics.Mass.fromInverse(1))};
game.hud.Credits.prototype.addGraphics=function(){this.engine.graphics.add(physics.collections.Sorted.withOrder(new physics.rendering.graphics.Fitted(this.engine.rendering,physics.rendering.graphics.Container.fixed([new physics.rendering.graphics.Properties(this.engine.rendering,game.Engine.FONT_PROPERTIES.CREDITS),physics.rendering.graphics.Container.variable(this.outlines),physics.rendering.graphics.Container.variable(this.graphics)]),game.View.REF_SIZE,physics.rendering.graphics.Fitted.UPPER_RIGHT),
game.graphics.depths.HUD.GAME))};game.hud.Credits.prototype.addAmount=function(a){this.property.set(physics.utility.clamp(this.property.get()+a,game.hud.Credits.MIN_AMOUNT,game.hud.Credits.MAX_AMOUNT));this.updateDigits();this.digits[this.digits.length-1].bump(-1E3*Math.sign(a))};game.hud.Credits.prototype.newCoins=function(){const a=game.hud.Credits.COIN_ORIGINS.map(function(c){return new game.hud.Coin(this,c)}.bind(this));for(var b=1;b<a.length;b++)a[b-1].link(a[b]);return a};
game.hud.Credits.prototype.updateDigits=function(){const a=this.property.get().toString();var b=this.digits.length;const c=a.length;for(var d=Math.min(b,c),e=game.hud.Credits.TEXT_ORIGIN.x,f=0;f<d;f++){const g=a[a.length-f-1],h=game.Engine.measureWidth(g,game.Engine.FONT_PROPERTIES.CREDITS);this.digits[f].character=g;this.digits[f].groundX(e-h/2);e-=h}for(f=b;f<c;f++)d=a[a.length-f-1],b=game.Engine.measureWidth(d,game.Engine.FONT_PROPERTIES.CREDITS),d=new game.hud.Digit(this,d,new physics.dynamics.Vector(e-
b/2,game.hud.Credits.TEXT_ORIGIN.y)),d.link(0<f?this.digits[f-1]:this.coins[0]),this.digits.push(d),e-=b;this.digits.splice(c).forEach(function(g){g.release()})};game.hud.Credits.prototype.groundX=function(a,b){return(new physics.collections.Bundle).add(this.engine.actors,physics.actors.projection(physics.interaction.Rail.stationary(physics.interaction.Axis.throughX(b)),physics.interaction.Fixture.centroid(a),physics.interaction.handlers.elasticity(game.hud.Credits.GROUND_ELASTICITY)))};
game.hud.Credits.prototype.groundY=function(a,b){return(new physics.collections.Bundle).add(this.engine.actors,physics.actors.projection(physics.interaction.Rail.stationary(physics.interaction.Axis.throughY(b)),physics.interaction.Fixture.centroid(a),physics.interaction.handlers.elasticity(game.hud.Credits.GROUND_ELASTICITY)))};
game.hud.Credits.prototype.link=function(a,b,c){return(new physics.collections.Bundle).add(this.engine.actors,physics.actors.projection(new physics.interaction.Rail(a,physics.interaction.Axis.Y_0),physics.interaction.Fixture.centroid(b),physics.interaction.handlers.center(physics.interaction.handlers.elasticity(game.hud.Credits.LINK_ELASTICITY),c)))};game.hud.Coin.prototype.addParticle=function(){this.credits.engine.particles.add(this.particle)};
game.hud.Coin.prototype.addGraphics=function(){this.credits.outlines.add(physics.rendering.graphics.Transformator.identity(this.credits.engine.rendering,this.credits.engine.newImage(resources.hud.credits.outline,physics.dynamics.Vector.ZERO,physics.rendering.graphics.Image.CENTER),this.particle));this.credits.graphics.add(physics.rendering.graphics.Transformator.identity(this.credits.engine.rendering,this.credits.engine.newImage(resources.hud.credits.coin,physics.dynamics.Vector.ZERO,physics.rendering.graphics.Image.CENTER),
this.particle))};game.hud.Coin.prototype.groundY=function(a){this.credits.groundY(this.particle,a)};game.hud.Coin.prototype.link=function(a){this.credits.link(this.particle,a.particle,a.origin-this.origin)};game.hud.Digit.prototype.addBundle=function(){this.bundle.add(this.credits.engine.particles,this.particle).add(this.credits.outlines,this.newGraphic(physics.rendering.graphics.text.Stroker)).add(this.credits.graphics,this.newGraphic(physics.rendering.graphics.text.Filler))};
game.hud.Digit.prototype.newGraphic=function(a){return physics.rendering.graphics.Transformator.identity(this.credits.engine.rendering,new a(this.credits.engine.rendering,physics.dynamics.Vector.ZERO,function(){return this.character}.bind(this)),this.particle)};
game.hud.Digit.prototype.bump=function(a){const b=(new physics.collections.Bundle).add(this.credits.engine.actors,function(c){b.release();return[new physics.interaction.Action(this.particle,physics.dynamics.Transformation.fromTranslation(new physics.dynamics.Vector(0,a)).divide(c))]}.bind(this))};game.hud.Digit.prototype.groundX=function(a){this.bundleX.release();this.bundleX=this.credits.groundX(this.particle,a)};
game.hud.Digit.prototype.groundY=function(a){this.bundle.addBundle(this.credits.groundY(this.particle,a))};game.hud.Digit.prototype.link=function(a){this.bundle.addBundle(this.credits.link(this.particle,a.particle,a.origin-this.origin))};game.hud.Digit.prototype.release=function(){this.bundleX.release();this.bundle.release()};game.hud.Locator.ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x/2,160);game.hud.Locator.RANGE=game.utility.Range.symmetric(250);
game.hud.Locator.prototype.addTrack=function(){this.graphics.add(this.view.engine.newImage(resources.hud.locator.track,game.hud.Locator.ORIGIN,physics.rendering.graphics.Image.CENTER))};
game.hud.Locator.prototype.addPointer=function(a){return(new physics.collections.Bundle).add(this.graphics,physics.rendering.graphics.Translator.fixture(this.view.engine.rendering,this.view.engine.newImage(resources.hud.locator.pointer,game.hud.Locator.ORIGIN,new physics.dynamics.Vector(-.5,-117/122)),a,function(b){return new physics.dynamics.Vector(game.hud.Locator.RANGE.interpolate(game.utility.Range.ONE.clamp(this.ranges.values().map(function(c){return c.alpha(b.x)}).reduce(physics.utility.add,0))),
0)}.bind(this)))};game.hud.Locator.prototype.addGraphics=function(){this.removeGraphics();this.bundle.add(this.view.engine.graphics,physics.collections.Sorted.withOrder(new physics.rendering.graphics.Fitted(this.view.engine.rendering,physics.rendering.graphics.Container.variable(this.graphics),game.View.REF_SIZE,physics.rendering.graphics.Fitted.UPPER_CENTER),game.graphics.depths.HUD.GAME))};game.hud.Locator.prototype.removeGraphics=function(){this.bundle.release()};
game.hud.Locator.prototype.origin=function(){const a=this.origins.values();return a.reduce(physics.utility.addMethod,physics.dynamics.Vector.ZERO).divide(a.length)};game.hud.Locator.prototype.follow=function(a){return(new physics.collections.Bundle).addBundle(this.addPointer(a)).addBundle(this.view.follow(a))};game.hud.Confirmer.SHIFT=48;game.hud.Confirmer.prototype.showCargoLost=function(a,b){return this.show(b,"All cargo will be lost",0,function(){return 0<a.reward})};
game.hud.Confirmer.prototype.showImportOverwrite=function(a){return this.show("import","Progress will be overwritten",-128,function(){return!0})};
game.hud.Confirmer.prototype.show=function(a,b,c,d){if(!d())return this.cancel(),!0;d=this.cancelable.run(function(e,f){e.add(this.engine.actors,(new physics.actors.animation.Timer(3,0)).elapsedActor(f)).add(this.engine.graphics,physics.collections.Sorted.withOrder(new physics.rendering.graphics.Fitted(this.engine.rendering,physics.rendering.graphics.Container.fixed([new physics.rendering.graphics.Properties(this.engine.rendering,game.Engine.FONT_PROPERTIES.MENU_LARGE),this.engine.newPulseTextGraphic(game.View.REF_SIZE.divide(2).add(new physics.dynamics.Vector(0,
-game.hud.Confirmer.SHIFT+c)),function(g){return g}.bind(null,"Press again to "+a)),new physics.rendering.graphics.Properties(this.engine.rendering,game.Engine.FONT_PROPERTIES.MENU_SMALL),this.engine.newTextGraphic(game.View.REF_SIZE.divide(2).add(new physics.dynamics.Vector(0,game.hud.Confirmer.SHIFT+c)),function(g){return g}.bind(null,b+"!"))]),game.View.REF_SIZE,physics.rendering.graphics.Fitted.CENTER),game.graphics.depths.HUD.GAME))}.bind(this),function(){});if(this.name==a)return d?(this.cancel(),
!0):!1;this.name=a;return!1};game.hud.Confirmer.prototype.cancel=function(){this.cancelable.cancel()};game.hud.Button.MARGIN=physics.dynamics.Rectangle.symmetric(physics.dynamics.Vector.fromOne(48));game.hud.Button.COLLECTION=physics.collections.Sorted.byOrder();game.hud.Button.prototype.newButton=function(a){return new physics.actors.input.Button(physics.actors.constant([]),physics.actors.constant([]),a)};
game.hud.Button.prototype.filterOverlapping=function(a){if(!this.filter(a))return!1;const b=game.hud.Button.COLLECTION.values();for(var c=b.length-1;0<=c&&b[c]!=this;c--)if(b[c].filter(a))return!1;return!0};
game.hud.Button.prototype.newHandler=function(a,b){return new physics.actors.input.handlers.Merger([].concat(b.map(function(c){return new physics.actors.input.handlers.pressers.KeyPresser(this.button,c)}.bind(this)),new physics.actors.input.handlers.pressers.MousePresser(this.button,a,0),new physics.actors.input.handlers.pressers.TouchPresser(this.button,a,game.Engine.TAP_DISTANCE,game.Engine.TAP_DURATION)))};game.hud.Button.prototype.order=function(){return this.graphic.order()};
game.hud.Button.prototype.register=function(){this.registrator.register();this.bundle.add(game.hud.Button.COLLECTION,this).addAll(this.engine.actors,[this.handler.actor(),this.button.actor()]).add(this.engine.graphics,this.graphic)};game.hud.Button.prototype.release=function(){this.registrator.unregister();this.bundle.release();this.button.reset()};game.hud.Pedal.ELASTICITY=new physics.interaction.Elasticity(.05,1);game.hud.Pedal.MARGIN=physics.dynamics.Rectangle.symmetric(physics.dynamics.Vector.fromOne(128));
game.hud.Pedal.prototype.newGraphic=function(a,b){return new physics.rendering.graphics.Fitted(this.engine.rendering,physics.rendering.graphics.Transformator.identity(this.engine.rendering,a,this.particle),game.View.REF_SIZE,b)};game.hud.Pedal.prototype.newButton=function(a,b){return new physics.actors.input.Button(function(c){this.link(32);a.target+=b-this.shift;this.shift=b;return[]}.bind(this),function(c){this.link(0);this.stop();return[]}.bind(this),physics.actors.constant([]))};
game.hud.Pedal.prototype.newHandler=function(a){return new physics.actors.input.handlers.Merger([].concat(a.map(function(b){return new physics.actors.input.handlers.pressers.KeyPresser(this.button,b)}.bind(this)),new physics.actors.input.handlers.pressers.MousePresser(this.button,physics.actors.input.filters.bounds(this.graphic),0),new physics.actors.input.handlers.pressers.TouchPresser(this.button,physics.actors.input.filters.bounds(this.graphic),game.Engine.TAP_DISTANCE,game.Engine.TAP_DURATION)))};
game.hud.Pedal.prototype.stop=function(){this.motor.target-=this.shift;this.shift=0};game.hud.Pedal.prototype.link=function(a){this.linkBundle.release();this.linkBundle.add(this.engine.actors,physics.actors.projection(physics.interaction.Rail.stationary(physics.interaction.Axis.throughY(a)),physics.interaction.Fixture.centroid(this.particle),physics.interaction.handlers.elasticity(game.hud.Pedal.ELASTICITY)))};
game.hud.Pedal.prototype.add=function(){this.registrator.register();this.bundle.add(this.engine.particles,this.particle).addAll(this.engine.actors,[this.handler.actor(),this.button.actor()]).add(this.engine.graphics,physics.collections.Sorted.withOrder(this.graphic,game.graphics.depths.HUD.GAME)).addBundle(this.linkBundle)};game.hud.Pedal.prototype.release=function(){this.registrator.unregister();this.bundle.release();this.stop()};
game.hud.KeyboardControls.ACTIVATION_EVENTS=["keydown","keypress","keyup"];game.hud.KeyboardControls.DEACTIVATION_EVENTS="click mousedown mouseup touchstart touchmove touchend".split(" ");game.hud.KeyboardControls.addGraphic=function(a){a.bundle.add(a.collection,a.graphic)};game.hud.KeyboardControls.attach=function(a,b){a.forEach(function(c){window.addEventListener(c,b)})};game.hud.KeyboardControls.detach=function(a,b){a.forEach(function(c){window.removeEventListener(c,b)})};
game.hud.KeyboardControls.prototype.attachActivation=function(){game.hud.KeyboardControls.attach(game.hud.KeyboardControls.ACTIVATION_EVENTS,this.activationListener)};game.hud.KeyboardControls.prototype.detachActivation=function(){game.hud.KeyboardControls.detach(game.hud.KeyboardControls.ACTIVATION_EVENTS,this.activationListener)};game.hud.KeyboardControls.prototype.attachDeactivation=function(){game.hud.KeyboardControls.attach(game.hud.KeyboardControls.DEACTIVATION_EVENTS,this.deactivationListener)};
game.hud.KeyboardControls.prototype.detachDeactivation=function(){game.hud.KeyboardControls.detach(game.hud.KeyboardControls.DEACTIVATION_EVENTS,this.deactivationListener)};game.hud.KeyboardControls.prototype.runActivate=function(){return this.cancelable.run(function(a,b){a.add(this.engine.particles,this.animation).addAll(this.engine.actors,[this.timer.elapsedActor(b),physics.actors.animation.Transition.zeroPi(this.timer,this.animation).actor()])}.bind(this),function(){})};
game.hud.KeyboardControls.prototype.activate=function(){this.active||(this.active=!0,this.detachActivation(),this.attachDeactivation(),this.runActivate()||this.collection.values().forEach(game.hud.KeyboardControls.addGraphic))};
game.hud.KeyboardControls.prototype.deactivate=function(){this.active&&(this.active=!1,this.detachDeactivation(),this.attachActivation(),this.cancelable.run(function(a,b){a.add(this.engine.particles,this.animation).addAll(this.engine.actors,[this.timer.reverseActor(b),physics.actors.animation.Transition.zeroPi(this.timer,this.animation).actor()])}.bind(this),function(){this.collection.values().forEach(function(a){a.bundle.release()})}.bind(this)))};
game.hud.KeyboardControls.prototype.add=function(a,b){b={graphic:new physics.rendering.graphics.Alpha(this.engine.rendering,a,this.animation,physics.rendering.mappers.WAVE_01),collection:b,bundle:new physics.collections.Bundle};a.order&&(b.graphic.order=function(){return a.order()});this.active&&game.hud.KeyboardControls.addGraphic(b);return(new physics.collections.Bundle).add(this.collection,b).addBundle(b.bundle)};
game.hud.Tutorial.prototype.find=function(a){for(var b=0;b<this.queue.length;b++)if(a.id==this.queue[b].id)return b};game.hud.Tutorial.prototype.insert=function(a){for(var b=0;b<this.queue.length;b++){if(a.id==this.queue[b].id)return this.queue[b]=a,b==this.queue.length-1&&this.updateButton(a),!1;if(a.order<this.queue[b].order)return this.queue.splice(b,0,a),!0}this.queue.push(a);this.replaceButton(a);return!0};
game.hud.Tutorial.prototype.newButton=function(a){return new game.hud.Button(this.engine,this.filters,game.Engine.orderedControlSurface(this.fadingFactory(this.engine.newFittedControlSurface(this.engine.newControlSurface(this.engine.newImage(a.image,a.absolute,a.relative),a.margin,this.keyboardControls,resources.hud.keys.control,a.keysAbsolute,physics.rendering.graphics.Image.CENTER,physics.dynamics.Vector.ONE),a.alignment)),game.graphics.depths.HUD.TUTORIAL),function(b){this.engine.fireAudio(resources.hud.tutorial.confirm);
this.confirm(a);return[]}.bind(this),["ControlLeft","ControlRight"])};game.hud.Tutorial.prototype.updateButton=function(a){this.button.release();this.button=this.newButton(a)};game.hud.Tutorial.prototype.replaceButton=function(a){this.fadingFactory=this.engine.newFadingControlSurfaceFactory(game.Engine.FADE_DURATION);this.button&&this.button.release();this.button=this.newButton(a)};game.hud.Tutorial.prototype.confirm=function(a){a.confirm();this.close(a)};
game.hud.Tutorial.prototype.open=function(a){return!a.isConfirmed()&&this.insert(a)};game.hud.Tutorial.prototype.close=function(a){a=this.find(a);null!=a&&(this.queue.splice(a,1),a==this.queue.length&&(0<a?this.replaceButton(this.queue[a-1]):(this.button.release(),delete this.button,delete this.fadingFactory)))};game.hud.TutorialBox.PROPERTIES=new Map;
game.hud.TutorialBox.property=function(a){game.hud.TutorialBox.PROPERTIES.has(a)||game.hud.TutorialBox.PROPERTIES.set(a,game.hud.Property.boolean(["tutorial",a,"confirmed"],!1));return game.hud.TutorialBox.PROPERTIES.get(a)};game.hud.TutorialBox.BOTTOM_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x*game.View.CAMERA_OFFSET.x,game.View.REF_SIZE.y-48);game.hud.TutorialBox.MENU_RIGHT_OFFSET=new physics.dynamics.Vector(24,0);
game.hud.TutorialBox.INTRO=new game.hud.TutorialBox("intro",0,resources.hud.tutorial.intro,game.hud.TutorialBox.BOTTOM_ORIGIN,new physics.dynamics.Vector(-.5,-1),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.LOWER_CENTER,physics.dynamics.Vector.ZERO);game.hud.TutorialBox.LOADING=new game.hud.TutorialBox("loading",1,resources.hud.tutorial.loading,game.hud.TutorialBox.BOTTOM_ORIGIN,new physics.dynamics.Vector(-.5,-1),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.LOWER_CENTER,physics.dynamics.Vector.ZERO);
game.hud.TutorialBox.CARGO=new game.hud.TutorialBox("cargo",2,resources.hud.tutorial.cargo,game.hud.Menu.DELIVERY_ORIGIN.add(new physics.dynamics.Vector(0,56)),new physics.dynamics.Vector(-1,0),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.UPPER_RIGHT,physics.dynamics.Vector.ZERO);
game.hud.TutorialBox.RESTART=new game.hud.TutorialBox("restart",3,resources.hud.tutorial.restart,new physics.dynamics.Vector(293,220),physics.dynamics.Vector.ZERO,game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.UPPER_LEFT,physics.dynamics.Vector.ZERO);
game.hud.TutorialBox.DELIVERY=function(a){return new game.hud.TutorialBox("delivery",7,resources.hud.tutorial.delivery,game.hud.Menu.DELIVERY_ORIGIN.subtract(game.hud.TutorialBox.MENU_RIGHT_OFFSET).subtract(new physics.dynamics.Vector(a.measureDeliveryText(),0)),new physics.dynamics.Vector(-1,-.5),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.UPPER_RIGHT,new physics.dynamics.Vector(-25,0))};
game.hud.TutorialBox.MULTIPLIER=function(a){return new game.hud.TutorialBox("multiplier",6,resources.hud.tutorial.multiplier,game.hud.Menu.MULTIPLIER_ORIGIN.subtract(game.hud.TutorialBox.MENU_RIGHT_OFFSET).subtract(new physics.dynamics.Vector(a.measureMultiplierText(),0)),new physics.dynamics.Vector(-1,-.5),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.UPPER_RIGHT,new physics.dynamics.Vector(-25,0))};
game.hud.TutorialBox.UNLOCKED=function(a){return new game.hud.TutorialBox("unlocked",5,resources.hud.tutorial.unlocked,game.hud.Menu.UNLOCKED_ORIGIN.add(new physics.dynamics.Vector(24+a.measureUnlockedText(),0)),new physics.dynamics.Vector(0,-.5),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.UPPER_LEFT,physics.dynamics.Vector.ZERO)};
game.hud.TutorialBox.IO=new game.hud.TutorialBox("io",4,resources.hud.tutorial.io,game.View.REF_SIZE.subtract(new physics.dynamics.Vector(256,381)),new physics.dynamics.Vector(-1,-.5),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.LOWER_RIGHT,new physics.dynamics.Vector(-25,0));
game.hud.TutorialBox.COMPLETED=new game.hud.TutorialBox("completed",8,resources.hud.tutorial.completed,game.hud.TutorialBox.BOTTOM_ORIGIN,new physics.dynamics.Vector(-.5,-1),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.LOWER_CENTER,physics.dynamics.Vector.ZERO);game.hud.TutorialBox.prototype.confirm=function(){game.hud.TutorialBox.property(this.id).set(!0)};game.hud.TutorialBox.prototype.isConfirmed=function(){return game.hud.TutorialBox.property(this.id).get()};
game.graphics.BackgroundGraphic.prototype.render=function(){this.context.doScaled(this.context.size.y/this.height,this.graphic.render.bind(this.graphic))};game.graphics.BackgroundOffset.prototype.render=function(){this.context.doTranslated((new physics.dynamics.Vector(this.height*this.context.size.x/this.context.size.y,this.height)).multiplyVector(this.alpha),this.graphic.render.bind(this.graphic))};
game.graphics.ParallaxBackground.prototype.render=function(){this.camera.context.doTranslated(this.camera.position().translation.multiplyVector(this.multiplier).modPositive(this.size).negate(),this.graphic.render.bind(this.graphic))};game.graphics.ParallaxImage.prototype.bounds=function(){return new physics.dynamics.Rectangle(new physics.dynamics.Vector(this.range.min,this.origin.y),new physics.dynamics.Vector(this.range.max,this.origin.y+this.image.height))};
game.graphics.ParallaxImage.prototype.updating=function(){return!1};game.graphics.ParallaxImage.prototype.render=function(){const a=new physics.dynamics.Vector(this.origin.x*(1-this.multiplier)+this.camera.position().translation.x*this.multiplier,this.origin.y);this.camera.context.doTranslated(a,this.renderTransformed.bind(this,this.range.min-a.x))};
game.graphics.ParallaxImage.prototype.renderTransformed=function(a){this.camera.context.context2d.beginPath();this.camera.context.context2d.rect(a,0,this.range.length(),this.image.height);this.camera.context.context2d.fillStyle=this.pattern;this.camera.context.context2d.fill()};
game.graphics.RepeatedGraphic.prototype.render=function(){var a=this.graphic.bounds();const b=Math.floor((this.size.x+this.size.y*this.context.size.x/this.context.size.y-a.min.x)/this.size.x);for(a=Math.ceil(-a.max.x/this.size.x);a<=b;a++)this.context.doTranslated(new physics.dynamics.Vector(a*this.size.x,0),this.graphic.render.bind(this.graphic))};
game.graphics.RepeatedImageX.prototype.render=function(){this.context.doTranslated(new physics.dynamics.Vector(0,this.size.y-this.image.height),function(){this.context.context2d.beginPath();this.context.context2d.rect(0,0,this.size.x+this.size.y*this.context.size.x/this.context.size.y,this.image.height);this.context.context2d.fillStyle=this.pattern;this.context.context2d.fill()}.bind(this))};
game.graphics.RepeatedImage.prototype.render=function(){const a=this.mapper(this.context.position(this.particle));this.context.doTranslated(a,function(){this.context.context2d.beginPath();this.context.context2d.rect(-a.x,-a.y,this.size.x+this.height*this.context.size.x/this.context.size.y,this.size.y+this.height);this.context.context2d.fillStyle=this.pattern;this.context.context2d.fill()}.bind(this))};
game.graphics.depths=game.graphics.depthsOf([["SCENERY","LOADING"],["SCENERY","UNDERGROUND"],["SCENERY","OVERGROUND"],["SCENERY","PLANTING"],["SCENERY","BOUND"],["VEHICLE","BACKGROUND"],["LOADER"],["OBSTACLE"],["CARGO"],["VEHICLE","FOREGROUND"],["EMITTER"],["GAME"],["HUD","MENU","BACKGROUND"],["HUD","GAME"],["HUD","MENU","FOREGROUND"],["HUD","TUTORIAL"],["HUD","FLASH"],["HUD","DEBUGGING"]]);game.bootstrap.attach();
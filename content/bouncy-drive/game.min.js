'use strict';const game={Engine:function(a,b){this.canvas=a;this.avContext=b;this.preUpdateQueue=[];this.particles=new physics.collections.Ordered;this.actors=new physics.collections.Ordered;this.graphics=new physics.collections.Ordered;this.pulseAnimation=physics.dynamics.Particle.rotating(physics.utility.PI_2/game.Engine.PULSE_DURATION);this.rendering=this.newRendering();this.addParticle()},View:function(a){this.engine=a;this.collisions=physics.collisions.builder(new physics.tracking.Tracker(game.View.COLLISION_TRACKING_SIZE,
game.View.COLLISION_TRACKING_MARGIN));this.graphics=physics.rendering.perspective.builder(new physics.tracking.Tracker(game.View.GRAPHIC_TRACKING_SIZE,game.View.GRAPHIC_TRACKING_MARGIN));this.background=new physics.collections.Ordered;this.scalings=new physics.collections.Ordered;this.camera=this.newCamera();this.addCamera()},utility:{Range:function(a,b){this.min=a;this.max=b},randomInt:function(a){return Math.floor(a*Math.random())},randomFromArray:function(a){return a[this.randomInt(a.length)]},
arrayOfSize:function(a){return Array.apply(null,Array(a))},zipArrays:function(a){const b=[];for(;a.length;)a=a.filter(function(c){return c.length}),a.forEach(function(c){b.push(c.shift())});return b},scaledPolygonBody:function(a,b,c){return physics.collisions.Body.uniform(physics.dynamics.Particle.fromMass(c),physics.collisions.shapes.Polygon.convexHull(a.map(function(d){return d.multiply(b)})),1)}},bootstrap:{attach:function(){window.addEventListener("load",this.runLoadResources.bind(this,this.AvContext.build()))},
loadFonts:function(){return Promise.all(Object.keys(game.Engine.FONT_PROPERTIES).map(function(a){return document.fonts.load(game.Engine.FONT_PROPERTIES[a].font)}))},runLoadResources:function(a){Promise.all([this.loadFonts(),resources.utility.ImageLoader.INSTANCE.run(),resources.utility.AudioLoader.INSTANCE.run(a.audio)]).then(this.runCheckAudio.bind(this,a))},runCheckAudio:function(a){if("suspended"==a.audio.state){const b=document.getElementsByTagName("div")[0],c=function(){window.removeEventListener("click",
c);b.style.display="none";(new this.Runner(a)).run()}.bind(this);b.style.display="initial";window.addEventListener("click",c)}else(new this.Runner(a)).run()},AvContext:function(){this.audio=new AudioContext},CapturedAvContext:function(a,b,c){this.fps=a;this.sampleRate=b;this.duration=c;this.audio=new OfflineAudioContext(2,b*c,b)},Runner:function(a){this.motor=new physics.actors.Motor;this.engine=this.newEngine(a);this.filters=new physics.collections.Ordered;this.keyboardControls=this.newKeyboardControls();
this.tutorial=this.newTutorial();this.loader=this.newLoader();this.obstacles=this.newObstacles();this.locator=this.newLocator();this.menu=this.newMenu();this.upgrader=this.newUpgrader();this.cargoTracker=this.newCargoTracker();this.setUp()}},collisions:{Matchers:function(a){this.view=a;this.emitterQueues=new physics.collections.Ordered;this.clearanceToggle=new physics.actors.Toggle;this.loadToggle=new physics.actors.Toggle;this.obstacleToggle=new physics.actors.Toggle;this.clearanceMerger=physics.collisions.mergers.collision(this.clearanceToggle.handler(!0));
this.loadMerger=physics.collisions.mergers.collision(this.loadToggle.handler(!0));this.obstacleCheckMerger=physics.collisions.mergers.collision(this.obstacleToggle.handler(!0));this.frictionMultipliers=new physics.collections.Ordered;this.frictionalsVehicleScenery=game.collisions.Matchers.newFrictionalsVehicleScenery();this.chassisEnvironmentHandlers=new physics.collections.Ordered;this.chassisEnvironmentHandlers.add(this.frictionalsVehicleScenery.CHASSIS_ENVIRONMENT.handler());this.chassisObstacleHandlers=
new physics.collections.Ordered;this.chassisObstacleHandlers.add(this.frictionalsVehicleScenery.CHASSIS_OBSTACLE.handler());this.chassisCargoHandlers=new physics.collections.Ordered;this.chassisCargoHandlers.add(this.frictionalsVehicleScenery.CHASSIS_CARGO.handler());this.wheelEnvironmentHandlers=new physics.collections.Ordered;this.wheelEnvironmentHandlers.add(this.frictionalsVehicleScenery.WHEEL_ENVIRONMENT.handler());this.wheelObstacleHandlers=new physics.collections.Ordered;this.wheelObstacleHandlers.add(this.frictionalsVehicleScenery.WHEEL_OBSTACLE.handler());
this.environmentCargoHandlers=new physics.collections.Ordered;this.environmentCargoHandlers.add(game.collisions.Matchers.FRICTIONALS.ENVIRONMENT_CARGO.handler());this.environmentObstacleHandlers=new physics.collections.Ordered;this.environmentObstacleHandlers.add(physics.interaction.handlers.cast(game.collisions.Matchers.FRICTIONALS.ENVIRONMENT_OBSTACLE.handler(),.02));this.chassis=new physics.tracking.matchers.Mapping;this.wheel=new physics.tracking.matchers.Mapping;this.cargoes=new physics.collections.Ordered;
this.environment=new physics.tracking.matchers.Mapping;this.clearance=new physics.tracking.matchers.Mapping;this.load=new physics.tracking.matchers.Mapping;this.unload=new physics.tracking.matchers.Mapping;this.obstacles=new physics.collections.Ordered;this.obstacleCheck=new physics.tracking.matchers.Mapping;this.define()},Obstacles:function(a){this.matchers=a;this.reset()},EmitterParams:function(a,b,c,d,e,f,g,h,l,k,m,n,p,q){this.resources=a;this.rotation=b;this.dispersion=c;this.strengthHorizontalAbs=
d;this.strengthHorizontalRel=e;this.strengthVertical=f;this.strengthLimit=g;this.intensityThreshold=h;this.intensityLimit=l;this.interval=k;this.gravity=m;this.inDuration=n;this.outDuration=p;this.gain=q},EmitterContext:function(a,b,c){this.params=a;this.audioContext=b;this.view=c;this.start()}},loading:{Loader:function(a,b,c,d){this.matchers=a;this.credits=b;this.keyboardControls=c;this.tutorial=d;this.fixture=physics.interaction.Fixture.stationary(physics.dynamics.Vector.ZERO);this.animation=physics.dynamics.Particle.infiniteMass(physics.dynamics.Motion.ZERO);
this.animators=new physics.collections.Ordered;this.bounds=new physics.collections.Ordered;this.cargoes=new physics.collections.Ordered;this.bundle=new physics.collections.Bundle;this.controlsBundle=new physics.collections.Bundle},Animator:function(a,b,c,d){this.loader=a;this.upgrader=b;this.cargo=c;this.cargoData=d;this.graphics=new physics.collections.Ordered;this.animation=physics.dynamics.Particle.infiniteMass(physics.dynamics.Motion.ZERO);this.cancelable=new physics.actors.animation.Cancelable},
Animation:function(a,b,c){this.fillStyle=a;this.inDuration=b;this.outDuration=c}},hud:{Menu:function(a,b,c,d){this.loader=a;this.obstacles=b;this.locator=c;this.motor=d;this.flash=new game.hud.Flash(c.view.engine,.5);this.vehicleTunings=this.newVehicleTunings();this.sceneryTunings=this.newSceneryTunings();this.vehicleSelector=this.newVehicleSelector();this.scenerySelector=this.newScenerySelector();this.deliveries=[];this.deliveryBundle=new physics.collections.Bundle;this.submenuPath=[this.newSubmenu()];
this.unlockedBundle=new physics.collections.Bundle;this.leftGraphics=new physics.collections.Ordered;this.rightGraphics=new physics.collections.Ordered;this.submenuBundle=new physics.collections.Bundle;this.vehicleBuilder=this.newVehicleBuilder();this.sceneryBuilder=this.newSceneryBuilder();this.verifyDeliveryTargets();this.addDeliveries();this.addMultiplierGraphics()},Flash:function(a,b){this.engine=a;this.animation=physics.dynamics.Particle.infiniteMass(physics.dynamics.Motion.ZERO);this.timer=
new physics.actors.animation.Timer(b,0);this.bundle=new physics.collections.Bundle},Property:function(a,b,c,d){this.path=a;this.serializer=b;this.deserializer=c;this.original=d},Selector:function(a,b,c,d){this.label=a;this.list=b;this.index=game.hud.Selector.find(b,c.get());this.property=c;this.listener=d},Tuning:function(a,b,c,d,e,f,g,h,l){this.label=a;this.name=b;this.value=f.get();this.maxValue=c;this.maxMultiplier=d;this.allowNegative=e;this.valueProperty=f;this.lockedProperty=g;this.costEvaluator=
h;this.listener=l},Submenu:function(a,b,c,d,e,f){this.data=a;this.canIncrement=b;this.canDecrement=c;this.increment=d;this.decrement=e;this.unlock=f},Upgrader:function(a,b,c){this.menu=a;this.filters=b;this.listener=c},CargoTracker:function(a){this.menu=a;this.bundle=new physics.collections.Bundle;this.reset()},Credits:function(a){this.engine=a;this.property=game.hud.Property.integerRange(["credits"],game.hud.Credits.MIN_AMOUNT,game.hud.Credits.MAX_AMOUNT,0);this.graphics=new physics.collections.Ordered;
this.outlines=new physics.collections.Ordered;this.multiplier=1;this.digits=[];this.coins=this.newCoins();this.updateDigits()},Coin:function(a,b){this.credits=a;this.origin=b.y;this.particle=a.newParticle(b);this.addParticle();this.addGraphics();this.groundY(b.y)},Digit:function(a,b,c){this.credits=a;this.character=b;this.origin=c.y;this.particle=a.newParticle(c);this.bundleX=new physics.collections.Bundle;this.bundle=new physics.collections.Bundle;this.addBundle();this.groundX(c.x);this.groundY(c.y)},
Locator:function(a){this.view=a;this.origins=new physics.collections.Ordered;this.ranges=new physics.collections.Ordered;this.graphics=new physics.collections.Ordered;this.addTrack()},Button:function(a,b,c,d,e){this.engine=a;this.button=this.newButton(d);this.handler=this.newHandler(physics.actors.input.filters.bounds(c.graphic),e);this.registrator=this.handler.registrator();this.bundle=(new physics.collections.Bundle).add(b,physics.actors.input.filters.bounds(c.graphic)).addBundle(c.bundle);this.add(c.graphic)},
Pedal:function(a,b,c,d,e,f,g){this.engine=a;this.motor=e;this.shift=0;this.particle=physics.dynamics.Particle.oneMass(physics.dynamics.Motion.ZERO);this.graphic=this.newGraphic(c.graphic,d);this.button=this.newButton(e,f);this.handler=this.newHandler(g);this.registrator=this.handler.registrator();this.bundle=(new physics.collections.Bundle).add(b,physics.actors.input.filters.bounds(this.graphic)).addBundle(c.bundle);this.linkBundle=new physics.collections.Bundle;this.link(0);this.add()},KeyboardControls:function(a){this.engine=
a;this.collection=new physics.collections.Ordered;this.active=!1;this.animation=physics.dynamics.Particle.infiniteMass(physics.dynamics.Motion.ZERO);this.timer=new physics.actors.animation.Timer(game.Engine.FADE_DURATION,0);this.cancelable=new physics.actors.animation.Cancelable;this.activationListener=this.activate.bind(this);this.deactivationListener=this.deactivate.bind(this)},Tutorial:function(a,b,c){this.engine=a;this.filters=b;this.keyboardControls=c;this.queue=[]},TutorialBox:function(a,b,
c,d,e,f,g,h){this.id=a;this.order=b;this.image=c;this.absolute=d;this.relative=e;this.margin=f;this.alignment=g;this.keysAbsolute=h}},graphics:{BackgroundGraphic:function(a,b,c){this.context=a;this.graphic=b;this.height=c},BackgroundOffset:function(a,b,c,d){this.context=a;this.graphic=b;this.height=c;this.alpha=d},ParallaxBackground:function(a,b,c,d){this.camera=a;this.graphic=b;this.size=c;this.multiplier=d},ParallaxImage:function(a,b,c,d,e){this.camera=a;this.image=b();this.origin=c;this.range=
d;this.multiplier=e;this.pattern=a.context.context2d.createPattern(b(),"no-repeat")},RepeatedGraphic:function(a,b,c){this.context=a;this.graphic=b;this.size=c},RepeatedImageX:function(a,b,c){this.context=a;this.image=b();this.size=c;this.pattern=a.context2d.createPattern(b(),"repeat-x")},RepeatedImage:function(a,b,c,d,e,f){this.context=a;this.height=c;this.size=d;this.particle=e;this.mapper=f;this.pattern=a.context2d.createPattern(b(),"repeat")},depthsOf:function(a){const b={};a.forEach(function(c,
d){for(var e=b,f=0;f<c.length-1;f++)e.hasOwnProperty(c[f])||(e[c[f]]={}),e=e[c[f]];e[c[c.length-1]]=d});return b}}};game.Engine.STIFF_ELASTICITY=new physics.interaction.Elasticity(.2,.5);game.Engine.SINGULARITY=new physics.interaction.Singularity(.01);game.Engine.FADE_DURATION=.2;game.Engine.TAP_DISTANCE=16;game.Engine.TAP_DURATION=.25;game.Engine.PULSE_DURATION=.5;game.Engine.AUDIO_GAIN=.6;game.Engine.COLORS={WHITE:"#fff",BLACK:"#000",RED:"#f44",BLUE:"#44f"};game.Engine.FONT_FAMILY="'New Era Casual Regular'";
game.Engine.FONT_PROPERTIES={DEBUGGING:{font:"36px "+game.Engine.FONT_FAMILY,fillStyle:game.Engine.COLORS.BLACK,textAlign:"left",textBaseline:"middle"},CREDITS:{font:"112px "+game.Engine.FONT_FAMILY,fillStyle:game.Engine.COLORS.WHITE,strokeStyle:game.Engine.COLORS.BLACK,lineWidth:16,textAlign:"center",textBaseline:"middle"},MENU_PATH:{font:"72px "+game.Engine.FONT_FAMILY,fillStyle:game.Engine.COLORS.WHITE,strokeStyle:game.Engine.COLORS.BLACK,lineWidth:16,textBaseline:"middle"},MENU_STATS:{font:"56px "+
game.Engine.FONT_FAMILY,fillStyle:game.Engine.COLORS.WHITE,strokeStyle:game.Engine.COLORS.BLACK,lineWidth:16,textBaseline:"middle"}};game.Engine.stiffFrictional=function(a){return new physics.interaction.Frictional(game.Engine.STIFF_ELASTICITY,a)};game.Engine.prototype.newRendering=function(){return new physics.rendering.Context(this.canvas.getContext("2d"),new physics.Context(.005,this.particles,physics.actors.nonZero(physics.actors.container(this.actors))))};game.Engine.prototype.addParticle=function(){this.particles.add(this.pulseAnimation)};
game.Engine.prototype.addDebugging=function(){this.originalActor=this.rendering.physics.actor;this.rendering.physics.actor=physics.actors.warnDangling(this.originalActor,this.particles)};game.Engine.prototype.removeDebugging=function(){this.rendering.physics.actor=this.originalActor;delete this.originalActor};game.Engine.prototype.addGraphics=function(){this.graphics.add(new physics.rendering.graphics.Clearer(this.rendering))};
game.Engine.prototype.newTextGraphic=function(a,b){return physics.rendering.graphics.Container.fixed([new physics.rendering.graphics.text.Stroker(this.rendering,a,b),new physics.rendering.graphics.text.Filler(this.rendering,a,b)])};
game.Engine.prototype.newPulseTextGraphic=function(a,b){return physics.rendering.graphics.Container.fixed([new physics.rendering.graphics.ColorProperty(this.rendering,this.pulseAnimation,physics.rendering.mappers.WAVE_01,"fillStyle",physics.rendering.Color.fromCss(game.Engine.COLORS.WHITE),physics.rendering.Color.fromCss(game.Engine.COLORS.RED)),this.newTextGraphic(a,b)])};
game.Engine.prototype.newBackgroundFiller=function(a){return physics.rendering.graphics.Container.fixed([new physics.rendering.graphics.path.Beginner(this.rendering),new physics.rendering.graphics.Background(this.rendering),new physics.rendering.graphics.Properties(this.rendering,{fillStyle:a}),new physics.rendering.graphics.path.Filler(this.rendering)])};
game.Engine.prototype.newFittedControlSurface=function(a,b){return{graphic:new physics.rendering.graphics.Fitted(this.rendering,a.graphic,game.View.REF_SIZE,b),bundle:a.bundle}};
game.Engine.prototype.newFadingControlSurfaceFactory=function(a){const b=physics.dynamics.Particle.infiniteMass(physics.dynamics.Motion.ZERO),c=new physics.actors.animation.Timer(a,0),d=new physics.collections.Bundle;return function(e){d.release();return{graphic:new physics.rendering.graphics.Alpha(this.rendering,e.graphic,b,physics.rendering.mappers.WAVE_01),bundle:e.bundle.addBundle(d.add(this.particles,b).addAll(this.actors,[c.elapsedActor(function(){d.release()}),physics.actors.animation.Transition.zeroPi(c,
b).actor()]))}}.bind(this)};
game.Engine.prototype.newControlSurface=function(a,b,c,d,e,f,g,h,l){d=new physics.rendering.graphics.Margin(physics.rendering.graphics.Image.fromOrigin(this.rendering,a(),b).addRelative(c),d);const k=new physics.collections.Ordered;k.add(d);return{graphic:new physics.rendering.graphics.Separator(d,physics.rendering.graphics.Container.variable(k)),bundle:e.add(physics.rendering.graphics.Image.fromOrigin(this.rendering,f(),b.add(g).add(physics.dynamics.Vector.fromImage(a()).multiplyVector(c.add(l)))).addRelative(h),k)}};
game.Engine.prototype.measureWidth=function(a,b){this.rendering.assign(b);return this.rendering.context2d.measureText(a).width};game.Engine.prototype.fireAudio=function(a){const b=new GainNode(this.avContext.audio,{gain:game.Engine.AUDIO_GAIN});b.connect(this.avContext.audio.destination);a=new AudioBufferSourceNode(this.avContext.audio,{buffer:a()});a.connect(b);a.onended=function(){b.disconnect()};a.start()};
game.Engine.prototype.queueUpdateSize=function(){this.preUpdateQueue.push(function(){this.canvas.width=window.innerWidth*window.devicePixelRatio;this.canvas.height=window.innerHeight*window.devicePixelRatio}.bind(this))};game.Engine.prototype.preUpdate=function(){for(;this.preUpdateQueue.length;)this.preUpdateQueue.pop().call(null)};
game.Engine.prototype.attach=function(){this.queueUpdateSize();var a=null,b=this.avContext.run(this);window.addEventListener("resize",this.queueUpdateSize.bind(this));window.addEventListener("visibilitychange",function(){"visible"==document.visibilityState?a&&(b=a(),a=null):b&&(a=b(),b=null)}.bind(this))};game.View.REF_SIZE=new physics.dynamics.Vector(1920,1080);game.View.PX_PER_M=200;game.View.GRAVITY=9.81*game.View.PX_PER_M;game.View.MOTION_SCALING=2E-4;game.View.NORMAL_DISTANCE=10*game.View.PX_PER_M;
game.View.CAMERA_OFFSET=new physics.dynamics.Vector(.515,.63);game.View.COLLISION_TRACKING_SIZE=(new physics.dynamics.Vector(.5,.5)).multiply(game.View.PX_PER_M);game.View.GRAPHIC_TRACKING_SIZE=(new physics.dynamics.Vector(game.View.REF_SIZE.x/4,0)).add(sceneries.utility.Builder.TERRAIN_HEIGHT);game.View.COLLISION_TRACKING_MARGIN=physics.dynamics.Rectangle.symmetric(physics.dynamics.Vector.fromOne(.1).multiply(game.View.PX_PER_M));game.View.GRAPHIC_TRACKING_MARGIN=physics.dynamics.Rectangle.symmetric(physics.dynamics.Vector.fromOne(25));
game.View.prototype.sceneryScaling=function(){return this.scalings.values().reduce(physics.utility.multiply,1)};game.View.prototype.scaledRefSize=function(){return this.sceneryScaling()*game.View.REF_SIZE.length()};game.View.prototype.cameraDepth=function(a){return game.View.NORMAL_DISTANCE*(this.sceneryScaling()+game.View.MOTION_SCALING*a.velocity.translation.length())};game.View.prototype.cameraScale=function(a){return game.View.REF_SIZE.length()/(game.View.NORMAL_DISTANCE*a.length())};
game.View.prototype.audioHandler=function(a){return physics.interaction.handlers.audio(this.engine.avContext.audio,this.camera,a(),game.View.NORMAL_DISTANCE,.2,1*game.View.PX_PER_M,8*game.View.PX_PER_M)};game.View.prototype.fireAudio=function(a,b){this.camera.fireAudio(this.engine.avContext.audio,a,.8*game.View.NORMAL_DISTANCE,b())};
game.View.prototype.newGravity=function(a,b){return physics.actors.constant([new physics.interaction.Action(a,physics.dynamics.Transformation.fromTranslation(new physics.dynamics.Vector(0,b)))])};game.View.prototype.newDefaultGravity=function(a){return this.newGravity(a,game.View.GRAVITY)};game.View.prototype.addGravityParticle=function(a,b){return(new physics.collections.Bundle).add(this.engine.particles,a).add(this.engine.actors,this.newGravity(a,b))};
game.View.prototype.addDefaultGravityParticle=function(a){return this.addGravityParticle(a,game.View.GRAVITY)};game.View.prototype.newCamera=function(){return new physics.rendering.perspective.Camera(this.engine.rendering,physics.dynamics.Particle.oneMass(physics.dynamics.Motion.ZERO),this.cameraDepth.bind(this),this.cameraScale.bind(this),game.View.CAMERA_OFFSET)};game.View.prototype.addCamera=function(){this.engine.particles.add(this.camera.particle);this.graphics.add(this.camera)};
game.View.prototype.addGraphics=function(){physics.collections.addAll(this.engine.graphics,[physics.rendering.graphics.Container.variable(this.background),new physics.rendering.perspective.Transformer(this.graphics.graphic(),this.camera)])};game.View.prototype.centerCamera=function(a){this.camera.particle.reset(physics.dynamics.Motion.fromPosition(physics.dynamics.Transformation.fromTranslation(a.transformOrigin())))};
game.View.prototype.follow=function(a){const b=new physics.collections.Ordered,c=physics.interaction.Fixture.stationary(physics.dynamics.Vector.ZERO);this.centerCamera(a);return(new physics.collections.Bundle).add(this.engine.actors,physics.actors.container(b)).addAll(b,[physics.actors.tracer(a,c,200,1.5),physics.actors.projection2(c,physics.interaction.Fixture.centroid(this.camera.particle),physics.interaction.handlers.elasticity(new physics.interaction.Elasticity(.02,1)))])};
game.bootstrap.AvContext.CAPTURED_REG_EXP=/capture\((\d+),(\d+),(\d+)\)/;game.bootstrap.AvContext.build=function(){const a=window.location.search.match(game.bootstrap.AvContext.CAPTURED_REG_EXP);return a?new game.bootstrap.CapturedAvContext(parseInt(a[1]),parseInt(a[2]),parseInt(a[3])):new game.bootstrap.AvContext};
game.bootstrap.AvContext.prototype.run=function(a){const b=function(c){this.audio.resume();return function(d){this.audio.suspend();d();return b}.bind(this,a.rendering.run(c,a.preUpdate.bind(a)))}.bind(this,physics.rendering.graphics.Container.variable(a.graphics));return b()};game.bootstrap.CapturedAvContext.READY_COUNT=3;
game.bootstrap.CapturedAvContext.audioBufferToPcm=function(a){const b=[];for(var c=0;c<a.numberOfChannels;c++)b.push(a.getChannelData(c));const d=new Float32Array(a.length*a.numberOfChannels);for(c=0;c<a.length;c++)b.forEach(function(e,f){d[c*a.numberOfChannels+f]=e[c]});return d};game.bootstrap.CapturedAvContext.downloadBlobs=function(a){a=new Blob(a,{type:"application/octet-stream"});window.open(URL.createObjectURL(a));URL.revokeObjectURL(a)};
game.bootstrap.CapturedAvContext.prototype.makeReady=function(a){++a.readyCount>=game.bootstrap.CapturedAvContext.READY_COUNT&&this.step(a)};game.bootstrap.CapturedAvContext.prototype.toggleCanvasCapture=function(a,b){"F9"===b.code&&(a.doCaptureCanvas=!a.doCaptureCanvas)};
game.bootstrap.CapturedAvContext.prototype.prepare=function(a){a.engine.preUpdate();a.engine.canvas.toBlob(function(b){a.emptyBlob=b;this.makeReady(a)}.bind(this));this.audio.suspend(a.currentTime).then(this.makeReady.bind(this,a));this.audio.startRendering().then(function(b){game.bootstrap.CapturedAvContext.downloadBlobs(a.canvasBlobs);game.bootstrap.CapturedAvContext.downloadBlobs([game.bootstrap.CapturedAvContext.audioBufferToPcm(b)]);a.readyCount--})};
game.bootstrap.CapturedAvContext.prototype.step=function(a){a.readyCount-=game.bootstrap.CapturedAvContext.READY_COUNT;a.engine.preUpdate();a.engine.rendering.update(1/this.fps);a.engine.rendering.render(a.graphic);a.currentTime+=1/this.fps;a.currentTime<this.duration&&this.audio.suspend(a.currentTime).then(this.makeReady.bind(this,a));this.audio.resume();a.doCaptureCanvas?a.engine.canvas.toBlob(function(b){a.canvasBlobs.push(b);this.makeReady(a)}.bind(this)):(a.canvasBlobs.push(a.emptyBlob),this.makeReady(a));
setTimeout(this.makeReady.bind(this,a),1E3/this.fps)};game.bootstrap.CapturedAvContext.prototype.alert=function(){alert(["Capture video at ",this.fps," fps and audio at ",this.sampleRate," Hz for ",this.duration," seconds"].join(""))};
game.bootstrap.CapturedAvContext.prototype.run=function(a){const b={engine:a,graphic:physics.rendering.graphics.Container.variable(a.graphics),currentTime:this.audio.currentTime,canvasBlobs:[],readyCount:0,doCaptureCanvas:!1};this.alert();this.prepare(b);const c=this.toggleCanvasCapture.bind(this,b),d=function(){window.addEventListener("keydown",c);this.makeReady(b);return function(){window.removeEventListener("keydown",c);b.readyCount--;return d}}.bind(this);return d()};
game.bootstrap.Runner.prototype.setUp=function(){this.addGraphics();this.addParticles();this.addActors();this.addGameButtons();this.tutorial.open(game.hud.TutorialBox.INTRO);this.menu.update();this.menu.resetScenery()};game.bootstrap.Runner.prototype.newEngine=function(a){return new game.Engine(document.getElementsByTagName("canvas")[0],a)};game.bootstrap.Runner.prototype.newKeyboardControls=function(){return new game.hud.KeyboardControls(this.engine)};
game.bootstrap.Runner.prototype.newTutorial=function(){return new game.hud.Tutorial(this.engine,this.filters,this.keyboardControls)};game.bootstrap.Runner.prototype.newLoader=function(){return new game.loading.Loader(new game.collisions.Matchers(new game.View(this.engine)),new game.hud.Credits(this.engine),this.keyboardControls,this.tutorial)};game.bootstrap.Runner.prototype.newObstacles=function(){return new game.collisions.Obstacles(this.loader.matchers)};
game.bootstrap.Runner.prototype.newLocator=function(){return new game.hud.Locator(this.loader.matchers.view)};game.bootstrap.Runner.prototype.newMenu=function(){return new game.hud.Menu(this.loader,this.obstacles,this.locator,this.motor)};game.bootstrap.Runner.prototype.newUpgrader=function(){return new game.hud.Upgrader(this.menu,this.filters,function(){this.menuButton.button.reset()}.bind(this))};game.bootstrap.Runner.prototype.newCargoTracker=function(){return new game.hud.CargoTracker(this.menu)};
game.bootstrap.Runner.prototype.addGameButtons=function(){this.addMenuButton();this.addRestartButton();this.addBrakePedal();this.addGasPedal();this.loader.addControls(this.upgrader,this.cargoTracker,this.newLoaderFilter())};game.bootstrap.Runner.prototype.removeGameButtons=function(){this.loader.removeControls();this.menuButton.release();this.restartButton.release();this.brakePedal.release();this.gasPedal.release()};
game.bootstrap.Runner.prototype.updateCrementButtons=function(){this.removeIncrementButton();this.removeDecrementButton();this.addIncrementButton();this.addDecrementButton()};
game.bootstrap.Runner.prototype.addRestartButton=function(){this.restartButton=new game.hud.Button(this.engine,this.filters,this.engine.newFittedControlSurface(this.engine.newControlSurface(resources.hud.buttons.game.restart.image,new physics.dynamics.Vector(304,-game.hud.Button.MARGIN.min.y),physics.dynamics.Vector.ZERO,game.hud.Button.MARGIN,this.keyboardControls,resources.hud.keys.enterTab,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-.5,-1),new physics.dynamics.Vector(1,1.1)),physics.rendering.graphics.Fitted.UPPER_LEFT),
function(a){this.engine.fireAudio(resources.hud.buttons.game.restart.sound);this.cargoTracker.confirmRestartTutorial();this.menu.flash.doWaiting(this.menu.resetScenery.bind(this.menu));return[]}.bind(this),["Enter","Tab"])};
game.bootstrap.Runner.prototype.addMenuButton=function(){this.menuButton=new game.hud.Button(this.engine,this.filters,this.engine.newFittedControlSurface(this.engine.newControlSurface(resources.hud.buttons.game.menu.image,game.hud.Button.MARGIN.min.negate(),physics.dynamics.Vector.ZERO,game.hud.Button.MARGIN,this.keyboardControls,resources.hud.keys.escapeBackspace,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-.5,-1),new physics.dynamics.Vector(1,1.1)),physics.rendering.graphics.Fitted.UPPER_LEFT),
function(a){this.engine.fireAudio(resources.hud.buttons.game.menu.sound);this.cargoTracker.confirmRestartTutorial();this.menu.resetVehicle();this.menu.addGraphics();this.menu.update();this.upgrader.removeGraphics();this.removeGameButtons();this.addNextButton();this.addExitButton();this.addIncrementButton();this.addDecrementButton();this.menu.flash.trigger(game.hud.Flash.RESET_FILL_STYLE);return[]}.bind(this),["Escape","Backspace"])};
game.bootstrap.Runner.prototype.addNextButton=function(){this.nextButton=new game.hud.Button(this.engine,this.filters,this.engine.newFittedControlSurface(this.engine.newControlSurface(resources.hud.buttons.menu.select.next,new physics.dynamics.Vector(304,-game.hud.Button.MARGIN.min.y),physics.dynamics.Vector.ZERO,game.hud.Button.MARGIN,this.keyboardControls,resources.hud.keys.enterTab,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-.5,-1),new physics.dynamics.Vector(1,1.1)),physics.rendering.graphics.Fitted.UPPER_LEFT),
function(a){this.menu.unlockable()?(this.engine.fireAudio(resources.hud.buttons.menu.select.sound),this.menu.unlock(),this.menu.isRoot()&&(this.exitButton.release(),this.addPreviousButton()),this.menu.next(),this.menu.isLeaf()&&this.nextButton.release(),this.updateCrementButtons()):(this.engine.fireAudio(resources.hud.buttons.locked),this.menu.flash.trigger(game.hud.Flash.LOCKED_FILL_STYLE));return[]}.bind(this),["Enter","Tab"])};
game.bootstrap.Runner.prototype.addPreviousButton=function(){this.previousButton=new game.hud.Button(this.engine,this.filters,this.engine.newFittedControlSurface(this.engine.newControlSurface(resources.hud.buttons.menu.select.previous,game.hud.Button.MARGIN.min.negate(),physics.dynamics.Vector.ZERO,game.hud.Button.MARGIN,this.keyboardControls,resources.hud.keys.escapeBackspace,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-.5,-1),new physics.dynamics.Vector(1,1.1)),physics.rendering.graphics.Fitted.UPPER_LEFT),
function(a){this.menu.unlockable()?(this.engine.fireAudio(resources.hud.buttons.menu.select.sound),this.menu.unlock(),this.menu.isLeaf()&&this.addNextButton(),this.menu.previous(),this.menu.isRoot()&&(this.previousButton.release(),this.addExitButton()),this.updateCrementButtons()):(this.engine.fireAudio(resources.hud.buttons.locked),this.menu.flash.trigger(game.hud.Flash.LOCKED_FILL_STYLE));return[]}.bind(this),["Escape","Backspace"])};
game.bootstrap.Runner.prototype.addIncrementButton=function(){!this.hasOwnProperty("incrementButton")&&this.menu.canIncrement()&&(this.incrementButton=new game.hud.Button(this.engine,this.filters,this.engine.newFittedControlSurface(this.engine.newControlSurface(resources.hud.buttons.menu.change.increment,game.View.REF_SIZE.subtract(game.hud.Button.MARGIN.max),new physics.dynamics.Vector(-1,-1),game.hud.Button.MARGIN,this.keyboardControls,resources.hud.keys.arrowUpRight,physics.dynamics.Vector.ZERO,
new physics.dynamics.Vector(0,-1),new physics.dynamics.Vector(0,1)),physics.rendering.graphics.Fitted.LOWER_RIGHT),function(a){this.engine.fireAudio(resources.hud.buttons.menu.change.sound);this.menu.increment();this.addDecrementButton();this.menu.canIncrement()||this.removeIncrementButton();return[]}.bind(this),["ArrowUp","ArrowRight"]))};game.bootstrap.Runner.prototype.removeIncrementButton=function(){this.hasOwnProperty("incrementButton")&&(this.incrementButton.release(),delete this.incrementButton)};
game.bootstrap.Runner.prototype.addDecrementButton=function(){!this.hasOwnProperty("decrementButton")&&this.menu.canDecrement()&&(this.decrementButton=new game.hud.Button(this.engine,this.filters,this.engine.newFittedControlSurface(this.engine.newControlSurface(resources.hud.buttons.menu.change.decrement,new physics.dynamics.Vector(-game.hud.Button.MARGIN.min.x,game.View.REF_SIZE.y-game.hud.Button.MARGIN.max.y),new physics.dynamics.Vector(0,-1),game.hud.Button.MARGIN,this.keyboardControls,resources.hud.keys.arrowDownLeft,
physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-1,-1),new physics.dynamics.Vector(1,1)),physics.rendering.graphics.Fitted.LOWER_LEFT),function(a){this.engine.fireAudio(resources.hud.buttons.menu.change.sound);this.menu.decrement();this.addIncrementButton();this.menu.canDecrement()||this.removeDecrementButton();return[]}.bind(this),["ArrowDown","ArrowLeft"]))};
game.bootstrap.Runner.prototype.removeDecrementButton=function(){this.hasOwnProperty("decrementButton")&&(this.decrementButton.release(),delete this.decrementButton)};
game.bootstrap.Runner.prototype.addExitButton=function(){this.exitButton=new game.hud.Button(this.engine,this.filters,this.engine.newFittedControlSurface(this.engine.newControlSurface(resources.hud.buttons.menu.exit.image,game.hud.Button.MARGIN.min.negate(),physics.dynamics.Vector.ZERO,game.hud.Button.MARGIN,this.keyboardControls,resources.hud.keys.escapeBackspace,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-.5,-1),new physics.dynamics.Vector(1,1.1)),physics.rendering.graphics.Fitted.UPPER_LEFT),
function(a){this.menu.unlockable()?(this.engine.fireAudio(resources.hud.buttons.menu.exit.sound),this.menu.unlock(),this.menu.flash.doWaiting(function(){this.nextButton.release();this.exitButton.release();this.removeIncrementButton();this.removeDecrementButton();this.addGameButtons();this.menu.resetScenery();this.menu.removeGraphics();this.upgrader.update()}.bind(this))):(this.engine.fireAudio(resources.hud.buttons.locked),this.menu.flash.trigger(game.hud.Flash.LOCKED_FILL_STYLE));return[]}.bind(this),
["Escape","Backspace"])};
game.bootstrap.Runner.prototype.addBrakePedal=function(){this.brakePedal=new game.hud.Pedal(this.engine,this.filters,this.engine.newControlSurface(resources.hud.pedals.brake,new physics.dynamics.Vector(-game.hud.Button.MARGIN.min.x,game.View.REF_SIZE.y),new physics.dynamics.Vector(0,-1),game.hud.Pedal.MARGIN,this.keyboardControls,resources.hud.keys.arrowDownLeft,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-.75,-.5),new physics.dynamics.Vector(1,.4)),physics.rendering.graphics.Fitted.LOWER_LEFT,this.motor,
-1,["ArrowDown","ArrowLeft"])};
game.bootstrap.Runner.prototype.addGasPedal=function(){this.gasPedal=new game.hud.Pedal(this.engine,this.filters,this.engine.newControlSurface(resources.hud.pedals.gas,game.View.REF_SIZE.subtract(new physics.dynamics.Vector(game.hud.Button.MARGIN.max.x,0)),new physics.dynamics.Vector(-1,-1),game.hud.Pedal.MARGIN,this.keyboardControls,resources.hud.keys.arrowUpRight,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-.55,-.5),new physics.dynamics.Vector(0,.55)),physics.rendering.graphics.Fitted.LOWER_RIGHT,
this.motor,1,["ArrowUp","ArrowRight"])};game.bootstrap.Runner.prototype.newLoaderFilter=function(){return physics.actors.input.filters.not(physics.actors.input.filters.anyOf(this.filters))};game.bootstrap.Runner.prototype.addParticles=function(){this.loader.addParticle()};game.bootstrap.Runner.prototype.addActors=function(){this.loader.addActors();this.obstacles.addBeforeActors();this.obstacles.matchers.addActors();this.obstacles.addAfterActors()};
game.bootstrap.Runner.prototype.addGraphics=function(){this.loader.matchers.view.engine.addGraphics();this.loader.matchers.view.addGraphics();this.loader.credits.addGraphics();this.locator.addGraphics();this.upgrader.update()};game.bootstrap.Runner.prototype.run=function(){this.engine.attach();this.keyboardControls.attachActivation();this.menu.attach()};game.utility.Range.ZERO=new game.utility.Range(0,0);game.utility.Range.ONE=new game.utility.Range(0,1);
game.utility.Range.PI_2=new game.utility.Range(0,physics.utility.PI_2);game.utility.Range.rectangleX=function(a){return new game.utility.Range(a.min.x,a.max.x)};game.utility.Range.symmetric=function(a){return new game.utility.Range(-a,a)};game.utility.Range.prototype.contains=function(a){return a>=this.min&&a<this.max};game.utility.Range.prototype.intersects=function(a){return this.max>a.min&&this.min<a.max};
game.utility.Range.prototype.intersect=function(a){return new game.utility.Range(Math.max(this.min,a.min),Math.min(this.max,a.max))};game.utility.Range.prototype.length=function(){return this.max-this.min};game.utility.Range.prototype.alpha=function(a){return(a-this.min)/this.length()};game.utility.Range.prototype.interpolate=function(a){return physics.utility.interpolate(this.min,this.max,a)};game.utility.Range.prototype.random=function(){return this.interpolate(Math.random())};
game.utility.Range.prototype.add=function(a){return new game.utility.Range(this.min+a,this.max+a)};game.utility.Range.prototype.subtract=function(a){return new game.utility.Range(this.min-a,this.max-a)};game.utility.Range.prototype.multiply=function(a){return new game.utility.Range(this.min*a,this.max*a)};game.utility.Range.prototype.divide=function(a){return new game.utility.Range(this.min/a,this.max/a)};game.utility.Range.prototype.clamp=function(a){return physics.utility.clamp(a,this.min,this.max)};
game.collisions.Matchers.newFrictionalsVehicleScenery=function(){const a={};Object.keys(game.collisions.Matchers.FRICTIONALS.VEHICLE_SCENERY).forEach(function(b){a[b]=new physics.interaction.Frictional(game.collisions.Matchers.FRICTIONALS.VEHICLE_SCENERY[b].elasticity,game.collisions.Matchers.FRICTIONALS.VEHICLE_SCENERY[b].friction)}.bind(this));return a};
game.collisions.Matchers.prototype.define=function(){this.chassis.defineSymmetric(this.environment,physics.collisions.mergers.collision(physics.interaction.handlers.merge(this.chassisEnvironmentHandlers)));this.wheel.defineDirectedMerger(this.environment,physics.collisions.mergers.collision(physics.interaction.handlers.merge(this.wheelEnvironmentHandlers)));this.load.defineSymmetric(this.chassis,this.loadMerger);this.load.defineSymmetric(this.wheel,this.loadMerger);this.obstacleCheck.defineSymmetric(this.obstacleCheck,
this.obstacleCheckMerger)};game.collisions.Matchers.prototype.defineCargo=function(a,b,c){a.defineSymmetric(b,physics.collisions.mergers.collision(c));this.clearance.defineSymmetric(b,this.clearanceMerger)};game.collisions.Matchers.prototype.defineObstacle=function(a,b,c){a.defineSymmetric(b,physics.collisions.mergers.collision(c));this.obstacleCheck.defineSymmetric(b,this.obstacleCheckMerger)};
game.collisions.Matchers.prototype.defineCargoObstacle=function(a,b,c,d){a.defineSymmetric(c,physics.collisions.mergers.collision(physics.interaction.handlers.mergeArray([game.collisions.Matchers.FRICTIONALS.OBSTACLE_CARGO.handler(),this.view.audioHandler(b),this.view.audioHandler(d)])));this.clearance.defineSymmetric(c,this.clearanceMerger);this.obstacleCheck.defineSymmetric(a,this.obstacleCheckMerger)};
game.collisions.Matchers.prototype.updateFrictions=function(){const a=this.frictionMultipliers.values().reduce(physics.utility.multiply,1);Object.keys(this.frictionalsVehicleScenery).forEach(function(b){this.frictionalsVehicleScenery[b].friction=a*game.collisions.Matchers.FRICTIONALS.VEHICLE_SCENERY[b].friction}.bind(this))};
game.collisions.Matchers.prototype.addActors=function(){physics.collections.addAll(this.view.engine.actors,[this.clearanceToggle.resetActor(!1),this.loadToggle.resetActor(!1),this.obstacleToggle.resetActor(!1),this.clearanceToggle.unlockActor(this.loadToggle.unlockActor(this.obstacleToggle.unlockActor(physics.actors.maximizer(this.view.collisions.actor(),game.Engine.SINGULARITY))))])};
game.collisions.Matchers.prototype.addEmitter=function(a){const b=[];return(new physics.collections.Bundle).add(this.wheelEnvironmentHandlers,a.collisionHandler(b)).add(this.emitterQueues,b)};game.collisions.Matchers.prototype.newHandlers=function(a,b){return physics.interaction.handlers.mergeArray([physics.interaction.handlers.merge(a),this.view.audioHandler(b)])};
game.collisions.Matchers.prototype.addCargoMatcher=function(a,b){const c=new physics.tracking.matchers.Mapping;a.add(this.cargoes,{sound:b,matcher:c});this.defineCargo(c,this.chassis,this.newHandlers(this.chassisCargoHandlers,b));this.cargoes.values().forEach(function(d){this.defineCargo(c,d.matcher,physics.interaction.handlers.mergeArray([game.collisions.Matchers.FRICTIONALS.CARGO_SELF.handler(),this.view.audioHandler(b),this.view.audioHandler(d.sound)]))}.bind(this));this.obstacles.values().forEach(function(d){this.defineCargoObstacle(c,
b,d.matcher,d.sound)}.bind(this));return c};
game.collisions.Matchers.prototype.addCargoCollisions=function(a,b,c,d,e){c=new physics.tracking.matchers.MappingOverride(c);c.defineSymmetric(this.environment,physics.collisions.mergers.collision(physics.interaction.handlers.mergeArray([physics.interaction.handlers.merge(this.environmentCargoHandlers),this.view.audioHandler(b),function(f,g,h){d();return[]}])));c.defineDirectedMerger(this.unload,physics.collisions.mergers.ifContains(function(f){e();return[]}));return(new physics.collections.Bundle).add(this.view.collisions,
new physics.collisions.Collider(a,c))};
game.collisions.Matchers.prototype.addObstacleMatcher=function(a,b){const c=new physics.tracking.matchers.Mapping;a.add(this.obstacles,{sound:b,matcher:c});this.defineObstacle(c,this.environment,this.newHandlers(this.environmentObstacleHandlers,b));this.defineObstacle(c,this.wheel,this.newHandlers(this.wheelObstacleHandlers,b));this.defineObstacle(c,this.chassis,this.newHandlers(this.chassisObstacleHandlers,b));this.obstacles.values().forEach(function(d){this.defineObstacle(c,d.matcher,physics.interaction.handlers.mergeArray([game.collisions.Matchers.FRICTIONALS.OBSTACLE_SELF.handler(),
this.view.audioHandler(b),this.view.audioHandler(d.sound)]))}.bind(this));this.cargoes.values().forEach(function(d){this.defineCargoObstacle(d.matcher,d.sound,c,b)}.bind(this));return c};
game.collisions.Matchers.FRICTIONALS={VEHICLE_SCENERY:{CHASSIS_ENVIRONMENT:game.Engine.stiffFrictional(.1),CHASSIS_OBSTACLE:game.Engine.stiffFrictional(.5),CHASSIS_CARGO:game.Engine.stiffFrictional(.5),WHEEL_ENVIRONMENT:game.Engine.stiffFrictional(1),WHEEL_OBSTACLE:game.Engine.stiffFrictional(1)},ENVIRONMENT_OBSTACLE:game.Engine.stiffFrictional(1),ENVIRONMENT_CARGO:game.Engine.stiffFrictional(1),OBSTACLE_SELF:game.Engine.stiffFrictional(.5),OBSTACLE_CARGO:game.Engine.stiffFrictional(.5),CARGO_SELF:game.Engine.stiffFrictional(1)};
game.collisions.Obstacles.SPAWN_OVERSCAN=1.2;game.collisions.Obstacles.PRUNE_OVERSCAN=1.5;game.collisions.Obstacles.SPAWN_MARGIN=physics.dynamics.Rectangle.symmetric(physics.dynamics.Vector.ONE);game.collisions.Obstacles.singleBody=function(a,b){return game.collisions.Obstacles.singleGraphic([a],b)};game.collisions.Obstacles.singleGraphic=function(a,b){return a.map(function(c,d){return{body:c,graphic:0==d?b:null}})};
game.collisions.Obstacles.limitedSpawner=function(a,b){return function(c,d){b.contains(c)&&a(c,d)}};game.collisions.Obstacles.prototype.reset=function(){this.queued=[];this.active=[];this.positiveLoad=this.negativeLoad=0};game.collisions.Obstacles.prototype.addBeforeActors=function(){this.matchers.view.engine.actors.add(function(a){this.bundle=this.performCheck();return[]}.bind(this))};
game.collisions.Obstacles.prototype.addAfterActors=function(){this.matchers.view.engine.actors.add(function(a){this.bundle&&(this.bundle.release(),delete this.bundle,this.evaluateCheck());return[]}.bind(this))};game.collisions.Obstacles.prototype.performCheck=function(){return this.queued.length?(new physics.collections.Bundle).addAll(this.matchers.view.collisions,physics.utility.flatten(this.queued.map(function(a){return this.newColliders(this.matchers.obstacleCheck,a.bodies)}.bind(this)))):null};
game.collisions.Obstacles.prototype.evaluateCheck=function(){if(this.matchers.obstacleToggle.active)this.listener&&this.listener(this.queued);else{const a=this.queued.map(function(b){return(new physics.collections.Bundle).addAll(this.matchers.view.collisions,this.newColliders(b.matcher,b.bodies))}.bind(this));this.queued.forEach(function(b,c){this.active.push({bodies:b.bodies,bundle:b.handler().addBundle(a[c])})}.bind(this))}this.queued=[]};
game.collisions.Obstacles.prototype.newColliders=function(a,b){const c=new physics.tracking.matchers.Distinct(a);return b.map(function(d){return new physics.collisions.Collider(d,c)})};game.collisions.Obstacles.prototype.addObstacle=function(a,b,c){this.queued.push({bodies:a,handler:b,matcher:c})};
game.collisions.Obstacles.prototype.addSpawner=function(a,b){return(new physics.collections.Bundle).add(this.matchers.view.engine.actors,function(c){var d=this.matchers.view.camera.particle;c=d.motion.position.translation.x;d=d.trace.position.translation.x;this.prune(c);this.spawn(a,b,c,d);return[]}.bind(this))};game.collisions.Obstacles.prototype.sightRange=function(a){a*=this.matchers.view.scaledRefSize();return new game.utility.Range(-a*game.View.CAMERA_OFFSET.x,a*(1-game.View.CAMERA_OFFSET.x))};
game.collisions.Obstacles.prototype.prune=function(a){a=this.sightRange(game.collisions.Obstacles.PRUNE_OVERSCAN).add(a);for(var b=0;b<this.active.length;b++){const c=physics.collisions.Body.bounds(this.active[b].bodies);a.intersects(game.utility.Range.rectangleX(c))||(this.active[b].bundle.release(),this.active.splice(b,1),b--)}};game.collisions.Obstacles.prototype.clear=function(){this.active.forEach(function(a){a.bundle.release()});this.reset()};
game.collisions.Obstacles.prototype.spawn=function(a,b,c,d){d=c-d;const e=this.sightRange(game.collisions.Obstacles.PRUNE_OVERSCAN),f=this.sightRange(game.collisions.Obstacles.SPAWN_OVERSCAN);this.positiveLoad=physics.utility.clamp(this.positiveLoad-d,0,e.max-f.max);this.negativeLoad=physics.utility.clamp(this.negativeLoad-d,e.min-f.min,0);0<d?0==this.positiveLoad&&0<physics.utility.randomPoisson(d/a,1)&&b(c+f.max,0):0==this.negativeLoad&&0<physics.utility.randomPoisson(-d/a,1)&&b(c+f.min,1)};
game.collisions.Obstacles.prototype.randomSpawner=function(a,b){return function(c,d){const e=game.utility.randomFromArray(b),f=e.factory(this.matchers.view.engine.rendering),g=physics.utility.distinct(f.map(function(h){return h.body.particle}));a.alignParticles(g,physics.collisions.Body.bounds(f.map(function(h){return h.body})).addRectangle(game.collisions.Obstacles.SPAWN_MARGIN),c,d);this.addObstacle(f.map(function(h){return h.body}),function(){return g.reduce(function(h,l){return h.addBundle(this.matchers.view.addDefaultGravityParticle(l))}.bind(this),
new physics.collections.Bundle).addAll(this.matchers.view.graphics,f.filter(function(h){return h.graphic}).map(function(h){return new physics.rendering.perspective.View(physics.rendering.graphics.Transformator.identity(this.matchers.view.engine.rendering,h.graphic,h.body.particle),game.graphics.depths.OBSTACLE)}.bind(this)))}.bind(this),e.matcher)}.bind(this)};
game.collisions.EmitterParams.prototype.collisionHandler=function(a,b,c){return function(d,e,f,g){const h=e.rotate();f=Math.min(Math.abs(h.velocity()*f),this.intensityLimit);f>this.intensityThreshold&&(this.randomPoisson(d,e,h,f,g),b.collect(h,f));return[]}.bind(this,this.randomHandler(a,c))};game.collisions.EmitterParams.prototype.intensityAlpha=function(a){return Math.max(Math.min((a-this.intensityThreshold)/(this.intensityLimit-this.intensityThreshold),1),0)};
game.collisions.EmitterParams.prototype.computeVelocity=function(a,b){const c=a.first.pivot.particle.motion.velocity.translation.dot(b.first.direction),d=(b.first.velocity-c)*this.strengthHorizontalRel,e=Math.abs(d)*this.strengthVertical;return b.first.direction.multiply(d).add(a.first.direction.multiply(e)).maxLength(this.strengthLimit).add(b.first.direction.multiply(c*this.strengthHorizontalAbs))};
game.collisions.EmitterParams.prototype.randomPoisson=function(a,b,c,d,e){if(d=physics.utility.randomPoisson(e*d/this.interval,2))for(b=a.bind(this,c.first.pivot.origin,this.computeVelocity(b,c)),a=0;a<d;a++)b()};
game.collisions.EmitterParams.prototype.randomHandler=function(a,b){const c=new physics.collections.Ordered,d=this.inDuration+this.outDuration,e=.5*physics.utility.PI_2/d,f=physics.dynamics.Particle.rotating(e);return function(g,h){const l=f.motion.position.rotation;g=physics.dynamics.Particle.oneMass(new physics.dynamics.Motion(new physics.dynamics.Transformation(g,game.utility.Range.PI_2.random()),new physics.dynamics.Transformation(h.add(physics.dynamics.Vector.X_UNIT.rotate(game.utility.Range.PI_2.random()).multiply(this.dispersion*
Math.random())),this.rotation.random())));g=(new physics.collections.Bundle).addBundle(a.addGravityParticle(g,this.gravity)).add(c,physics.rendering.graphics.Transformator.identity(a.engine.rendering,new physics.rendering.graphics.Alpha(a.engine.rendering,physics.rendering.graphics.Image.fromOrigin(a.engine.rendering,game.utility.randomFromArray(this.resources.images)(),physics.dynamics.Vector.ZERO).addRelative(physics.rendering.graphics.Image.CENTER),f,function(k){k=physics.utility.modPositive(k.rotation-
l,physics.utility.PI_2)/e;return k<this.inDuration?Math.max(k/this.inDuration,0):Math.max(1-(k-this.inDuration)/this.outDuration,0)}.bind(this)),g));if(!b.length){const k=(new physics.collections.Bundle).add(a.engine.particles,f).add(a.engine.actors,function(m){for(;b.length;)if(m=physics.utility.modPositive(f.motion.position.rotation-b[0].start,physics.utility.PI_2)/e,0>m||m>=d)b[0].bundle.release(),b.shift(),b.length||k.release();else break;return[]}).add(a.graphics.collector,new physics.rendering.perspective.View(physics.rendering.graphics.Container.variable(c),
game.graphics.depths.EMITTER))}b.push({start:l,bundle:g})}.bind(this)};game.collisions.EmitterContext.SOUND_FADE_DURATION=.1;game.collisions.EmitterContext.ALPHA_THRESHOLD=.01;
game.collisions.EmitterContext.prototype.start=function(){this.fixture=physics.interaction.Fixture.stationary(physics.dynamics.Vector.ZERO);const a=physics.actors.spatialAudio(this.audioContext,this.view.camera,this.fixture,game.View.NORMAL_DISTANCE/2);this.spatialActor=a.actor;a.output.connect(this.audioContext.destination);this.intensityNode=new GainNode(this.audioContext,{gain:0});this.intensityNode.connect(a.input);this.fadeNode=new GainNode(this.audioContext,{gain:0});physics.utility.fadeAudio(this.fadeNode,
game.collisions.EmitterContext.SOUND_FADE_DURATION,1);this.fadeNode.connect(this.intensityNode);this.sourceNode=new AudioBufferSourceNode(this.audioContext,{buffer:this.params.resources.sound()});this.sourceNode.loop=!0;this.sourceNode.onended=function(){a.output.disconnect()};this.sourceNode.connect(this.fadeNode);this.sourceNode.start();this.collector=[]};
game.collisions.EmitterContext.prototype.stop=function(){this.sourceNode.stop(physics.utility.fadeAudio(this.fadeNode,game.collisions.EmitterContext.SOUND_FADE_DURATION,0))};
game.collisions.EmitterContext.prototype.actor=function(){return physics.actors.containerArray([function(a){const b=this.collector.map(function(c){return c.alpha}).reduce(physics.utility.add,0);b>game.collisions.EmitterContext.ALPHA_THRESHOLD&&(this.fixture.origin=this.collector.map(function(c){return c.origin.multiply(c.alpha)}).reduce(physics.utility.addMethod,physics.dynamics.Vector.ZERO).divide(b));this.intensityNode.gain.linearRampToValueAtTime(b*this.params.gain,this.audioContext.currentTime+
a);this.collector=[];return[]}.bind(this),this.spatialActor])};game.collisions.EmitterContext.prototype.collect=function(a,b){this.collector.push({origin:a.first.pivot.origin,alpha:this.params.intensityAlpha(b)})};game.collisions.EmitterContext.prototype.collisionHandler=function(a){return this.params.collisionHandler(this.view,this,a)};game.loading.Loader.FADE_DURATION=game.Engine.FADE_DURATION;game.loading.Loader.TOGGLE_LINE_WIDTH=.15*game.View.PX_PER_M;
game.loading.Loader.KEYS_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x/2,248);
game.loading.Loader.newHandler=function(a,b,c){return new physics.actors.input.handlers.Merger([new physics.actors.input.handlers.movers.KeyMover(a,"KeyA","KeyD","KeyW","KeyS",2E3,.01),new physics.actors.input.handlers.movers.MouseMover(a),new physics.actors.input.handlers.movers.TouchMover(a,c),new physics.actors.input.handlers.pressers.KeyPresser(b,"Space"),new physics.actors.input.handlers.pressers.MousePresser(b,c,0),new physics.actors.input.handlers.pressers.TouchPresser(b,c,game.Engine.TAP_DISTANCE,
game.Engine.TAP_DURATION)])};game.loading.Loader.prototype.rendering=function(){return this.matchers.view.engine.rendering};game.loading.Loader.prototype.newToggleProperties=function(a){return new physics.rendering.graphics.Properties(this.rendering(),{fillStyle:a,strokeStyle:a,lineJoin:"round",lineWidth:game.loading.Loader.TOGGLE_LINE_WIDTH})};
game.loading.Loader.prototype.newToggleGraphic=function(a){return physics.rendering.graphics.Container.separated([new physics.rendering.graphics.path.Beginner(this.rendering()),a,new physics.rendering.graphics.Toggled(this.rendering(),this.matchers.clearanceToggle,this.newToggleProperties(game.Engine.COLORS.RED),this.newToggleProperties(game.Engine.COLORS.BLUE)),new physics.rendering.graphics.path.Stroker(this.rendering()),new physics.rendering.graphics.path.Filler(this.rendering())],1)};
game.loading.Loader.prototype.addParticle=function(){this.matchers.view.engine.particles.add(this.animation)};
game.loading.Loader.prototype.addActors=function(){const a=new physics.actors.animation.Timer(game.loading.Loader.FADE_DURATION,0);var b=!1;physics.collections.addAll(this.matchers.view.engine.actors,[a.toggledActor(this.matchers.loadToggle),physics.actors.animation.Transition.zeroPi(a,this.animation).actor(),function(c){!b&&this.matchers.loadToggle.active&&(b=!0,this.tutorial.confirm(game.hud.TutorialBox.INTRO),this.tutorial.open(game.hud.TutorialBox.LOADING));b&&!this.matchers.loadToggle.active&&
(b=!1,this.tutorial.close(game.hud.TutorialBox.LOADING));return[]}.bind(this)])};
game.loading.Loader.prototype.addBody=function(){return(new physics.collections.Bundle).add(this.matchers.view.engine.particles,this.cargoData.body.particle).addAll(this.matchers.view.engine.actors,this.bounds.values().map(function(a){return a(this.fixture,this.cargoData.body.shape.transform(physics.dynamics.Transformation.fromRotation(this.cargoPosition().rotation)))}.bind(this)).concat(physics.actors.projection2(this.fixture,physics.interaction.Fixture.centroid(this.cargoData.body.particle),physics.interaction.handlers.elasticity(physics.interaction.Elasticity.MAX)))).add(this.matchers.view.collisions,
new physics.collisions.Collider(this.cargoData.body,this.matchers.clearance)).add(this.matchers.view.graphics,new physics.rendering.perspective.View(physics.rendering.graphics.Transformator.identity(this.rendering(),new physics.rendering.graphics.Alpha(this.rendering(),physics.rendering.graphics.Container.fixed([this.newToggleGraphic(this.cargoData.body.shape.graphic(this.rendering())),this.cargoData.graphic]),this.animation,physics.rendering.mappers.WAVE_01),this.cargoData.body.particle),game.graphics.depths.LOADER))};
game.loading.Loader.prototype.addCargoFactory=function(a,b,c){const d=new physics.collections.Bundle;d.add(this.cargoes,{factory:a,cost:b,sound:c,matcher:this.matchers.addCargoMatcher(d,c)});return d};game.loading.Loader.prototype.resetCargo=function(){this.fixture.origin=null;this.addCargoAt(physics.dynamics.Vector.ZERO)};game.loading.Loader.prototype.cargoPosition=function(){return this.cargoData.body.particle.motion.position};game.loading.Loader.prototype.replaceCargo=function(){this.addCargoAt(this.cargoPosition().translation)};
game.loading.Loader.prototype.addCargoAt=function(a){this.cargo=game.utility.randomFromArray(this.cargoes.values());this.cargoData=this.cargo.factory(this.rendering(),a);this.bundle.release();this.bundle=this.addBody()};game.loading.Loader.prototype.spawn=function(a,b){this.matchers.loadToggle.active&&!this.matchers.clearanceToggle.active&&(this.unload(a),this.replaceCargo(),this.matchers.view.fireAudio(this.cargoPosition().translation,resources.hud.cargo.spawn));return[]};
game.loading.Loader.prototype.unload=function(a){const b=this.cargo.factory(this.rendering(),physics.dynamics.Vector.ZERO);b.body.particle.reset(physics.dynamics.Motion.fromPosition(this.cargoPosition()));(new game.loading.Animator(this,a,this.cargo,b)).animate()};game.loading.Loader.prototype.clear=function(){this.animators.values().forEach(function(a){a.release()});this.cargoTracker&&this.cargoTracker.reset()};
game.loading.Loader.prototype.addKeysGraphic=function(){this.controlsBundle.addBundle(this.keyboardControls.add(new physics.rendering.graphics.Fitted(this.rendering(),new physics.rendering.graphics.Alpha(this.rendering(),physics.rendering.graphics.Image.fromOrigin(this.rendering(),resources.hud.keys.wasdSpace(),game.loading.Loader.KEYS_ORIGIN).addRelative(physics.rendering.graphics.Image.CENTER),this.animation,physics.rendering.mappers.WAVE_01),game.View.REF_SIZE,physics.rendering.graphics.Fitted.UPPER_CENTER),
this.matchers.view.engine.graphics))};
game.loading.Loader.prototype.addControls=function(a,b,c){const d=new physics.actors.input.Anchor(this.matchers.view.camera,this.fixture);a=new physics.actors.input.Button(physics.actors.constant([]),physics.actors.constant([]),this.spawn.bind(this,a));c=game.loading.Loader.newHandler(d,a,c);this.controlsBundle.addAll(this.matchers.view.engine.actors,[c.actor(),d.actor(),a.actor()]);this.addKeysGraphic();this.registrator=c.registrator();this.registrator.register();this.cargoTracker=b};
game.loading.Loader.prototype.removeControls=function(){this.controlsBundle.release();this.registrator.unregister();delete this.registrator;delete this.cargoTracker};game.loading.Animator.prototype.release=function(){this.cancelable.cancel()};game.loading.Animator.prototype.rendering=function(){return this.loader.matchers.view.engine.rendering};
game.loading.Animator.prototype.newFadeGraphic=function(a){return physics.rendering.graphics.Transformator.identity(this.rendering(),new physics.rendering.graphics.Alpha(this.rendering(),physics.rendering.graphics.path.Filler.wrap(this.rendering(),this.cargoData.body.shape.graphic(this.rendering()),{fillStyle:a}),this.animation,physics.rendering.mappers.WAVE_01),this.cargoData.body.particle)};
game.loading.Animator.prototype.newCollisionAction=function(){return this.animateOut.bind(this,game.loading.Animation.COLLISION,this.fireAudio.bind(this,resources.hud.cargo.collision),function(){this.loader.cargoTracker.addReward(-this.cargoReward());this.loader.cargoTracker.refresh()}.bind(this))};
game.loading.Animator.prototype.newUnloadAction=function(){return this.animateOut.bind(this,game.loading.Animation.UNLOAD,this.fireAudio.bind(this,resources.hud.cargo.unload),function(){const a=this.cargoReward();this.loader.credits.addAmount(a);this.loader.cargoTracker.addReward(-a);this.loader.cargoTracker.addDelivery(a);this.upgrader.update();this.loader.cargoTracker.refresh();this.loader.tutorial.confirm(game.hud.TutorialBox.CARGO)}.bind(this))};
game.loading.Animator.prototype.animateIn=function(a){const b=new physics.actors.animation.Timer(a.inDuration,0),c=physics.actors.animation.Transition.zeroPi(b,this.animation);this.cancelable.run(function(d,e){d.add(this.graphics,this.newFadeGraphic(a.fillStyle)).addAll(this.loader.matchers.view.engine.actors,[b.elapsedActor(e),c.actor()]);this.attach(d);this.addAnimation(d);this.addBody(d);this.addPhysicsWithoutActions(d)}.bind(this),function(){b.duration=a.outDuration;b.elapse();this.cancelable.run(function(d,
e){this.addBodyGraphic(d);d.add(this.graphics,this.newFadeGraphic(a.fillStyle)).addAll(this.loader.matchers.view.engine.actors,[b.reverseActor(e),c.actor()]);this.attach(d);this.addAnimation(d);this.addBody(d);this.addPhysicsWithoutActions(d)}.bind(this),function(){this.cancelable.run(function(d,e){this.attach(d);this.addAnimation(d);this.addBodyGraphic(d);this.addBody(d);this.addPhysicsWithActions(d)}.bind(this),function(){})}.bind(this))}.bind(this))};
game.loading.Animator.prototype.animateOut=function(a,b,c){b();const d=new physics.actors.animation.Timer(a.inDuration,0),e=physics.actors.animation.Transition.zeroPi(d,this.animation);this.cancelable.run(function(f,g){this.addBodyGraphic(f);f.add(this.graphics,this.newFadeGraphic(a.fillStyle)).addAll(this.loader.matchers.view.engine.actors,[d.elapsedActor(g),e.actor()]);this.attach(f);this.addAnimation(f);this.addBody(f);this.addPhysicsWithoutActions(f)}.bind(this),function(){c();d.duration=a.outDuration;
d.elapse();this.cancelable.run(function(f,g){f.add(this.graphics,this.newFadeGraphic(a.fillStyle)).addAll(this.loader.matchers.view.engine.actors,[d.reverseActor(g),e.actor()]);this.attach(f);this.addAnimation(f);this.addBody(f)}.bind(this),function(){})}.bind(this))};game.loading.Animator.prototype.fireAudio=function(a){this.loader.matchers.view.fireAudio(this.cargoData.body.particle.motion.position.translation,a)};game.loading.Animator.prototype.attach=function(a){a.add(this.loader.animators,this)};
game.loading.Animator.prototype.addAnimation=function(a){a.add(this.loader.matchers.view.engine.particles,this.animation)};game.loading.Animator.prototype.addBody=function(a){a.add(this.loader.matchers.view.engine.particles,this.cargoData.body.particle).add(this.loader.matchers.view.graphics,new physics.rendering.perspective.View(physics.rendering.graphics.Container.variable(this.graphics),game.graphics.depths.CARGO))};
game.loading.Animator.prototype.addBodyGraphic=function(a){a.add(this.graphics,physics.rendering.graphics.Transformator.identity(this.rendering(),this.cargoData.graphic,this.cargoData.body.particle))};game.loading.Animator.prototype.addPhysics=function(a,b,c){a.addBundle(this.loader.matchers.addCargoCollisions(this.cargoData.body,this.cargo.sound,this.cargo.matcher,b,c)).add(this.loader.matchers.view.engine.actors,this.loader.matchers.view.newDefaultGravity(this.cargoData.body.particle))};
game.loading.Animator.prototype.addPhysicsWithoutActions=function(a){this.addPhysics(a,function(){},function(){})};game.loading.Animator.prototype.addPhysicsWithActions=function(a){this.addPhysics(a,this.newCollisionAction(),this.newUnloadAction())};
game.loading.Animator.prototype.animate=function(){this.animateIn(game.loading.Animation.SPAWN);this.loader.credits.addAmount(-this.cargo.cost);this.loader.cargoTracker.addReward(this.cargoReward());this.loader.cargoTracker.resetDelivery();this.upgrader.update();this.loader.cargoTracker.refresh();this.loader.tutorial.confirm(game.hud.TutorialBox.LOADING)};game.loading.Animator.prototype.cargoReward=function(){return Math.ceil(this.cargo.cost*this.loader.credits.multiplier)};
game.loading.Animation.SPAWN=new game.loading.Animation(game.Engine.COLORS.WHITE,game.Engine.FADE_DURATION,game.Engine.FADE_DURATION);game.loading.Animation.UNLOAD=new game.loading.Animation(game.Engine.COLORS.WHITE,game.Engine.FADE_DURATION,game.Engine.FADE_DURATION);game.loading.Animation.COLLISION=new game.loading.Animation(game.Engine.COLORS.RED,3*game.Engine.FADE_DURATION,3*game.Engine.FADE_DURATION);game.hud.Menu.SUBMENU_ORIGIN=new physics.dynamics.Vector(48,284);
game.hud.Menu.UNLOCKED_ORIGIN=new physics.dynamics.Vector(196,420);game.hud.Menu.UNLOCKED_ICON_ORIGIN=new physics.dynamics.Vector(104,416);game.hud.Menu.DELIVERY_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x-256,292);game.hud.Menu.DELIVERY_ICON_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x-160,288);game.hud.Menu.MULTIPLIER_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x-256,420);game.hud.Menu.MULTIPLIER_ICON_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x-160,416);
game.hud.Menu.COST_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x-256,548);game.hud.Menu.COST_ICON_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x-160,544);game.hud.Menu.BASE_MULTIPLIER=2;game.hud.Menu.MAX_DELIVERY=function(){return game.hud.Credits.MAX_AMOUNT};game.hud.Menu.VEHICLES=[vehicles.vintagePickup,vehicles.carWithTrailer,vehicles.agriculturalTractor,vehicles.pickup6x6,vehicles.flatbedSemiTruck,vehicles.trackedDumpTruck,vehicles.baggageTractor,vehicles.cargoBike];
game.hud.Menu.SCENERIES=[sceneries.grassland,sceneries.city,sceneries.snowscape];
game.hud.Menu.DELIVERY_TARGETS=[[{cost:150,tunings:[10,8,8,10,2]},{cost:260,tunings:[10,10,10,7,0]},{cost:510,tunings:[10,7,7,7,5]},{cost:150,tunings:[10,10,10,10,10]},{cost:1280,tunings:[10,6,8,2,0]},{cost:280,tunings:[10,10,10,8,10]},{cost:560,tunings:[10,8,8,8,0]},{cost:130,tunings:[10,10,10,10,0]}],[{cost:240,tunings:[10,10,10,10,0]},{cost:360,tunings:[10,10,10,7,0]},{cost:530,tunings:[10,6,8,7,3]},{cost:260,tunings:[10,10,10,10,10]},{cost:1840,tunings:[10,6,10,2,0]},{cost:360,tunings:[10,8,10,
8,10]},{cost:860,tunings:[10,8,10,8,0]},{cost:120,tunings:[10,10,10,10,0]}],[{cost:250,tunings:[10,8,8,10,0]},{cost:280,tunings:[10,5,5,7,0]},{cost:590,tunings:[10,5,7,5,2]},{cost:230,tunings:[10,10,10,10,10]},{cost:2490,tunings:[10,6,6,2,0]},{cost:370,tunings:[10,8,10,10,5]},{cost:870,tunings:[10,7,7,8,0]},{cost:210,tunings:[10,6,6,10,0]}]];game.hud.Menu.DELIVERY_TARGET_PERCENTAGE=.9;game.hud.Menu.DELIVERY_TARGET_ROUNDING=100;
game.hud.Menu.totalTuningUnlocks=function(a){return physics.utility.flatten(a).map(function(b){return b.maxValue}).reduce(physics.utility.add,0)+(a.length-1)};game.hud.Menu.actualTuningUnlocks=function(a,b){return physics.utility.flatten(b).map(function(c){return c.lockedProperty.get()}).reduce(physics.utility.add,0)+(a.countUnlocked()-1)};game.hud.Menu.unlockedText=function(a,b){return a+"/"+b+" ("+Math.floor(100*a/b)+"%)"};game.hud.Menu.deliveryText=function(a,b){return a+"/"+b};
game.hud.Menu.prototype.newVehicleTuning=function(a,b,c,d){const e=game.hud.Tuning.fromType("vehicle",a.PROPERTY_PATH,b,c,10,1,d,game.hud.Tuning.COST_LADDER_SLOW,a.TUNING_COST_OFFSET,function(){this.updateVehicleSetupSingle(e)}.bind(this));return e};game.hud.Menu.prototype.newSceneryTuning=function(a,b,c,d,e,f,g){return game.hud.Tuning.fromType("scenery",a.PROPERTY_PATH,b,c,10,Math.pow(a.TUNING_MAX_MULTIPLIER,g),d,e,a.TUNING_COST_OFFSET+f,function(){})};
game.hud.Menu.prototype.newVehicleTunings=function(){return game.hud.Menu.VEHICLES.map(function(a){return[this.newVehicleTuning(a,"speed","Speed",!1),this.newVehicleTuning(a,"acceleration","Acceleration",!1),this.newVehicleTuning(a,"traction","Traction",!1),this.newVehicleTuning(a,"stiffness","Stiffness",!0),this.newVehicleTuning(a,"damping","Damping",!0),this.newVehicleTuning(a,"height","Height",!0)]}.bind(this))};
game.hud.Menu.prototype.newSceneryTunings=function(){return game.hud.Menu.SCENERIES.map(function(a){return[this.newSceneryTuning(a,"distance","Distance",!1,game.hud.Tuning.COST_LADDER_FAST,0,1),this.newSceneryTuning(a,"uphill","Uphill",!1,game.hud.Tuning.COST_LADDER_FAST,0,1),this.newSceneryTuning(a,"downhill","Downhill",!1,game.hud.Tuning.COST_LADDER_FAST,0,.5),this.newSceneryTuning(a,"alternation","Alternation",!1,game.hud.Tuning.COST_LADDER_FAST,0,1),this.newSceneryTuning(a,"obstacles","Obstacles",
!1,game.hud.Tuning.COST_LADDER_SLOW,3,1.5)]}.bind(this))};game.hud.Menu.prototype.newVehicleSelector=function(){return game.hud.Selector.fromType("vehicle","Vehicle",this.vehicleTunings.map(function(a,b){return{name:game.hud.Property.joinPath(game.hud.Menu.VEHICLES[b].PROPERTY_PATH),cost:game.hud.Menu.VEHICLES[b].COST,submenu:game.hud.Submenu.typeSelection(a.map(function(c){return c.toNamedSubmenu()}))}}),this.resetVehicle.bind(this))};
game.hud.Menu.prototype.newScenerySelector=function(){return game.hud.Selector.fromType("scenery","Scenery",this.sceneryTunings.map(function(a,b){return{name:game.hud.Property.joinPath(game.hud.Menu.SCENERIES[b].PROPERTY_PATH),cost:game.hud.Menu.SCENERIES[b].COST,submenu:game.hud.Submenu.typeSelection(a.map(function(c){return c.toNamedSubmenu()}))}}),this.flash.doWaiting.bind(this.flash,this.resetScenery.bind(this)))};
game.hud.Menu.prototype.newSubmenu=function(){return game.hud.Submenu.typeSelection([this.vehicleSelector.toNamedSubmenu(),this.scenerySelector.toNamedSubmenu()])};game.hud.Menu.prototype.newVehicleBuilder=function(){return new vehicles.utility.Builder(this.loader.matchers,this.locator,this.motor,new vehicles.utility.Setup)};game.hud.Menu.prototype.newSceneryBuilder=function(){return new sceneries.utility.Builder(this.loader,this.obstacles,this.locator,new sceneries.utility.Setup)};
game.hud.Menu.prototype.rendering=function(){return this.locator.view.engine.rendering};
game.hud.Menu.prototype.openTutorial=function(){this.loader.tutorial.open(game.hud.TutorialBox.UNLOCKED(this));this.loader.tutorial.open(game.hud.TutorialBox.DELIVERY(this));this.loader.tutorial.open(game.hud.TutorialBox.MULTIPLIER(this));this.hasCost()?this.loader.tutorial.open(game.hud.TutorialBox.COST(this)):this.loader.tutorial.close(game.hud.TutorialBox.COST(this));if(this.submenuData.tutorial){const a=this.submenuData.tutorial(this);this.loader.tutorial.open(a)&&this.submenuTutorial&&this.loader.tutorial.close(this.submenuTutorial);
this.submenuTutorial=a}else this.submenuTutorial&&(this.loader.tutorial.close(this.submenuTutorial),delete this.submenuTutorial)};
game.hud.Menu.prototype.closeTutorial=function(){this.loader.tutorial.close(game.hud.TutorialBox.UNLOCKED(this));this.loader.tutorial.close(game.hud.TutorialBox.DELIVERY(this));this.loader.tutorial.close(game.hud.TutorialBox.MULTIPLIER(this));this.hasCost()&&this.loader.tutorial.close(game.hud.TutorialBox.COST(this));this.submenuData.tutorial&&this.loader.tutorial.close(this.submenuData.tutorial(this));delete this.submenuTutorial};
game.hud.Menu.prototype.addDebugging=function(a){return(new physics.collections.Bundle).add(this.locator.view.engine.graphics,new physics.rendering.graphics.Fitted(this.rendering(),physics.rendering.graphics.Container.fixed([].concat(new physics.rendering.graphics.Properties(this.rendering(),game.Engine.FONT_PROPERTIES.DEBUGGING),[physics.rendering.text.keyValue(physics.rendering.text.constant("fps"),physics.rendering.text.fps()),physics.rendering.text.keyValue(physics.rendering.text.constant("camera"),
physics.rendering.text.camera(this.locator.view.camera)),physics.rendering.text.keyValue(physics.rendering.text.constant("particles"),physics.rendering.text.count(this.locator.view.engine.particles)),physics.rendering.text.keyValue(physics.rendering.text.constant("actors"),physics.rendering.text.count(this.locator.view.engine.actors)),physics.rendering.text.keyValue(physics.rendering.text.constant("collision"),physics.rendering.text.tracking(this.locator.view.collisions)),physics.rendering.text.keyValue(physics.rendering.text.constant("graphic"),
physics.rendering.text.tracking(this.locator.view.graphics)),physics.rendering.text.keyValue(physics.rendering.text.constant("cargoes"),physics.rendering.text.count(this.loader.animators)),physics.rendering.text.keyValue(physics.rendering.text.constant("obstacles"),function(){return this.obstacles.active.length+" / failed: "+a.single+" single, "+a.multiple+" multiple / load: "+Math.round(this.obstacles.negativeLoad)+", "+Math.round(this.obstacles.positiveLoad)}.bind(this)),physics.rendering.text.keyValue(physics.rendering.text.constant("emitters"),
function(){return this.loader.matchers.emitterQueues.values().map(function(b){return b.length}).join(", ")}.bind(this))].map(function(b,c,d){return new physics.rendering.graphics.text.Filler(this.rendering(),new physics.dynamics.Vector(32,game.View.REF_SIZE.y/2+40*(c-d.length/2)),b)}.bind(this)))),game.View.REF_SIZE,physics.rendering.graphics.Fitted.CENTER_LEFT))};
game.hud.Menu.prototype.verifyDeliveryTargets=function(){game.hud.Menu.DELIVERY_TARGETS.length!=game.hud.Menu.SCENERIES.length&&console.warn("Number of delivery targets does not match number of sceneries");for(var a=0;a<game.hud.Menu.SCENERIES.length;a++){game.hud.Menu.DELIVERY_TARGETS[a].length!=game.hud.Menu.VEHICLES.length&&console.warn("Number of delivery targets does not match number of vehicles",a);for(var b=0;b<game.hud.Menu.VEHICLES.length;b++)game.hud.Menu.DELIVERY_TARGETS[a][b].tunings.length!=
this.sceneryTunings[a].length&&console.warn("Wrong number of tunings for delivery target",a,b)}};game.hud.Menu.prototype.addDeliveries=function(){for(var a=0;a<game.hud.Menu.SCENERIES.length;a++){this.deliveries.push([]);for(var b=0;b<game.hud.Menu.VEHICLES.length;b++)this.deliveries[a].push(game.hud.Property.integerRange([].concat("delivery",game.hud.Menu.SCENERIES[a].PROPERTY_PATH,game.hud.Menu.VEHICLES[b].PROPERTY_PATH),0,game.hud.Menu.MAX_DELIVERY(),0))}};
game.hud.Menu.prototype.addGraphics=function(){this.graphicsBundle=(new physics.collections.Bundle).addAll(this.locator.view.engine.graphics,[new physics.rendering.graphics.Properties(this.rendering(),{textAlign:"left"}),new physics.rendering.graphics.Fitted(this.rendering(),physics.rendering.graphics.Container.variable(this.leftGraphics),game.View.REF_SIZE,physics.rendering.graphics.Fitted.UPPER_LEFT),new physics.rendering.graphics.Properties(this.rendering(),{textAlign:"right"}),new physics.rendering.graphics.Fitted(this.rendering(),
physics.rendering.graphics.Container.variable(this.rightGraphics),game.View.REF_SIZE,physics.rendering.graphics.Fitted.UPPER_RIGHT)]);this.loader.tutorial.confirm(game.hud.TutorialBox.INTRO);this.openTutorial()};game.hud.Menu.prototype.removeGraphics=function(){this.graphicsBundle.release();delete this.graphicsBundle;this.closeTutorial()};game.hud.Menu.prototype.totalDeliveryUnlocks=function(){return game.hud.Menu.SCENERIES.length*game.hud.Menu.VEHICLES.length};
game.hud.Menu.prototype.actualDeliveryUnlocks=function(){for(var a=0,b=0;b<game.hud.Menu.SCENERIES.length;b++)for(var c=0;c<game.hud.Menu.VEHICLES.length;c++)this.deliveries[b][c].get()>=this.deliveryTarget(b,c)&&a++;return a};game.hud.Menu.prototype.countTotalUnlocks=function(){return game.hud.Menu.totalTuningUnlocks(this.vehicleTunings)+game.hud.Menu.totalTuningUnlocks(this.sceneryTunings)+this.totalDeliveryUnlocks()};
game.hud.Menu.prototype.countActualUnlocks=function(){return game.hud.Menu.actualTuningUnlocks(this.vehicleSelector,this.vehicleTunings)+game.hud.Menu.actualTuningUnlocks(this.scenerySelector,this.sceneryTunings)+this.actualDeliveryUnlocks()};game.hud.Menu.prototype.updateCompletedTutorial=function(){this.unlockedTextFactory(this.countActualUnlocks(),this.countTotalUnlocks())};
game.hud.Menu.prototype.unlockedTextFactory=function(a,b){return a==b?(this.loader.tutorial.confirm(game.hud.TutorialBox.INTRO),this.loader.tutorial.open(game.hud.TutorialBox.COMPLETED),this.locator.view.engine.newPulseTextGraphic):this.locator.view.engine.newTextGraphic};
game.hud.Menu.prototype.updateUnlockedGraphics=function(){const a=this.countActualUnlocks(),b=this.countTotalUnlocks();this.unlockedBundle.release();this.unlockedBundle.addAll(this.leftGraphics,[new physics.rendering.graphics.Properties(this.rendering(),game.Engine.FONT_PROPERTIES.MENU_STATS),this.unlockedTextFactory(a,b).call(this.locator.view.engine,game.hud.Menu.UNLOCKED_ORIGIN,game.hud.Menu.unlockedText.bind(this,a,b)),physics.rendering.graphics.Image.fromOrigin(this.rendering(),resources.hud.lock.open(),
game.hud.Menu.UNLOCKED_ICON_ORIGIN).addRelative(physics.rendering.graphics.Image.CENTER)])};game.hud.Menu.prototype.measureUnlockedText=function(){return this.locator.view.engine.measureWidth(game.hud.Menu.unlockedText(this.countActualUnlocks(),this.countTotalUnlocks()),game.Engine.FONT_PROPERTIES.MENU_STATS)};game.hud.Menu.prototype.selectedDelivery=function(){return this.deliveries[this.scenerySelector.index][this.vehicleSelector.index]};
game.hud.Menu.prototype.selectedDeliveryTarget=function(){return this.deliveryTarget(this.scenerySelector.index,this.vehicleSelector.index)};game.hud.Menu.prototype.deliveryTarget=function(a,b){b=game.hud.Menu.DELIVERY_TARGETS[a][b];a=this.sceneryTunings[a];for(var c=game.hud.Menu.BASE_MULTIPLIER*b.cost,d=0;d<a.length;d++)c*=a[d].multiplierOf(b.tunings[d]);return Math.floor(c*game.hud.Menu.DELIVERY_TARGET_PERCENTAGE/game.hud.Menu.DELIVERY_TARGET_ROUNDING)*game.hud.Menu.DELIVERY_TARGET_ROUNDING};
game.hud.Menu.prototype.updateDelivery=function(a){const b=this.selectedDelivery();a>b.get()&&(b.set(a),this.updateCompletedTutorial())};
game.hud.Menu.prototype.updateDeliveryGraphics=function(){const a=this.selectedDelivery().get(),b=this.selectedDeliveryTarget();this.deliveryBundle.release();this.deliveryBundle.addAll(this.rightGraphics,[new physics.rendering.graphics.Properties(this.rendering(),game.Engine.FONT_PROPERTIES.MENU_STATS),(a>=b?this.locator.view.engine.newPulseTextGraphic:this.locator.view.engine.newTextGraphic).call(this.locator.view.engine,game.hud.Menu.DELIVERY_ORIGIN,game.hud.Menu.deliveryText.bind(null,a,b)),physics.rendering.graphics.Image.fromOrigin(this.rendering(),
resources.hud.cargo.tracker(),game.hud.Menu.DELIVERY_ICON_ORIGIN).addRelative(physics.rendering.graphics.Image.CENTER)])};game.hud.Menu.prototype.measureDeliveryText=function(){return this.locator.view.engine.measureWidth(game.hud.Menu.deliveryText(this.selectedDelivery().get(),this.selectedDeliveryTarget()),game.Engine.FONT_PROPERTIES.MENU_STATS)};
game.hud.Menu.prototype.addMultiplierGraphics=function(){physics.collections.addAll(this.rightGraphics,[new physics.rendering.graphics.Properties(this.rendering(),game.Engine.FONT_PROPERTIES.MENU_STATS),this.locator.view.engine.newTextGraphic(game.hud.Menu.MULTIPLIER_ORIGIN,this.multiplierText.bind(this)),physics.rendering.graphics.Image.fromOrigin(this.rendering(),resources.hud.multiplier(),game.hud.Menu.MULTIPLIER_ICON_ORIGIN).addRelative(physics.rendering.graphics.Image.CENTER)])};
game.hud.Menu.prototype.multiplierText=function(){return this.loader.credits.multiplier.toFixed(1)};game.hud.Menu.prototype.measureMultiplierText=function(){return this.locator.view.engine.measureWidth(this.multiplierText(),game.Engine.FONT_PROPERTIES.MENU_STATS)};game.hud.Menu.prototype.hasCost=function(){return 0<this.submenuData.cost};
game.hud.Menu.prototype.addCostGraphic=function(){this.costBundle||(this.costBundle=(new physics.collections.Bundle).addAll(this.rightGraphics,[new physics.rendering.graphics.Properties(this.rendering(),game.Engine.FONT_PROPERTIES.MENU_STATS),this.locator.view.engine.newPulseTextGraphic(game.hud.Menu.COST_ORIGIN,this.costText.bind(this)),physics.rendering.graphics.Image.fromOrigin(this.rendering(),resources.hud.lock.closed(),game.hud.Menu.COST_ICON_ORIGIN).addRelative(physics.rendering.graphics.Image.CENTER)]))};
game.hud.Menu.prototype.removeCostGraphic=function(){this.costBundle&&(this.costBundle.release(),delete this.costBundle)};game.hud.Menu.prototype.costText=function(){return-this.submenuData.cost};game.hud.Menu.prototype.measureCostText=function(){return this.locator.view.engine.measureWidth(this.costText(),game.Engine.FONT_PROPERTIES.MENU_STATS)};game.hud.Menu.prototype.selectedSubmenu=function(){return this.submenuPath[this.submenuPath.length-1]};
game.hud.Menu.prototype.update=function(){this.submenuData=this.selectedSubmenu().data();this.submenuOrigins=[game.hud.Menu.SUBMENU_ORIGIN];this.submenuBundle.release();this.submenuBundle.addAll(this.leftGraphics,[].concat(new physics.rendering.graphics.Properties(this.rendering(),game.Engine.FONT_PROPERTIES.MENU_PATH),this.submenuPath.map(function(a,b){const c=this.submenuOrigins[b];a="\x3e  "+a.data().text+"  ";b=b+1==this.submenuPath.length?this.locator.view.engine.newPulseTextGraphic(c,physics.rendering.text.constant(a)):
this.locator.view.engine.newTextGraphic(c,physics.rendering.text.constant(a));this.submenuOrigins.push(c.add(new physics.dynamics.Vector(this.locator.view.engine.measureWidth(a,game.Engine.FONT_PROPERTIES.MENU_PATH),0)));return b}.bind(this))));this.updateUnlockedGraphics();this.updateDeliveryGraphics();this.loader.credits.multiplier=this.selectedTunings().map(function(a){return a.multiplier()}).reduce(physics.utility.multiply,game.hud.Menu.BASE_MULTIPLIER);this.hasCost()?this.addCostGraphic():this.removeCostGraphic();
this.graphicsBundle&&this.openTutorial()};game.hud.Menu.prototype.unlockable=function(){return this.submenuData.cost<=Math.max(this.loader.credits.property.get(),0)};game.hud.Menu.prototype.unlock=function(){0<this.submenuData.cost&&(this.locator.view.engine.fireAudio(resources.hud.buttons.unlock),this.loader.credits.addAmount(-this.submenuData.cost),this.loader.tutorial.confirm(game.hud.TutorialBox.COST(this)),this.selectedSubmenu().unlock(),this.update())};game.hud.Menu.prototype.canIncrement=function(){return this.selectedSubmenu().canIncrement()};
game.hud.Menu.prototype.canDecrement=function(){return this.selectedSubmenu().canDecrement()};game.hud.Menu.prototype.increment=function(){const a=this.selectedSubmenu();a.canIncrement()?(a.increment(),this.update()):console.warn("Cannot increment submenu",a)};game.hud.Menu.prototype.decrement=function(){const a=this.selectedSubmenu();a.canDecrement()?(a.decrement(),this.update()):console.warn("Cannot decrement submenu",a)};
game.hud.Menu.prototype.next=function(){this.isLeaf()?console.warn("Cannot descent from leaf",menu):(this.submenuPath.push(this.submenuData.child),this.update())};game.hud.Menu.prototype.previous=function(){this.isRoot()?console.warn("Cannot ascent from root",menu):(this.submenuPath.pop(),this.update())};game.hud.Menu.prototype.isRoot=function(){return 1==this.submenuPath.length};game.hud.Menu.prototype.isLeaf=function(){return!this.submenuData.child};game.hud.Menu.prototype.selectedVehicle=function(){return game.hud.Menu.VEHICLES[this.vehicleSelector.index]};
game.hud.Menu.prototype.selectedVehicleTunings=function(){return this.vehicleTunings[this.vehicleSelector.index]};game.hud.Menu.prototype.resetVehicle=function(){this.loader.clear();this.obstacles.clear();this.vehicleBuilder.release();this.updateVehicleSetup();this.selectedVehicle().build(this.vehicleBuilder);this.loader.matchers.updateFrictions()};game.hud.Menu.prototype.updateVehicleSetup=function(){this.selectedVehicleTunings().forEach(function(a){a.apply(this.vehicleBuilder.setup)}.bind(this))};
game.hud.Menu.prototype.updateVehicleSetupSingle=function(a){a.apply(this.vehicleBuilder.setup);this.vehicleBuilder.update()};game.hud.Menu.prototype.selectedScenery=function(){return game.hud.Menu.SCENERIES[this.scenerySelector.index]};game.hud.Menu.prototype.selectedSceneryTunings=function(){return this.sceneryTunings[this.scenerySelector.index]};
game.hud.Menu.prototype.resetScenery=function(){this.sceneryBuilder.release();this.updateScenerySetup();this.selectedScenery().build(this.sceneryBuilder);this.loader.resetCargo();this.resetVehicle()};game.hud.Menu.prototype.updateScenerySetup=function(){this.selectedSceneryTunings().forEach(function(a){a.apply(this.sceneryBuilder.setup)}.bind(this))};game.hud.Menu.prototype.selectedTunings=function(){return this.selectedVehicleTunings().concat(this.selectedSceneryTunings())};
game.hud.Menu.prototype.attach=function(){var a=null;window.addEventListener("keydown",function(b){if("F10"===b.code){if(a)delete this.obstacles.listener,a.release(),a=null,this.locator.view.engine.removeDebugging();else{const c={single:0,multiple:0};this.obstacles.listener=function(d){c[1<d.length?"multiple":"single"]++};a=this.addDebugging(c);this.locator.view.engine.addDebugging()}b.preventDefault()}}.bind(this))};game.hud.Flash.LOCKED_FILL_STYLE=game.Engine.COLORS.RED;
game.hud.Flash.RESET_FILL_STYLE=game.Engine.COLORS.WHITE;
game.hud.Flash.prototype.trigger=function(a){const b=(new physics.collections.Bundle).add(this.engine.particles,this.animation).addAll(this.engine.actors,[this.timer.reverseActor(function(){b.release()}),physics.actors.animation.Transition.zeroPi(this.timer,this.animation).actor()]).add(this.engine.graphics,new physics.rendering.graphics.Alpha(this.engine.rendering,this.engine.newBackgroundFiller(a),this.animation,physics.rendering.mappers.waveZeroMax(.5)));this.timer.elapse();this.animation.reset(physics.dynamics.Motion.fromPosition(physics.dynamics.Transformation.PI));
this.bundle.release();this.bundle=b};
game.hud.Flash.prototype.doWaiting=function(a){this.trigger(game.hud.Flash.RESET_FILL_STYLE);const b=(new physics.collections.Bundle).add(this.engine.graphics,new physics.rendering.graphics.Fitted(this.engine.rendering,physics.rendering.graphics.Image.fromOrigin(this.engine.rendering,resources.hud.hourglass(),game.View.REF_SIZE.divide(2)).addRelative(physics.rendering.graphics.Image.CENTER),game.View.REF_SIZE,physics.rendering.graphics.Fitted.CENTER));this.engine.preUpdateQueue.push(function(){b.release();a()})};
game.hud.Property.PREFIX_PATH=["bouncy","drive"];game.hud.Property.string=function(a,b,c){return new game.hud.Property(a,function(d){d=d.toString();if(b(d))return d},function(d){if(b(d))return d},c)};game.hud.Property.boolean=function(a,b){return new game.hud.Property(a,function(c){if(!1===c)return"false";if(!0===c)return"true"},function(c){if("false"===c)return!1;if("true"===c)return!0},b)};
game.hud.Property.integer=function(a,b,c){return new game.hud.Property(a,function(d){const e=parseInt(d,10);if(e===d&&b(e))return e.toString()},function(d){d=parseInt(d,10);if(!isNaN(d)&&b(d))return d},c)};game.hud.Property.integerRange=function(a,b,c,d){return game.hud.Property.integer(a,function(e){return e>=b&&e<=c},d)};game.hud.Property.joinPath=function(a){return a.join("-")};game.hud.Property.prototype.key=function(){return game.hud.Property.joinPath(game.hud.Property.PREFIX_PATH.concat(this.path))};
game.hud.Property.prototype.get=function(){if(!this.hasOwnProperty("value")){const a=window.localStorage.getItem(this.key());if(null==a)this.value=this.original;else{const b=this.deserializer(a);null==b?(this.value=this.original,console.warn("Trying to restore invalid value",a)):this.value=b;this.value==this.original&&window.localStorage.removeItem(this.key())}}return this.value};
game.hud.Property.prototype.set=function(a){const b=this.serializer(a);null==b?console.warn("Trying to store invalid value",a):(this.value=a,a===this.original?window.localStorage.removeItem(this.key()):window.localStorage.setItem(this.key(),b))};game.hud.Property.prototype.isValid=function(a){return null!=this.serializer(a)};
game.hud.Selector.fromType=function(a,b,c,d){c.forEach(function(e,f){e.property=game.hud.Property.boolean([a,"unlocked",e.name],0==f)});return new game.hud.Selector(b,c,game.hud.Property.string([a,"selected"],function(e){e=game.hud.Selector.find(c,e);return null!=e&&c[e].property.get()},c[0].name),d)};game.hud.Selector.find=function(a,b){for(var c=0;c<a.length;c++)if(a[c].name==b)return c};game.hud.Selector.prototype.countUnlocked=function(){return this.list.filter(function(a){return a.property.get()}).length};
game.hud.Selector.prototype.toNamedSubmenu=function(){return{name:this.label,submenu:this.toSubmenu()}};
game.hud.Selector.prototype.toSubmenu=function(){return new game.hud.Submenu(function(){return{text:this.index+1+"/"+this.list.length,child:this.list[this.index].submenu,cost:this.property.isValid(this.list[this.index].name)?0:this.list[this.index].cost}}.bind(this),function(){return!0},function(){return!0},function(){this.index=physics.utility.modPositive(this.index+1,this.list.length);this.property.isValid(this.list[this.index].name)&&this.property.set(this.list[this.index].name);this.listener()}.bind(this),
function(){this.index=physics.utility.modPositive(this.index-1,this.list.length);this.property.isValid(this.list[this.index].name)&&this.property.set(this.list[this.index].name);this.listener()}.bind(this),function(){this.list[this.index].property.set(!0);this.property.set(this.list[this.index].name)}.bind(this))};game.hud.Tuning.COST_LADDER_FAST=[100,250,500,750,1E3,2500,5E3,7500,1E4,25E3,5E4,75E3,1E5];game.hud.Tuning.COST_LADDER_SLOW=[100,200,400,600,800,1E3,2E3,4E3,6E3,8E3,1E4,2E4,4E4,6E4,8E4];
game.hud.Tuning.fromType=function(a,b,c,d,e,f,g,h,l,k){e+l>h.length&&console.warn("Cost ladder out of bounds",a,b,c,h,l);const m=game.hud.Property.integerRange([].concat(a,"setup",b,c,"unlocked"),0,e,0);return new game.hud.Tuning(d,c,e,f,g,game.hud.Property.integer([].concat(a,"setup",b,c,"selected"),function(n){return Math.abs(n)<=m.get()},0),m,function(n){return h[n+l-1]},k)};game.hud.Tuning.prototype.minValue=function(){return this.allowNegative?-this.maxValue:0};
game.hud.Tuning.prototype.multiplierOf=function(a){return Math.pow(this.maxMultiplier,a/this.maxValue)};game.hud.Tuning.prototype.multiplier=function(){return this.multiplierOf(Math.abs(this.value))};game.hud.Tuning.prototype.apply=function(a){a[this.name]=this.value};game.hud.Tuning.prototype.cost=function(){for(var a=0,b=this.lockedProperty.get();b<Math.abs(this.value);b++)a+=this.costEvaluator(b+1);return a};
game.hud.Tuning.prototype.unlock=function(){this.lockedProperty.set(Math.abs(this.value));this.valueProperty.set(this.value)};game.hud.Tuning.prototype.upgradable=function(){return this.lockedProperty.get()<this.maxValue&&Math.abs(this.value)==this.lockedProperty.get()};game.hud.Tuning.prototype.upgradeValue=function(){return this.lockedProperty.get()+1};game.hud.Tuning.prototype.upgradeSign=function(){return 0>this.value?-1:1};game.hud.Tuning.prototype.upgradeCost=function(){return this.costEvaluator(this.upgradeValue())};
game.hud.Tuning.prototype.upgrade=function(){this.value=this.upgradeSign()*this.upgradeValue();this.unlock()};game.hud.Tuning.prototype.toNamedSubmenu=function(){return{name:this.label,submenu:this.toSubmenu()}};
game.hud.Tuning.prototype.toSubmenu=function(){return new game.hud.Submenu(function(){return{text:(this.allowNegative&&0<this.value?"+":"")+this.value+"/"+(this.allowNegative?"±":"")+this.lockedProperty.get()+"/"+(this.allowNegative?"±":"")+this.maxValue,cost:this.cost(),tutorial:game.hud.TutorialBox.TUNING}}.bind(this),function(){return this.value<this.maxValue}.bind(this),function(){return this.value>this.minValue()}.bind(this),function(){this.value++;this.valueProperty.isValid(this.value)&&this.valueProperty.set(this.value);
this.listener()}.bind(this),function(){this.value--;this.valueProperty.isValid(this.value)&&this.valueProperty.set(this.value);this.listener()}.bind(this),this.unlock.bind(this))};game.hud.Submenu.typeSelection=function(a){var b=0;return new game.hud.Submenu(function(){return{text:a[b].name,child:a[b].submenu,cost:0}},function(){return!0},function(){return!0},function(){++b==a.length&&(b=0)},function(){0==b--&&(b=a.length-1)},function(){})};
game.hud.Upgrader.prototype.addGraphics=function(){this.button&&this.button.release();this.button=new game.hud.Button(this.menu.locator.view.engine,this.filters,this.wrapControlSurface(this.menu.locator.view.engine.newFittedControlSurface(this.menu.locator.view.engine.newControlSurface(resources.hud.buttons.game.upgrade,new physics.dynamics.Vector(-game.hud.Button.MARGIN.min.x,256),physics.dynamics.Vector.ZERO,new physics.dynamics.Rectangle(new physics.dynamics.Vector(game.hud.Button.MARGIN.min.x,
0),game.hud.Button.MARGIN.max),this.menu.loader.keyboardControls,resources.hud.keys.shift,physics.dynamics.Vector.ZERO,new physics.dynamics.Vector(-.5,-1),new physics.dynamics.Vector(1,1)),physics.rendering.graphics.Fitted.UPPER_LEFT)),function(a){this.listener();this.menu.loader.credits.addAmount(-this.tuning.upgradeCost());this.menu.loader.tutorial.confirm(game.hud.TutorialBox.UPGRADE);this.tuning.upgrade();this.menu.update();this.update();this.menu.flash.doWaiting(function(){this.menu.resetScenery();
this.menu.locator.view.engine.fireAudio(resources.hud.buttons.unlock)}.bind(this));return[]}.bind(this),["ShiftLeft","ShiftRight"]);this.menu.loader.tutorial.open(game.hud.TutorialBox.UPGRADE)};
game.hud.Upgrader.prototype.wrapControlSurface=function(a){return{graphic:new physics.rendering.graphics.Separator(a.graphic,physics.rendering.graphics.Container.fixed([a.graphic,new physics.rendering.graphics.Properties(this.menu.rendering(),game.Engine.FONT_PROPERTIES.MENU_STATS),new physics.rendering.graphics.Properties(this.menu.rendering(),{textAlign:"left"}),new physics.rendering.graphics.Fitted(this.menu.rendering(),this.menu.locator.view.engine.newPulseTextGraphic(new physics.dynamics.Vector(256,
336),function(b){return b}.bind(null,this.tuning.label+": "+this.tuning.upgradeSign()*this.tuning.upgradeValue()+"/"+this.tuning.upgradeSign()*this.tuning.maxValue+" ("+-this.tuning.upgradeCost()+")")),game.View.REF_SIZE,physics.rendering.graphics.Fitted.UPPER_LEFT)])),bundle:a.bundle}};game.hud.Upgrader.prototype.removeGraphics=function(){this.button&&(this.button.release(),delete this.button);this.menu.loader.tutorial.close(game.hud.TutorialBox.UPGRADE)};
game.hud.Upgrader.prototype.update=function(){this.tuning=null;this.menu.selectedTunings().forEach(function(a){a.upgradable()&&(!this.tuning||a.upgradeCost()<this.tuning.upgradeCost())&&(this.tuning=a)}.bind(this));this.tuning&&this.tuning.upgradeCost()>this.menu.loader.credits.property.get()&&(this.tuning=null);this.tuning?this.addGraphics():this.removeGraphics()};
game.hud.CargoTracker.prototype.addGraphics=function(){this.bundle.release();this.bundle.add(this.menu.locator.view.engine.graphics,new physics.rendering.graphics.Fitted(this.menu.rendering(),physics.rendering.graphics.Container.fixed([new physics.rendering.graphics.Properties(this.menu.rendering(),game.Engine.FONT_PROPERTIES.MENU_STATS),new physics.rendering.graphics.Properties(this.menu.rendering(),{textAlign:"right"}),(this.improving?this.menu.locator.view.engine.newPulseTextGraphic:this.menu.locator.view.engine.newTextGraphic).call(this.menu.locator.view.engine,
game.hud.Menu.DELIVERY_ORIGIN,function(){return this.delivery+"/"+(this.reward+this.delivery)}.bind(this)),physics.rendering.graphics.Image.fromOrigin(this.menu.rendering(),resources.hud.cargo.tracker(),game.hud.Menu.DELIVERY_ICON_ORIGIN).addRelative(physics.rendering.graphics.Image.CENTER)]),game.View.REF_SIZE,physics.rendering.graphics.Fitted.UPPER_RIGHT));this.menu.loader.tutorial.open(game.hud.TutorialBox.CARGO);0==this.reward&&this.menu.loader.tutorial.open(game.hud.TutorialBox.RESTART)};
game.hud.CargoTracker.prototype.removeGraphics=function(){this.bundle.release();this.menu.loader.tutorial.close(game.hud.TutorialBox.CARGO);this.menu.loader.tutorial.close(game.hud.TutorialBox.RESTART)};game.hud.CargoTracker.prototype.reset=function(){this.reward=0;this.improving=!1;this.resetDelivery();this.removeGraphics()};game.hud.CargoTracker.prototype.resetDelivery=function(){this.delivery=0};
game.hud.CargoTracker.prototype.refresh=function(){const a=this.isImproving();!this.improving&&a&&this.menu.locator.view.engine.fireAudio(resources.hud.buttons.unlock);this.improving=a;0<this.reward||0<this.delivery?this.addGraphics():this.removeGraphics();this.menu.updateDelivery(this.delivery)};game.hud.CargoTracker.prototype.confirmRestartTutorial=function(){0<this.delivery&&0==this.reward&&this.menu.loader.tutorial.confirm(game.hud.TutorialBox.RESTART)};
game.hud.CargoTracker.prototype.addReward=function(a){this.reward+=a};game.hud.CargoTracker.prototype.addDelivery=function(a){this.delivery+=a};game.hud.CargoTracker.prototype.isImproving=function(){return this.delivery>=Math.max(this.menu.selectedDelivery().get()+1,this.menu.selectedDeliveryTarget())};game.hud.Credits.MAX_AMOUNT=999999;game.hud.Credits.MIN_AMOUNT=-999;game.hud.Credits.TEXT_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x-256,128);
game.hud.Credits.COIN_ORIGINS=[new physics.dynamics.Vector(game.View.REF_SIZE.x-96,160),new physics.dynamics.Vector(game.View.REF_SIZE.x-160,128),new physics.dynamics.Vector(game.View.REF_SIZE.x-128,80)];game.hud.Credits.GROUND_ELASTICITY=new physics.interaction.Elasticity(.001,.02);game.hud.Credits.LINK_ELASTICITY=new physics.interaction.Elasticity(.005,.005);
game.hud.Credits.prototype.newParticle=function(a){return new physics.dynamics.Particle(physics.dynamics.Motion.fromPosition(physics.dynamics.Transformation.fromTranslation(a)),physics.dynamics.Mass.fromInverse(1))};
game.hud.Credits.prototype.addGraphics=function(){this.engine.graphics.add(new physics.rendering.graphics.Fitted(this.engine.rendering,physics.rendering.graphics.Container.fixed([new physics.rendering.graphics.Properties(this.engine.rendering,game.Engine.FONT_PROPERTIES.CREDITS),physics.rendering.graphics.Container.variable(this.outlines),physics.rendering.graphics.Container.variable(this.graphics)]),game.View.REF_SIZE,physics.rendering.graphics.Fitted.UPPER_RIGHT))};
game.hud.Credits.prototype.addAmount=function(a){this.property.set(physics.utility.clamp(this.property.get()+a,game.hud.Credits.MIN_AMOUNT,game.hud.Credits.MAX_AMOUNT));this.updateDigits();this.digits[this.digits.length-1].bump(-1E3*Math.sign(a))};game.hud.Credits.prototype.newCoins=function(){const a=game.hud.Credits.COIN_ORIGINS.map(function(c){return new game.hud.Coin(this,c)}.bind(this));for(var b=1;b<a.length;b++)a[b-1].link(a[b]);return a};
game.hud.Credits.prototype.updateDigits=function(){const a=this.property.get().toString();var b=this.digits.length;const c=a.length;for(var d=Math.min(b,c),e=game.hud.Credits.TEXT_ORIGIN.x,f=0;f<d;f++){const g=a[a.length-f-1],h=this.engine.measureWidth(g,game.Engine.FONT_PROPERTIES.CREDITS);this.digits[f].character=g;this.digits[f].groundX(e-h/2);e-=h}for(f=b;f<c;f++)d=a[a.length-f-1],b=this.engine.measureWidth(d,game.Engine.FONT_PROPERTIES.CREDITS),d=new game.hud.Digit(this,d,new physics.dynamics.Vector(e-
b/2,game.hud.Credits.TEXT_ORIGIN.y)),d.link(0<f?this.digits[f-1]:this.coins[0]),this.digits.push(d),e-=b;this.digits.splice(c).forEach(function(g){g.release()})};game.hud.Credits.prototype.groundX=function(a,b){return(new physics.collections.Bundle).add(this.engine.actors,physics.actors.projection(physics.interaction.Rail.stationary(physics.interaction.Axis.throughX(b)),physics.interaction.Fixture.centroid(a),physics.interaction.handlers.elasticity(game.hud.Credits.GROUND_ELASTICITY)))};
game.hud.Credits.prototype.groundY=function(a,b){return(new physics.collections.Bundle).add(this.engine.actors,physics.actors.projection(physics.interaction.Rail.stationary(physics.interaction.Axis.throughY(b)),physics.interaction.Fixture.centroid(a),physics.interaction.handlers.elasticity(game.hud.Credits.GROUND_ELASTICITY)))};
game.hud.Credits.prototype.link=function(a,b,c){return(new physics.collections.Bundle).add(this.engine.actors,physics.actors.projection(new physics.interaction.Rail(a,physics.interaction.Axis.Y_0),physics.interaction.Fixture.centroid(b),physics.interaction.handlers.center(physics.interaction.handlers.elasticity(game.hud.Credits.LINK_ELASTICITY),c)))};game.hud.Coin.prototype.addParticle=function(){this.credits.engine.particles.add(this.particle)};
game.hud.Coin.prototype.addGraphics=function(){this.credits.outlines.add(physics.rendering.graphics.Transformator.identity(this.credits.engine.rendering,physics.rendering.graphics.Image.fromOrigin(this.credits.engine.rendering,resources.hud.credits.outline(),physics.dynamics.Vector.ZERO).addRelative(physics.rendering.graphics.Image.CENTER),this.particle));this.credits.graphics.add(physics.rendering.graphics.Transformator.identity(this.credits.engine.rendering,physics.rendering.graphics.Image.fromOrigin(this.credits.engine.rendering,
resources.hud.credits.coin(),physics.dynamics.Vector.ZERO).addRelative(physics.rendering.graphics.Image.CENTER),this.particle))};game.hud.Coin.prototype.groundY=function(a){this.credits.groundY(this.particle,a)};game.hud.Coin.prototype.link=function(a){this.credits.link(this.particle,a.particle,a.origin-this.origin)};
game.hud.Digit.prototype.addBundle=function(){this.bundle.add(this.credits.engine.particles,this.particle).add(this.credits.outlines,this.newGraphic(physics.rendering.graphics.text.Stroker)).add(this.credits.graphics,this.newGraphic(physics.rendering.graphics.text.Filler))};
game.hud.Digit.prototype.newGraphic=function(a){return physics.rendering.graphics.Transformator.identity(this.credits.engine.rendering,new a(this.credits.engine.rendering,physics.dynamics.Vector.ZERO,function(){return this.character}.bind(this)),this.particle)};
game.hud.Digit.prototype.bump=function(a){const b=(new physics.collections.Bundle).add(this.credits.engine.actors,function(c){b.release();return[new physics.interaction.Action(this.particle,physics.dynamics.Transformation.fromTranslation(new physics.dynamics.Vector(0,a)).divide(c))]}.bind(this))};game.hud.Digit.prototype.groundX=function(a){this.bundleX.release();this.bundleX=this.credits.groundX(this.particle,a)};
game.hud.Digit.prototype.groundY=function(a){this.bundle.addBundle(this.credits.groundY(this.particle,a))};game.hud.Digit.prototype.link=function(a){this.bundle.addBundle(this.credits.link(this.particle,a.particle,a.origin-this.origin))};game.hud.Digit.prototype.release=function(){this.bundleX.release();this.bundle.release()};game.hud.Locator.ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x/2,160);game.hud.Locator.RANGE=game.utility.Range.symmetric(250);
game.hud.Locator.prototype.addTrack=function(){this.graphics.add(physics.rendering.graphics.Image.fromOrigin(this.view.engine.rendering,resources.hud.locator.track(),game.hud.Locator.ORIGIN).addRelative(physics.rendering.graphics.Image.CENTER))};
game.hud.Locator.prototype.addPointer=function(a){return(new physics.collections.Bundle).add(this.graphics,physics.rendering.graphics.Translator.fixture(this.view.engine.rendering,physics.rendering.graphics.Image.fromOrigin(this.view.engine.rendering,resources.hud.locator.pointer(),game.hud.Locator.ORIGIN).addRelative(new physics.dynamics.Vector(-.5,-117/122)),a,function(b){return new physics.dynamics.Vector(game.hud.Locator.RANGE.interpolate(game.utility.Range.ONE.clamp(this.ranges.values().map(function(c){return c.alpha(b.x)}).reduce(physics.utility.add,
0))),0)}.bind(this)))};game.hud.Locator.prototype.addGraphics=function(){this.view.engine.graphics.add(new physics.rendering.graphics.Fitted(this.view.engine.rendering,physics.rendering.graphics.Container.variable(this.graphics),game.View.REF_SIZE,physics.rendering.graphics.Fitted.UPPER_CENTER))};game.hud.Locator.prototype.origin=function(){const a=this.origins.values();return a.reduce(physics.utility.addMethod,physics.dynamics.Vector.ZERO).divide(a.length)};game.hud.Locator.prototype.follow=function(a){return(new physics.collections.Bundle).addBundle(this.addPointer(a)).addBundle(this.view.follow(a))};
game.hud.Button.MARGIN=physics.dynamics.Rectangle.symmetric(physics.dynamics.Vector.fromOne(48));game.hud.Button.prototype.newButton=function(a){return new physics.actors.input.Button(physics.actors.constant([]),physics.actors.constant([]),a)};
game.hud.Button.prototype.newHandler=function(a,b){return new physics.actors.input.handlers.Merger([].concat(b.map(function(c){return new physics.actors.input.handlers.pressers.KeyPresser(this.button,c)}.bind(this)),new physics.actors.input.handlers.pressers.MousePresser(this.button,a,0),new physics.actors.input.handlers.pressers.TouchPresser(this.button,a,game.Engine.TAP_DISTANCE,game.Engine.TAP_DURATION)))};
game.hud.Button.prototype.add=function(a){this.registrator.register();this.bundle.addAll(this.engine.actors,[this.handler.actor(),this.button.actor()]).add(this.engine.graphics,a)};game.hud.Button.prototype.release=function(){this.registrator.unregister();this.bundle.release();this.button.reset()};game.hud.Pedal.ELASTICITY=new physics.interaction.Elasticity(.05,1);game.hud.Pedal.MARGIN=physics.dynamics.Rectangle.symmetric(physics.dynamics.Vector.fromOne(128));
game.hud.Pedal.prototype.newGraphic=function(a,b){return new physics.rendering.graphics.Fitted(this.engine.rendering,physics.rendering.graphics.Transformator.identity(this.engine.rendering,a,this.particle),game.View.REF_SIZE,b)};game.hud.Pedal.prototype.newButton=function(a,b){return new physics.actors.input.Button(function(c){this.link(32);a.target+=b-this.shift;this.shift=b;return[]}.bind(this),function(c){this.link(0);this.stop();return[]}.bind(this),physics.actors.constant([]))};
game.hud.Pedal.prototype.newHandler=function(a){return new physics.actors.input.handlers.Merger([].concat(a.map(function(b){return new physics.actors.input.handlers.pressers.KeyPresser(this.button,b)}.bind(this)),new physics.actors.input.handlers.pressers.MousePresser(this.button,physics.actors.input.filters.bounds(this.graphic),0),new physics.actors.input.handlers.pressers.TouchPresser(this.button,physics.actors.input.filters.bounds(this.graphic),game.Engine.TAP_DISTANCE,game.Engine.TAP_DURATION)))};
game.hud.Pedal.prototype.stop=function(){this.motor.target-=this.shift;this.shift=0};game.hud.Pedal.prototype.link=function(a){this.linkBundle.release();this.linkBundle.add(this.engine.actors,physics.actors.projection(physics.interaction.Rail.stationary(physics.interaction.Axis.throughY(a)),physics.interaction.Fixture.centroid(this.particle),physics.interaction.handlers.elasticity(game.hud.Pedal.ELASTICITY)))};
game.hud.Pedal.prototype.add=function(){this.registrator.register();this.bundle.add(this.engine.particles,this.particle).addAll(this.engine.actors,[this.handler.actor(),this.button.actor()]).add(this.engine.graphics,this.graphic).addBundle(this.linkBundle)};game.hud.Pedal.prototype.release=function(){this.registrator.unregister();this.bundle.release();this.stop()};game.hud.KeyboardControls.ACTIVATION_EVENTS=["keydown","keypress","keyup"];game.hud.KeyboardControls.DEACTIVATION_EVENTS="click mousedown mouseup touchstart touchmove touchend".split(" ");
game.hud.KeyboardControls.addGraphic=function(a){a.bundle.add(a.collection,a.graphic)};game.hud.KeyboardControls.attach=function(a,b){a.forEach(function(c){window.addEventListener(c,b)})};game.hud.KeyboardControls.detach=function(a,b){a.forEach(function(c){window.removeEventListener(c,b)})};game.hud.KeyboardControls.prototype.attachActivation=function(){game.hud.KeyboardControls.attach(game.hud.KeyboardControls.ACTIVATION_EVENTS,this.activationListener)};
game.hud.KeyboardControls.prototype.detachActivation=function(){game.hud.KeyboardControls.detach(game.hud.KeyboardControls.ACTIVATION_EVENTS,this.activationListener)};game.hud.KeyboardControls.prototype.attachDeactivation=function(){game.hud.KeyboardControls.attach(game.hud.KeyboardControls.DEACTIVATION_EVENTS,this.deactivationListener)};game.hud.KeyboardControls.prototype.detachDeactivation=function(){game.hud.KeyboardControls.detach(game.hud.KeyboardControls.DEACTIVATION_EVENTS,this.deactivationListener)};
game.hud.KeyboardControls.prototype.runActivate=function(){return this.cancelable.run(function(a,b){a.add(this.engine.particles,this.animation).addAll(this.engine.actors,[this.timer.elapsedActor(b),physics.actors.animation.Transition.zeroPi(this.timer,this.animation).actor()])}.bind(this),function(){})};game.hud.KeyboardControls.prototype.activate=function(){this.active||(this.active=!0,this.detachActivation(),this.attachDeactivation(),this.runActivate()||this.collection.values().forEach(game.hud.KeyboardControls.addGraphic))};
game.hud.KeyboardControls.prototype.deactivate=function(){this.active&&(this.active=!1,this.detachDeactivation(),this.attachActivation(),this.cancelable.run(function(a,b){a.add(this.engine.particles,this.animation).addAll(this.engine.actors,[this.timer.reverseActor(b),physics.actors.animation.Transition.zeroPi(this.timer,this.animation).actor()])}.bind(this),function(){this.collection.values().forEach(function(a){a.bundle.release()})}.bind(this)))};
game.hud.KeyboardControls.prototype.add=function(a,b){a={graphic:new physics.rendering.graphics.Alpha(this.engine.rendering,a,this.animation,physics.rendering.mappers.WAVE_01),collection:b,bundle:new physics.collections.Bundle};this.active&&game.hud.KeyboardControls.addGraphic(a);return(new physics.collections.Bundle).add(this.collection,a).addBundle(a.bundle)};game.hud.Tutorial.prototype.find=function(a){for(var b=0;b<this.queue.length;b++)if(a.id==this.queue[b].id)return b};
game.hud.Tutorial.prototype.insert=function(a){for(var b=0;b<this.queue.length;b++){if(a.id==this.queue[b].id)return this.queue[b]=a,b==this.queue.length-1&&this.updateButton(a),!1;if(a.order<this.queue[b].order)return this.queue.splice(b,0,a),!0}this.queue.push(a);this.replaceButton(a);return!0};
game.hud.Tutorial.prototype.newButton=function(a){return new game.hud.Button(this.engine,this.filters,this.fadingFactory(this.engine.newFittedControlSurface(this.engine.newControlSurface(a.image,a.absolute,a.relative,a.margin,this.keyboardControls,resources.hud.keys.control,a.keysAbsolute,physics.rendering.graphics.Image.CENTER,physics.dynamics.Vector.ONE),a.alignment)),function(b){this.engine.fireAudio(resources.hud.tutorial.confirm);this.confirm(a);return[]}.bind(this),["ControlLeft","ControlRight"])};
game.hud.Tutorial.prototype.updateButton=function(a){this.button.release();this.button=this.newButton(a)};game.hud.Tutorial.prototype.replaceButton=function(a){this.fadingFactory=this.engine.newFadingControlSurfaceFactory(game.Engine.FADE_DURATION);this.button&&this.button.release();this.button=this.newButton(a)};game.hud.Tutorial.prototype.confirm=function(a){a.confirm();this.close(a)};game.hud.Tutorial.prototype.open=function(a){return!a.isConfirmed()&&this.insert(a)};
game.hud.Tutorial.prototype.close=function(a){a=this.find(a);null!=a&&(this.queue.splice(a,1),a==this.queue.length&&(0<a?this.replaceButton(this.queue[a-1]):(this.button.release(),delete this.button,delete this.fadingFactory)))};game.hud.TutorialBox.PROPERTIES={};game.hud.TutorialBox.BOTTOM_ORIGIN=new physics.dynamics.Vector(game.View.REF_SIZE.x/2,game.View.REF_SIZE.y-48);game.hud.TutorialBox.MENU_RIGHT_OFFSET=new physics.dynamics.Vector(24,0);
game.hud.TutorialBox.INTRO=new game.hud.TutorialBox("intro",0,resources.hud.tutorial.intro,game.hud.TutorialBox.BOTTOM_ORIGIN,new physics.dynamics.Vector(-.5,-1),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.LOWER_CENTER,physics.dynamics.Vector.ZERO);game.hud.TutorialBox.LOADING=new game.hud.TutorialBox("loading",1,resources.hud.tutorial.loading,game.hud.TutorialBox.BOTTOM_ORIGIN,new physics.dynamics.Vector(-.5,-1),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.LOWER_CENTER,physics.dynamics.Vector.ZERO);
game.hud.TutorialBox.CARGO=new game.hud.TutorialBox("cargo",2,resources.hud.tutorial.cargo,game.hud.Menu.DELIVERY_ORIGIN.add(new physics.dynamics.Vector(0,56)),new physics.dynamics.Vector(-1,0),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.UPPER_RIGHT,physics.dynamics.Vector.ZERO);
game.hud.TutorialBox.UPGRADE=new game.hud.TutorialBox("upgrade",4,resources.hud.tutorial.upgrade,new physics.dynamics.Vector(52,428),physics.dynamics.Vector.ZERO,game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.UPPER_LEFT,physics.dynamics.Vector.ZERO);game.hud.TutorialBox.RESTART=new game.hud.TutorialBox("restart",3,resources.hud.tutorial.restart,new physics.dynamics.Vector(308,220),physics.dynamics.Vector.ZERO,game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.UPPER_LEFT,physics.dynamics.Vector.ZERO);
game.hud.TutorialBox.DELIVERY=function(a){return new game.hud.TutorialBox("delivery",8,resources.hud.tutorial.delivery,game.hud.Menu.DELIVERY_ORIGIN.subtract(game.hud.TutorialBox.MENU_RIGHT_OFFSET).subtract(new physics.dynamics.Vector(a.measureDeliveryText(),0)),new physics.dynamics.Vector(-1,-.5),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.UPPER_RIGHT,new physics.dynamics.Vector(-25,0))};
game.hud.TutorialBox.MULTIPLIER=function(a){return new game.hud.TutorialBox("multiplier",7,resources.hud.tutorial.multiplier,game.hud.Menu.MULTIPLIER_ORIGIN.subtract(game.hud.TutorialBox.MENU_RIGHT_OFFSET).subtract(new physics.dynamics.Vector(a.measureMultiplierText(),0)),new physics.dynamics.Vector(-1,-.5),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.UPPER_RIGHT,new physics.dynamics.Vector(-25,0))};
game.hud.TutorialBox.COST=function(a){return new game.hud.TutorialBox("cost",9,resources.hud.tutorial.cost,game.hud.Menu.COST_ORIGIN.subtract(game.hud.TutorialBox.MENU_RIGHT_OFFSET).subtract(new physics.dynamics.Vector(a.measureCostText(),0)),new physics.dynamics.Vector(-1,-.5),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.UPPER_RIGHT,new physics.dynamics.Vector(-25,0))};
game.hud.TutorialBox.UNLOCKED=function(a){return new game.hud.TutorialBox("unlocked",6,resources.hud.tutorial.unlocked,game.hud.Menu.UNLOCKED_ORIGIN.add(new physics.dynamics.Vector(24+a.measureUnlockedText(),0)),new physics.dynamics.Vector(0,-.5),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.UPPER_LEFT,physics.dynamics.Vector.ZERO)};
game.hud.TutorialBox.TUNING=function(a){return new game.hud.TutorialBox("tuning",5,resources.hud.tutorial.tuning,a.submenuOrigins[a.submenuOrigins.length-2].add(a.submenuOrigins[a.submenuOrigins.length-1]).divide(2).add(new physics.dynamics.Vector(0,56)),new physics.dynamics.Vector(-.5,0),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.UPPER_LEFT,physics.dynamics.Vector.ZERO)};
game.hud.TutorialBox.COMPLETED=new game.hud.TutorialBox("completed",10,resources.hud.tutorial.completed,game.hud.TutorialBox.BOTTOM_ORIGIN,new physics.dynamics.Vector(-.5,-1),game.hud.Button.MARGIN,physics.rendering.graphics.Fitted.LOWER_CENTER,physics.dynamics.Vector.ZERO);game.hud.TutorialBox.property=function(a){game.hud.TutorialBox.PROPERTIES.hasOwnProperty(a)||(game.hud.TutorialBox.PROPERTIES[a]=game.hud.Property.boolean(["tutorial",a,"confirmed"],!1));return game.hud.TutorialBox.PROPERTIES[a]};
game.hud.TutorialBox.prototype.confirm=function(){game.hud.TutorialBox.property(this.id).set(!0)};game.hud.TutorialBox.prototype.isConfirmed=function(){return game.hud.TutorialBox.property(this.id).get()};game.graphics.BackgroundGraphic.prototype.render=function(){this.context.doScaled(this.context.size.y/this.height,this.graphic.render.bind(this.graphic))};
game.graphics.BackgroundOffset.prototype.render=function(){this.context.doTranslated((new physics.dynamics.Vector(this.height*this.context.size.x/this.context.size.y,this.height)).multiplyVector(this.alpha),this.graphic.render.bind(this.graphic))};game.graphics.ParallaxBackground.prototype.render=function(){this.camera.context.doTranslated(this.camera.position().translation.multiplyVector(this.multiplier).modPositive(this.size).negate(),this.graphic.render.bind(this.graphic))};
game.graphics.ParallaxImage.prototype.bounds=function(){return new physics.dynamics.Rectangle(new physics.dynamics.Vector(this.range.min,this.origin.y),new physics.dynamics.Vector(this.range.max,this.origin.y+this.image.height))};game.graphics.ParallaxImage.prototype.updating=function(){return!1};
game.graphics.ParallaxImage.prototype.render=function(){const a=new physics.dynamics.Vector(this.origin.x*(1-this.multiplier)+this.camera.position().translation.x*this.multiplier,this.origin.y);this.camera.context.doTranslated(a,this.renderTransformed.bind(this,this.range.min-a.x))};
game.graphics.ParallaxImage.prototype.renderTransformed=function(a){this.camera.context.context2d.beginPath();this.camera.context.context2d.rect(a,0,this.range.length(),this.image.height);this.camera.context.context2d.fillStyle=this.pattern;this.camera.context.context2d.fill()};
game.graphics.RepeatedGraphic.prototype.render=function(){var a=this.graphic.bounds();const b=Math.floor((this.size.x+this.size.y*this.context.size.x/this.context.size.y-a.min.x)/this.size.x);for(a=Math.ceil(-a.max.x/this.size.x);a<=b;a++)this.context.doTranslated(new physics.dynamics.Vector(a*this.size.x,0),this.graphic.render.bind(this.graphic))};
game.graphics.RepeatedImageX.prototype.render=function(){this.context.doTranslated(new physics.dynamics.Vector(0,this.size.y-this.image.height),function(){this.context.context2d.beginPath();this.context.context2d.rect(0,0,this.size.x+this.size.y*this.context.size.x/this.context.size.y,this.image.height);this.context.context2d.fillStyle=this.pattern;this.context.context2d.fill()}.bind(this))};
game.graphics.RepeatedImage.prototype.render=function(){const a=this.mapper(this.context.position(this.particle));this.context.doTranslated(a,function(){this.context.context2d.beginPath();this.context.context2d.rect(-a.x,-a.y,this.size.x+this.height*this.context.size.x/this.context.size.y,this.size.y+this.height);this.context.context2d.fillStyle=this.pattern;this.context.context2d.fill()}.bind(this))};
game.graphics.depths=game.graphics.depthsOf([["SCENERY","LOADING"],["SCENERY","UNDERGROUND"],["SCENERY","OVERGROUND"],["SCENERY","PLANTING"],["SCENERY","BOUND"],["VEHICLE","BACKGROUND"],["LOADER"],["OBSTACLE"],["CARGO"],["VEHICLE","FOREGROUND"],["EMITTER"]]);game.bootstrap.attach();